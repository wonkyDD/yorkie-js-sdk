(function(){const he=document.createElement("link").relList;if(he&&he.supports&&he.supports("modulepreload"))return;for(const re of document.querySelectorAll('link[rel="modulepreload"]'))pe(re);new MutationObserver(re=>{for(const h of re)if(h.type==="childList")for(const L of h.addedNodes)L.tagName==="LINK"&&L.rel==="modulepreload"&&pe(L)}).observe(document,{childList:!0,subtree:!0});function M(re){const h={};return re.integrity&&(h.integrity=re.integrity),re.referrerpolicy&&(h.referrerPolicy=re.referrerpolicy),re.crossorigin==="use-credentials"?h.credentials="include":re.crossorigin==="anonymous"?h.credentials="omit":h.credentials="same-origin",h}function pe(re){if(re.ep)return;re.ep=!0;const h=M(re);fetch(re.href,h)}})();var Rf=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Jf(H){return H&&H.__esModule&&Object.prototype.hasOwnProperty.call(H,"default")?H.default:H}var bs={exports:{}};(function(H,he){(function(M,pe){pe(he)})(Rf,function(M){var pe=Object.defineProperty,re=(n,e,t)=>e in n?pe(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,h=(n,e,t)=>(re(n,typeof e!="symbol"?e+"":e,t),t),L;(function(n){n[n.Canceled=1]="Canceled",n[n.Unknown=2]="Unknown",n[n.InvalidArgument=3]="InvalidArgument",n[n.DeadlineExceeded=4]="DeadlineExceeded",n[n.NotFound=5]="NotFound",n[n.AlreadyExists=6]="AlreadyExists",n[n.PermissionDenied=7]="PermissionDenied",n[n.ResourceExhausted=8]="ResourceExhausted",n[n.FailedPrecondition=9]="FailedPrecondition",n[n.Aborted=10]="Aborted",n[n.OutOfRange=11]="OutOfRange",n[n.Unimplemented=12]="Unimplemented",n[n.Internal=13]="Internal",n[n.Unavailable=14]="Unavailable",n[n.DataLoss=15]="DataLoss",n[n.Unauthenticated=16]="Unauthenticated"})(L||(L={}));function k(n,e){if(!n)throw new Error(e)}const Mr=34028234663852886e22,ke=-34028234663852886e22,On=4294967295,Ur=2147483647,$r=-2147483648;function Pn(n){if(typeof n!="number")throw new Error("invalid int 32: "+typeof n);if(!Number.isInteger(n)||n>Ur||n<$r)throw new Error("invalid int 32: "+n)}function Qn(n){if(typeof n!="number")throw new Error("invalid uint 32: "+typeof n);if(!Number.isInteger(n)||n>On||n<0)throw new Error("invalid uint 32: "+n)}function ui(n){if(typeof n!="number")throw new Error("invalid float 32: "+typeof n);if(!!Number.isFinite(n)&&(n>Mr||n<ke))throw new Error("invalid float 32: "+n)}const li=Symbol("@bufbuild/protobuf/enum-type");function hi(n){const e=n[li];return k(e,"missing enum type on enum object"),e}function fi(n,e,t,r){n[li]=di(e,t.map(s=>({no:s.no,name:s.name,localName:n[s.no]})))}function di(n,e,t){const r=Object.create(null),s=Object.create(null),i=[];for(const o of e){const a=mi(o);i.push(a),r[o.name]=a,s[o.no]=a}return{typeName:n,values:i,findName(o){return r[o]},findNumber(o){return s[o]}}}function vc(n,e,t){const r={};for(const s of e){const i=mi(s);r[i.localName]=i.no,r[i.no]=i.localName}return fi(r,n,e),r}function mi(n){return"localName"in n?n:Object.assign(Object.assign({},n),{localName:n.name})}class w{equals(e){return this.getType().runtime.util.equals(this.getType(),this,e)}clone(){return this.getType().runtime.util.clone(this)}fromBinary(e,t){const r=this.getType(),s=r.runtime.bin,i=s.makeReadOptions(t);return s.readMessage(this,i.readerFactory(e),e.byteLength,i),this}fromJson(e,t){const r=this.getType(),s=r.runtime.json,i=s.makeReadOptions(t);return s.readMessage(r,e,i,this),this}fromJsonString(e,t){let r;try{r=JSON.parse(e)}catch(s){throw new Error(`cannot decode ${this.getType().typeName} from JSON: ${s instanceof Error?s.message:String(s)}`)}return this.fromJson(r,t)}toBinary(e){const t=this.getType(),r=t.runtime.bin,s=r.makeWriteOptions(e),i=s.writerFactory();return r.writeMessage(this,i,s),i.finish()}toJson(e){const t=this.getType(),r=t.runtime.json,s=r.makeWriteOptions(e);return r.writeMessage(this,s)}toJsonString(e){var t;const r=this.toJson(e);return JSON.stringify(r,null,(t=e==null?void 0:e.prettySpaces)!==null&&t!==void 0?t:0)}toJSON(){return this.toJson({emitDefaultValues:!0})}getType(){return Object.getPrototypeOf(this).constructor}}function Sc(n,e,t,r){var s;const i=(s=r==null?void 0:r.localName)!==null&&s!==void 0?s:e.substring(e.lastIndexOf(".")+1),o={[i]:function(a){n.util.initFields(this),n.util.initPartial(a,this)}}[i];return Object.setPrototypeOf(o.prototype,new w),Object.assign(o,{runtime:n,typeName:e,fields:n.util.newFieldList(t),fromBinary(a,c){return new o().fromBinary(a,c)},fromJson(a,c){return new o().fromJson(a,c)},fromJsonString(a,c){return new o().fromJsonString(a,c)},equals(a,c){return n.util.equals(o,a,c)}}),o}function gi(n,e,t,r){return{syntax:n,json:e,bin:t,util:r,makeMessageType(s,i,o){return Sc(this,s,i,o)},makeEnum:vc,makeEnumType:di,getEnumType:hi}}var m;(function(n){n[n.DOUBLE=1]="DOUBLE",n[n.FLOAT=2]="FLOAT",n[n.INT64=3]="INT64",n[n.UINT64=4]="UINT64",n[n.INT32=5]="INT32",n[n.FIXED64=6]="FIXED64",n[n.FIXED32=7]="FIXED32",n[n.BOOL=8]="BOOL",n[n.STRING=9]="STRING",n[n.BYTES=12]="BYTES",n[n.UINT32=13]="UINT32",n[n.SFIXED32=15]="SFIXED32",n[n.SFIXED64=16]="SFIXED64",n[n.SINT32=17]="SINT32",n[n.SINT64=18]="SINT64"})(m||(m={}));var Se;(function(n){n[n.BIGINT=0]="BIGINT",n[n.STRING=1]="STRING"})(Se||(Se={}));function bc(){let n=0,e=0;for(let r=0;r<28;r+=7){let s=this.buf[this.pos++];if(n|=(s&127)<<r,(s&128)==0)return this.assertBounds(),[n,e]}let t=this.buf[this.pos++];if(n|=(t&15)<<28,e=(t&112)>>4,(t&128)==0)return this.assertBounds(),[n,e];for(let r=3;r<=31;r+=7){let s=this.buf[this.pos++];if(e|=(s&127)<<r,(s&128)==0)return this.assertBounds(),[n,e]}throw new Error("invalid varint")}function ws(n,e,t){for(let i=0;i<28;i=i+7){const o=n>>>i,a=!(o>>>7==0&&e==0),c=(a?o|128:o)&255;if(t.push(c),!a)return}const r=n>>>28&15|(e&7)<<4,s=e>>3!=0;if(t.push((s?r|128:r)&255),!!s){for(let i=3;i<31;i=i+7){const o=e>>>i,a=o>>>7!=0,c=(a?o|128:o)&255;if(t.push(c),!a)return}t.push(e>>>31&1)}}const Fr=4294967296;function pi(n){const e=n[0]==="-";e&&(n=n.slice(1));const t=1e6;let r=0,s=0;function i(o,a){const c=Number(n.slice(o,a));s*=t,r=r*t+c,r>=Fr&&(s=s+(r/Fr|0),r=r%Fr)}return i(-24,-18),i(-18,-12),i(-12,-6),i(-6),e?Ti(r,s):Ns(r,s)}function wc(n,e){let t=Ns(n,e);const r=t.hi&2147483648;r&&(t=Ti(t.lo,t.hi));const s=yi(t.lo,t.hi);return r?"-"+s:s}function yi(n,e){if({lo:n,hi:e}=Nc(n,e),e<=2097151)return String(Fr*e+n);const t=n&16777215,r=(n>>>24|e<<8)&16777215,s=e>>16&65535;let i=t+r*6777216+s*6710656,o=r+s*8147497,a=s*2;const c=1e7;return i>=c&&(o+=Math.floor(i/c),i%=c),o>=c&&(a+=Math.floor(o/c),o%=c),a.toString()+vi(o)+vi(i)}function Nc(n,e){return{lo:n>>>0,hi:e>>>0}}function Ns(n,e){return{lo:n|0,hi:e|0}}function Ti(n,e){return e=~e,n?n=~n+1:e+=1,Ns(n,e)}const vi=n=>{const e=String(n);return"0000000".slice(e.length)+e};function Si(n,e){if(n>=0){for(;n>127;)e.push(n&127|128),n=n>>>7;e.push(n)}else{for(let t=0;t<9;t++)e.push(n&127|128),n=n>>7;e.push(1)}}function Ec(){let n=this.buf[this.pos++],e=n&127;if((n&128)==0)return this.assertBounds(),e;if(n=this.buf[this.pos++],e|=(n&127)<<7,(n&128)==0)return this.assertBounds(),e;if(n=this.buf[this.pos++],e|=(n&127)<<14,(n&128)==0)return this.assertBounds(),e;if(n=this.buf[this.pos++],e|=(n&127)<<21,(n&128)==0)return this.assertBounds(),e;n=this.buf[this.pos++],e|=(n&15)<<28;for(let t=5;(n&128)!==0&&t<10;t++)n=this.buf[this.pos++];if((n&128)!=0)throw new Error("invalid varint");return this.assertBounds(),e>>>0}function Ic(){const n=new DataView(new ArrayBuffer(8));if(typeof BigInt=="function"&&typeof n.getBigInt64=="function"&&typeof n.getBigUint64=="function"&&typeof n.setBigInt64=="function"&&typeof n.setBigUint64=="function"&&(typeof process!="object"||typeof process.env!="object"||{}.BUF_BIGINT_DISABLE!=="1")){const s=BigInt("-9223372036854775808"),i=BigInt("9223372036854775807"),o=BigInt("0"),a=BigInt("18446744073709551615");return{zero:BigInt(0),supported:!0,parse(c){const u=typeof c=="bigint"?c:BigInt(c);if(u>i||u<s)throw new Error(`int64 invalid: ${c}`);return u},uParse(c){const u=typeof c=="bigint"?c:BigInt(c);if(u>a||u<o)throw new Error(`uint64 invalid: ${c}`);return u},enc(c){return n.setBigInt64(0,this.parse(c),!0),{lo:n.getInt32(0,!0),hi:n.getInt32(4,!0)}},uEnc(c){return n.setBigInt64(0,this.uParse(c),!0),{lo:n.getInt32(0,!0),hi:n.getInt32(4,!0)}},dec(c,u){return n.setInt32(0,c,!0),n.setInt32(4,u,!0),n.getBigInt64(0,!0)},uDec(c,u){return n.setInt32(0,c,!0),n.setInt32(4,u,!0),n.getBigUint64(0,!0)}}}const t=s=>k(/^-?[0-9]+$/.test(s),`int64 invalid: ${s}`),r=s=>k(/^[0-9]+$/.test(s),`uint64 invalid: ${s}`);return{zero:"0",supported:!1,parse(s){return typeof s!="string"&&(s=s.toString()),t(s),s},uParse(s){return typeof s!="string"&&(s=s.toString()),r(s),s},enc(s){return typeof s!="string"&&(s=s.toString()),t(s),pi(s)},uEnc(s){return typeof s!="string"&&(s=s.toString()),r(s),pi(s)},dec(s,i){return wc(s,i)},uDec(s,i){return yi(s,i)}}}const z=Ic();var j;(function(n){n[n.Varint=0]="Varint",n[n.Bit64=1]="Bit64",n[n.LengthDelimited=2]="LengthDelimited",n[n.StartGroup=3]="StartGroup",n[n.EndGroup=4]="EndGroup",n[n.Bit32=5]="Bit32"})(j||(j={}));class bi{constructor(e){this.stack=[],this.textEncoder=e!=null?e:new TextEncoder,this.chunks=[],this.buf=[]}finish(){this.chunks.push(new Uint8Array(this.buf));let e=0;for(let s=0;s<this.chunks.length;s++)e+=this.chunks[s].length;let t=new Uint8Array(e),r=0;for(let s=0;s<this.chunks.length;s++)t.set(this.chunks[s],r),r+=this.chunks[s].length;return this.chunks=[],t}fork(){return this.stack.push({chunks:this.chunks,buf:this.buf}),this.chunks=[],this.buf=[],this}join(){let e=this.finish(),t=this.stack.pop();if(!t)throw new Error("invalid state, fork stack empty");return this.chunks=t.chunks,this.buf=t.buf,this.uint32(e.byteLength),this.raw(e)}tag(e,t){return this.uint32((e<<3|t)>>>0)}raw(e){return this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]),this.chunks.push(e),this}uint32(e){for(Qn(e);e>127;)this.buf.push(e&127|128),e=e>>>7;return this.buf.push(e),this}int32(e){return Pn(e),Si(e,this.buf),this}bool(e){return this.buf.push(e?1:0),this}bytes(e){return this.uint32(e.byteLength),this.raw(e)}string(e){let t=this.textEncoder.encode(e);return this.uint32(t.byteLength),this.raw(t)}float(e){ui(e);let t=new Uint8Array(4);return new DataView(t.buffer).setFloat32(0,e,!0),this.raw(t)}double(e){let t=new Uint8Array(8);return new DataView(t.buffer).setFloat64(0,e,!0),this.raw(t)}fixed32(e){Qn(e);let t=new Uint8Array(4);return new DataView(t.buffer).setUint32(0,e,!0),this.raw(t)}sfixed32(e){Pn(e);let t=new Uint8Array(4);return new DataView(t.buffer).setInt32(0,e,!0),this.raw(t)}sint32(e){return Pn(e),e=(e<<1^e>>31)>>>0,Si(e,this.buf),this}sfixed64(e){let t=new Uint8Array(8),r=new DataView(t.buffer),s=z.enc(e);return r.setInt32(0,s.lo,!0),r.setInt32(4,s.hi,!0),this.raw(t)}fixed64(e){let t=new Uint8Array(8),r=new DataView(t.buffer),s=z.uEnc(e);return r.setInt32(0,s.lo,!0),r.setInt32(4,s.hi,!0),this.raw(t)}int64(e){let t=z.enc(e);return ws(t.lo,t.hi,this.buf),this}sint64(e){let t=z.enc(e),r=t.hi>>31,s=t.lo<<1^r,i=(t.hi<<1|t.lo>>>31)^r;return ws(s,i,this.buf),this}uint64(e){let t=z.uEnc(e);return ws(t.lo,t.hi,this.buf),this}}class Es{constructor(e,t){this.varint64=bc,this.uint32=Ec,this.buf=e,this.len=e.length,this.pos=0,this.view=new DataView(e.buffer,e.byteOffset,e.byteLength),this.textDecoder=t!=null?t:new TextDecoder}tag(){let e=this.uint32(),t=e>>>3,r=e&7;if(t<=0||r<0||r>5)throw new Error("illegal tag: field no "+t+" wire type "+r);return[t,r]}skip(e){let t=this.pos;switch(e){case j.Varint:for(;this.buf[this.pos++]&128;);break;case j.Bit64:this.pos+=4;case j.Bit32:this.pos+=4;break;case j.LengthDelimited:let r=this.uint32();this.pos+=r;break;case j.StartGroup:let s;for(;(s=this.tag()[1])!==j.EndGroup;)this.skip(s);break;default:throw new Error("cant skip wire type "+e)}return this.assertBounds(),this.buf.subarray(t,this.pos)}assertBounds(){if(this.pos>this.len)throw new RangeError("premature EOF")}int32(){return this.uint32()|0}sint32(){let e=this.uint32();return e>>>1^-(e&1)}int64(){return z.dec(...this.varint64())}uint64(){return z.uDec(...this.varint64())}sint64(){let[e,t]=this.varint64(),r=-(e&1);return e=(e>>>1|(t&1)<<31)^r,t=t>>>1^r,z.dec(e,t)}bool(){let[e,t]=this.varint64();return e!==0||t!==0}fixed32(){return this.view.getUint32((this.pos+=4)-4,!0)}sfixed32(){return this.view.getInt32((this.pos+=4)-4,!0)}fixed64(){return z.uDec(this.sfixed32(),this.sfixed32())}sfixed64(){return z.dec(this.sfixed32(),this.sfixed32())}float(){return this.view.getFloat32((this.pos+=4)-4,!0)}double(){return this.view.getFloat64((this.pos+=8)-8,!0)}bytes(){let e=this.uint32(),t=this.pos;return this.pos+=e,this.assertBounds(),this.buf.subarray(t,t+e)}string(){return this.textDecoder.decode(this.bytes())}}function qr(n,e){return e instanceof w||!n.fieldWrapper?e:n.fieldWrapper.wrapField(e)}function kc(n){if(n.fieldKind==="message"&&!n.repeated&&n.oneof==null)return Ac[n.message.typeName]}const Ac={"google.protobuf.DoubleValue":m.DOUBLE,"google.protobuf.FloatValue":m.FLOAT,"google.protobuf.Int64Value":m.INT64,"google.protobuf.UInt64Value":m.UINT64,"google.protobuf.Int32Value":m.INT32,"google.protobuf.UInt32Value":m.UINT32,"google.protobuf.BoolValue":m.BOOL,"google.protobuf.StringValue":m.STRING,"google.protobuf.BytesValue":m.BYTES};function Qt(n,e,t){if(e===t)return!0;if(n==m.BYTES){if(!(e instanceof Uint8Array)||!(t instanceof Uint8Array)||e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}switch(n){case m.UINT64:case m.FIXED64:case m.INT64:case m.SFIXED64:case m.SINT64:return e==t}return!1}function jr(n,e){switch(n){case m.BOOL:return!1;case m.UINT64:case m.FIXED64:case m.INT64:case m.SFIXED64:case m.SINT64:return e==0?z.zero:"0";case m.DOUBLE:case m.FLOAT:return 0;case m.BYTES:return new Uint8Array(0);case m.STRING:return"";default:return 0}}function wi(n,e){const t=e===void 0;let r=j.Varint,s=e===0;switch(n){case m.STRING:s=t||!e.length,r=j.LengthDelimited;break;case m.BOOL:s=e===!1;break;case m.DOUBLE:r=j.Bit64;break;case m.FLOAT:r=j.Bit32;break;case m.INT64:s=t||e==0;break;case m.UINT64:s=t||e==0;break;case m.FIXED64:s=t||e==0,r=j.Bit64;break;case m.BYTES:s=t||!e.byteLength,r=j.LengthDelimited;break;case m.FIXED32:r=j.Bit32;break;case m.SFIXED32:r=j.Bit32;break;case m.SFIXED64:s=t||e==0,r=j.Bit64;break;case m.SINT64:s=t||e==0;break}const i=m[n].toLowerCase();return[r,i,t||s]}const xn=Symbol("@bufbuild/protobuf/unknown-fields"),Ni={readUnknownFields:!0,readerFactory:n=>new Es(n)},Ei={writeUnknownFields:!0,writerFactory:()=>new bi};function _c(n){return n?Object.assign(Object.assign({},Ni),n):Ni}function Oc(n){return n?Object.assign(Object.assign({},Ei),n):Ei}function Vr(){return{makeReadOptions:_c,makeWriteOptions:Oc,listUnknownFields(n){var e;return(e=n[xn])!==null&&e!==void 0?e:[]},discardUnknownFields(n){delete n[xn]},writeUnknownFields(n,e){const r=n[xn];if(r)for(const s of r)e.tag(s.no,s.wireType).raw(s.data)},onUnknownField(n,e,t,r){const s=n;Array.isArray(s[xn])||(s[xn]=[]),s[xn].push({no:e,wireType:t,data:r})},readMessage(n,e,t,r,s){const i=n.getType(),o=s?e.len:e.pos+t;let a,c;for(;e.pos<o&&([a,c]=e.tag(),c!=j.EndGroup);){const u=i.fields.find(a);if(!u){const p=e.skip(c);r.readUnknownFields&&this.onUnknownField(n,a,c,p);continue}let l=n,y=u.repeated,f=u.localName;switch(u.oneof&&(l=l[u.oneof.localName],l.case!=f&&delete l.value,l.case=f,f="value"),u.kind){case"scalar":case"enum":const p=u.kind=="enum"?m.INT32:u.T;let b=Kr;if(u.kind=="scalar"&&u.L>0&&(b=xc),y){let K=l[f];if(c==j.LengthDelimited&&p!=m.STRING&&p!=m.BYTES){let B=e.uint32()+e.pos;for(;e.pos<B;)K.push(b(e,p))}else K.push(b(e,p))}else l[f]=b(e,p);break;case"message":const N=u.T;y?l[f].push(Yr(e,new N,r,u)):l[f]instanceof w?Yr(e,l[f],r,u):(l[f]=Yr(e,new N,r,u),N.fieldWrapper&&!u.oneof&&!u.repeated&&(l[f]=N.fieldWrapper.unwrapField(l[f])));break;case"map":let[E,D]=Pc(u,e,r);l[f][E]=D;break}}if(s&&(c!=j.EndGroup||a!==t))throw new Error("invalid end group tag")}}}function Yr(n,e,t,r){const s=e.getType().runtime.bin,i=r==null?void 0:r.delimited;return s.readMessage(e,n,i?r==null?void 0:r.no:n.uint32(),t,i),e}function Pc(n,e,t){const r=e.uint32(),s=e.pos+r;let i,o;for(;e.pos<s;){let[a]=e.tag();switch(a){case 1:i=Kr(e,n.K);break;case 2:switch(n.V.kind){case"scalar":o=Kr(e,n.V.T);break;case"enum":o=e.int32();break;case"message":o=Yr(e,new n.V.T,t,void 0);break}break}}if(i===void 0){let a=jr(n.K,Se.BIGINT);i=n.K==m.BOOL?a.toString():a}if(typeof i!="string"&&typeof i!="number"&&(i=i.toString()),o===void 0)switch(n.V.kind){case"scalar":o=jr(n.V.T,Se.BIGINT);break;case"enum":o=0;break;case"message":o=new n.V.T;break}return[i,o]}function xc(n,e){const t=Kr(n,e);return typeof t=="bigint"?t.toString():t}function Kr(n,e){switch(e){case m.STRING:return n.string();case m.BOOL:return n.bool();case m.DOUBLE:return n.double();case m.FLOAT:return n.float();case m.INT32:return n.int32();case m.INT64:return n.int64();case m.UINT64:return n.uint64();case m.FIXED64:return n.fixed64();case m.BYTES:return n.bytes();case m.FIXED32:return n.fixed32();case m.SFIXED32:return n.sfixed32();case m.SFIXED64:return n.sfixed64();case m.SINT64:return n.sint64();case m.UINT32:return n.uint32();case m.SINT32:return n.sint32()}}function Ii(n,e,t,r,s){n.tag(t.no,j.LengthDelimited),n.fork();let i=r;switch(t.K){case m.INT32:case m.FIXED32:case m.UINT32:case m.SFIXED32:case m.SINT32:i=Number.parseInt(r);break;case m.BOOL:k(r=="true"||r=="false"),i=r=="true";break}switch(dn(n,t.K,1,i,!0),t.V.kind){case"scalar":dn(n,t.V.T,2,s,!0);break;case"enum":dn(n,m.INT32,2,s,!0);break;case"message":n.tag(2,j.LengthDelimited).bytes(s.toBinary(e));break}n.join()}function Gr(n,e,t,r){if(r!==void 0){const s=qr(t.T,r);t!=null&&t.delimited?n.tag(t.no,j.StartGroup).raw(s.toBinary(e)).tag(t.no,j.EndGroup):n.tag(t.no,j.LengthDelimited).bytes(s.toBinary(e))}}function dn(n,e,t,r,s){let[i,o,a]=wi(e,r);(!a||s)&&n.tag(t,i)[o](r)}function ki(n,e,t,r){if(!r.length)return;n.tag(t,j.LengthDelimited).fork();let[,s]=wi(e);for(let i=0;i<r.length;i++)n[s](r[i]);n.join()}function Dc(){return Object.assign(Object.assign({},Vr()),{writeMessage(n,e,t){const r=n.getType();for(const s of r.fields.byNumber()){let i,o=s.repeated,a=s.localName;if(s.oneof){const c=n[s.oneof.localName];if(c.case!==a)continue;i=c.value}else i=n[a];switch(s.kind){case"scalar":case"enum":let c=s.kind=="enum"?m.INT32:s.T;if(o)if(s.packed)ki(e,c,s.no,i);else for(const u of i)dn(e,c,s.no,u,!0);else i!==void 0&&dn(e,c,s.no,i,!!s.oneof||s.opt);break;case"message":if(o)for(const u of i)Gr(e,t,s,u);else Gr(e,t,s,i);break;case"map":for(const[u,l]of Object.entries(i))Ii(e,t,s,u,l);break}}return t.writeUnknownFields&&this.writeUnknownFields(n,e),e}})}let Ft="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),zr=[];for(let n=0;n<Ft.length;n++)zr[Ft[n].charCodeAt(0)]=n;zr["-".charCodeAt(0)]=Ft.indexOf("+"),zr["_".charCodeAt(0)]=Ft.indexOf("/");const er={dec(n){let e=n.length*3/4;n[n.length-2]=="="?e-=2:n[n.length-1]=="="&&(e-=1);let t=new Uint8Array(e),r=0,s=0,i,o=0;for(let a=0;a<n.length;a++){if(i=zr[n.charCodeAt(a)],i===void 0)switch(n[a]){case"=":s=0;case`
`:case"\r":case"	":case" ":continue;default:throw Error("invalid base64 string.")}switch(s){case 0:o=i,s=1;break;case 1:t[r++]=o<<2|(i&48)>>4,o=i,s=2;break;case 2:t[r++]=(o&15)<<4|(i&60)>>2,o=i,s=3;break;case 3:t[r++]=(o&3)<<6|i,s=0;break}}if(s==1)throw Error("invalid base64 string.");return t.subarray(0,r)},enc(n){let e="",t=0,r,s=0;for(let i=0;i<n.length;i++)switch(r=n[i],t){case 0:e+=Ft[r>>2],s=(r&3)<<4,t=1;break;case 1:e+=Ft[s|r>>4],s=(r&15)<<2,t=2;break;case 2:e+=Ft[s|r>>6],e+=Ft[r&63],t=0;break}return t&&(e+=Ft[s],e+="=",t==1&&(e+="=")),e}},Ai={ignoreUnknownFields:!1},_i={emitDefaultValues:!1,enumAsInteger:!1,useProtoFieldName:!1,prettySpaces:0};function Cc(n){return n?Object.assign(Object.assign({},Ai),n):Ai}function Rc(n){return n?Object.assign(Object.assign({},_i),n):_i}function Oi(n){const e=n(Jc,xi);return{makeReadOptions:Cc,makeWriteOptions:Rc,readMessage(t,r,s,i){if(r==null||Array.isArray(r)||typeof r!="object")throw new Error(`cannot decode message ${t.typeName} from JSON: ${this.debug(r)}`);i=i!=null?i:new t;const o={};for(const[a,c]of Object.entries(r)){const u=t.fields.findJsonName(a);if(!u){if(!s.ignoreUnknownFields)throw new Error(`cannot decode message ${t.typeName} from JSON: key "${a}" is unknown`);continue}let l=u.localName,y=i;if(u.oneof){if(c===null&&u.kind=="scalar")continue;const f=o[u.oneof.localName];if(f)throw new Error(`cannot decode message ${t.typeName} from JSON: multiple keys for oneof "${u.oneof.name}" present: "${f}", "${a}"`);o[u.oneof.localName]=a,y=y[u.oneof.localName]={case:l},l="value"}if(u.repeated){if(c===null)continue;if(!Array.isArray(c))throw new Error(`cannot decode field ${t.typeName}.${u.name} from JSON: ${this.debug(c)}`);const f=y[l];for(const p of c){if(p===null)throw new Error(`cannot decode field ${t.typeName}.${u.name} from JSON: ${this.debug(p)}`);let b;switch(u.kind){case"message":b=u.T.fromJson(p,s);break;case"enum":if(b=Is(u.T,p,s.ignoreUnknownFields),b===void 0)continue;break;case"scalar":try{b=tr(u.T,p,u.L)}catch(N){let E=`cannot decode field ${t.typeName}.${u.name} from JSON: ${this.debug(p)}`;throw N instanceof Error&&N.message.length>0&&(E+=`: ${N.message}`),new Error(E)}break}f.push(b)}}else if(u.kind=="map"){if(c===null)continue;if(Array.isArray(c)||typeof c!="object")throw new Error(`cannot decode field ${t.typeName}.${u.name} from JSON: ${this.debug(c)}`);const f=y[l];for(const[p,b]of Object.entries(c)){if(b===null)throw new Error(`cannot decode field ${t.typeName}.${u.name} from JSON: map value null`);let N;switch(u.V.kind){case"message":N=u.V.T.fromJson(b,s);break;case"enum":if(N=Is(u.V.T,b,s.ignoreUnknownFields),N===void 0)continue;break;case"scalar":try{N=tr(u.V.T,b,Se.BIGINT)}catch(E){let D=`cannot decode map value for field ${t.typeName}.${u.name} from JSON: ${this.debug(c)}`;throw E instanceof Error&&E.message.length>0&&(D+=`: ${E.message}`),new Error(D)}break}try{f[tr(u.K,u.K==m.BOOL?p=="true"?!0:p=="false"?!1:p:p,Se.BIGINT).toString()]=N}catch(E){let D=`cannot decode map key for field ${t.typeName}.${u.name} from JSON: ${this.debug(c)}`;throw E instanceof Error&&E.message.length>0&&(D+=`: ${E.message}`),new Error(D)}}}else switch(u.kind){case"message":const f=u.T;if(c===null&&f.typeName!="google.protobuf.Value"){if(u.oneof)throw new Error(`cannot decode field ${t.typeName}.${u.name} from JSON: null is invalid for oneof field "${a}"`);continue}y[l]instanceof w?y[l].fromJson(c,s):(y[l]=f.fromJson(c,s),f.fieldWrapper&&!u.oneof&&(y[l]=f.fieldWrapper.unwrapField(y[l])));break;case"enum":const p=Is(u.T,c,s.ignoreUnknownFields);p!==void 0&&(y[l]=p);break;case"scalar":try{y[l]=tr(u.T,c,u.L)}catch(b){let N=`cannot decode field ${t.typeName}.${u.name} from JSON: ${this.debug(c)}`;throw b instanceof Error&&b.message.length>0&&(N+=`: ${b.message}`),new Error(N)}break}}return i},writeMessage(t,r){const s=t.getType(),i={};let o;try{for(const a of s.fields.byMember()){let c;if(a.kind=="oneof"){const u=t[a.localName];if(u.value===void 0)continue;if(o=a.findField(u.case),!o)throw"oneof case not found: "+u.case;c=e(o,u.value,r)}else o=a,c=e(o,t[o.localName],r);c!==void 0&&(i[r.useProtoFieldName?o.name:o.jsonName]=c)}}catch(a){const c=o?`cannot encode field ${s.typeName}.${o.name} to JSON`:`cannot encode message ${s.typeName} to JSON`,u=a instanceof Error?a.message:String(a);throw new Error(c+(u.length>0?`: ${u}`:""))}return i},readScalar:tr,writeScalar:xi,debug:Pi}}function Pi(n){if(n===null)return"null";switch(typeof n){case"object":return Array.isArray(n)?"array":"object";case"string":return n.length>100?"string":`"${n.split('"').join('\\"')}"`;default:return String(n)}}function tr(n,e,t){switch(n){case m.DOUBLE:case m.FLOAT:if(e===null)return 0;if(e==="NaN")return Number.NaN;if(e==="Infinity")return Number.POSITIVE_INFINITY;if(e==="-Infinity")return Number.NEGATIVE_INFINITY;if(e===""||typeof e=="string"&&e.trim().length!==e.length||typeof e!="string"&&typeof e!="number")break;const r=Number(e);if(Number.isNaN(r)||!Number.isFinite(r))break;return n==m.FLOAT&&ui(r),r;case m.INT32:case m.FIXED32:case m.SFIXED32:case m.SINT32:case m.UINT32:if(e===null)return 0;let s;if(typeof e=="number"?s=e:typeof e=="string"&&e.length>0&&e.trim().length===e.length&&(s=Number(e)),s===void 0)break;return n==m.UINT32?Qn(s):Pn(s),s;case m.INT64:case m.SFIXED64:case m.SINT64:if(e===null)return z.zero;if(typeof e!="number"&&typeof e!="string")break;const i=z.parse(e);return t?i.toString():i;case m.FIXED64:case m.UINT64:if(e===null)return z.zero;if(typeof e!="number"&&typeof e!="string")break;const o=z.uParse(e);return t?o.toString():o;case m.BOOL:if(e===null)return!1;if(typeof e!="boolean")break;return e;case m.STRING:if(e===null)return"";if(typeof e!="string")break;try{encodeURIComponent(e)}catch{throw new Error("invalid UTF8")}return e;case m.BYTES:if(e===null||e==="")return new Uint8Array(0);if(typeof e!="string")break;return er.dec(e)}throw new Error}function Is(n,e,t){if(e===null)return 0;switch(typeof e){case"number":if(Number.isInteger(e))return e;break;case"string":const r=n.findName(e);if(r||t)return r==null?void 0:r.no;break}throw new Error(`cannot decode enum ${n.typeName} from JSON: ${Pi(e)}`)}function Jc(n,e,t,r){var s;if(e===void 0)return e;if(e===0&&!t)return;if(r)return e;if(n.typeName=="google.protobuf.NullValue")return null;const i=n.findNumber(e);return(s=i==null?void 0:i.name)!==null&&s!==void 0?s:e}function xi(n,e,t){if(e!==void 0)switch(n){case m.INT32:case m.SFIXED32:case m.SINT32:case m.FIXED32:case m.UINT32:return k(typeof e=="number"),e!=0||t?e:void 0;case m.FLOAT:case m.DOUBLE:return k(typeof e=="number"),Number.isNaN(e)?"NaN":e===Number.POSITIVE_INFINITY?"Infinity":e===Number.NEGATIVE_INFINITY?"-Infinity":e!==0||t?e:void 0;case m.STRING:return k(typeof e=="string"),e.length>0||t?e:void 0;case m.BOOL:return k(typeof e=="boolean"),e||t?e:void 0;case m.UINT64:case m.FIXED64:case m.INT64:case m.SFIXED64:case m.SINT64:return k(typeof e=="bigint"||typeof e=="string"||typeof e=="number"),t||e!=0?e.toString(10):void 0;case m.BYTES:return k(e instanceof Uint8Array),t||e.byteLength>0?er.enc(e):void 0}}function Bc(){return Oi((n,e)=>function(r,s,i){if(r.kind=="map"){const o={};switch(r.V.kind){case"scalar":for(const[c,u]of Object.entries(s)){const l=e(r.V.T,u,!0);k(l!==void 0),o[c.toString()]=l}break;case"message":for(const[c,u]of Object.entries(s))o[c.toString()]=u.toJson(i);break;case"enum":const a=r.V.T;for(const[c,u]of Object.entries(s)){k(u===void 0||typeof u=="number");const l=n(a,u,!0,i.enumAsInteger);k(l!==void 0),o[c.toString()]=l}break}return i.emitDefaultValues||Object.keys(o).length>0?o:void 0}else if(r.repeated){const o=[];switch(r.kind){case"scalar":for(let a=0;a<s.length;a++)o.push(e(r.T,s[a],!0));break;case"enum":for(let a=0;a<s.length;a++)o.push(n(r.T,s[a],!0,i.enumAsInteger));break;case"message":for(let a=0;a<s.length;a++)o.push(qr(r.T,s[a]).toJson(i));break}return i.emitDefaultValues||o.length>0?o:void 0}else switch(r.kind){case"scalar":return e(r.T,s,!!r.oneof||r.opt||i.emitDefaultValues);case"enum":return n(r.T,s,!!r.oneof||r.opt||i.emitDefaultValues,i.enumAsInteger);case"message":return s!==void 0?qr(r.T,s).toJson(i):void 0}})}function Di(){return{setEnumType:fi,initPartial(n,e){if(n===void 0)return;const t=e.getType();for(const r of t.fields.byMember()){const s=r.localName,i=e,o=n;if(o[s]!==void 0)switch(r.kind){case"oneof":const a=o[s].case;if(a===void 0)continue;const c=r.findField(a);let u=o[s].value;c&&c.kind=="message"&&!(u instanceof c.T)?u=new c.T(u):c&&c.kind==="scalar"&&c.T===m.BYTES&&(u=nr(u)),i[s]={case:a,value:u};break;case"scalar":case"enum":let l=o[s];r.T===m.BYTES&&(l=r.repeated?l.map(nr):nr(l)),i[s]=l;break;case"map":switch(r.V.kind){case"scalar":case"enum":if(r.V.T===m.BYTES)for(const[p,b]of Object.entries(o[s]))i[s][p]=nr(b);else Object.assign(i[s],o[s]);break;case"message":const f=r.V.T;for(const p of Object.keys(o[s])){let b=o[s][p];f.fieldWrapper||(b=new f(b)),i[s][p]=b}break}break;case"message":const y=r.T;if(r.repeated)i[s]=o[s].map(f=>f instanceof y?f:new y(f));else if(o[s]!==void 0){const f=o[s];y.fieldWrapper?y.typeName==="google.protobuf.BytesValue"?i[s]=nr(f):i[s]=f:i[s]=f instanceof y?f:new y(f)}break}}},equals(n,e,t){return e===t?!0:!e||!t?!1:n.fields.byMember().every(r=>{const s=e[r.localName],i=t[r.localName];if(r.repeated){if(s.length!==i.length)return!1;switch(r.kind){case"message":return s.every((o,a)=>r.T.equals(o,i[a]));case"scalar":return s.every((o,a)=>Qt(r.T,o,i[a]));case"enum":return s.every((o,a)=>Qt(m.INT32,o,i[a]))}throw new Error(`repeated cannot contain ${r.kind}`)}switch(r.kind){case"message":return r.T.equals(s,i);case"enum":return Qt(m.INT32,s,i);case"scalar":return Qt(r.T,s,i);case"oneof":if(s.case!==i.case)return!1;const o=r.findField(s.case);if(o===void 0)return!0;switch(o.kind){case"message":return o.T.equals(s.value,i.value);case"enum":return Qt(m.INT32,s.value,i.value);case"scalar":return Qt(o.T,s.value,i.value)}throw new Error(`oneof cannot contain ${o.kind}`);case"map":const a=Object.keys(s).concat(Object.keys(i));switch(r.V.kind){case"message":const c=r.V.T;return a.every(l=>c.equals(s[l],i[l]));case"enum":return a.every(l=>Qt(m.INT32,s[l],i[l]));case"scalar":const u=r.V.T;return a.every(l=>Qt(u,s[l],i[l]))}break}})},clone(n){const e=n.getType(),t=new e,r=t;for(const s of e.fields.byMember()){const i=n[s.localName];let o;if(s.repeated)o=i.map(Wr);else if(s.kind=="map"){o=r[s.localName];for(const[a,c]of Object.entries(i))o[a]=Wr(c)}else s.kind=="oneof"?o=s.findField(i.case)?{case:i.case,value:Wr(i.value)}:{case:void 0}:o=Wr(i);r[s.localName]=o}return t}}}function Wr(n){if(n===void 0)return n;if(n instanceof w)return n.clone();if(n instanceof Uint8Array){const e=new Uint8Array(n.byteLength);return e.set(n),e}return n}function nr(n){return n instanceof Uint8Array?n:new Uint8Array(n)}class Ci{constructor(e,t){this._fields=e,this._normalizer=t}findJsonName(e){if(!this.jsonNames){const t={};for(const r of this.list())t[r.jsonName]=t[r.name]=r;this.jsonNames=t}return this.jsonNames[e]}find(e){if(!this.numbers){const t={};for(const r of this.list())t[r.no]=r;this.numbers=t}return this.numbers[e]}list(){return this.all||(this.all=this._normalizer(this._fields)),this.all}byNumber(){return this.numbersAsc||(this.numbersAsc=this.list().concat().sort((e,t)=>e.no-t.no)),this.numbersAsc}byMember(){if(!this.members){this.members=[];const e=this.members;let t;for(const r of this.list())r.oneof?r.oneof!==t&&(t=r.oneof,e.push(t)):e.push(r)}return this.members}}function Xr(n){switch(n.kind){case"field":return Hr(n.name,n.oneof!==void 0);case"oneof":return Ri(n.name);case"enum":case"message":case"service":{const e=n.file.proto.package,t=e===void 0?0:e.length+1,r=n.typeName.substring(t).replace(/\./g,"_");return rr(Bi(r))}case"enum_value":{const e=n.parent.sharedPrefix;if(e===void 0)return n.name;const t=n.name.substring(e.length);return rr(t)}case"rpc":{let e=n.name;return e.length==0?e:(e=e[0].toLowerCase()+e.substring(1),rr(e))}}}function Hr(n,e){const t=Ji(n);return e?t:rr(qc(t))}function Ri(n){return Hr(n,!1)}const ks=Ji;function Lc(n,e){const t=Mc(n)+"_";for(const r of e){if(!r.toLowerCase().startsWith(t))return;const s=r.substring(t.length);if(s.length==0||/^\d/.test(s))return}return t}function Mc(n){return(n.substring(0,1)+n.substring(1).replace(/[A-Z]/g,e=>"_"+e)).toLowerCase()}function Ji(n){let e=!1;const t=[];for(let r=0;r<n.length;r++){let s=n.charAt(r);switch(s){case"_":e=!0;break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":t.push(s),e=!1;break;default:e&&(e=!1,s=s.toUpperCase()),t.push(s);break}}return t.join("")}const Uc=new Set(["break","case","catch","class","const","continue","debugger","default","delete","do","else","export","extends","false","finally","for","function","if","import","in","instanceof","new","null","return","super","switch","this","throw","true","try","typeof","var","void","while","with","yield","enum","implements","interface","let","package","private","protected","public","static","Object","bigint","number","boolean","string","object","globalThis","Uint8Array","Partial"]),$c=new Set(["constructor","toString","toJSON","valueOf"]),Fc=new Set(["getType","clone","equals","fromBinary","fromJson","fromJsonString","toBinary","toJson","toJsonString","toObject"]),As=n=>`${n}$`,qc=n=>Fc.has(n)?As(n):n,rr=n=>$c.has(n)?As(n):n,Bi=n=>Uc.has(n)?As(n):n;class Li{constructor(e){this.kind="oneof",this.repeated=!1,this.packed=!1,this.opt=!1,this.default=void 0,this.fields=[],this.name=e,this.localName=Ri(e)}addField(e){k(e.oneof===this,`field ${e.name} not one of ${this.name}`),this.fields.push(e)}findField(e){if(!this._lookup){this._lookup=Object.create(null);for(let t=0;t<this.fields.length;t++)this._lookup[this.fields[t].localName]=this.fields[t]}return this._lookup[e]}}const g=gi("proto3",Bc(),Dc(),Object.assign(Object.assign({},Di()),{newFieldList(n){return new Ci(n,jc)},initFields(n){for(const e of n.getType().fields.byMember()){if(e.opt)continue;const t=e.localName,r=n;if(e.repeated){r[t]=[];continue}switch(e.kind){case"oneof":r[t]={case:void 0};break;case"enum":r[t]=0;break;case"map":r[t]={};break;case"scalar":r[t]=jr(e.T,e.L);break}}}}));function jc(n){var e,t,r,s;const i=[];let o;for(const a of typeof n=="function"?n():n){const c=a;if(c.localName=Hr(a.name,a.oneof!==void 0),c.jsonName=(e=a.jsonName)!==null&&e!==void 0?e:ks(a.name),c.repeated=(t=a.repeated)!==null&&t!==void 0?t:!1,a.kind=="scalar"&&(c.L=(r=a.L)!==null&&r!==void 0?r:Se.BIGINT),a.oneof!==void 0){const u=typeof a.oneof=="string"?a.oneof:a.oneof.name;(!o||o.name!=u)&&(o=new Li(u)),c.oneof=o,o.addField(c)}a.kind=="message"&&(c.delimited=!1),c.packed=(s=a.packed)!==null&&s!==void 0?s:a.kind=="enum"||a.kind=="scalar"&&a.T!=m.BYTES&&a.T!=m.STRING,i.push(c)}return i}function Vc(){return Object.assign(Object.assign({},Vr()),{writeMessage(n,e,t){const r=n.getType();let s;try{for(s of r.fields.byNumber()){let i,o=s.repeated,a=s.localName;if(s.oneof){const c=n[s.oneof.localName];if(c.case!==a)continue;i=c.value}else if(i=n[a],i===void 0&&!s.oneof&&!s.opt)throw new Error(`cannot encode field ${r.typeName}.${s.name} to binary: required field not set`);switch(s.kind){case"scalar":case"enum":let c=s.kind=="enum"?m.INT32:s.T;if(o)if(s.packed)ki(e,c,s.no,i);else for(const u of i)dn(e,c,s.no,u,!0);else i!==void 0&&dn(e,c,s.no,i,!0);break;case"message":if(o)for(const u of i)Gr(e,t,s,u);else Gr(e,t,s,i);break;case"map":for(const[u,l]of Object.entries(i))Ii(e,t,s,u,l);break}}}catch(i){let o=s?`cannot encode field ${r.typeName}.${s==null?void 0:s.name} to binary`:`cannot encode message ${r.typeName} to binary`,a=i instanceof Error?i.message:String(i);throw new Error(o+(a.length>0?`: ${a}`:""))}return t.writeUnknownFields&&this.writeUnknownFields(n,e),e}})}function Yc(){return Oi((n,e)=>function(r,s,i){if(r.kind=="map"){const o={};switch(r.V.kind){case"scalar":for(const[c,u]of Object.entries(s)){const l=e(r.V.T,u,!0);k(l!==void 0),o[c.toString()]=l}break;case"message":for(const[c,u]of Object.entries(s))o[c.toString()]=u.toJson(i);break;case"enum":const a=r.V.T;for(const[c,u]of Object.entries(s)){k(u===void 0||typeof u=="number");const l=n(a,u,!0,i.enumAsInteger);k(l!==void 0),o[c.toString()]=l}break}return i.emitDefaultValues||Object.keys(o).length>0?o:void 0}else if(r.repeated){const o=[];switch(r.kind){case"scalar":for(let a=0;a<s.length;a++)o.push(e(r.T,s[a],!0));break;case"enum":for(let a=0;a<s.length;a++)o.push(n(r.T,s[a],!0,i.enumAsInteger));break;case"message":for(let a=0;a<s.length;a++)o.push(s[a].toJson(i));break}return i.emitDefaultValues||o.length>0?o:void 0}else{if(s===void 0){if(!r.oneof&&!r.opt)throw"required field not set";return}switch(r.kind){case"scalar":return e(r.T,s,!0);case"enum":return n(r.T,s,!0,i.enumAsInteger);case"message":return qr(r.T,s).toJson(i)}}})}const d=gi("proto2",Yc(),Vc(),Object.assign(Object.assign({},Di()),{newFieldList(n){return new Ci(n,Kc)},initFields(n){for(const e of n.getType().fields.byMember()){const t=e.localName,r=n;if(e.repeated){r[t]=[];continue}switch(e.kind){case"oneof":r[t]={case:void 0};break;case"map":r[t]={};break}}}}));function Kc(n){var e,t,r,s,i;const o=[];let a;for(const c of typeof n=="function"?n():n){const u=c;if(u.localName=Hr(c.name,c.oneof!==void 0),u.jsonName=(e=c.jsonName)!==null&&e!==void 0?e:ks(c.name),u.repeated=(t=c.repeated)!==null&&t!==void 0?t:!1,c.kind=="scalar"&&(u.L=(r=c.L)!==null&&r!==void 0?r:Se.BIGINT),c.oneof!==void 0){const l=typeof c.oneof=="string"?c.oneof:c.oneof.name;(!a||a.name!=l)&&(a=new Li(l)),u.oneof=a,a.addField(u)}c.kind=="message"&&(u.delimited=(s=c.delimited)!==null&&s!==void 0?s:!1),u.packed=(i=c.packed)!==null&&i!==void 0?i:!1,o.push(u)}return o}const Gc={NaN:Number.NaN,POSITIVE_INFINITY:Number.POSITIVE_INFINITY,NEGATIVE_INFINITY:Number.NEGATIVE_INFINITY};var zc=globalThis&&globalThis.__asyncValues||function(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=n[Symbol.asyncIterator],t;return e?e.call(n):(n=typeof __values=="function"?__values(n):n[Symbol.iterator](),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(i){t[i]=n[i]&&function(o){return new Promise(function(a,c){o=n[i](o),s(a,c,o.done,o.value)})}}function s(i,o,a,c){Promise.resolve(c).then(function(u){i({value:u,done:a})},o)}},Dn=globalThis&&globalThis.__await||function(n){return this instanceof Dn?(this.v=n,this):new Dn(n)},Wc=globalThis&&globalThis.__asyncGenerator||function(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=t.apply(n,e||[]),s,i=[];return s={},a("next"),a("throw"),a("return",o),s[Symbol.asyncIterator]=function(){return this},s;function o(p){return function(b){return Promise.resolve(b).then(p,y)}}function a(p,b){r[p]&&(s[p]=function(N){return new Promise(function(E,D){i.push([p,N,E,D])>1||c(p,N)})},b&&(s[p]=b(s[p])))}function c(p,b){try{u(r[p](b))}catch(N){f(i[0][3],N)}}function u(p){p.value instanceof Dn?Promise.resolve(p.value.v).then(l,y):f(i[0][2],p)}function l(p){c("next",p)}function y(p){c("throw",p)}function f(p,b){p(b),i.shift(),i.length&&c(i[0][0],i[0][1])}};const _s={enc(n,e){const t=Vr().makeWriteOptions(e);return t.writerFactory().bytes(n.toBinary(t)).finish()},dec(n,e,t){const r=Vr().makeReadOptions(t);return n.fromBinary(r.readerFactory(e).bytes(),r)},decStream(n,e){return Wc(this,arguments,function*(){var r,s,i,o;function a(f,p){const b=new Uint8Array(f.byteLength+p.byteLength);return b.set(f),b.set(p,f.length),b}let c=new Uint8Array(0);try{for(var u=!0,l=zc(e),y;y=yield Dn(l.next()),r=y.done,!r;u=!0)for(o=y.value,u=!1,c=a(c,o);;){const p=_s.peekSize(c);if(p.eof||p.offset+p.size>c.byteLength)break;yield yield Dn(_s.dec(n,c)),c=c.subarray(p.offset+p.size)}}catch(f){s={error:f}}finally{try{!u&&!r&&(i=l.return)&&(yield Dn(i.call(l)))}finally{if(s)throw s.error}}if(c.byteLength>0)throw new Error("incomplete data")})},peekSize(n){const e={eof:!0,size:null,offset:null};for(let t=0;t<10;t++){if(t>n.byteLength)return e;if((n[t]&128)==0){const r=new Es(n);let s;try{s=r.uint32()}catch(i){if(i instanceof RangeError)return e;throw i}return{eof:!1,size:s,offset:r.pos}}}throw new Error("invalid varint")}};function Xc(n){switch(n.typeName){case"google.protobuf.Any":{const e=n.fields.find(r=>r.number==1&&r.fieldKind=="scalar"&&r.scalar===m.STRING),t=n.fields.find(r=>r.number==2&&r.fieldKind=="scalar"&&r.scalar===m.BYTES);if(e&&t)return{typeName:n.typeName,typeUrl:e,value:t};break}case"google.protobuf.Timestamp":{const e=n.fields.find(r=>r.number==1&&r.fieldKind=="scalar"&&r.scalar===m.INT64),t=n.fields.find(r=>r.number==2&&r.fieldKind=="scalar"&&r.scalar===m.INT32);if(e&&t)return{typeName:n.typeName,seconds:e,nanos:t};break}case"google.protobuf.Duration":{const e=n.fields.find(r=>r.number==1&&r.fieldKind=="scalar"&&r.scalar===m.INT64),t=n.fields.find(r=>r.number==2&&r.fieldKind=="scalar"&&r.scalar===m.INT32);if(e&&t)return{typeName:n.typeName,seconds:e,nanos:t};break}case"google.protobuf.Struct":{const e=n.fields.find(t=>t.number==1&&!t.repeated);if((e==null?void 0:e.fieldKind)!=="map"||e.mapValue.kind!=="message"||e.mapValue.message.typeName!=="google.protobuf.Value")break;return{typeName:n.typeName,fields:e}}case"google.protobuf.Value":{const e=n.oneofs.find(c=>c.name==="kind"),t=n.fields.find(c=>c.number==1&&c.oneof===e);if((t==null?void 0:t.fieldKind)!=="enum"||t.enum.typeName!=="google.protobuf.NullValue")return;const r=n.fields.find(c=>c.number==2&&c.fieldKind=="scalar"&&c.scalar===m.DOUBLE&&c.oneof===e),s=n.fields.find(c=>c.number==3&&c.fieldKind=="scalar"&&c.scalar===m.STRING&&c.oneof===e),i=n.fields.find(c=>c.number==4&&c.fieldKind=="scalar"&&c.scalar===m.BOOL&&c.oneof===e),o=n.fields.find(c=>c.number==5&&c.oneof===e);if((o==null?void 0:o.fieldKind)!=="message"||o.message.typeName!=="google.protobuf.Struct")return;const a=n.fields.find(c=>c.number==6&&c.oneof===e);if((a==null?void 0:a.fieldKind)!=="message"||a.message.typeName!=="google.protobuf.ListValue")return;if(e&&r&&s&&i)return{typeName:n.typeName,kind:e,nullValue:t,numberValue:r,stringValue:s,boolValue:i,structValue:o,listValue:a};break}case"google.protobuf.ListValue":{const e=n.fields.find(t=>t.number==1&&t.repeated);if((e==null?void 0:e.fieldKind)!="message"||e.message.typeName!=="google.protobuf.Value")break;return{typeName:n.typeName,values:e}}case"google.protobuf.FieldMask":{const e=n.fields.find(t=>t.number==1&&t.fieldKind=="scalar"&&t.scalar===m.STRING&&t.repeated);if(e)return{typeName:n.typeName,paths:e};break}case"google.protobuf.DoubleValue":case"google.protobuf.FloatValue":case"google.protobuf.Int64Value":case"google.protobuf.UInt64Value":case"google.protobuf.Int32Value":case"google.protobuf.UInt32Value":case"google.protobuf.BoolValue":case"google.protobuf.StringValue":case"google.protobuf.BytesValue":{const e=n.fields.find(t=>t.number==1&&t.name=="value");if(!e||e.fieldKind!=="scalar")break;return{typeName:n.typeName,value:e}}}}const ee="@bufbuild/protobuf",Hc={packageName:"@bufbuild/protobuf",localName:Xr,reifyWkt:Xc,getUnwrappedFieldType:kc,scalarDefaultValue:jr,safeIdentifier:Bi,safeObjectProperty:rr,symbols:{proto2:{typeOnly:!1,privateImportPath:"./proto2.js",publicImportPath:ee},proto3:{typeOnly:!1,privateImportPath:"./proto3.js",publicImportPath:ee},Message:{typeOnly:!1,privateImportPath:"./message.js",publicImportPath:ee},PartialMessage:{typeOnly:!0,privateImportPath:"./message.js",publicImportPath:ee},PlainMessage:{typeOnly:!0,privateImportPath:"./message.js",publicImportPath:ee},FieldList:{typeOnly:!0,privateImportPath:"./field-list.js",publicImportPath:ee},MessageType:{typeOnly:!0,privateImportPath:"./message-type.js",publicImportPath:ee},BinaryReadOptions:{typeOnly:!0,privateImportPath:"./binary-format.js",publicImportPath:ee},BinaryWriteOptions:{typeOnly:!0,privateImportPath:"./binary-format.js",publicImportPath:ee},JsonReadOptions:{typeOnly:!0,privateImportPath:"./json-format.js",publicImportPath:ee},JsonWriteOptions:{typeOnly:!0,privateImportPath:"./json-format.js",publicImportPath:ee},JsonValue:{typeOnly:!0,privateImportPath:"./json-format.js",publicImportPath:ee},JsonObject:{typeOnly:!0,privateImportPath:"./json-format.js",publicImportPath:ee},protoDouble:{typeOnly:!1,privateImportPath:"./proto-double.js",publicImportPath:ee},protoInt64:{typeOnly:!1,privateImportPath:"./proto-int64.js",publicImportPath:ee},ScalarType:{typeOnly:!1,privateImportPath:"./field.js",publicImportPath:ee},LongType:{typeOnly:!1,privateImportPath:"./field.js",publicImportPath:ee},MethodKind:{typeOnly:!1,privateImportPath:"./service-type.js",publicImportPath:ee},MethodIdempotency:{typeOnly:!1,privateImportPath:"./service-type.js",publicImportPath:ee},IMessageTypeRegistry:{typeOnly:!0,privateImportPath:"./type-registry.js",publicImportPath:ee}},wktSourceFiles:["google/protobuf/compiler/plugin.proto","google/protobuf/any.proto","google/protobuf/api.proto","google/protobuf/descriptor.proto","google/protobuf/duration.proto","google/protobuf/empty.proto","google/protobuf/field_mask.proto","google/protobuf/source_context.proto","google/protobuf/struct.proto","google/protobuf/timestamp.proto","google/protobuf/type.proto","google/protobuf/wrappers.proto"]};var Ae;(function(n){n[n.Unary=0]="Unary",n[n.ServerStreaming=1]="ServerStreaming",n[n.ClientStreaming=2]="ClientStreaming",n[n.BiDiStreaming=3]="BiDiStreaming"})(Ae||(Ae={}));var sr;(function(n){n[n.NoSideEffects=1]="NoSideEffects",n[n.Idempotent=2]="Idempotent"})(sr||(sr={}));var V;(function(n){n[n.EDITION_UNKNOWN=0]="EDITION_UNKNOWN",n[n.EDITION_PROTO2=998]="EDITION_PROTO2",n[n.EDITION_PROTO3=999]="EDITION_PROTO3",n[n.EDITION_2023=1e3]="EDITION_2023",n[n.EDITION_1_TEST_ONLY=1]="EDITION_1_TEST_ONLY",n[n.EDITION_2_TEST_ONLY=2]="EDITION_2_TEST_ONLY",n[n.EDITION_99997_TEST_ONLY=99997]="EDITION_99997_TEST_ONLY",n[n.EDITION_99998_TEST_ONLY=99998]="EDITION_99998_TEST_ONLY",n[n.EDITION_99999_TEST_ONLY=99999]="EDITION_99999_TEST_ONLY"})(V||(V={})),d.util.setEnumType(V,"google.protobuf.Edition",[{no:0,name:"EDITION_UNKNOWN"},{no:998,name:"EDITION_PROTO2"},{no:999,name:"EDITION_PROTO3"},{no:1e3,name:"EDITION_2023"},{no:1,name:"EDITION_1_TEST_ONLY"},{no:2,name:"EDITION_2_TEST_ONLY"},{no:99997,name:"EDITION_99997_TEST_ONLY"},{no:99998,name:"EDITION_99998_TEST_ONLY"},{no:99999,name:"EDITION_99999_TEST_ONLY"}]);class _e extends w{constructor(e){super(),this.file=[],d.util.initPartial(e,this)}static fromBinary(e,t){return new _e().fromBinary(e,t)}static fromJson(e,t){return new _e().fromJson(e,t)}static fromJsonString(e,t){return new _e().fromJsonString(e,t)}static equals(e,t){return d.util.equals(_e,e,t)}}_e.runtime=d,_e.typeName="google.protobuf.FileDescriptorSet",_e.fields=d.util.newFieldList(()=>[{no:1,name:"file",kind:"message",T:Oe,repeated:!0}]);class Oe extends w{constructor(e){super(),this.dependency=[],this.publicDependency=[],this.weakDependency=[],this.messageType=[],this.enumType=[],this.service=[],this.extension=[],d.util.initPartial(e,this)}static fromBinary(e,t){return new Oe().fromBinary(e,t)}static fromJson(e,t){return new Oe().fromJson(e,t)}static fromJsonString(e,t){return new Oe().fromJsonString(e,t)}static equals(e,t){return d.util.equals(Oe,e,t)}}Oe.runtime=d,Oe.typeName="google.protobuf.FileDescriptorProto",Oe.fields=d.util.newFieldList(()=>[{no:1,name:"name",kind:"scalar",T:9,opt:!0},{no:2,name:"package",kind:"scalar",T:9,opt:!0},{no:3,name:"dependency",kind:"scalar",T:9,repeated:!0},{no:10,name:"public_dependency",kind:"scalar",T:5,repeated:!0},{no:11,name:"weak_dependency",kind:"scalar",T:5,repeated:!0},{no:4,name:"message_type",kind:"message",T:Ge,repeated:!0},{no:5,name:"enum_type",kind:"message",T:ze,repeated:!0},{no:6,name:"service",kind:"message",T:lt,repeated:!0},{no:7,name:"extension",kind:"message",T:Pe,repeated:!0},{no:8,name:"options",kind:"message",T:ft,opt:!0},{no:9,name:"source_code_info",kind:"message",T:Et,opt:!0},{no:12,name:"syntax",kind:"scalar",T:9,opt:!0},{no:14,name:"edition",kind:"enum",T:d.getEnumType(V),opt:!0}]);class Ge extends w{constructor(e){super(),this.field=[],this.extension=[],this.nestedType=[],this.enumType=[],this.extensionRange=[],this.oneofDecl=[],this.reservedRange=[],this.reservedName=[],d.util.initPartial(e,this)}static fromBinary(e,t){return new Ge().fromBinary(e,t)}static fromJson(e,t){return new Ge().fromJson(e,t)}static fromJsonString(e,t){return new Ge().fromJsonString(e,t)}static equals(e,t){return d.util.equals(Ge,e,t)}}Ge.runtime=d,Ge.typeName="google.protobuf.DescriptorProto",Ge.fields=d.util.newFieldList(()=>[{no:1,name:"name",kind:"scalar",T:9,opt:!0},{no:2,name:"field",kind:"message",T:Pe,repeated:!0},{no:6,name:"extension",kind:"message",T:Pe,repeated:!0},{no:3,name:"nested_type",kind:"message",T:Ge,repeated:!0},{no:4,name:"enum_type",kind:"message",T:ze,repeated:!0},{no:5,name:"extension_range",kind:"message",T:rt,repeated:!0},{no:8,name:"oneof_decl",kind:"message",T:at,repeated:!0},{no:7,name:"options",kind:"message",T:dt,opt:!0},{no:9,name:"reserved_range",kind:"message",T:st,repeated:!0},{no:10,name:"reserved_name",kind:"scalar",T:9,repeated:!0}]);class rt extends w{constructor(e){super(),d.util.initPartial(e,this)}static fromBinary(e,t){return new rt().fromBinary(e,t)}static fromJson(e,t){return new rt().fromJson(e,t)}static fromJsonString(e,t){return new rt().fromJsonString(e,t)}static equals(e,t){return d.util.equals(rt,e,t)}}rt.runtime=d,rt.typeName="google.protobuf.DescriptorProto.ExtensionRange",rt.fields=d.util.newFieldList(()=>[{no:1,name:"start",kind:"scalar",T:5,opt:!0},{no:2,name:"end",kind:"scalar",T:5,opt:!0},{no:3,name:"options",kind:"message",T:it,opt:!0}]);class st extends w{constructor(e){super(),d.util.initPartial(e,this)}static fromBinary(e,t){return new st().fromBinary(e,t)}static fromJson(e,t){return new st().fromJson(e,t)}static fromJsonString(e,t){return new st().fromJsonString(e,t)}static equals(e,t){return d.util.equals(st,e,t)}}st.runtime=d,st.typeName="google.protobuf.DescriptorProto.ReservedRange",st.fields=d.util.newFieldList(()=>[{no:1,name:"start",kind:"scalar",T:5,opt:!0},{no:2,name:"end",kind:"scalar",T:5,opt:!0}]);class it extends w{constructor(e){super(),this.uninterpretedOption=[],this.declaration=[],d.util.initPartial(e,this)}static fromBinary(e,t){return new it().fromBinary(e,t)}static fromJson(e,t){return new it().fromJson(e,t)}static fromJsonString(e,t){return new it().fromJsonString(e,t)}static equals(e,t){return d.util.equals(it,e,t)}}it.runtime=d,it.typeName="google.protobuf.ExtensionRangeOptions",it.fields=d.util.newFieldList(()=>[{no:999,name:"uninterpreted_option",kind:"message",T:oe,repeated:!0},{no:2,name:"declaration",kind:"message",T:ot,repeated:!0},{no:50,name:"features",kind:"message",T:Z,opt:!0},{no:3,name:"verification",kind:"enum",T:d.getEnumType(Cn),opt:!0,default:Cn.UNVERIFIED}]);var Cn;(function(n){n[n.DECLARATION=0]="DECLARATION",n[n.UNVERIFIED=1]="UNVERIFIED"})(Cn||(Cn={})),d.util.setEnumType(Cn,"google.protobuf.ExtensionRangeOptions.VerificationState",[{no:0,name:"DECLARATION"},{no:1,name:"UNVERIFIED"}]);class ot extends w{constructor(e){super(),d.util.initPartial(e,this)}static fromBinary(e,t){return new ot().fromBinary(e,t)}static fromJson(e,t){return new ot().fromJson(e,t)}static fromJsonString(e,t){return new ot().fromJsonString(e,t)}static equals(e,t){return d.util.equals(ot,e,t)}}ot.runtime=d,ot.typeName="google.protobuf.ExtensionRangeOptions.Declaration",ot.fields=d.util.newFieldList(()=>[{no:1,name:"number",kind:"scalar",T:5,opt:!0},{no:2,name:"full_name",kind:"scalar",T:9,opt:!0},{no:3,name:"type",kind:"scalar",T:9,opt:!0},{no:5,name:"reserved",kind:"scalar",T:8,opt:!0},{no:6,name:"repeated",kind:"scalar",T:8,opt:!0}]);class Pe extends w{constructor(e){super(),d.util.initPartial(e,this)}static fromBinary(e,t){return new Pe().fromBinary(e,t)}static fromJson(e,t){return new Pe().fromJson(e,t)}static fromJsonString(e,t){return new Pe().fromJsonString(e,t)}static equals(e,t){return d.util.equals(Pe,e,t)}}Pe.runtime=d,Pe.typeName="google.protobuf.FieldDescriptorProto",Pe.fields=d.util.newFieldList(()=>[{no:1,name:"name",kind:"scalar",T:9,opt:!0},{no:3,name:"number",kind:"scalar",T:5,opt:!0},{no:4,name:"label",kind:"enum",T:d.getEnumType(en),opt:!0},{no:5,name:"type",kind:"enum",T:d.getEnumType(J),opt:!0},{no:6,name:"type_name",kind:"scalar",T:9,opt:!0},{no:2,name:"extendee",kind:"scalar",T:9,opt:!0},{no:7,name:"default_value",kind:"scalar",T:9,opt:!0},{no:9,name:"oneof_index",kind:"scalar",T:5,opt:!0},{no:10,name:"json_name",kind:"scalar",T:9,opt:!0},{no:8,name:"options",kind:"message",T:mt,opt:!0},{no:17,name:"proto3_optional",kind:"scalar",T:8,opt:!0}]);var J;(function(n){n[n.DOUBLE=1]="DOUBLE",n[n.FLOAT=2]="FLOAT",n[n.INT64=3]="INT64",n[n.UINT64=4]="UINT64",n[n.INT32=5]="INT32",n[n.FIXED64=6]="FIXED64",n[n.FIXED32=7]="FIXED32",n[n.BOOL=8]="BOOL",n[n.STRING=9]="STRING",n[n.GROUP=10]="GROUP",n[n.MESSAGE=11]="MESSAGE",n[n.BYTES=12]="BYTES",n[n.UINT32=13]="UINT32",n[n.ENUM=14]="ENUM",n[n.SFIXED32=15]="SFIXED32",n[n.SFIXED64=16]="SFIXED64",n[n.SINT32=17]="SINT32",n[n.SINT64=18]="SINT64"})(J||(J={})),d.util.setEnumType(J,"google.protobuf.FieldDescriptorProto.Type",[{no:1,name:"TYPE_DOUBLE"},{no:2,name:"TYPE_FLOAT"},{no:3,name:"TYPE_INT64"},{no:4,name:"TYPE_UINT64"},{no:5,name:"TYPE_INT32"},{no:6,name:"TYPE_FIXED64"},{no:7,name:"TYPE_FIXED32"},{no:8,name:"TYPE_BOOL"},{no:9,name:"TYPE_STRING"},{no:10,name:"TYPE_GROUP"},{no:11,name:"TYPE_MESSAGE"},{no:12,name:"TYPE_BYTES"},{no:13,name:"TYPE_UINT32"},{no:14,name:"TYPE_ENUM"},{no:15,name:"TYPE_SFIXED32"},{no:16,name:"TYPE_SFIXED64"},{no:17,name:"TYPE_SINT32"},{no:18,name:"TYPE_SINT64"}]);var en;(function(n){n[n.OPTIONAL=1]="OPTIONAL",n[n.REPEATED=3]="REPEATED",n[n.REQUIRED=2]="REQUIRED"})(en||(en={})),d.util.setEnumType(en,"google.protobuf.FieldDescriptorProto.Label",[{no:1,name:"LABEL_OPTIONAL"},{no:3,name:"LABEL_REPEATED"},{no:2,name:"LABEL_REQUIRED"}]);class at extends w{constructor(e){super(),d.util.initPartial(e,this)}static fromBinary(e,t){return new at().fromBinary(e,t)}static fromJson(e,t){return new at().fromJson(e,t)}static fromJsonString(e,t){return new at().fromJsonString(e,t)}static equals(e,t){return d.util.equals(at,e,t)}}at.runtime=d,at.typeName="google.protobuf.OneofDescriptorProto",at.fields=d.util.newFieldList(()=>[{no:1,name:"name",kind:"scalar",T:9,opt:!0},{no:2,name:"options",kind:"message",T:pt,opt:!0}]);class ze extends w{constructor(e){super(),this.value=[],this.reservedRange=[],this.reservedName=[],d.util.initPartial(e,this)}static fromBinary(e,t){return new ze().fromBinary(e,t)}static fromJson(e,t){return new ze().fromJson(e,t)}static fromJsonString(e,t){return new ze().fromJsonString(e,t)}static equals(e,t){return d.util.equals(ze,e,t)}}ze.runtime=d,ze.typeName="google.protobuf.EnumDescriptorProto",ze.fields=d.util.newFieldList(()=>[{no:1,name:"name",kind:"scalar",T:9,opt:!0},{no:2,name:"value",kind:"message",T:ut,repeated:!0},{no:3,name:"options",kind:"message",T:yt,opt:!0},{no:4,name:"reserved_range",kind:"message",T:ct,repeated:!0},{no:5,name:"reserved_name",kind:"scalar",T:9,repeated:!0}]);class ct extends w{constructor(e){super(),d.util.initPartial(e,this)}static fromBinary(e,t){return new ct().fromBinary(e,t)}static fromJson(e,t){return new ct().fromJson(e,t)}static fromJsonString(e,t){return new ct().fromJsonString(e,t)}static equals(e,t){return d.util.equals(ct,e,t)}}ct.runtime=d,ct.typeName="google.protobuf.EnumDescriptorProto.EnumReservedRange",ct.fields=d.util.newFieldList(()=>[{no:1,name:"start",kind:"scalar",T:5,opt:!0},{no:2,name:"end",kind:"scalar",T:5,opt:!0}]);class ut extends w{constructor(e){super(),d.util.initPartial(e,this)}static fromBinary(e,t){return new ut().fromBinary(e,t)}static fromJson(e,t){return new ut().fromJson(e,t)}static fromJsonString(e,t){return new ut().fromJsonString(e,t)}static equals(e,t){return d.util.equals(ut,e,t)}}ut.runtime=d,ut.typeName="google.protobuf.EnumValueDescriptorProto",ut.fields=d.util.newFieldList(()=>[{no:1,name:"name",kind:"scalar",T:9,opt:!0},{no:2,name:"number",kind:"scalar",T:5,opt:!0},{no:3,name:"options",kind:"message",T:Tt,opt:!0}]);class lt extends w{constructor(e){super(),this.method=[],d.util.initPartial(e,this)}static fromBinary(e,t){return new lt().fromBinary(e,t)}static fromJson(e,t){return new lt().fromJson(e,t)}static fromJsonString(e,t){return new lt().fromJsonString(e,t)}static equals(e,t){return d.util.equals(lt,e,t)}}lt.runtime=d,lt.typeName="google.protobuf.ServiceDescriptorProto",lt.fields=d.util.newFieldList(()=>[{no:1,name:"name",kind:"scalar",T:9,opt:!0},{no:2,name:"method",kind:"message",T:ht,repeated:!0},{no:3,name:"options",kind:"message",T:vt,opt:!0}]);class ht extends w{constructor(e){super(),d.util.initPartial(e,this)}static fromBinary(e,t){return new ht().fromBinary(e,t)}static fromJson(e,t){return new ht().fromJson(e,t)}static fromJsonString(e,t){return new ht().fromJsonString(e,t)}static equals(e,t){return d.util.equals(ht,e,t)}}ht.runtime=d,ht.typeName="google.protobuf.MethodDescriptorProto",ht.fields=d.util.newFieldList(()=>[{no:1,name:"name",kind:"scalar",T:9,opt:!0},{no:2,name:"input_type",kind:"scalar",T:9,opt:!0},{no:3,name:"output_type",kind:"scalar",T:9,opt:!0},{no:4,name:"options",kind:"message",T:St,opt:!0},{no:5,name:"client_streaming",kind:"scalar",T:8,opt:!0,default:!1},{no:6,name:"server_streaming",kind:"scalar",T:8,opt:!0,default:!1}]);class ft extends w{constructor(e){super(),this.uninterpretedOption=[],d.util.initPartial(e,this)}static fromBinary(e,t){return new ft().fromBinary(e,t)}static fromJson(e,t){return new ft().fromJson(e,t)}static fromJsonString(e,t){return new ft().fromJsonString(e,t)}static equals(e,t){return d.util.equals(ft,e,t)}}ft.runtime=d,ft.typeName="google.protobuf.FileOptions",ft.fields=d.util.newFieldList(()=>[{no:1,name:"java_package",kind:"scalar",T:9,opt:!0},{no:8,name:"java_outer_classname",kind:"scalar",T:9,opt:!0},{no:10,name:"java_multiple_files",kind:"scalar",T:8,opt:!0,default:!1},{no:20,name:"java_generate_equals_and_hash",kind:"scalar",T:8,opt:!0},{no:27,name:"java_string_check_utf8",kind:"scalar",T:8,opt:!0,default:!1},{no:9,name:"optimize_for",kind:"enum",T:d.getEnumType(Rn),opt:!0,default:Rn.SPEED},{no:11,name:"go_package",kind:"scalar",T:9,opt:!0},{no:16,name:"cc_generic_services",kind:"scalar",T:8,opt:!0,default:!1},{no:17,name:"java_generic_services",kind:"scalar",T:8,opt:!0,default:!1},{no:18,name:"py_generic_services",kind:"scalar",T:8,opt:!0,default:!1},{no:42,name:"php_generic_services",kind:"scalar",T:8,opt:!0,default:!1},{no:23,name:"deprecated",kind:"scalar",T:8,opt:!0,default:!1},{no:31,name:"cc_enable_arenas",kind:"scalar",T:8,opt:!0,default:!0},{no:36,name:"objc_class_prefix",kind:"scalar",T:9,opt:!0},{no:37,name:"csharp_namespace",kind:"scalar",T:9,opt:!0},{no:39,name:"swift_prefix",kind:"scalar",T:9,opt:!0},{no:40,name:"php_class_prefix",kind:"scalar",T:9,opt:!0},{no:41,name:"php_namespace",kind:"scalar",T:9,opt:!0},{no:44,name:"php_metadata_namespace",kind:"scalar",T:9,opt:!0},{no:45,name:"ruby_package",kind:"scalar",T:9,opt:!0},{no:50,name:"features",kind:"message",T:Z,opt:!0},{no:999,name:"uninterpreted_option",kind:"message",T:oe,repeated:!0}]);var Rn;(function(n){n[n.SPEED=1]="SPEED",n[n.CODE_SIZE=2]="CODE_SIZE",n[n.LITE_RUNTIME=3]="LITE_RUNTIME"})(Rn||(Rn={})),d.util.setEnumType(Rn,"google.protobuf.FileOptions.OptimizeMode",[{no:1,name:"SPEED"},{no:2,name:"CODE_SIZE"},{no:3,name:"LITE_RUNTIME"}]);class dt extends w{constructor(e){super(),this.uninterpretedOption=[],d.util.initPartial(e,this)}static fromBinary(e,t){return new dt().fromBinary(e,t)}static fromJson(e,t){return new dt().fromJson(e,t)}static fromJsonString(e,t){return new dt().fromJsonString(e,t)}static equals(e,t){return d.util.equals(dt,e,t)}}dt.runtime=d,dt.typeName="google.protobuf.MessageOptions",dt.fields=d.util.newFieldList(()=>[{no:1,name:"message_set_wire_format",kind:"scalar",T:8,opt:!0,default:!1},{no:2,name:"no_standard_descriptor_accessor",kind:"scalar",T:8,opt:!0,default:!1},{no:3,name:"deprecated",kind:"scalar",T:8,opt:!0,default:!1},{no:7,name:"map_entry",kind:"scalar",T:8,opt:!0},{no:11,name:"deprecated_legacy_json_field_conflicts",kind:"scalar",T:8,opt:!0},{no:12,name:"features",kind:"message",T:Z,opt:!0},{no:999,name:"uninterpreted_option",kind:"message",T:oe,repeated:!0}]);class mt extends w{constructor(e){super(),this.targets=[],this.editionDefaults=[],this.uninterpretedOption=[],d.util.initPartial(e,this)}static fromBinary(e,t){return new mt().fromBinary(e,t)}static fromJson(e,t){return new mt().fromJson(e,t)}static fromJsonString(e,t){return new mt().fromJsonString(e,t)}static equals(e,t){return d.util.equals(mt,e,t)}}mt.runtime=d,mt.typeName="google.protobuf.FieldOptions",mt.fields=d.util.newFieldList(()=>[{no:1,name:"ctype",kind:"enum",T:d.getEnumType(Jn),opt:!0,default:Jn.STRING},{no:2,name:"packed",kind:"scalar",T:8,opt:!0},{no:6,name:"jstype",kind:"enum",T:d.getEnumType(tn),opt:!0,default:tn.JS_NORMAL},{no:5,name:"lazy",kind:"scalar",T:8,opt:!0,default:!1},{no:15,name:"unverified_lazy",kind:"scalar",T:8,opt:!0,default:!1},{no:3,name:"deprecated",kind:"scalar",T:8,opt:!0,default:!1},{no:10,name:"weak",kind:"scalar",T:8,opt:!0,default:!1},{no:16,name:"debug_redact",kind:"scalar",T:8,opt:!0,default:!1},{no:17,name:"retention",kind:"enum",T:d.getEnumType(ir),opt:!0},{no:19,name:"targets",kind:"enum",T:d.getEnumType(or),repeated:!0},{no:20,name:"edition_defaults",kind:"message",T:gt,repeated:!0},{no:21,name:"features",kind:"message",T:Z,opt:!0},{no:999,name:"uninterpreted_option",kind:"message",T:oe,repeated:!0}]);var Jn;(function(n){n[n.STRING=0]="STRING",n[n.CORD=1]="CORD",n[n.STRING_PIECE=2]="STRING_PIECE"})(Jn||(Jn={})),d.util.setEnumType(Jn,"google.protobuf.FieldOptions.CType",[{no:0,name:"STRING"},{no:1,name:"CORD"},{no:2,name:"STRING_PIECE"}]);var tn;(function(n){n[n.JS_NORMAL=0]="JS_NORMAL",n[n.JS_STRING=1]="JS_STRING",n[n.JS_NUMBER=2]="JS_NUMBER"})(tn||(tn={})),d.util.setEnumType(tn,"google.protobuf.FieldOptions.JSType",[{no:0,name:"JS_NORMAL"},{no:1,name:"JS_STRING"},{no:2,name:"JS_NUMBER"}]);var ir;(function(n){n[n.RETENTION_UNKNOWN=0]="RETENTION_UNKNOWN",n[n.RETENTION_RUNTIME=1]="RETENTION_RUNTIME",n[n.RETENTION_SOURCE=2]="RETENTION_SOURCE"})(ir||(ir={})),d.util.setEnumType(ir,"google.protobuf.FieldOptions.OptionRetention",[{no:0,name:"RETENTION_UNKNOWN"},{no:1,name:"RETENTION_RUNTIME"},{no:2,name:"RETENTION_SOURCE"}]);var or;(function(n){n[n.TARGET_TYPE_UNKNOWN=0]="TARGET_TYPE_UNKNOWN",n[n.TARGET_TYPE_FILE=1]="TARGET_TYPE_FILE",n[n.TARGET_TYPE_EXTENSION_RANGE=2]="TARGET_TYPE_EXTENSION_RANGE",n[n.TARGET_TYPE_MESSAGE=3]="TARGET_TYPE_MESSAGE",n[n.TARGET_TYPE_FIELD=4]="TARGET_TYPE_FIELD",n[n.TARGET_TYPE_ONEOF=5]="TARGET_TYPE_ONEOF",n[n.TARGET_TYPE_ENUM=6]="TARGET_TYPE_ENUM",n[n.TARGET_TYPE_ENUM_ENTRY=7]="TARGET_TYPE_ENUM_ENTRY",n[n.TARGET_TYPE_SERVICE=8]="TARGET_TYPE_SERVICE",n[n.TARGET_TYPE_METHOD=9]="TARGET_TYPE_METHOD"})(or||(or={})),d.util.setEnumType(or,"google.protobuf.FieldOptions.OptionTargetType",[{no:0,name:"TARGET_TYPE_UNKNOWN"},{no:1,name:"TARGET_TYPE_FILE"},{no:2,name:"TARGET_TYPE_EXTENSION_RANGE"},{no:3,name:"TARGET_TYPE_MESSAGE"},{no:4,name:"TARGET_TYPE_FIELD"},{no:5,name:"TARGET_TYPE_ONEOF"},{no:6,name:"TARGET_TYPE_ENUM"},{no:7,name:"TARGET_TYPE_ENUM_ENTRY"},{no:8,name:"TARGET_TYPE_SERVICE"},{no:9,name:"TARGET_TYPE_METHOD"}]);class gt extends w{constructor(e){super(),d.util.initPartial(e,this)}static fromBinary(e,t){return new gt().fromBinary(e,t)}static fromJson(e,t){return new gt().fromJson(e,t)}static fromJsonString(e,t){return new gt().fromJsonString(e,t)}static equals(e,t){return d.util.equals(gt,e,t)}}gt.runtime=d,gt.typeName="google.protobuf.FieldOptions.EditionDefault",gt.fields=d.util.newFieldList(()=>[{no:3,name:"edition",kind:"enum",T:d.getEnumType(V),opt:!0},{no:2,name:"value",kind:"scalar",T:9,opt:!0}]);class pt extends w{constructor(e){super(),this.uninterpretedOption=[],d.util.initPartial(e,this)}static fromBinary(e,t){return new pt().fromBinary(e,t)}static fromJson(e,t){return new pt().fromJson(e,t)}static fromJsonString(e,t){return new pt().fromJsonString(e,t)}static equals(e,t){return d.util.equals(pt,e,t)}}pt.runtime=d,pt.typeName="google.protobuf.OneofOptions",pt.fields=d.util.newFieldList(()=>[{no:1,name:"features",kind:"message",T:Z,opt:!0},{no:999,name:"uninterpreted_option",kind:"message",T:oe,repeated:!0}]);class yt extends w{constructor(e){super(),this.uninterpretedOption=[],d.util.initPartial(e,this)}static fromBinary(e,t){return new yt().fromBinary(e,t)}static fromJson(e,t){return new yt().fromJson(e,t)}static fromJsonString(e,t){return new yt().fromJsonString(e,t)}static equals(e,t){return d.util.equals(yt,e,t)}}yt.runtime=d,yt.typeName="google.protobuf.EnumOptions",yt.fields=d.util.newFieldList(()=>[{no:2,name:"allow_alias",kind:"scalar",T:8,opt:!0},{no:3,name:"deprecated",kind:"scalar",T:8,opt:!0,default:!1},{no:6,name:"deprecated_legacy_json_field_conflicts",kind:"scalar",T:8,opt:!0},{no:7,name:"features",kind:"message",T:Z,opt:!0},{no:999,name:"uninterpreted_option",kind:"message",T:oe,repeated:!0}]);class Tt extends w{constructor(e){super(),this.uninterpretedOption=[],d.util.initPartial(e,this)}static fromBinary(e,t){return new Tt().fromBinary(e,t)}static fromJson(e,t){return new Tt().fromJson(e,t)}static fromJsonString(e,t){return new Tt().fromJsonString(e,t)}static equals(e,t){return d.util.equals(Tt,e,t)}}Tt.runtime=d,Tt.typeName="google.protobuf.EnumValueOptions",Tt.fields=d.util.newFieldList(()=>[{no:1,name:"deprecated",kind:"scalar",T:8,opt:!0,default:!1},{no:2,name:"features",kind:"message",T:Z,opt:!0},{no:3,name:"debug_redact",kind:"scalar",T:8,opt:!0,default:!1},{no:999,name:"uninterpreted_option",kind:"message",T:oe,repeated:!0}]);class vt extends w{constructor(e){super(),this.uninterpretedOption=[],d.util.initPartial(e,this)}static fromBinary(e,t){return new vt().fromBinary(e,t)}static fromJson(e,t){return new vt().fromJson(e,t)}static fromJsonString(e,t){return new vt().fromJsonString(e,t)}static equals(e,t){return d.util.equals(vt,e,t)}}vt.runtime=d,vt.typeName="google.protobuf.ServiceOptions",vt.fields=d.util.newFieldList(()=>[{no:34,name:"features",kind:"message",T:Z,opt:!0},{no:33,name:"deprecated",kind:"scalar",T:8,opt:!0,default:!1},{no:999,name:"uninterpreted_option",kind:"message",T:oe,repeated:!0}]);class St extends w{constructor(e){super(),this.uninterpretedOption=[],d.util.initPartial(e,this)}static fromBinary(e,t){return new St().fromBinary(e,t)}static fromJson(e,t){return new St().fromJson(e,t)}static fromJsonString(e,t){return new St().fromJsonString(e,t)}static equals(e,t){return d.util.equals(St,e,t)}}St.runtime=d,St.typeName="google.protobuf.MethodOptions",St.fields=d.util.newFieldList(()=>[{no:33,name:"deprecated",kind:"scalar",T:8,opt:!0,default:!1},{no:34,name:"idempotency_level",kind:"enum",T:d.getEnumType(qt),opt:!0,default:qt.IDEMPOTENCY_UNKNOWN},{no:35,name:"features",kind:"message",T:Z,opt:!0},{no:999,name:"uninterpreted_option",kind:"message",T:oe,repeated:!0}]);var qt;(function(n){n[n.IDEMPOTENCY_UNKNOWN=0]="IDEMPOTENCY_UNKNOWN",n[n.NO_SIDE_EFFECTS=1]="NO_SIDE_EFFECTS",n[n.IDEMPOTENT=2]="IDEMPOTENT"})(qt||(qt={})),d.util.setEnumType(qt,"google.protobuf.MethodOptions.IdempotencyLevel",[{no:0,name:"IDEMPOTENCY_UNKNOWN"},{no:1,name:"NO_SIDE_EFFECTS"},{no:2,name:"IDEMPOTENT"}]);class oe extends w{constructor(e){super(),this.name=[],d.util.initPartial(e,this)}static fromBinary(e,t){return new oe().fromBinary(e,t)}static fromJson(e,t){return new oe().fromJson(e,t)}static fromJsonString(e,t){return new oe().fromJsonString(e,t)}static equals(e,t){return d.util.equals(oe,e,t)}}oe.runtime=d,oe.typeName="google.protobuf.UninterpretedOption",oe.fields=d.util.newFieldList(()=>[{no:2,name:"name",kind:"message",T:bt,repeated:!0},{no:3,name:"identifier_value",kind:"scalar",T:9,opt:!0},{no:4,name:"positive_int_value",kind:"scalar",T:4,opt:!0},{no:5,name:"negative_int_value",kind:"scalar",T:3,opt:!0},{no:6,name:"double_value",kind:"scalar",T:1,opt:!0},{no:7,name:"string_value",kind:"scalar",T:12,opt:!0},{no:8,name:"aggregate_value",kind:"scalar",T:9,opt:!0}]);class bt extends w{constructor(e){super(),d.util.initPartial(e,this)}static fromBinary(e,t){return new bt().fromBinary(e,t)}static fromJson(e,t){return new bt().fromJson(e,t)}static fromJsonString(e,t){return new bt().fromJsonString(e,t)}static equals(e,t){return d.util.equals(bt,e,t)}}bt.runtime=d,bt.typeName="google.protobuf.UninterpretedOption.NamePart",bt.fields=d.util.newFieldList(()=>[{no:1,name:"name_part",kind:"scalar",T:9},{no:2,name:"is_extension",kind:"scalar",T:8}]);class Z extends w{constructor(e){super(),d.util.initPartial(e,this)}static fromBinary(e,t){return new Z().fromBinary(e,t)}static fromJson(e,t){return new Z().fromJson(e,t)}static fromJsonString(e,t){return new Z().fromJsonString(e,t)}static equals(e,t){return d.util.equals(Z,e,t)}}Z.runtime=d,Z.typeName="google.protobuf.FeatureSet",Z.fields=d.util.newFieldList(()=>[{no:1,name:"field_presence",kind:"enum",T:d.getEnumType(ar),opt:!0},{no:2,name:"enum_type",kind:"enum",T:d.getEnumType(cr),opt:!0},{no:3,name:"repeated_field_encoding",kind:"enum",T:d.getEnumType(mn),opt:!0},{no:4,name:"utf8_validation",kind:"enum",T:d.getEnumType(ur),opt:!0},{no:5,name:"message_encoding",kind:"enum",T:d.getEnumType(lr),opt:!0},{no:6,name:"json_format",kind:"enum",T:d.getEnumType(hr),opt:!0}]);var ar;(function(n){n[n.FIELD_PRESENCE_UNKNOWN=0]="FIELD_PRESENCE_UNKNOWN",n[n.EXPLICIT=1]="EXPLICIT",n[n.IMPLICIT=2]="IMPLICIT",n[n.LEGACY_REQUIRED=3]="LEGACY_REQUIRED"})(ar||(ar={})),d.util.setEnumType(ar,"google.protobuf.FeatureSet.FieldPresence",[{no:0,name:"FIELD_PRESENCE_UNKNOWN"},{no:1,name:"EXPLICIT"},{no:2,name:"IMPLICIT"},{no:3,name:"LEGACY_REQUIRED"}]);var cr;(function(n){n[n.ENUM_TYPE_UNKNOWN=0]="ENUM_TYPE_UNKNOWN",n[n.OPEN=1]="OPEN",n[n.CLOSED=2]="CLOSED"})(cr||(cr={})),d.util.setEnumType(cr,"google.protobuf.FeatureSet.EnumType",[{no:0,name:"ENUM_TYPE_UNKNOWN"},{no:1,name:"OPEN"},{no:2,name:"CLOSED"}]);var mn;(function(n){n[n.REPEATED_FIELD_ENCODING_UNKNOWN=0]="REPEATED_FIELD_ENCODING_UNKNOWN",n[n.PACKED=1]="PACKED",n[n.EXPANDED=2]="EXPANDED"})(mn||(mn={})),d.util.setEnumType(mn,"google.protobuf.FeatureSet.RepeatedFieldEncoding",[{no:0,name:"REPEATED_FIELD_ENCODING_UNKNOWN"},{no:1,name:"PACKED"},{no:2,name:"EXPANDED"}]);var ur;(function(n){n[n.UTF8_VALIDATION_UNKNOWN=0]="UTF8_VALIDATION_UNKNOWN",n[n.NONE=1]="NONE",n[n.VERIFY=2]="VERIFY"})(ur||(ur={})),d.util.setEnumType(ur,"google.protobuf.FeatureSet.Utf8Validation",[{no:0,name:"UTF8_VALIDATION_UNKNOWN"},{no:1,name:"NONE"},{no:2,name:"VERIFY"}]);var lr;(function(n){n[n.MESSAGE_ENCODING_UNKNOWN=0]="MESSAGE_ENCODING_UNKNOWN",n[n.LENGTH_PREFIXED=1]="LENGTH_PREFIXED",n[n.DELIMITED=2]="DELIMITED"})(lr||(lr={})),d.util.setEnumType(lr,"google.protobuf.FeatureSet.MessageEncoding",[{no:0,name:"MESSAGE_ENCODING_UNKNOWN"},{no:1,name:"LENGTH_PREFIXED"},{no:2,name:"DELIMITED"}]);var hr;(function(n){n[n.JSON_FORMAT_UNKNOWN=0]="JSON_FORMAT_UNKNOWN",n[n.ALLOW=1]="ALLOW",n[n.LEGACY_BEST_EFFORT=2]="LEGACY_BEST_EFFORT"})(hr||(hr={})),d.util.setEnumType(hr,"google.protobuf.FeatureSet.JsonFormat",[{no:0,name:"JSON_FORMAT_UNKNOWN"},{no:1,name:"ALLOW"},{no:2,name:"LEGACY_BEST_EFFORT"}]);class wt extends w{constructor(e){super(),this.defaults=[],d.util.initPartial(e,this)}static fromBinary(e,t){return new wt().fromBinary(e,t)}static fromJson(e,t){return new wt().fromJson(e,t)}static fromJsonString(e,t){return new wt().fromJsonString(e,t)}static equals(e,t){return d.util.equals(wt,e,t)}}wt.runtime=d,wt.typeName="google.protobuf.FeatureSetDefaults",wt.fields=d.util.newFieldList(()=>[{no:1,name:"defaults",kind:"message",T:Nt,repeated:!0},{no:4,name:"minimum_edition",kind:"enum",T:d.getEnumType(V),opt:!0},{no:5,name:"maximum_edition",kind:"enum",T:d.getEnumType(V),opt:!0}]);class Nt extends w{constructor(e){super(),d.util.initPartial(e,this)}static fromBinary(e,t){return new Nt().fromBinary(e,t)}static fromJson(e,t){return new Nt().fromJson(e,t)}static fromJsonString(e,t){return new Nt().fromJsonString(e,t)}static equals(e,t){return d.util.equals(Nt,e,t)}}Nt.runtime=d,Nt.typeName="google.protobuf.FeatureSetDefaults.FeatureSetEditionDefault",Nt.fields=d.util.newFieldList(()=>[{no:3,name:"edition",kind:"enum",T:d.getEnumType(V),opt:!0},{no:2,name:"features",kind:"message",T:Z,opt:!0}]);class Et extends w{constructor(e){super(),this.location=[],d.util.initPartial(e,this)}static fromBinary(e,t){return new Et().fromBinary(e,t)}static fromJson(e,t){return new Et().fromJson(e,t)}static fromJsonString(e,t){return new Et().fromJsonString(e,t)}static equals(e,t){return d.util.equals(Et,e,t)}}Et.runtime=d,Et.typeName="google.protobuf.SourceCodeInfo",Et.fields=d.util.newFieldList(()=>[{no:1,name:"location",kind:"message",T:It,repeated:!0}]);class It extends w{constructor(e){super(),this.path=[],this.span=[],this.leadingDetachedComments=[],d.util.initPartial(e,this)}static fromBinary(e,t){return new It().fromBinary(e,t)}static fromJson(e,t){return new It().fromJson(e,t)}static fromJsonString(e,t){return new It().fromJsonString(e,t)}static equals(e,t){return d.util.equals(It,e,t)}}It.runtime=d,It.typeName="google.protobuf.SourceCodeInfo.Location",It.fields=d.util.newFieldList(()=>[{no:1,name:"path",kind:"scalar",T:5,repeated:!0,packed:!0},{no:2,name:"span",kind:"scalar",T:5,repeated:!0,packed:!0},{no:3,name:"leading_comments",kind:"scalar",T:9,opt:!0},{no:4,name:"trailing_comments",kind:"scalar",T:9,opt:!0},{no:6,name:"leading_detached_comments",kind:"scalar",T:9,repeated:!0}]);class kt extends w{constructor(e){super(),this.annotation=[],d.util.initPartial(e,this)}static fromBinary(e,t){return new kt().fromBinary(e,t)}static fromJson(e,t){return new kt().fromJson(e,t)}static fromJsonString(e,t){return new kt().fromJsonString(e,t)}static equals(e,t){return d.util.equals(kt,e,t)}}kt.runtime=d,kt.typeName="google.protobuf.GeneratedCodeInfo",kt.fields=d.util.newFieldList(()=>[{no:1,name:"annotation",kind:"message",T:At,repeated:!0}]);class At extends w{constructor(e){super(),this.path=[],d.util.initPartial(e,this)}static fromBinary(e,t){return new At().fromBinary(e,t)}static fromJson(e,t){return new At().fromJson(e,t)}static fromJsonString(e,t){return new At().fromJsonString(e,t)}static equals(e,t){return d.util.equals(At,e,t)}}At.runtime=d,At.typeName="google.protobuf.GeneratedCodeInfo.Annotation",At.fields=d.util.newFieldList(()=>[{no:1,name:"path",kind:"scalar",T:5,repeated:!0,packed:!0},{no:2,name:"source_file",kind:"scalar",T:9,opt:!0},{no:3,name:"begin",kind:"scalar",T:5,opt:!0},{no:4,name:"end",kind:"scalar",T:5,opt:!0},{no:5,name:"semantic",kind:"enum",T:d.getEnumType(fr),opt:!0}]);var fr;(function(n){n[n.NONE=0]="NONE",n[n.SET=1]="SET",n[n.ALIAS=2]="ALIAS"})(fr||(fr={})),d.util.setEnumType(fr,"google.protobuf.GeneratedCodeInfo.Annotation.Semantic",[{no:0,name:"NONE"},{no:1,name:"SET"},{no:2,name:"ALIAS"}]);function Zc(n,e){const t=n.values.find(r=>r.name===e);return k(t,`cannot parse ${n.name} default value: ${e}`),t.number}function Qc(n,e){switch(n){case m.STRING:return e;case m.BYTES:{const t=eu(e);if(t===!1)throw new Error(`cannot parse ${m[n]} default value: ${e}`);return t}case m.INT64:case m.SFIXED64:case m.SINT64:return z.parse(e);case m.UINT64:case m.FIXED64:return z.uParse(e);case m.DOUBLE:case m.FLOAT:switch(e){case"inf":return Number.POSITIVE_INFINITY;case"-inf":return Number.NEGATIVE_INFINITY;case"nan":return Number.NaN;default:return parseFloat(e)}case m.BOOL:return e==="true";case m.INT32:case m.UINT32:case m.SINT32:case m.FIXED32:case m.SFIXED32:return parseInt(e,10)}}function eu(n){const e=[],t={tail:n,c:"",next(){return this.tail.length==0?!1:(this.c=this.tail[0],this.tail=this.tail.substring(1),!0)},take(r){if(this.tail.length>=r){const s=this.tail.substring(0,r);return this.tail=this.tail.substring(r),s}return!1}};for(;t.next();)switch(t.c){case"\\":if(t.next())switch(t.c){case"\\":e.push(t.c.charCodeAt(0));break;case"b":e.push(8);break;case"f":e.push(12);break;case"n":e.push(10);break;case"r":e.push(13);break;case"t":e.push(9);break;case"v":e.push(11);break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":{const r=t.c,s=t.take(2);if(s===!1)return!1;const i=parseInt(r+s,8);if(isNaN(i))return!1;e.push(i);break}case"x":{const r=t.c,s=t.take(2);if(s===!1)return!1;const i=parseInt(r+s,16);if(isNaN(i))return!1;e.push(i);break}case"u":{const r=t.c,s=t.take(4);if(s===!1)return!1;const i=parseInt(r+s,16);if(isNaN(i))return!1;const o=new Uint8Array(4);new DataView(o.buffer).setInt32(0,i,!0),e.push(o[0],o[1],o[2],o[3]);break}case"U":{const r=t.c,s=t.take(8);if(s===!1)return!1;const i=z.uEnc(r+s),o=new Uint8Array(8),a=new DataView(o.buffer);a.setInt32(0,i.lo,!0),a.setInt32(4,i.hi,!0),e.push(o[0],o[1],o[2],o[3],o[4],o[5],o[6],o[7]);break}}break;default:e.push(t.c.charCodeAt(0))}return new Uint8Array(e)}const tu=wt.fromBinary(er.dec("ChESDAgBEAIYAiABKAEwAhjmBwoREgwIAhABGAEgAigBMAEY5wcKERIMCAEQARgBIAIoATABGOgHIOYHKOgH"));function nu(n){const e=n.minimumEdition,t=n.maximumEdition;if(e===void 0||t===void 0||n.defaults.some(s=>s.edition===void 0))throw new Error("Invalid FeatureSetDefaults");const r=new Map;return(s,...i)=>{var o,a;let c=r.get(s);if(c===void 0){if(s<e)throw new Error(`Edition ${V[s]} is earlier than the minimum supported edition ${V[e]}`);if(t<s)throw new Error(`Edition ${V[s]} is later than the maximum supported edition ${V[t]}`);let l;for(const y of n.defaults){const f=(o=y.edition)!==null&&o!==void 0?o:0;f>s||l!==void 0&&l.e>f||(l={e:f,f:(a=y.features)!==null&&a!==void 0?a:new Z})}if(l===void 0)throw new Error(`No valid default found for edition ${V[s]}`);c=l.f.toBinary(),r.set(s,c)}const u=Z.fromBinary(c);for(const l of i)l!==void 0&&u.fromBinary(l.toBinary());if(!ru(u))throw new Error(`Invalid FeatureSet for edition ${V[s]}`);return u}}function ru(n){for(const e of Z.fields.list()){const t=n[e.localName];if(t===void 0||e.kind=="enum"&&t===0)return!1}return!0}function Mi(n,e){var t;const r={enums:new Map,messages:new Map,services:new Map,extensions:new Map,mapEntries:new Map,resolveFeatures:nu((t=e==null?void 0:e.featureSetDefaults)!==null&&t!==void 0?t:tu)},i=(n instanceof _e?n.file:n instanceof Uint8Array?_e.fromBinary(n).file:n).map(o=>su(o,r));return Object.assign({files:i},r)}function su(n,e){var t,r;k(n.name,"invalid FileDescriptorProto: missing name");const s=Object.assign(Object.assign({kind:"file",proto:n,deprecated:(r=(t=n.options)===null||t===void 0?void 0:t.deprecated)!==null&&r!==void 0?r:!1},cu(n.syntax,n.edition)),{name:n.name.replace(/\.proto/,""),enums:[],messages:[],extensions:[],services:[],toString(){return`file ${this.proto.name}`},getSyntaxComments(){return _t(this.proto.sourceCodeInfo,[fe.FileDescriptorProto_Syntax])},getPackageComments(){return _t(this.proto.sourceCodeInfo,[fe.FileDescriptorProto_Package])},getFeatures(){var i;return e.resolveFeatures(this.edition,(i=this.proto.options)===null||i===void 0?void 0:i.features)}});e.mapEntries.clear();for(const i of n.enumType)Ui(i,s,void 0,e);for(const i of n.messageType)$i(i,s,void 0,e);for(const i of n.service)iu(i,s,e);Os(s,e);for(const i of e.mapEntries.values())Ps(i,e);for(const i of s.messages)Ps(i,e),Os(i,e);return e.mapEntries.clear(),s}function Os(n,e){switch(n.kind){case"file":for(const t of n.proto.extension){const r=qi(t,n,void 0,e);n.extensions.push(r),e.extensions.set(r.typeName,r)}break;case"message":for(const t of n.proto.extension){const r=qi(t,n.file,n,e);n.nestedExtensions.push(r),e.extensions.set(r.typeName,r)}for(const t of n.nestedMessages)Os(t,e);break}}function Ps(n,e){const t=n.proto.oneofDecl.map(s=>au(s,n,e)),r=new Set;for(const s of n.proto.field){const i=lu(s,t),o=Fi(s,n.file,n,i,e);n.fields.push(o),i===void 0?n.members.push(o):(i.fields.push(o),r.has(i)||(r.add(i),n.members.push(i)))}for(const s of t.filter(i=>r.has(i)))n.oneofs.push(s);for(const s of n.nestedMessages)Ps(s,e)}function Ui(n,e,t,r){var s,i,o;k(n.name,"invalid EnumDescriptorProto: missing name");const a={kind:"enum",proto:n,deprecated:(i=(s=n.options)===null||s===void 0?void 0:s.deprecated)!==null&&i!==void 0?i:!1,file:e,parent:t,name:n.name,typeName:Zr(n,t,e),values:[],sharedPrefix:Lc(n.name,n.value.map(c=>{var u;return(u=c.name)!==null&&u!==void 0?u:""})),toString(){return`enum ${this.typeName}`},getComments(){const c=this.parent?[...this.parent.getComments().sourcePath,fe.DescriptorProto_EnumType,this.parent.proto.enumType.indexOf(this.proto)]:[fe.FileDescriptorProto_EnumType,this.file.proto.enumType.indexOf(this.proto)];return _t(e.proto.sourceCodeInfo,c)},getFeatures(){var c,u,l;const y=(u=(c=this.parent)===null||c===void 0?void 0:c.getFeatures())!==null&&u!==void 0?u:this.file.getFeatures();return r.resolveFeatures(this.file.edition,y,(l=this.proto.options)===null||l===void 0?void 0:l.features)}};r.enums.set(a.typeName,a),n.value.forEach(c=>{var u,l;k(c.name,"invalid EnumValueDescriptorProto: missing name"),k(c.number!==void 0,"invalid EnumValueDescriptorProto: missing number"),a.values.push({kind:"enum_value",proto:c,deprecated:(l=(u=c.options)===null||u===void 0?void 0:u.deprecated)!==null&&l!==void 0?l:!1,parent:a,name:c.name,number:c.number,toString(){return`enum value ${a.typeName}.${this.name}`},declarationString(){var y;let f=`${this.name} = ${this.number}`;return((y=this.proto.options)===null||y===void 0?void 0:y.deprecated)===!0&&(f+=" [deprecated = true]"),f},getComments(){const y=[...this.parent.getComments().sourcePath,fe.EnumDescriptorProto_Value,this.parent.proto.value.indexOf(this.proto)];return _t(e.proto.sourceCodeInfo,y)},getFeatures(){var y;return r.resolveFeatures(this.parent.file.edition,this.parent.getFeatures(),(y=this.proto.options)===null||y===void 0?void 0:y.features)}})}),((o=t==null?void 0:t.nestedEnums)!==null&&o!==void 0?o:e.enums).push(a)}function $i(n,e,t,r){var s,i,o,a;k(n.name,"invalid DescriptorProto: missing name");const c={kind:"message",proto:n,deprecated:(i=(s=n.options)===null||s===void 0?void 0:s.deprecated)!==null&&i!==void 0?i:!1,file:e,parent:t,name:n.name,typeName:Zr(n,t,e),fields:[],oneofs:[],members:[],nestedEnums:[],nestedMessages:[],nestedExtensions:[],toString(){return`message ${this.typeName}`},getComments(){const u=this.parent?[...this.parent.getComments().sourcePath,fe.DescriptorProto_NestedType,this.parent.proto.nestedType.indexOf(this.proto)]:[fe.FileDescriptorProto_MessageType,this.file.proto.messageType.indexOf(this.proto)];return _t(e.proto.sourceCodeInfo,u)},getFeatures(){var u,l,y;const f=(l=(u=this.parent)===null||u===void 0?void 0:u.getFeatures())!==null&&l!==void 0?l:this.file.getFeatures();return r.resolveFeatures(this.file.edition,f,(y=this.proto.options)===null||y===void 0?void 0:y.features)}};((o=n.options)===null||o===void 0?void 0:o.mapEntry)===!0?r.mapEntries.set(c.typeName,c):(((a=t==null?void 0:t.nestedMessages)!==null&&a!==void 0?a:e.messages).push(c),r.messages.set(c.typeName,c));for(const u of n.enumType)Ui(u,e,c,r);for(const u of n.nestedType)$i(u,e,c,r)}function iu(n,e,t){var r,s;k(n.name,"invalid ServiceDescriptorProto: missing name");const i={kind:"service",proto:n,deprecated:(s=(r=n.options)===null||r===void 0?void 0:r.deprecated)!==null&&s!==void 0?s:!1,file:e,name:n.name,typeName:Zr(n,void 0,e),methods:[],toString(){return`service ${this.typeName}`},getComments(){const o=[fe.FileDescriptorProto_Service,this.file.proto.service.indexOf(this.proto)];return _t(e.proto.sourceCodeInfo,o)},getFeatures(){var o;return t.resolveFeatures(this.file.edition,this.file.getFeatures(),(o=this.proto.options)===null||o===void 0?void 0:o.features)}};e.services.push(i),t.services.set(i.typeName,i);for(const o of n.method)i.methods.push(ou(o,i,t))}function ou(n,e,t){var r,s,i;k(n.name,"invalid MethodDescriptorProto: missing name"),k(n.inputType,"invalid MethodDescriptorProto: missing input_type"),k(n.outputType,"invalid MethodDescriptorProto: missing output_type");let o;n.clientStreaming===!0&&n.serverStreaming===!0?o=Ae.BiDiStreaming:n.clientStreaming===!0?o=Ae.ClientStreaming:n.serverStreaming===!0?o=Ae.ServerStreaming:o=Ae.Unary;let a;switch((r=n.options)===null||r===void 0?void 0:r.idempotencyLevel){case qt.IDEMPOTENT:a=sr.Idempotent;break;case qt.NO_SIDE_EFFECTS:a=sr.NoSideEffects;break;case qt.IDEMPOTENCY_UNKNOWN:case void 0:a=void 0;break}const c=t.messages.get(Bn(n.inputType)),u=t.messages.get(Bn(n.outputType));k(c,`invalid MethodDescriptorProto: input_type ${n.inputType} not found`),k(u,`invalid MethodDescriptorProto: output_type ${n.inputType} not found`);const l=n.name;return{kind:"rpc",proto:n,deprecated:(i=(s=n.options)===null||s===void 0?void 0:s.deprecated)!==null&&i!==void 0?i:!1,parent:e,name:l,methodKind:o,input:c,output:u,idempotency:a,toString(){return`rpc ${e.typeName}.${l}`},getComments(){const y=[...this.parent.getComments().sourcePath,fe.ServiceDescriptorProto_Method,this.parent.proto.method.indexOf(this.proto)];return _t(e.file.proto.sourceCodeInfo,y)},getFeatures(){var y;return t.resolveFeatures(this.parent.file.edition,this.parent.getFeatures(),(y=this.proto.options)===null||y===void 0?void 0:y.features)}}}function au(n,e,t){return k(n.name,"invalid OneofDescriptorProto: missing name"),{kind:"oneof",proto:n,deprecated:!1,parent:e,fields:[],name:n.name,toString(){return`oneof ${e.typeName}.${this.name}`},getComments(){const r=[...this.parent.getComments().sourcePath,fe.DescriptorProto_OneofDecl,this.parent.proto.oneofDecl.indexOf(this.proto)];return _t(e.file.proto.sourceCodeInfo,r)},getFeatures(){var r;return t.resolveFeatures(this.parent.file.edition,this.parent.getFeatures(),(r=this.proto.options)===null||r===void 0?void 0:r.features)}}}function Fi(n,e,t,r,s){var i,o,a;k(n.name,"invalid FieldDescriptorProto: missing name"),k(n.number,"invalid FieldDescriptorProto: missing number"),k(n.type,"invalid FieldDescriptorProto: missing type");const c={proto:n,deprecated:(o=(i=n.options)===null||i===void 0?void 0:i.deprecated)!==null&&o!==void 0?o:!1,name:n.name,number:n.number,parent:t,oneof:r,optional:hu(n,e.syntax),packedByDefault:fu(e,n,s.resolveFeatures),packed:du(e,t,n,s.resolveFeatures),jsonName:n.jsonName===ks(n.name)?void 0:n.jsonName,scalar:void 0,longType:void 0,message:void 0,enum:void 0,mapKey:void 0,mapValue:void 0,declarationString:gu,toString(){return`field ${this.parent.typeName}.${this.name}`},getComments(){const l=[...this.parent.getComments().sourcePath,fe.DescriptorProto_Field,this.parent.proto.field.indexOf(this.proto)];return _t(e.proto.sourceCodeInfo,l)},getFeatures(){var l;return s.resolveFeatures(e.edition,this.parent.getFeatures(),(l=this.proto.options)===null||l===void 0?void 0:l.features)}},u=n.label===en.REPEATED;switch(n.type){case J.MESSAGE:case J.GROUP:{k(n.typeName,"invalid FieldDescriptorProto: missing type_name");const l=s.mapEntries.get(Bn(n.typeName));if(l!==void 0)return k(u,"invalid FieldDescriptorProto: expected map entry to be repeated"),Object.assign(Object.assign(Object.assign({},c),{kind:"field",fieldKind:"map",repeated:!1}),uu(l));const y=s.messages.get(Bn(n.typeName));return k(y!==void 0,`invalid FieldDescriptorProto: type_name ${n.typeName} not found`),Object.assign(Object.assign({},c),{kind:"field",fieldKind:"message",repeated:u,message:y})}case J.ENUM:{k(n.typeName,"invalid FieldDescriptorProto: missing type_name");const l=s.enums.get(Bn(n.typeName));return k(l!==void 0,`invalid FieldDescriptorProto: type_name ${n.typeName} not found`),Object.assign(Object.assign({},c),{kind:"field",fieldKind:"enum",getDefaultValue:ji,repeated:u,enum:l})}default:{const l=mu[n.type];return k(l,`invalid FieldDescriptorProto: unknown type ${n.type}`),Object.assign(Object.assign({},c),{kind:"field",fieldKind:"scalar",getDefaultValue:ji,repeated:u,scalar:l,longType:((a=n.options)===null||a===void 0?void 0:a.jstype)==tn.JS_STRING?Se.STRING:Se.BIGINT})}}}function qi(n,e,t,r){k(n.extendee,"invalid FieldDescriptorProto: missing extendee");const s=Fi(n,e,null,void 0,r),i=r.messages.get(Bn(n.extendee));return k(i,`invalid FieldDescriptorProto: extendee ${n.extendee} not found`),Object.assign(Object.assign({},s),{kind:"extension",typeName:Zr(n,t,e),parent:t,file:e,extendee:i,toString(){return`extension ${this.typeName}`},getComments(){const o=this.parent?[...this.parent.getComments().sourcePath,fe.DescriptorProto_Extension,this.parent.proto.extension.indexOf(n)]:[fe.FileDescriptorProto_Extension,this.file.proto.extension.indexOf(n)];return _t(e.proto.sourceCodeInfo,o)},getFeatures(){var o,a;return r.resolveFeatures(this.file.edition,((o=this.parent)!==null&&o!==void 0?o:this.file).getFeatures(),(a=this.proto.options)===null||a===void 0?void 0:a.features)}})}function cu(n,e){let t,r;switch(n){case void 0:case"proto2":r="proto2",t=V.EDITION_PROTO2;break;case"proto3":r="proto3",t=V.EDITION_PROTO3;break;case"editions":switch(r="editions",e){case void 0:case V.EDITION_1_TEST_ONLY:case V.EDITION_2_TEST_ONLY:case V.EDITION_99997_TEST_ONLY:case V.EDITION_99998_TEST_ONLY:case V.EDITION_99999_TEST_ONLY:case V.EDITION_UNKNOWN:t=V.EDITION_UNKNOWN;break;default:t=e;break}break;default:throw new Error(`invalid FileDescriptorProto: unsupported syntax: ${n}`)}if(n==="editions"&&e===V.EDITION_UNKNOWN)throw new Error(`invalid FileDescriptorProto: syntax ${n} cannot have edition ${String(e)}`);return{syntax:r,edition:t}}function Zr(n,e,t){k(n.name,`invalid ${n.getType().typeName}: missing name`);let r;return e?r=`${e.typeName}.${n.name}`:t.proto.package!==void 0?r=`${t.proto.package}.${n.name}`:r=`${n.name}`,r}function Bn(n){return n.startsWith(".")?n.substring(1):n}function uu(n){var e,t;k((e=n.proto.options)===null||e===void 0?void 0:e.mapEntry,`invalid DescriptorProto: expected ${n.toString()} to be a map entry`),k(n.fields.length===2,`invalid DescriptorProto: map entry ${n.toString()} has ${n.fields.length} fields`);const r=n.fields.find(o=>o.proto.number===1);k(r,`invalid DescriptorProto: map entry ${n.toString()} is missing key field`);const s=r.scalar;k(s!==void 0&&s!==m.BYTES&&s!==m.FLOAT&&s!==m.DOUBLE,`invalid DescriptorProto: map entry ${n.toString()} has unexpected key type ${(t=r.proto.type)!==null&&t!==void 0?t:-1}`);const i=n.fields.find(o=>o.proto.number===2);switch(k(i,`invalid DescriptorProto: map entry ${n.toString()} is missing value field`),i.fieldKind){case"scalar":return{mapKey:s,mapValue:Object.assign(Object.assign({},i),{kind:"scalar"})};case"message":return{mapKey:s,mapValue:Object.assign(Object.assign({},i),{kind:"message"})};case"enum":return{mapKey:s,mapValue:Object.assign(Object.assign({},i),{kind:"enum"})};default:throw new Error("invalid DescriptorProto: unsupported map entry value field")}}function lu(n,e){var t;const r=n.oneofIndex;if(r===void 0)return;let s;return n.proto3Optional!==!0&&(s=e[r],k(s,`invalid FieldDescriptorProto: oneof #${r} for field #${(t=n.number)!==null&&t!==void 0?t:-1} not found`)),s}function hu(n,e){switch(e){case"proto2":return n.oneofIndex===void 0&&n.label===en.OPTIONAL;case"proto3":return n.proto3Optional===!0;case"editions":return!1}}function fu(n,e,t){const{repeatedFieldEncoding:r}=t(n.edition);if(r!=mn.PACKED)return!1;switch(e.type){case J.STRING:case J.BYTES:case J.GROUP:case J.MESSAGE:return!1;default:return!0}}function du(n,e,t,r){var s,i,o,a,c,u;switch(t.type){case J.STRING:case J.BYTES:case J.GROUP:case J.MESSAGE:return!1;default:switch(n.edition){case V.EDITION_PROTO2:return(i=(s=t.options)===null||s===void 0?void 0:s.packed)!==null&&i!==void 0?i:!1;case V.EDITION_PROTO3:return(a=(o=t.options)===null||o===void 0?void 0:o.packed)!==null&&a!==void 0?a:!0;default:{const{repeatedFieldEncoding:l}=r(n.edition,(c=e==null?void 0:e.getFeatures())!==null&&c!==void 0?c:n.getFeatures(),(u=t.options)===null||u===void 0?void 0:u.features);return l==mn.PACKED}}}}const mu={[J.DOUBLE]:m.DOUBLE,[J.FLOAT]:m.FLOAT,[J.INT64]:m.INT64,[J.UINT64]:m.UINT64,[J.INT32]:m.INT32,[J.FIXED64]:m.FIXED64,[J.FIXED32]:m.FIXED32,[J.BOOL]:m.BOOL,[J.STRING]:m.STRING,[J.GROUP]:void 0,[J.MESSAGE]:void 0,[J.BYTES]:m.BYTES,[J.UINT32]:m.UINT32,[J.ENUM]:void 0,[J.SFIXED32]:m.SFIXED32,[J.SFIXED64]:m.SFIXED64,[J.SINT32]:m.SINT32,[J.SINT64]:m.SINT64};function _t(n,e){if(!n)return{leadingDetached:[],sourcePath:e};for(const t of n.location)if(t.path.length===e.length&&!t.path.some((r,s)=>e[s]!==r))return{leadingDetached:t.leadingDetachedComments,leading:t.leadingComments,trailing:t.trailingComments,sourcePath:e};return{leadingDetached:[],sourcePath:e}}var fe;(function(n){n[n.FileDescriptorProto_Package=2]="FileDescriptorProto_Package",n[n.FileDescriptorProto_MessageType=4]="FileDescriptorProto_MessageType",n[n.FileDescriptorProto_EnumType=5]="FileDescriptorProto_EnumType",n[n.FileDescriptorProto_Service=6]="FileDescriptorProto_Service",n[n.FileDescriptorProto_Extension=7]="FileDescriptorProto_Extension",n[n.FileDescriptorProto_Syntax=12]="FileDescriptorProto_Syntax",n[n.DescriptorProto_Field=2]="DescriptorProto_Field",n[n.DescriptorProto_NestedType=3]="DescriptorProto_NestedType",n[n.DescriptorProto_EnumType=4]="DescriptorProto_EnumType",n[n.DescriptorProto_Extension=6]="DescriptorProto_Extension",n[n.DescriptorProto_OneofDecl=8]="DescriptorProto_OneofDecl",n[n.EnumDescriptorProto_Value=2]="EnumDescriptorProto_Value",n[n.ServiceDescriptorProto_Method=2]="ServiceDescriptorProto_Method"})(fe||(fe={}));function gu(){var n,e,t;const r=[];this.repeated&&r.push("repeated"),this.optional&&r.push("optional"),(this.kind==="extension"?this.file:this.parent.file).syntax=="proto2"&&this.proto.label===en.REQUIRED&&r.push("required");let i;switch(this.fieldKind){case"scalar":i=m[this.scalar].toLowerCase();break;case"enum":i=this.enum.typeName;break;case"message":i=this.message.typeName;break;case"map":{const c=m[this.mapKey].toLowerCase();let u;switch(this.mapValue.kind){case"scalar":u=m[this.mapValue.scalar].toLowerCase();break;case"enum":u=this.mapValue.enum.typeName;break;case"message":u=this.mapValue.message.typeName;break}i=`map<${c}, ${u}>`;break}}r.push(`${i} ${this.name} = ${this.number}`);const o=[];((n=this.proto.options)===null||n===void 0?void 0:n.packed)!==void 0&&o.push(`packed = ${this.proto.options.packed.toString()}`);let a=this.proto.defaultValue;return a!==void 0&&((this.proto.type==J.BYTES||this.proto.type==J.STRING)&&(a='"'+a.replace('"','\\"')+'"'),o.push(`default = ${a}`)),this.jsonName!==void 0&&o.push(`json_name = "${this.jsonName}"`),((e=this.proto.options)===null||e===void 0?void 0:e.jstype)!==void 0&&o.push(`jstype = ${tn[this.proto.options.jstype]}`),((t=this.proto.options)===null||t===void 0?void 0:t.deprecated)===!0&&o.push("deprecated = true"),o.length>0&&r.push("["+o.join(", ")+"]"),r.join(" ")}function ji(){const n=this.proto.defaultValue;if(n!==void 0)switch(this.fieldKind){case"enum":return Zc(this.enum,n);case"scalar":return Qc(this.scalar,n);default:return}}function pu(...n){const e={},t={},r={},s={add(i){if("fields"in i){if(!this.findMessage(i.typeName)){e[i.typeName]=i;for(const o of i.fields.list())o.kind=="message"?this.add(o.T):o.kind=="map"&&o.V.kind=="message"?this.add(o.V.T):o.kind=="enum"&&this.add(o.T)}}else if("methods"in i){if(!this.findService(i.typeName)){r[i.typeName]=i;for(const o of Object.values(i.methods))this.add(o.I),this.add(o.O)}}else t[i.typeName]=i},findMessage(i){return e[i]},findEnum(i){return t[i]},findService(i){return r[i]}};for(const i of n)s.add(i);return s}let dr=class _n extends w{constructor(e){super(),this.seconds=z.zero,this.nanos=0,g.util.initPartial(e,this)}fromJson(e,t){if(typeof e!="string")throw new Error(`cannot decode google.protobuf.Timestamp from JSON: ${g.json.debug(e)}`);const r=e.match(/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2}):([0-9]{2})(?:Z|\.([0-9]{3,9})Z|([+-][0-9][0-9]:[0-9][0-9]))$/);if(!r)throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");const s=Date.parse(r[1]+"-"+r[2]+"-"+r[3]+"T"+r[4]+":"+r[5]+":"+r[6]+(r[8]?r[8]:"Z"));if(Number.isNaN(s))throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");if(s<Date.parse("0001-01-01T00:00:00Z")||s>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot decode message google.protobuf.Timestamp from JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");return this.seconds=z.parse(s/1e3),this.nanos=0,r[7]&&(this.nanos=parseInt("1"+r[7]+"0".repeat(9-r[7].length))-1e9),this}toJson(e){const t=Number(this.seconds)*1e3;if(t<Date.parse("0001-01-01T00:00:00Z")||t>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot encode google.protobuf.Timestamp to JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");if(this.nanos<0)throw new Error("cannot encode google.protobuf.Timestamp to JSON: nanos must not be negative");let r="Z";if(this.nanos>0){const s=(this.nanos+1e9).toString().substring(1);s.substring(3)==="000000"?r="."+s.substring(0,3)+"Z":s.substring(6)==="000"?r="."+s.substring(0,6)+"Z":r="."+s+"Z"}return new Date(t).toISOString().replace(".000Z",r)}toDate(){return new Date(Number(this.seconds)*1e3+Math.ceil(this.nanos/1e6))}static now(){return _n.fromDate(new Date)}static fromDate(e){const t=e.getTime();return new _n({seconds:z.parse(Math.floor(t/1e3)),nanos:t%1e3*1e6})}static fromBinary(e,t){return new _n().fromBinary(e,t)}static fromJson(e,t){return new _n().fromJson(e,t)}static fromJsonString(e,t){return new _n().fromJsonString(e,t)}static equals(e,t){return g.util.equals(_n,e,t)}};dr.runtime=g,dr.typeName="google.protobuf.Timestamp",dr.fields=g.util.newFieldList(()=>[{no:1,name:"seconds",kind:"scalar",T:3},{no:2,name:"nanos",kind:"scalar",T:5}]);class We extends w{constructor(e){super(),this.seconds=z.zero,this.nanos=0,g.util.initPartial(e,this)}fromJson(e,t){if(typeof e!="string")throw new Error(`cannot decode google.protobuf.Duration from JSON: ${g.json.debug(e)}`);const r=e.match(/^(-?[0-9]+)(?:\.([0-9]+))?s/);if(r===null)throw new Error(`cannot decode google.protobuf.Duration from JSON: ${g.json.debug(e)}`);const s=Number(r[1]);if(s>315576e6||s<-315576e6)throw new Error(`cannot decode google.protobuf.Duration from JSON: ${g.json.debug(e)}`);if(this.seconds=z.parse(s),typeof r[2]=="string"){const i=r[2]+"0".repeat(9-r[2].length);this.nanos=parseInt(i),(s<0||Object.is(s,-0))&&(this.nanos=-this.nanos)}return this}toJson(e){if(Number(this.seconds)>315576e6||Number(this.seconds)<-315576e6)throw new Error("cannot encode google.protobuf.Duration to JSON: value out of range");let t=this.seconds.toString();if(this.nanos!==0){let r=Math.abs(this.nanos).toString();r="0".repeat(9-r.length)+r,r.substring(3)==="000000"?r=r.substring(0,3):r.substring(6)==="000"&&(r=r.substring(0,6)),t+="."+r,this.nanos<0&&Number(this.seconds)==0&&(t="-"+t)}return t+"s"}static fromBinary(e,t){return new We().fromBinary(e,t)}static fromJson(e,t){return new We().fromJson(e,t)}static fromJsonString(e,t){return new We().fromJsonString(e,t)}static equals(e,t){return g.util.equals(We,e,t)}}We.runtime=g,We.typeName="google.protobuf.Duration",We.fields=g.util.newFieldList(()=>[{no:1,name:"seconds",kind:"scalar",T:3},{no:2,name:"nanos",kind:"scalar",T:5}]);class be extends w{constructor(e){super(),this.typeUrl="",this.value=new Uint8Array(0),g.util.initPartial(e,this)}toJson(e){var t;if(this.typeUrl==="")return{};const r=this.typeUrlToName(this.typeUrl),s=(t=e==null?void 0:e.typeRegistry)===null||t===void 0?void 0:t.findMessage(r);if(!s)throw new Error(`cannot encode message google.protobuf.Any to JSON: "${this.typeUrl}" is not in the type registry`);let o=s.fromBinary(this.value).toJson(e);return(r.startsWith("google.protobuf.")||o===null||Array.isArray(o)||typeof o!="object")&&(o={value:o}),o["@type"]=this.typeUrl,o}fromJson(e,t){var r;if(e===null||Array.isArray(e)||typeof e!="object")throw new Error(`cannot decode message google.protobuf.Any from JSON: expected object but got ${e===null?"null":Array.isArray(e)?"array":typeof e}`);if(Object.keys(e).length==0)return this;const s=e["@type"];if(typeof s!="string"||s=="")throw new Error('cannot decode message google.protobuf.Any from JSON: "@type" is empty');const i=this.typeUrlToName(s),o=(r=t==null?void 0:t.typeRegistry)===null||r===void 0?void 0:r.findMessage(i);if(!o)throw new Error(`cannot decode message google.protobuf.Any from JSON: ${s} is not in the type registry`);let a;if(i.startsWith("google.protobuf.")&&Object.prototype.hasOwnProperty.call(e,"value"))a=o.fromJson(e.value,t);else{const c=Object.assign({},e);delete c["@type"],a=o.fromJson(c,t)}return this.packFrom(a),this}packFrom(e){this.value=e.toBinary(),this.typeUrl=this.typeNameToUrl(e.getType().typeName)}unpackTo(e){return this.is(e.getType())?(e.fromBinary(this.value),!0):!1}unpack(e){if(this.typeUrl==="")return;const t=e.findMessage(this.typeUrlToName(this.typeUrl));if(!!t)return t.fromBinary(this.value)}is(e){if(this.typeUrl==="")return!1;const t=this.typeUrlToName(this.typeUrl);let r="";return typeof e=="string"?r=e:r=e.typeName,t===r}typeNameToUrl(e){return`type.googleapis.com/${e}`}typeUrlToName(e){if(!e.length)throw new Error(`invalid type url: ${e}`);const t=e.lastIndexOf("/"),r=t>=0?e.substring(t+1):e;if(!r.length)throw new Error(`invalid type url: ${e}`);return r}static pack(e){const t=new be;return t.packFrom(e),t}static fromBinary(e,t){return new be().fromBinary(e,t)}static fromJson(e,t){return new be().fromJson(e,t)}static fromJsonString(e,t){return new be().fromJsonString(e,t)}static equals(e,t){return g.util.equals(be,e,t)}}be.runtime=g,be.typeName="google.protobuf.Any",be.fields=g.util.newFieldList(()=>[{no:1,name:"type_url",kind:"scalar",T:9},{no:2,name:"value",kind:"scalar",T:12}]);class Ot extends w{constructor(e){super(),g.util.initPartial(e,this)}static fromBinary(e,t){return new Ot().fromBinary(e,t)}static fromJson(e,t){return new Ot().fromJson(e,t)}static fromJsonString(e,t){return new Ot().fromJsonString(e,t)}static equals(e,t){return g.util.equals(Ot,e,t)}}Ot.runtime=g,Ot.typeName="google.protobuf.Empty",Ot.fields=g.util.newFieldList(()=>[]);class Pt extends w{constructor(e){super(),this.paths=[],g.util.initPartial(e,this)}toJson(e){function t(r){let s=!1;const i=[];for(let o=0;o<r.length;o++){let a=r.charAt(o);switch(a){case"_":s=!0;break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":i.push(a),s=!1;break;default:s&&(s=!1,a=a.toUpperCase()),i.push(a);break}}return i.join("")}return this.paths.map(r=>{if(r.match(/_[0-9]?_/g)||r.match(/[A-Z]/g))throw new Error('cannot encode google.protobuf.FieldMask to JSON: lowerCamelCase of path name "'+r+'" is irreversible');return t(r)}).join(",")}fromJson(e,t){if(typeof e!="string")throw new Error("cannot decode google.protobuf.FieldMask from JSON: "+g.json.debug(e));if(e==="")return this;function r(s){if(s.includes("_"))throw new Error("cannot decode google.protobuf.FieldMask from JSON: path names must be lowerCamelCase");const i=s.replace(/[A-Z]/g,o=>"_"+o.toLowerCase());return i[0]==="_"?i.substring(1):i}return this.paths=e.split(",").map(r),this}static fromBinary(e,t){return new Pt().fromBinary(e,t)}static fromJson(e,t){return new Pt().fromJson(e,t)}static fromJsonString(e,t){return new Pt().fromJsonString(e,t)}static equals(e,t){return g.util.equals(Pt,e,t)}}Pt.runtime=g,Pt.typeName="google.protobuf.FieldMask",Pt.fields=g.util.newFieldList(()=>[{no:1,name:"paths",kind:"scalar",T:9,repeated:!0}]);var gn;(function(n){n[n.NULL_VALUE=0]="NULL_VALUE"})(gn||(gn={})),g.util.setEnumType(gn,"google.protobuf.NullValue",[{no:0,name:"NULL_VALUE"}]);class xe extends w{constructor(e){super(),this.fields={},g.util.initPartial(e,this)}toJson(e){const t={};for(const[r,s]of Object.entries(this.fields))t[r]=s.toJson(e);return t}fromJson(e,t){if(typeof e!="object"||e==null||Array.isArray(e))throw new Error("cannot decode google.protobuf.Struct from JSON "+g.json.debug(e));for(const[r,s]of Object.entries(e))this.fields[r]=ye.fromJson(s);return this}static fromBinary(e,t){return new xe().fromBinary(e,t)}static fromJson(e,t){return new xe().fromJson(e,t)}static fromJsonString(e,t){return new xe().fromJsonString(e,t)}static equals(e,t){return g.util.equals(xe,e,t)}}xe.runtime=g,xe.typeName="google.protobuf.Struct",xe.fields=g.util.newFieldList(()=>[{no:1,name:"fields",kind:"map",K:9,V:{kind:"message",T:ye}}]);class ye extends w{constructor(e){super(),this.kind={case:void 0},g.util.initPartial(e,this)}toJson(e){switch(this.kind.case){case"nullValue":return null;case"numberValue":if(!Number.isFinite(this.kind.value))throw new Error("google.protobuf.Value cannot be NaN or Infinity");return this.kind.value;case"boolValue":return this.kind.value;case"stringValue":return this.kind.value;case"structValue":case"listValue":return this.kind.value.toJson(Object.assign(Object.assign({},e),{emitDefaultValues:!0}))}throw new Error("google.protobuf.Value must have a value")}fromJson(e,t){switch(typeof e){case"number":this.kind={case:"numberValue",value:e};break;case"string":this.kind={case:"stringValue",value:e};break;case"boolean":this.kind={case:"boolValue",value:e};break;case"object":e===null?this.kind={case:"nullValue",value:gn.NULL_VALUE}:Array.isArray(e)?this.kind={case:"listValue",value:De.fromJson(e)}:this.kind={case:"structValue",value:xe.fromJson(e)};break;default:throw new Error("cannot decode google.protobuf.Value from JSON "+g.json.debug(e))}return this}static fromBinary(e,t){return new ye().fromBinary(e,t)}static fromJson(e,t){return new ye().fromJson(e,t)}static fromJsonString(e,t){return new ye().fromJsonString(e,t)}static equals(e,t){return g.util.equals(ye,e,t)}}ye.runtime=g,ye.typeName="google.protobuf.Value",ye.fields=g.util.newFieldList(()=>[{no:1,name:"null_value",kind:"enum",T:g.getEnumType(gn),oneof:"kind"},{no:2,name:"number_value",kind:"scalar",T:1,oneof:"kind"},{no:3,name:"string_value",kind:"scalar",T:9,oneof:"kind"},{no:4,name:"bool_value",kind:"scalar",T:8,oneof:"kind"},{no:5,name:"struct_value",kind:"message",T:xe,oneof:"kind"},{no:6,name:"list_value",kind:"message",T:De,oneof:"kind"}]);class De extends w{constructor(e){super(),this.values=[],g.util.initPartial(e,this)}toJson(e){return this.values.map(t=>t.toJson())}fromJson(e,t){if(!Array.isArray(e))throw new Error("cannot decode google.protobuf.ListValue from JSON "+g.json.debug(e));for(let r of e)this.values.push(ye.fromJson(r));return this}static fromBinary(e,t){return new De().fromBinary(e,t)}static fromJson(e,t){return new De().fromJson(e,t)}static fromJsonString(e,t){return new De().fromJsonString(e,t)}static equals(e,t){return g.util.equals(De,e,t)}}De.runtime=g,De.typeName="google.protobuf.ListValue",De.fields=g.util.newFieldList(()=>[{no:1,name:"values",kind:"message",T:ye,repeated:!0}]);class Ce extends w{constructor(e){super(),this.value=0,g.util.initPartial(e,this)}toJson(e){return g.json.writeScalar(m.DOUBLE,this.value,!0)}fromJson(e,t){try{this.value=g.json.readScalar(m.DOUBLE,e)}catch(r){let s='cannot decode message google.protobuf.DoubleValue from JSON"';throw r instanceof Error&&r.message.length>0&&(s+=`: ${r.message}`),new Error(s)}return this}static fromBinary(e,t){return new Ce().fromBinary(e,t)}static fromJson(e,t){return new Ce().fromJson(e,t)}static fromJsonString(e,t){return new Ce().fromJsonString(e,t)}static equals(e,t){return g.util.equals(Ce,e,t)}}Ce.runtime=g,Ce.typeName="google.protobuf.DoubleValue",Ce.fields=g.util.newFieldList(()=>[{no:1,name:"value",kind:"scalar",T:1}]),Ce.fieldWrapper={wrapField(n){return new Ce({value:n})},unwrapField(n){return n.value}};class Re extends w{constructor(e){super(),this.value=0,g.util.initPartial(e,this)}toJson(e){return g.json.writeScalar(m.FLOAT,this.value,!0)}fromJson(e,t){try{this.value=g.json.readScalar(m.FLOAT,e)}catch(r){let s='cannot decode message google.protobuf.FloatValue from JSON"';throw r instanceof Error&&r.message.length>0&&(s+=`: ${r.message}`),new Error(s)}return this}static fromBinary(e,t){return new Re().fromBinary(e,t)}static fromJson(e,t){return new Re().fromJson(e,t)}static fromJsonString(e,t){return new Re().fromJsonString(e,t)}static equals(e,t){return g.util.equals(Re,e,t)}}Re.runtime=g,Re.typeName="google.protobuf.FloatValue",Re.fields=g.util.newFieldList(()=>[{no:1,name:"value",kind:"scalar",T:2}]),Re.fieldWrapper={wrapField(n){return new Re({value:n})},unwrapField(n){return n.value}};class Je extends w{constructor(e){super(),this.value=z.zero,g.util.initPartial(e,this)}toJson(e){return g.json.writeScalar(m.INT64,this.value,!0)}fromJson(e,t){try{this.value=g.json.readScalar(m.INT64,e)}catch(r){let s='cannot decode message google.protobuf.Int64Value from JSON"';throw r instanceof Error&&r.message.length>0&&(s+=`: ${r.message}`),new Error(s)}return this}static fromBinary(e,t){return new Je().fromBinary(e,t)}static fromJson(e,t){return new Je().fromJson(e,t)}static fromJsonString(e,t){return new Je().fromJsonString(e,t)}static equals(e,t){return g.util.equals(Je,e,t)}}Je.runtime=g,Je.typeName="google.protobuf.Int64Value",Je.fields=g.util.newFieldList(()=>[{no:1,name:"value",kind:"scalar",T:3}]),Je.fieldWrapper={wrapField(n){return new Je({value:n})},unwrapField(n){return n.value}};class Be extends w{constructor(e){super(),this.value=z.zero,g.util.initPartial(e,this)}toJson(e){return g.json.writeScalar(m.UINT64,this.value,!0)}fromJson(e,t){try{this.value=g.json.readScalar(m.UINT64,e)}catch(r){let s='cannot decode message google.protobuf.UInt64Value from JSON"';throw r instanceof Error&&r.message.length>0&&(s+=`: ${r.message}`),new Error(s)}return this}static fromBinary(e,t){return new Be().fromBinary(e,t)}static fromJson(e,t){return new Be().fromJson(e,t)}static fromJsonString(e,t){return new Be().fromJsonString(e,t)}static equals(e,t){return g.util.equals(Be,e,t)}}Be.runtime=g,Be.typeName="google.protobuf.UInt64Value",Be.fields=g.util.newFieldList(()=>[{no:1,name:"value",kind:"scalar",T:4}]),Be.fieldWrapper={wrapField(n){return new Be({value:n})},unwrapField(n){return n.value}};class Le extends w{constructor(e){super(),this.value=0,g.util.initPartial(e,this)}toJson(e){return g.json.writeScalar(m.INT32,this.value,!0)}fromJson(e,t){try{this.value=g.json.readScalar(m.INT32,e)}catch(r){let s='cannot decode message google.protobuf.Int32Value from JSON"';throw r instanceof Error&&r.message.length>0&&(s+=`: ${r.message}`),new Error(s)}return this}static fromBinary(e,t){return new Le().fromBinary(e,t)}static fromJson(e,t){return new Le().fromJson(e,t)}static fromJsonString(e,t){return new Le().fromJsonString(e,t)}static equals(e,t){return g.util.equals(Le,e,t)}}Le.runtime=g,Le.typeName="google.protobuf.Int32Value",Le.fields=g.util.newFieldList(()=>[{no:1,name:"value",kind:"scalar",T:5}]),Le.fieldWrapper={wrapField(n){return new Le({value:n})},unwrapField(n){return n.value}};class Me extends w{constructor(e){super(),this.value=0,g.util.initPartial(e,this)}toJson(e){return g.json.writeScalar(m.UINT32,this.value,!0)}fromJson(e,t){try{this.value=g.json.readScalar(m.UINT32,e)}catch(r){let s='cannot decode message google.protobuf.UInt32Value from JSON"';throw r instanceof Error&&r.message.length>0&&(s+=`: ${r.message}`),new Error(s)}return this}static fromBinary(e,t){return new Me().fromBinary(e,t)}static fromJson(e,t){return new Me().fromJson(e,t)}static fromJsonString(e,t){return new Me().fromJsonString(e,t)}static equals(e,t){return g.util.equals(Me,e,t)}}Me.runtime=g,Me.typeName="google.protobuf.UInt32Value",Me.fields=g.util.newFieldList(()=>[{no:1,name:"value",kind:"scalar",T:13}]),Me.fieldWrapper={wrapField(n){return new Me({value:n})},unwrapField(n){return n.value}};class Ue extends w{constructor(e){super(),this.value=!1,g.util.initPartial(e,this)}toJson(e){return g.json.writeScalar(m.BOOL,this.value,!0)}fromJson(e,t){try{this.value=g.json.readScalar(m.BOOL,e)}catch(r){let s='cannot decode message google.protobuf.BoolValue from JSON"';throw r instanceof Error&&r.message.length>0&&(s+=`: ${r.message}`),new Error(s)}return this}static fromBinary(e,t){return new Ue().fromBinary(e,t)}static fromJson(e,t){return new Ue().fromJson(e,t)}static fromJsonString(e,t){return new Ue().fromJsonString(e,t)}static equals(e,t){return g.util.equals(Ue,e,t)}}Ue.runtime=g,Ue.typeName="google.protobuf.BoolValue",Ue.fields=g.util.newFieldList(()=>[{no:1,name:"value",kind:"scalar",T:8}]),Ue.fieldWrapper={wrapField(n){return new Ue({value:n})},unwrapField(n){return n.value}};let pn=class Lr extends w{constructor(e){super(),this.value="",g.util.initPartial(e,this)}toJson(e){return g.json.writeScalar(m.STRING,this.value,!0)}fromJson(e,t){try{this.value=g.json.readScalar(m.STRING,e)}catch(r){let s='cannot decode message google.protobuf.StringValue from JSON"';throw r instanceof Error&&r.message.length>0&&(s+=`: ${r.message}`),new Error(s)}return this}static fromBinary(e,t){return new Lr().fromBinary(e,t)}static fromJson(e,t){return new Lr().fromJson(e,t)}static fromJsonString(e,t){return new Lr().fromJsonString(e,t)}static equals(e,t){return g.util.equals(Lr,e,t)}};pn.runtime=g,pn.typeName="google.protobuf.StringValue",pn.fields=g.util.newFieldList(()=>[{no:1,name:"value",kind:"scalar",T:9}]),pn.fieldWrapper={wrapField(n){return new pn({value:n})},unwrapField(n){return n.value}};class $e extends w{constructor(e){super(),this.value=new Uint8Array(0),g.util.initPartial(e,this)}toJson(e){return g.json.writeScalar(m.BYTES,this.value,!0)}fromJson(e,t){try{this.value=g.json.readScalar(m.BYTES,e)}catch(r){let s='cannot decode message google.protobuf.BytesValue from JSON"';throw r instanceof Error&&r.message.length>0&&(s+=`: ${r.message}`),new Error(s)}return this}static fromBinary(e,t){return new $e().fromBinary(e,t)}static fromJson(e,t){return new $e().fromJson(e,t)}static fromJsonString(e,t){return new $e().fromJsonString(e,t)}static equals(e,t){return g.util.equals($e,e,t)}}$e.runtime=g,$e.typeName="google.protobuf.BytesValue",$e.fields=g.util.newFieldList(()=>[{no:1,name:"value",kind:"scalar",T:12}]),$e.fieldWrapper={wrapField(n){return new $e({value:n})},unwrapField(n){return n.value}};const yu=[be,We,Ot,Pt,xe,ye,De,dr,We,Ce,Re,Je,Le,Me,Be,Ue,pn,$e],Tu=[hi(gn)];function vu(n,e=!0){const t=n instanceof Uint8Array||n instanceof _e?Mi(n):n,r={},s={},i={};if(e){for(const o of yu)s[o.typeName]=o;for(const o of Tu)r[o.typeName]=o}return{findEnum(o){const a=r[o];if(a)return a;const c=t.enums.get(o);if(!c)return;const l=(c.file.syntax=="proto3"?g:d).makeEnumType(o,c.values.map(y=>({no:y.number,name:y.name,localName:Xr(y)})),{});return r[o]=l,l},findMessage(o){const a=s[o];if(a)return a;const c=t.messages.get(o);if(!c)return;const u=c.file.syntax=="proto3"?g:d,l=[],y=u.makeMessageType(o,()=>l,{localName:Xr(c)});s[o]=y;for(const f of c.fields){const p=Su(f,this);l.push(p)}return y},findService(o){const a=i[o];if(a)return a;const c=t.services.get(o);if(!c)return;const u={};for(const l of c.methods){const y=this.findMessage(l.input.typeName),f=this.findMessage(l.output.typeName);k(y,`message "${l.input.typeName}" for ${l.toString()} not found`),k(f,`output message "${l.output.typeName}" for ${l.toString()} not found`),u[Xr(l)]={name:l.name,I:y,O:f,kind:l.methodKind,idempotency:l.idempotency}}return i[o]={typeName:c.typeName,methods:u}}}}function Su(n,e){switch(n.fieldKind){case"map":return bu(n,e);case"message":return Nu(n,e);case"enum":{const t=Eu(n,e);return t.default=n.getDefaultValue(),t}case"scalar":{const t=wu(n);return t.default=n.getDefaultValue(),t}}}function bu(n,e){const t={kind:"map",no:n.number,name:n.name,jsonName:n.jsonName,K:n.mapKey};if(n.mapValue.message){const r=e.findMessage(n.mapValue.message.typeName);return k(r,`message "${n.mapValue.message.typeName}" for ${n.toString()} not found`),Object.assign(Object.assign({},t),{V:{kind:"message",T:r}})}if(n.mapValue.enum){const r=e.findEnum(n.mapValue.enum.typeName);return k(r,`enum "${n.mapValue.enum.typeName}" for ${n.toString()} not found`),Object.assign(Object.assign({},t),{V:{kind:"enum",T:r}})}return Object.assign(Object.assign({},t),{V:{kind:"scalar",T:n.mapValue.scalar}})}function wu(n){const e=n.longType==Se.STRING?{L:Se.STRING}:{},t=Object.assign({kind:"scalar",no:n.number,name:n.name,jsonName:n.jsonName,T:n.scalar},e);return n.repeated?Object.assign(Object.assign({},t),{repeated:!0,packed:n.packed,oneof:void 0,T:n.scalar}):n.oneof?Object.assign(Object.assign({},t),{oneof:n.oneof.name}):n.optional?Object.assign(Object.assign({},t),{opt:!0}):t}function Nu(n,e){const t=e.findMessage(n.message.typeName);k(t,`message "${n.message.typeName}" for ${n.toString()} not found`);const r={kind:"message",no:n.number,name:n.name,jsonName:n.jsonName,T:t,delimited:n.proto.type==J.GROUP};return n.repeated?Object.assign(Object.assign({},r),{repeated:!0,packed:n.packed,oneof:void 0}):n.oneof?Object.assign(Object.assign({},r),{oneof:n.oneof.name}):n.optional?Object.assign(Object.assign({},r),{opt:!0}):r}function Eu(n,e){const t=e.findEnum(n.enum.typeName);k(t,`enum "${n.enum.typeName}" for ${n.toString()} not found`);const r={kind:"enum",no:n.number,name:n.name,jsonName:n.jsonName,T:t};return n.repeated?Object.assign(Object.assign({},r),{repeated:!0,packed:n.packed,oneof:void 0}):n.oneof?Object.assign(Object.assign({},r),{oneof:n.oneof.name}):n.optional?Object.assign(Object.assign({},r),{opt:!0}):r}function Vi(n){if(!(n instanceof w))return n;const e=n.getType(),t={};for(const r of e.fields.byMember()){const s=n[r.localName];let i;if(r.repeated)i=s.map(o=>Qr(o));else if(r.kind=="map"){i={};for(const[o,a]of Object.entries(s))i[o]=Qr(a)}else r.kind=="oneof"?i=r.findField(s.case)?{case:s.case,value:Qr(s.value)}:{case:void 0}:i=Qr(s);t[r.localName]=i}return t}function Qr(n){if(n===void 0)return n;if(n instanceof w)return Vi(n);if(n instanceof Uint8Array){const e=new Uint8Array(n.byteLength);return e.set(n),e}return n}class xt extends w{constructor(e){super(),d.util.initPartial(e,this)}static fromBinary(e,t){return new xt().fromBinary(e,t)}static fromJson(e,t){return new xt().fromJson(e,t)}static fromJsonString(e,t){return new xt().fromJsonString(e,t)}static equals(e,t){return d.util.equals(xt,e,t)}}xt.runtime=d,xt.typeName="google.protobuf.compiler.Version",xt.fields=d.util.newFieldList(()=>[{no:1,name:"major",kind:"scalar",T:5,opt:!0},{no:2,name:"minor",kind:"scalar",T:5,opt:!0},{no:3,name:"patch",kind:"scalar",T:5,opt:!0},{no:4,name:"suffix",kind:"scalar",T:9,opt:!0}]);class jt extends w{constructor(e){super(),this.fileToGenerate=[],this.protoFile=[],this.sourceFileDescriptors=[],d.util.initPartial(e,this)}static fromBinary(e,t){return new jt().fromBinary(e,t)}static fromJson(e,t){return new jt().fromJson(e,t)}static fromJsonString(e,t){return new jt().fromJsonString(e,t)}static equals(e,t){return d.util.equals(jt,e,t)}}jt.runtime=d,jt.typeName="google.protobuf.compiler.CodeGeneratorRequest",jt.fields=d.util.newFieldList(()=>[{no:1,name:"file_to_generate",kind:"scalar",T:9,repeated:!0},{no:2,name:"parameter",kind:"scalar",T:9,opt:!0},{no:15,name:"proto_file",kind:"message",T:Oe,repeated:!0},{no:17,name:"source_file_descriptors",kind:"message",T:Oe,repeated:!0},{no:3,name:"compiler_version",kind:"message",T:xt,opt:!0}]);class Vt extends w{constructor(e){super(),this.file=[],d.util.initPartial(e,this)}static fromBinary(e,t){return new Vt().fromBinary(e,t)}static fromJson(e,t){return new Vt().fromJson(e,t)}static fromJsonString(e,t){return new Vt().fromJsonString(e,t)}static equals(e,t){return d.util.equals(Vt,e,t)}}Vt.runtime=d,Vt.typeName="google.protobuf.compiler.CodeGeneratorResponse",Vt.fields=d.util.newFieldList(()=>[{no:1,name:"error",kind:"scalar",T:9,opt:!0},{no:2,name:"supported_features",kind:"scalar",T:4,opt:!0},{no:15,name:"file",kind:"message",T:Dt,repeated:!0}]);var es;(function(n){n[n.NONE=0]="NONE",n[n.PROTO3_OPTIONAL=1]="PROTO3_OPTIONAL",n[n.SUPPORTS_EDITIONS=2]="SUPPORTS_EDITIONS"})(es||(es={})),d.util.setEnumType(es,"google.protobuf.compiler.CodeGeneratorResponse.Feature",[{no:0,name:"FEATURE_NONE"},{no:1,name:"FEATURE_PROTO3_OPTIONAL"},{no:2,name:"FEATURE_SUPPORTS_EDITIONS"}]);class Dt extends w{constructor(e){super(),d.util.initPartial(e,this)}static fromBinary(e,t){return new Dt().fromBinary(e,t)}static fromJson(e,t){return new Dt().fromJson(e,t)}static fromJsonString(e,t){return new Dt().fromJsonString(e,t)}static equals(e,t){return d.util.equals(Dt,e,t)}}Dt.runtime=d,Dt.typeName="google.protobuf.compiler.CodeGeneratorResponse.File",Dt.fields=d.util.newFieldList(()=>[{no:1,name:"name",kind:"scalar",T:9,opt:!0},{no:2,name:"insertion_point",kind:"scalar",T:9,opt:!0},{no:15,name:"content",kind:"scalar",T:9,opt:!0},{no:16,name:"generated_code_info",kind:"message",T:kt,opt:!0}]);class Fe extends w{constructor(e){super(),this.fileName="",g.util.initPartial(e,this)}static fromBinary(e,t){return new Fe().fromBinary(e,t)}static fromJson(e,t){return new Fe().fromJson(e,t)}static fromJsonString(e,t){return new Fe().fromJsonString(e,t)}static equals(e,t){return g.util.equals(Fe,e,t)}}Fe.runtime=g,Fe.typeName="google.protobuf.SourceContext",Fe.fields=g.util.newFieldList(()=>[{no:1,name:"file_name",kind:"scalar",T:9}]);var qe;(function(n){n[n.PROTO2=0]="PROTO2",n[n.PROTO3=1]="PROTO3",n[n.EDITIONS=2]="EDITIONS"})(qe||(qe={})),g.util.setEnumType(qe,"google.protobuf.Syntax",[{no:0,name:"SYNTAX_PROTO2"},{no:1,name:"SYNTAX_PROTO3"},{no:2,name:"SYNTAX_EDITIONS"}]);class Yt extends w{constructor(e){super(),this.name="",this.fields=[],this.oneofs=[],this.options=[],this.syntax=qe.PROTO2,this.edition="",g.util.initPartial(e,this)}static fromBinary(e,t){return new Yt().fromBinary(e,t)}static fromJson(e,t){return new Yt().fromJson(e,t)}static fromJsonString(e,t){return new Yt().fromJsonString(e,t)}static equals(e,t){return g.util.equals(Yt,e,t)}}Yt.runtime=g,Yt.typeName="google.protobuf.Type",Yt.fields=g.util.newFieldList(()=>[{no:1,name:"name",kind:"scalar",T:9},{no:2,name:"fields",kind:"message",T:Ct,repeated:!0},{no:3,name:"oneofs",kind:"scalar",T:9,repeated:!0},{no:4,name:"options",kind:"message",T:de,repeated:!0},{no:5,name:"source_context",kind:"message",T:Fe},{no:6,name:"syntax",kind:"enum",T:g.getEnumType(qe)},{no:7,name:"edition",kind:"scalar",T:9}]);class Ct extends w{constructor(e){super(),this.kind=Ln.TYPE_UNKNOWN,this.cardinality=Mn.UNKNOWN,this.number=0,this.name="",this.typeUrl="",this.oneofIndex=0,this.packed=!1,this.options=[],this.jsonName="",this.defaultValue="",g.util.initPartial(e,this)}static fromBinary(e,t){return new Ct().fromBinary(e,t)}static fromJson(e,t){return new Ct().fromJson(e,t)}static fromJsonString(e,t){return new Ct().fromJsonString(e,t)}static equals(e,t){return g.util.equals(Ct,e,t)}}Ct.runtime=g,Ct.typeName="google.protobuf.Field",Ct.fields=g.util.newFieldList(()=>[{no:1,name:"kind",kind:"enum",T:g.getEnumType(Ln)},{no:2,name:"cardinality",kind:"enum",T:g.getEnumType(Mn)},{no:3,name:"number",kind:"scalar",T:5},{no:4,name:"name",kind:"scalar",T:9},{no:6,name:"type_url",kind:"scalar",T:9},{no:7,name:"oneof_index",kind:"scalar",T:5},{no:8,name:"packed",kind:"scalar",T:8},{no:9,name:"options",kind:"message",T:de,repeated:!0},{no:10,name:"json_name",kind:"scalar",T:9},{no:11,name:"default_value",kind:"scalar",T:9}]);var Ln;(function(n){n[n.TYPE_UNKNOWN=0]="TYPE_UNKNOWN",n[n.TYPE_DOUBLE=1]="TYPE_DOUBLE",n[n.TYPE_FLOAT=2]="TYPE_FLOAT",n[n.TYPE_INT64=3]="TYPE_INT64",n[n.TYPE_UINT64=4]="TYPE_UINT64",n[n.TYPE_INT32=5]="TYPE_INT32",n[n.TYPE_FIXED64=6]="TYPE_FIXED64",n[n.TYPE_FIXED32=7]="TYPE_FIXED32",n[n.TYPE_BOOL=8]="TYPE_BOOL",n[n.TYPE_STRING=9]="TYPE_STRING",n[n.TYPE_GROUP=10]="TYPE_GROUP",n[n.TYPE_MESSAGE=11]="TYPE_MESSAGE",n[n.TYPE_BYTES=12]="TYPE_BYTES",n[n.TYPE_UINT32=13]="TYPE_UINT32",n[n.TYPE_ENUM=14]="TYPE_ENUM",n[n.TYPE_SFIXED32=15]="TYPE_SFIXED32",n[n.TYPE_SFIXED64=16]="TYPE_SFIXED64",n[n.TYPE_SINT32=17]="TYPE_SINT32",n[n.TYPE_SINT64=18]="TYPE_SINT64"})(Ln||(Ln={})),g.util.setEnumType(Ln,"google.protobuf.Field.Kind",[{no:0,name:"TYPE_UNKNOWN"},{no:1,name:"TYPE_DOUBLE"},{no:2,name:"TYPE_FLOAT"},{no:3,name:"TYPE_INT64"},{no:4,name:"TYPE_UINT64"},{no:5,name:"TYPE_INT32"},{no:6,name:"TYPE_FIXED64"},{no:7,name:"TYPE_FIXED32"},{no:8,name:"TYPE_BOOL"},{no:9,name:"TYPE_STRING"},{no:10,name:"TYPE_GROUP"},{no:11,name:"TYPE_MESSAGE"},{no:12,name:"TYPE_BYTES"},{no:13,name:"TYPE_UINT32"},{no:14,name:"TYPE_ENUM"},{no:15,name:"TYPE_SFIXED32"},{no:16,name:"TYPE_SFIXED64"},{no:17,name:"TYPE_SINT32"},{no:18,name:"TYPE_SINT64"}]);var Mn;(function(n){n[n.UNKNOWN=0]="UNKNOWN",n[n.OPTIONAL=1]="OPTIONAL",n[n.REQUIRED=2]="REQUIRED",n[n.REPEATED=3]="REPEATED"})(Mn||(Mn={})),g.util.setEnumType(Mn,"google.protobuf.Field.Cardinality",[{no:0,name:"CARDINALITY_UNKNOWN"},{no:1,name:"CARDINALITY_OPTIONAL"},{no:2,name:"CARDINALITY_REQUIRED"},{no:3,name:"CARDINALITY_REPEATED"}]);class Kt extends w{constructor(e){super(),this.name="",this.enumvalue=[],this.options=[],this.syntax=qe.PROTO2,this.edition="",g.util.initPartial(e,this)}static fromBinary(e,t){return new Kt().fromBinary(e,t)}static fromJson(e,t){return new Kt().fromJson(e,t)}static fromJsonString(e,t){return new Kt().fromJsonString(e,t)}static equals(e,t){return g.util.equals(Kt,e,t)}}Kt.runtime=g,Kt.typeName="google.protobuf.Enum",Kt.fields=g.util.newFieldList(()=>[{no:1,name:"name",kind:"scalar",T:9},{no:2,name:"enumvalue",kind:"message",T:Rt,repeated:!0},{no:3,name:"options",kind:"message",T:de,repeated:!0},{no:4,name:"source_context",kind:"message",T:Fe},{no:5,name:"syntax",kind:"enum",T:g.getEnumType(qe)},{no:6,name:"edition",kind:"scalar",T:9}]);class Rt extends w{constructor(e){super(),this.name="",this.number=0,this.options=[],g.util.initPartial(e,this)}static fromBinary(e,t){return new Rt().fromBinary(e,t)}static fromJson(e,t){return new Rt().fromJson(e,t)}static fromJsonString(e,t){return new Rt().fromJsonString(e,t)}static equals(e,t){return g.util.equals(Rt,e,t)}}Rt.runtime=g,Rt.typeName="google.protobuf.EnumValue",Rt.fields=g.util.newFieldList(()=>[{no:1,name:"name",kind:"scalar",T:9},{no:2,name:"number",kind:"scalar",T:5},{no:3,name:"options",kind:"message",T:de,repeated:!0}]);class de extends w{constructor(e){super(),this.name="",g.util.initPartial(e,this)}static fromBinary(e,t){return new de().fromBinary(e,t)}static fromJson(e,t){return new de().fromJson(e,t)}static fromJsonString(e,t){return new de().fromJsonString(e,t)}static equals(e,t){return g.util.equals(de,e,t)}}de.runtime=g,de.typeName="google.protobuf.Option",de.fields=g.util.newFieldList(()=>[{no:1,name:"name",kind:"scalar",T:9},{no:2,name:"value",kind:"message",T:be}]);class Gt extends w{constructor(e){super(),this.name="",this.methods=[],this.options=[],this.version="",this.mixins=[],this.syntax=qe.PROTO2,g.util.initPartial(e,this)}static fromBinary(e,t){return new Gt().fromBinary(e,t)}static fromJson(e,t){return new Gt().fromJson(e,t)}static fromJsonString(e,t){return new Gt().fromJsonString(e,t)}static equals(e,t){return g.util.equals(Gt,e,t)}}Gt.runtime=g,Gt.typeName="google.protobuf.Api",Gt.fields=g.util.newFieldList(()=>[{no:1,name:"name",kind:"scalar",T:9},{no:2,name:"methods",kind:"message",T:Jt,repeated:!0},{no:3,name:"options",kind:"message",T:de,repeated:!0},{no:4,name:"version",kind:"scalar",T:9},{no:5,name:"source_context",kind:"message",T:Fe},{no:6,name:"mixins",kind:"message",T:Bt,repeated:!0},{no:7,name:"syntax",kind:"enum",T:g.getEnumType(qe)}]);class Jt extends w{constructor(e){super(),this.name="",this.requestTypeUrl="",this.requestStreaming=!1,this.responseTypeUrl="",this.responseStreaming=!1,this.options=[],this.syntax=qe.PROTO2,g.util.initPartial(e,this)}static fromBinary(e,t){return new Jt().fromBinary(e,t)}static fromJson(e,t){return new Jt().fromJson(e,t)}static fromJsonString(e,t){return new Jt().fromJsonString(e,t)}static equals(e,t){return g.util.equals(Jt,e,t)}}Jt.runtime=g,Jt.typeName="google.protobuf.Method",Jt.fields=g.util.newFieldList(()=>[{no:1,name:"name",kind:"scalar",T:9},{no:2,name:"request_type_url",kind:"scalar",T:9},{no:3,name:"request_streaming",kind:"scalar",T:8},{no:4,name:"response_type_url",kind:"scalar",T:9},{no:5,name:"response_streaming",kind:"scalar",T:8},{no:6,name:"options",kind:"message",T:de,repeated:!0},{no:7,name:"syntax",kind:"enum",T:g.getEnumType(qe)}]);class Bt extends w{constructor(e){super(),this.name="",this.root="",g.util.initPartial(e,this)}static fromBinary(e,t){return new Bt().fromBinary(e,t)}static fromJson(e,t){return new Bt().fromJson(e,t)}static fromJsonString(e,t){return new Bt().fromJsonString(e,t)}static equals(e,t){return g.util.equals(Bt,e,t)}}Bt.runtime=g,Bt.typeName="google.protobuf.Mixin",Bt.fields=g.util.newFieldList(()=>[{no:1,name:"name",kind:"scalar",T:9},{no:2,name:"root",kind:"scalar",T:9}]);const xs=Object.freeze(Object.defineProperty({__proto__:null,Any:be,Api:Gt,BinaryReader:Es,BinaryWriter:bi,BoolValue:Ue,BytesValue:$e,CodeGeneratorRequest:jt,CodeGeneratorResponse:Vt,get CodeGeneratorResponse_Feature(){return es},CodeGeneratorResponse_File:Dt,DescriptorProto:Ge,DescriptorProto_ExtensionRange:rt,DescriptorProto_ReservedRange:st,DoubleValue:Ce,Duration:We,get Edition(){return V},Empty:Ot,Enum:Kt,EnumDescriptorProto:ze,EnumDescriptorProto_EnumReservedRange:ct,EnumOptions:yt,EnumValue:Rt,EnumValueDescriptorProto:ut,EnumValueOptions:Tt,ExtensionRangeOptions:it,ExtensionRangeOptions_Declaration:ot,get ExtensionRangeOptions_VerificationState(){return Cn},FeatureSet:Z,FeatureSetDefaults:wt,FeatureSetDefaults_FeatureSetEditionDefault:Nt,get FeatureSet_EnumType(){return cr},get FeatureSet_FieldPresence(){return ar},get FeatureSet_JsonFormat(){return hr},get FeatureSet_MessageEncoding(){return lr},get FeatureSet_RepeatedFieldEncoding(){return mn},get FeatureSet_Utf8Validation(){return ur},Field:Ct,FieldDescriptorProto:Pe,get FieldDescriptorProto_Label(){return en},get FieldDescriptorProto_Type(){return J},FieldMask:Pt,FieldOptions:mt,get FieldOptions_CType(){return Jn},FieldOptions_EditionDefault:gt,get FieldOptions_JSType(){return tn},get FieldOptions_OptionRetention(){return ir},get FieldOptions_OptionTargetType(){return or},get Field_Cardinality(){return Mn},get Field_Kind(){return Ln},FileDescriptorProto:Oe,FileDescriptorSet:_e,FileOptions:ft,get FileOptions_OptimizeMode(){return Rn},FloatValue:Re,GeneratedCodeInfo:kt,GeneratedCodeInfo_Annotation:At,get GeneratedCodeInfo_Annotation_Semantic(){return fr},Int32Value:Le,Int64Value:Je,ListValue:De,get LongType(){return Se},Message:w,MessageOptions:dt,Method:Jt,MethodDescriptorProto:ht,get MethodIdempotency(){return sr},get MethodKind(){return Ae},MethodOptions:St,get MethodOptions_IdempotencyLevel(){return qt},Mixin:Bt,get NullValue(){return gn},OneofDescriptorProto:at,OneofOptions:pt,Option:de,get ScalarType(){return m},ServiceDescriptorProto:lt,ServiceOptions:vt,SourceCodeInfo:Et,SourceCodeInfo_Location:It,SourceContext:Fe,StringValue:pn,Struct:xe,get Syntax(){return qe},Timestamp:dr,Type:Yt,UInt32Value:Me,UInt64Value:Be,UninterpretedOption:oe,UninterpretedOption_NamePart:bt,Value:ye,Version:xt,get WireType(){return j},codegenInfo:Hc,createDescriptorSet:Mi,createRegistry:pu,createRegistryFromDescriptors:vu,proto2:d,proto3:g,protoBase64:er,protoDelimited:_s,protoDouble:Gc,protoInt64:z,toPlainMessage:Vi},Symbol.toStringTag,{value:"Module"}));function Yi(n){const e=L[n];return typeof e!="string"?n.toString():e[0].toLowerCase()+e.substring(1).replace(/[A-Z]/g,t=>"_"+t.toLowerCase())}class se extends Error{constructor(e,t=L.Unknown,r,s,i){super(Iu(e,t)),this.name="ConnectError",Object.setPrototypeOf(this,new.target.prototype),this.rawMessage=e,this.code=t,this.metadata=new Headers(r!=null?r:{}),this.details=s!=null?s:[],this.cause=i}static from(e,t=L.Unknown){return e instanceof se?e:e instanceof Error?e.name=="AbortError"?new se(e.message,L.Canceled):new se(e.message,t,void 0,void 0,e):new se(String(e),t,void 0,void 0,e)}findDetails(e){const t="typeName"in e?{findMessage:s=>s===e.typeName?e:void 0}:e,r=[];for(const s of this.details){if(s instanceof w){t.findMessage(s.getType().typeName)&&r.push(s);continue}const i=t.findMessage(s.type);if(i)try{r.push(i.fromBinary(s.value))}catch{}}return r}}function Iu(n,e){return n.length?`[${Yi(e)}] ${n}`:`[${Yi(e)}]`}function ku(n,e,t){try{const r=er.dec(n);return e?e.fromBinary(r,t):r}catch(r){throw se.from(r,L.DataLoss)}}function Au(n,e){const t={};for(const[r,s]of Object.entries(n.methods)){const i=e(Object.assign(Object.assign({},s),{localName:r,service:n}));i!=null&&(t[r]=i)}return t}function Ki(n){let e,t=new Uint8Array(0);function r(s){const i=new Uint8Array(t.length+s.length);i.set(t),i.set(s,t.length),t=i}return new ReadableStream({start(){e=n.getReader()},async pull(s){let i;for(;;){if(i===void 0&&t.byteLength>=5){let c=0;for(let u=1;u<5;u++)c=(c<<8)+t[u];i={flags:t[0],length:c}}if(i!==void 0&&t.byteLength>=i.length+5)break;const a=await e.read();if(a.done)break;r(a.value)}if(i===void 0){if(t.byteLength==0){s.close();return}s.error(new se("premature end of stream",L.DataLoss));return}const o=t.subarray(5,5+i.length);t=t.subarray(5+i.length),s.enqueue({flags:i.flags,data:o})}})}function Gi(n,e){const t=new Uint8Array(e.length+5);t.set(e,5);const r=new DataView(t.buffer,t.byteOffset,t.byteLength);return r.setUint8(0,n),r.setUint32(1,e.length),t}var _u=globalThis&&globalThis.__asyncValues||function(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=n[Symbol.asyncIterator],t;return e?e.call(n):(n=typeof __values=="function"?__values(n):n[Symbol.iterator](),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(i){t[i]=n[i]&&function(o){return new Promise(function(a,c){o=n[i](o),s(a,c,o.done,o.value)})}}function s(i,o,a,c){Promise.resolve(c).then(function(u){i({value:u,done:a})},o)}},mr=globalThis&&globalThis.__await||function(n){return this instanceof mr?(this.v=n,this):new mr(n)},Ou=globalThis&&globalThis.__asyncGenerator||function(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=t.apply(n,e||[]),s,i=[];return s={},o("next"),o("throw"),o("return"),s[Symbol.asyncIterator]=function(){return this},s;function o(f){r[f]&&(s[f]=function(p){return new Promise(function(b,N){i.push([f,p,b,N])>1||a(f,p)})})}function a(f,p){try{c(r[f](p))}catch(b){y(i[0][3],b)}}function c(f){f.value instanceof mr?Promise.resolve(f.value.v).then(u,l):y(i[0][2],f)}function u(f){a("next",f)}function l(f){a("throw",f)}function y(f,p){f(p),i.shift(),i.length&&a(i[0][0],i[0][1])}},Pu=globalThis&&globalThis.__asyncDelegator||function(n){var e,t;return e={},r("next"),r("throw",function(s){throw s}),r("return"),e[Symbol.iterator]=function(){return this},e;function r(s,i){e[s]=n[s]?function(o){return(t=!t)?{value:mr(n[s](o)),done:!1}:i?i(o):o}:i}};function xu(n){return Ou(this,arguments,function*(){yield mr(yield*Pu(_u(n)))})}var zi=globalThis&&globalThis.__asyncValues||function(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=n[Symbol.asyncIterator],t;return e?e.call(n):(n=typeof __values=="function"?__values(n):n[Symbol.iterator](),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(i){t[i]=n[i]&&function(o){return new Promise(function(a,c){o=n[i](o),s(a,c,o.done,o.value)})}}function s(i,o,a,c){Promise.resolve(c).then(function(u){i({value:u,done:a})},o)}},Un=globalThis&&globalThis.__await||function(n){return this instanceof Un?(this.v=n,this):new Un(n)},Du=globalThis&&globalThis.__asyncDelegator||function(n){var e,t;return e={},r("next"),r("throw",function(s){throw s}),r("return"),e[Symbol.iterator]=function(){return this},e;function r(s,i){e[s]=n[s]?function(o){return(t=!t)?{value:Un(n[s](o)),done:!1}:i?i(o):o}:i}},Cu=globalThis&&globalThis.__asyncGenerator||function(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=t.apply(n,e||[]),s,i=[];return s={},o("next"),o("throw"),o("return"),s[Symbol.asyncIterator]=function(){return this},s;function o(f){r[f]&&(s[f]=function(p){return new Promise(function(b,N){i.push([f,p,b,N])>1||a(f,p)})})}function a(f,p){try{c(r[f](p))}catch(b){y(i[0][3],b)}}function c(f){f.value instanceof Un?Promise.resolve(f.value.v).then(u,l):y(i[0][2],f)}function u(f){a("next",f)}function l(f){a("throw",f)}function y(f,p){f(p),i.shift(),i.length&&a(i[0][0],i[0][1])}};function Ru(n,e){return Au(n,t=>{switch(t.kind){case Ae.Unary:return Ju(e,n,t);case Ae.ServerStreaming:return Bu(e,n,t);case Ae.ClientStreaming:return Lu(e,n,t);case Ae.BiDiStreaming:return Mu(e,n,t);default:return null}})}function Ju(n,e,t){return async function(r,s){var i,o;const a=await n.unary(e,t,s==null?void 0:s.signal,s==null?void 0:s.timeoutMs,s==null?void 0:s.headers,r,s==null?void 0:s.contextValues);return(i=s==null?void 0:s.onHeader)===null||i===void 0||i.call(s,a.header),(o=s==null?void 0:s.onTrailer)===null||o===void 0||o.call(s,a.trailer),a.message}}function Bu(n,e,t){return function(r,s){return Wi(n.stream(e,t,s==null?void 0:s.signal,s==null?void 0:s.timeoutMs,s==null?void 0:s.headers,xu([r]),s==null?void 0:s.contextValues),s)}}function Lu(n,e,t){return async function(r,s){var i,o,a,c,u,l;const y=await n.stream(e,t,s==null?void 0:s.signal,s==null?void 0:s.timeoutMs,s==null?void 0:s.headers,r,s==null?void 0:s.contextValues);(u=s==null?void 0:s.onHeader)===null||u===void 0||u.call(s,y.header);let f;try{for(var p=!0,b=zi(y.message),N;N=await b.next(),i=N.done,!i;p=!0)c=N.value,p=!1,f=c}catch(E){o={error:E}}finally{try{!p&&!i&&(a=b.return)&&await a.call(b)}finally{if(o)throw o.error}}if(!f)throw new se("protocol error: missing response message",L.Internal);return(l=s==null?void 0:s.onTrailer)===null||l===void 0||l.call(s,y.trailer),f}}function Mu(n,e,t){return function(r,s){return Wi(n.stream(e,t,s==null?void 0:s.signal,s==null?void 0:s.timeoutMs,s==null?void 0:s.headers,r,s==null?void 0:s.contextValues),s)}}function Wi(n,e){const t=function(){var r,s;return Cu(this,arguments,function*(){const i=yield Un(n);(r=e==null?void 0:e.onHeader)===null||r===void 0||r.call(e,i.header),yield Un(yield*Du(zi(i.message))),(s=e==null?void 0:e.onTrailer)===null||s===void 0||s.call(e,i.trailer)})}()[Symbol.asyncIterator]();return{[Symbol.asyncIterator]:()=>({next:()=>t.next()})}}function Uu(...n){const e=new AbortController,t=n.filter(s=>s!==void 0).concat(e.signal);for(const s of t){if(s.aborted){r.apply(s);break}s.addEventListener("abort",r)}function r(){e.signal.aborted||e.abort(Xi(this));for(const s of t)s.removeEventListener("abort",r)}return e}function $u(n){const e=new AbortController,t=()=>{e.abort(new se("the operation timed out",L.DeadlineExceeded))};let r;return n!==void 0&&(n<=0?t():r=setTimeout(t,n)),{signal:e.signal,cleanup:()=>clearTimeout(r)}}function Xi(n){if(!n.aborted)return;if(n.reason!==void 0)return n.reason;const e=new Error("This operation was aborted");return e.name="AbortError",e}function Hi(){return{get(n){return n.id in this?this[n.id]:n.defaultValue},set(n,e){return this[n.id]=e,this},delete(n){return delete this[n.id],this}}}const Ds=128;function Zi(n){const e=new Headers,t=new TextDecoder().decode(n).split(`\r
`);for(const r of t){if(r==="")continue;const s=r.indexOf(":");if(s>0){const i=r.substring(0,s).trim(),o=r.substring(s+1).trim();e.append(i,o)}}return e}const Fu="Content-Type",qu="Grpc-Timeout",Qi="Grpc-Status",eo="Grpc-Message",ju="Grpc-Status-Details-Bin",Vu="User-Agent",Yu="X-User-Agent",Ku="X-Grpc-Web",Gu="application/grpc-web+proto",zu="application/grpc-web+json";class zt extends w{constructor(e){super(),this.code=0,this.message="",this.details=[],g.util.initPartial(e,this)}static fromBinary(e,t){return new zt().fromBinary(e,t)}static fromJson(e,t){return new zt().fromJson(e,t)}static fromJsonString(e,t){return new zt().fromJsonString(e,t)}static equals(e,t){return g.util.equals(zt,e,t)}}zt.runtime=g,zt.typeName="google.rpc.Status",zt.fields=g.util.newFieldList(()=>[{no:1,name:"code",kind:"scalar",T:5},{no:2,name:"message",kind:"scalar",T:9},{no:3,name:"details",kind:"message",T:be,repeated:!0}]);const Wu="0";function to(n){var e;const t=n.get(ju);if(t!=null){const s=ku(t,zt);if(s.code==0)return;const i=new se(s.message,s.code,n);return i.details=s.details.map(o=>({type:o.typeUrl.substring(o.typeUrl.lastIndexOf("/")+1),value:o.value})),i}const r=n.get(Qi);if(r!=null){if(r===Wu)return;const s=parseInt(r,10);return s in L?new se(decodeURIComponent((e=n.get(eo))!==null&&e!==void 0?e:""),s,n):new se(`invalid grpc-status: ${r}`,L.Internal,n)}}function no(n,e,t){const r=typeof e=="string"?e:e.typeName,s=typeof t=="string"?t:t.name;return n.toString().replace(/\/?$/,`/${r}/${s}`)}function ro(n,e){return e instanceof w?e:new n(e)}function Xu(n,e){function t(r){return r.done===!0?r:{done:r.done,value:ro(n,r.value)}}return{[Symbol.asyncIterator](){const r=e[Symbol.asyncIterator](),s={next:()=>r.next().then(t)};return r.throw!==void 0&&(s.throw=i=>r.throw(i).then(t)),r.return!==void 0&&(s.return=i=>r.return(i).then(t)),s}}}function Hu(n){var e;const t=Object.assign({},n);return(e=t.ignoreUnknownFields)!==null&&e!==void 0||(t.ignoreUnknownFields=!0),t}function so(n,e,t,r){const s=e?io(n.I,r):oo(n.I,t);return{parse:(e?io(n.O,r):oo(n.O,t)).parse,serialize:s.serialize}}function io(n,e){return{parse(t){try{return n.fromBinary(t,e)}catch(r){const s=r instanceof Error?r.message:String(r);throw new se(`parse binary: ${s}`,L.InvalidArgument)}},serialize(t){try{return t.toBinary(e)}catch(r){const s=r instanceof Error?r.message:String(r);throw new se(`serialize binary: ${s}`,L.Internal)}}}}function oo(n,e){var t,r;const s=(t=e==null?void 0:e.textEncoder)!==null&&t!==void 0?t:new TextEncoder,i=(r=e==null?void 0:e.textDecoder)!==null&&r!==void 0?r:new TextDecoder,o=Hu(e);return{parse(a){try{const c=i.decode(a);return n.fromJsonString(c,o)}catch(c){throw se.from(c,L.InvalidArgument)}},serialize(a){try{const c=a.toJsonString(o);return s.encode(c)}catch(c){throw se.from(c,L.Internal)}}}}function Zu(n){const e=co(n.next,n.interceptors),[t,r,s]=ao(n),i=Object.assign(Object.assign({},n.req),{message:ro(n.req.method.I,n.req.message),signal:t});return e(i).then(o=>(s(),o),r)}function Qu(n){const e=co(n.next,n.interceptors),[t,r,s]=ao(n),i=Object.assign(Object.assign({},n.req),{message:Xu(n.req.method.I,n.req.message),signal:t});let o=!1;return t.addEventListener("abort",function(){var a,c;const u=n.req.message[Symbol.asyncIterator]();o||(a=u.throw)===null||a===void 0||a.call(u,this.reason).catch(()=>{}),(c=u.return)===null||c===void 0||c.call(u).catch(()=>{})}),e(i).then(a=>Object.assign(Object.assign({},a),{message:{[Symbol.asyncIterator](){const c=a.message[Symbol.asyncIterator]();return{next(){return c.next().then(u=>(u.done==!0&&(o=!0,s()),u),r)}}}}}),r)}function ao(n){const{signal:e,cleanup:t}=$u(n.timeoutMs),r=Uu(n.signal,e);return[r.signal,function(i){const o=se.from(e.aborted?Xi(e):i);return r.abort(o),t(),Promise.reject(o)},function(){t(),r.abort()}]}function co(n,e){var t;return(t=e==null?void 0:e.concat().reverse().reduce((r,s)=>s(r),n))!==null&&t!==void 0?t:n}function el(){try{new Headers}catch{throw new Error("connect-web requires the fetch API. Are you running on an old version of Node.js? Node.js is not supported in Connect for Web - please stay tuned for Connect for Node.")}}function uo(n,e){const t=to(n);if(t)throw e.forEach((r,s)=>{t.metadata.append(s,r)}),t}function lo(n,e,t,r){const s=new Headers(t!=null?t:{});return s.set(Fu,n?Gu:zu),s.set(Ku,"1"),s.set(Yu,"connect-es/1.2.0"),r&&s.set(Vu,"connect-es/1.2.0"),e!==void 0&&s.set(qu,`${e}m`),s}function tl(n){switch(n){case 400:return L.Internal;case 401:return L.Unauthenticated;case 403:return L.PermissionDenied;case 404:return L.Unimplemented;case 429:return L.Unavailable;case 502:return L.Unavailable;case 503:return L.Unavailable;case 504:return L.Unavailable;default:return L.Unknown}}function ho(n,e){var t;if(n>=200&&n<300){const r=to(e);if(r)throw r;return{foundStatus:e.has(Qi)}}throw new se(decodeURIComponent((t=e.get(eo))!==null&&t!==void 0?t:`HTTP ${n}`),tl(n),e)}var yn=globalThis&&globalThis.__await||function(n){return this instanceof yn?(this.v=n,this):new yn(n)},nl=globalThis&&globalThis.__asyncGenerator||function(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=t.apply(n,e||[]),s,i=[];return s={},o("next"),o("throw"),o("return"),s[Symbol.asyncIterator]=function(){return this},s;function o(f){r[f]&&(s[f]=function(p){return new Promise(function(b,N){i.push([f,p,b,N])>1||a(f,p)})})}function a(f,p){try{c(r[f](p))}catch(b){y(i[0][3],b)}}function c(f){f.value instanceof yn?Promise.resolve(f.value.v).then(u,l):y(i[0][2],f)}function u(f){a("next",f)}function l(f){a("throw",f)}function y(f,p){f(p),i.shift(),i.length&&a(i[0][0],i[0][1])}};function rl(n){var e;el();const t=(e=n.useBinaryFormat)!==null&&e!==void 0?e:!0;return{async unary(r,s,i,o,a,c,u){var l;const{serialize:y,parse:f}=so(s,t,n.jsonOptions,n.binaryOptions);return o=o===void 0?n.defaultTimeoutMs:o<=0?void 0:o,await Zu({interceptors:n.interceptors,signal:i,timeoutMs:o,req:{stream:!1,service:r,method:s,url:no(n.baseUrl,r,s),init:{method:"POST",credentials:(l=n.credentials)!==null&&l!==void 0?l:"same-origin",redirect:"error",mode:"cors"},header:lo(t,o,a,!1),contextValues:u!=null?u:Hi(),message:c},next:async p=>{var b;const E=await((b=n.fetch)!==null&&b!==void 0?b:globalThis.fetch)(p.url,Object.assign(Object.assign({},p.init),{headers:p.header,signal:p.signal,body:Gi(0,y(p.message))}));if(ho(E.status,E.headers),!E.body)throw"missing response body";const D=Ki(E.body).getReader();let K,B;for(;;){const q=await D.read();if(q.done)break;const{flags:G,data:X}=q.value;if(G===Ds){if(K!==void 0)throw"extra trailer";K=Zi(X);continue}if(B!==void 0)throw"extra message";B=f(X)}if(K===void 0)throw"missing trailer";if(uo(K,E.headers),B===void 0)throw"missing message";return{stream:!1,header:E.headers,message:B,trailer:K}}})},async stream(r,s,i,o,a,c,u){var l;const{serialize:y,parse:f}=so(s,t,n.jsonOptions,n.binaryOptions);function p(N,E,D,K){return nl(this,arguments,function*(){const q=Ki(N).getReader();if(E){if(!(yield yn(q.read())).done)throw"extra data for trailers-only";return yield yn(void 0)}let G=!1;for(;;){const X=yield yn(q.read());if(X.done)break;const{flags:kn,data:An}=X.value;if((kn&Ds)===Ds){if(G)throw"extra trailer";G=!0;const Br=Zi(An);uo(Br,K),Br.forEach((Df,Cf)=>D.set(Cf,Df));continue}if(G)throw"extra message";yield yield yn(f(An))}if(!G)throw"missing trailer"})}async function b(N){if(s.kind!=Ae.ServerStreaming)throw"The fetch API does not support streaming request bodies";const E=await N[Symbol.asyncIterator]().next();if(E.done==!0)throw"missing request message";return Gi(0,y(E.value))}return o=o===void 0?n.defaultTimeoutMs:o<=0?void 0:o,Qu({interceptors:n.interceptors,signal:i,timeoutMs:o,req:{stream:!0,service:r,method:s,url:no(n.baseUrl,r,s),init:{method:"POST",credentials:(l=n.credentials)!==null&&l!==void 0?l:"same-origin",redirect:"error",mode:"cors"},header:lo(t,o,a,!1),contextValues:u!=null?u:Hi(),message:c},next:async N=>{var E;const K=await((E=n.fetch)!==null&&E!==void 0?E:globalThis.fetch)(N.url,Object.assign(Object.assign({},N.init),{headers:N.header,signal:N.signal,body:await b(N.message)})),{foundStatus:B}=ho(K.status,K.headers);if(!K.body)throw"missing response body";const q=new Headers;return Object.assign(Object.assign({},N),{header:K.headers,trailer:q,message:p(K.body,B,q,K.headers)})}})}}}var T={exports:{}},P=T.exports;Object.defineProperty(P,"__esModule",{value:!0});const{proto3:O,StringValue:Cs,Timestamp:$n}=xs,ts=O.makeEnum("yorkie.v1.ValueType",[{no:0,name:"VALUE_TYPE_NULL",localName:"NULL"},{no:1,name:"VALUE_TYPE_BOOLEAN",localName:"BOOLEAN"},{no:2,name:"VALUE_TYPE_INTEGER",localName:"INTEGER"},{no:3,name:"VALUE_TYPE_LONG",localName:"LONG"},{no:4,name:"VALUE_TYPE_DOUBLE",localName:"DOUBLE"},{no:5,name:"VALUE_TYPE_STRING",localName:"STRING"},{no:6,name:"VALUE_TYPE_BYTES",localName:"BYTES"},{no:7,name:"VALUE_TYPE_DATE",localName:"DATE"},{no:8,name:"VALUE_TYPE_JSON_OBJECT",localName:"JSON_OBJECT"},{no:9,name:"VALUE_TYPE_JSON_ARRAY",localName:"JSON_ARRAY"},{no:10,name:"VALUE_TYPE_TEXT",localName:"TEXT"},{no:11,name:"VALUE_TYPE_INTEGER_CNT",localName:"INTEGER_CNT"},{no:12,name:"VALUE_TYPE_LONG_CNT",localName:"LONG_CNT"},{no:13,name:"VALUE_TYPE_TREE",localName:"TREE"}]),fo=O.makeEnum("yorkie.v1.DocEventType",[{no:0,name:"DOC_EVENT_TYPE_DOCUMENT_CHANGED",localName:"DOCUMENT_CHANGED"},{no:1,name:"DOC_EVENT_TYPE_DOCUMENT_WATCHED",localName:"DOCUMENT_WATCHED"},{no:2,name:"DOC_EVENT_TYPE_DOCUMENT_UNWATCHED",localName:"DOCUMENT_UNWATCHED"},{no:3,name:"DOC_EVENT_TYPE_DOCUMENT_BROADCAST",localName:"DOCUMENT_BROADCAST"}]),sl=O.makeMessageType("yorkie.v1.Snapshot",()=>[{no:1,name:"root",kind:"message",T:rs},{no:2,name:"presences",kind:"map",K:9,V:{kind:"message",T:Ms}}]),il=O.makeMessageType("yorkie.v1.ChangePack",()=>[{no:1,name:"document_key",kind:"scalar",T:9},{no:2,name:"checkpoint",kind:"message",T:Uo},{no:3,name:"snapshot",kind:"scalar",T:12},{no:4,name:"changes",kind:"message",T:mo,repeated:!0},{no:5,name:"min_synced_ticket",kind:"message",T:A},{no:6,name:"is_removed",kind:"scalar",T:8}]),mo=O.makeMessageType("yorkie.v1.Change",()=>[{no:1,name:"id",kind:"message",T:go},{no:2,name:"message",kind:"scalar",T:9},{no:3,name:"operations",kind:"message",T:po,repeated:!0},{no:4,name:"presence_change",kind:"message",T:Lo}]),go=O.makeMessageType("yorkie.v1.ChangeID",()=>[{no:1,name:"client_seq",kind:"scalar",T:13},{no:2,name:"server_seq",kind:"scalar",T:3,L:1},{no:3,name:"lamport",kind:"scalar",T:3,L:1},{no:4,name:"actor_id",kind:"scalar",T:12}]),po=O.makeMessageType("yorkie.v1.Operation",()=>[{no:1,name:"set",kind:"message",T:yo,oneof:"body"},{no:2,name:"add",kind:"message",T:To,oneof:"body"},{no:3,name:"move",kind:"message",T:vo,oneof:"body"},{no:4,name:"remove",kind:"message",T:So,oneof:"body"},{no:5,name:"edit",kind:"message",T:bo,oneof:"body"},{no:6,name:"select",kind:"message",T:wo,oneof:"body"},{no:7,name:"style",kind:"message",T:No,oneof:"body"},{no:8,name:"increase",kind:"message",T:Eo,oneof:"body"},{no:9,name:"tree_edit",kind:"message",T:Io,oneof:"body"},{no:10,name:"tree_style",kind:"message",T:ko,oneof:"body"}]),yo=O.makeMessageType("yorkie.v1.Operation.Set",()=>[{no:1,name:"parent_created_at",kind:"message",T:A},{no:2,name:"key",kind:"scalar",T:9},{no:3,name:"value",kind:"message",T:ns},{no:4,name:"executed_at",kind:"message",T:A}],{localName:"Operation_Set"}),To=O.makeMessageType("yorkie.v1.Operation.Add",()=>[{no:1,name:"parent_created_at",kind:"message",T:A},{no:2,name:"prev_created_at",kind:"message",T:A},{no:3,name:"value",kind:"message",T:ns},{no:4,name:"executed_at",kind:"message",T:A}],{localName:"Operation_Add"}),vo=O.makeMessageType("yorkie.v1.Operation.Move",()=>[{no:1,name:"parent_created_at",kind:"message",T:A},{no:2,name:"prev_created_at",kind:"message",T:A},{no:3,name:"created_at",kind:"message",T:A},{no:4,name:"executed_at",kind:"message",T:A}],{localName:"Operation_Move"}),So=O.makeMessageType("yorkie.v1.Operation.Remove",()=>[{no:1,name:"parent_created_at",kind:"message",T:A},{no:2,name:"created_at",kind:"message",T:A},{no:3,name:"executed_at",kind:"message",T:A}],{localName:"Operation_Remove"}),bo=O.makeMessageType("yorkie.v1.Operation.Edit",()=>[{no:1,name:"parent_created_at",kind:"message",T:A},{no:2,name:"from",kind:"message",T:Tn},{no:3,name:"to",kind:"message",T:Tn},{no:4,name:"created_at_map_by_actor",kind:"map",K:9,V:{kind:"message",T:A}},{no:5,name:"content",kind:"scalar",T:9},{no:6,name:"executed_at",kind:"message",T:A},{no:7,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}}],{localName:"Operation_Edit"}),wo=O.makeMessageType("yorkie.v1.Operation.Select",()=>[{no:1,name:"parent_created_at",kind:"message",T:A},{no:2,name:"from",kind:"message",T:Tn},{no:3,name:"to",kind:"message",T:Tn},{no:4,name:"executed_at",kind:"message",T:A}],{localName:"Operation_Select"}),No=O.makeMessageType("yorkie.v1.Operation.Style",()=>[{no:1,name:"parent_created_at",kind:"message",T:A},{no:2,name:"from",kind:"message",T:Tn},{no:3,name:"to",kind:"message",T:Tn},{no:4,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:5,name:"executed_at",kind:"message",T:A},{no:6,name:"created_at_map_by_actor",kind:"map",K:9,V:{kind:"message",T:A}}],{localName:"Operation_Style"}),Eo=O.makeMessageType("yorkie.v1.Operation.Increase",()=>[{no:1,name:"parent_created_at",kind:"message",T:A},{no:2,name:"value",kind:"message",T:ns},{no:3,name:"executed_at",kind:"message",T:A}],{localName:"Operation_Increase"}),Io=O.makeMessageType("yorkie.v1.Operation.TreeEdit",()=>[{no:1,name:"parent_created_at",kind:"message",T:A},{no:2,name:"from",kind:"message",T:gr},{no:3,name:"to",kind:"message",T:gr},{no:4,name:"created_at_map_by_actor",kind:"map",K:9,V:{kind:"message",T:A}},{no:5,name:"contents",kind:"message",T:Jo,repeated:!0},{no:7,name:"split_level",kind:"scalar",T:5},{no:6,name:"executed_at",kind:"message",T:A}],{localName:"Operation_TreeEdit"}),ko=O.makeMessageType("yorkie.v1.Operation.TreeStyle",()=>[{no:1,name:"parent_created_at",kind:"message",T:A},{no:2,name:"from",kind:"message",T:gr},{no:3,name:"to",kind:"message",T:gr},{no:4,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:5,name:"executed_at",kind:"message",T:A},{no:6,name:"attributes_to_remove",kind:"scalar",T:9,repeated:!0},{no:7,name:"created_at_map_by_actor",kind:"map",K:9,V:{kind:"message",T:A}}],{localName:"Operation_TreeStyle"}),ns=O.makeMessageType("yorkie.v1.JSONElementSimple",()=>[{no:1,name:"created_at",kind:"message",T:A},{no:2,name:"moved_at",kind:"message",T:A},{no:3,name:"removed_at",kind:"message",T:A},{no:4,name:"type",kind:"enum",T:O.getEnumType(ts)},{no:5,name:"value",kind:"scalar",T:12}]),rs=O.makeMessageType("yorkie.v1.JSONElement",()=>[{no:1,name:"json_object",kind:"message",T:Ao,oneof:"body"},{no:2,name:"json_array",kind:"message",T:_o,oneof:"body"},{no:3,name:"primitive",kind:"message",T:Oo,oneof:"body"},{no:5,name:"text",kind:"message",T:Po,oneof:"body"},{no:6,name:"counter",kind:"message",T:xo,oneof:"body"},{no:7,name:"tree",kind:"message",T:Do,oneof:"body"}]),Ao=O.makeMessageType("yorkie.v1.JSONElement.JSONObject",()=>[{no:1,name:"nodes",kind:"message",T:Co,repeated:!0},{no:2,name:"created_at",kind:"message",T:A},{no:3,name:"moved_at",kind:"message",T:A},{no:4,name:"removed_at",kind:"message",T:A}],{localName:"JSONElement_JSONObject"}),_o=O.makeMessageType("yorkie.v1.JSONElement.JSONArray",()=>[{no:1,name:"nodes",kind:"message",T:Rs,repeated:!0},{no:2,name:"created_at",kind:"message",T:A},{no:3,name:"moved_at",kind:"message",T:A},{no:4,name:"removed_at",kind:"message",T:A}],{localName:"JSONElement_JSONArray"}),Oo=O.makeMessageType("yorkie.v1.JSONElement.Primitive",()=>[{no:1,name:"type",kind:"enum",T:O.getEnumType(ts)},{no:2,name:"value",kind:"scalar",T:12},{no:3,name:"created_at",kind:"message",T:A},{no:4,name:"moved_at",kind:"message",T:A},{no:5,name:"removed_at",kind:"message",T:A}],{localName:"JSONElement_Primitive"}),Po=O.makeMessageType("yorkie.v1.JSONElement.Text",()=>[{no:1,name:"nodes",kind:"message",T:Ro,repeated:!0},{no:2,name:"created_at",kind:"message",T:A},{no:3,name:"moved_at",kind:"message",T:A},{no:4,name:"removed_at",kind:"message",T:A}],{localName:"JSONElement_Text"}),xo=O.makeMessageType("yorkie.v1.JSONElement.Counter",()=>[{no:1,name:"type",kind:"enum",T:O.getEnumType(ts)},{no:2,name:"value",kind:"scalar",T:12},{no:3,name:"created_at",kind:"message",T:A},{no:4,name:"moved_at",kind:"message",T:A},{no:5,name:"removed_at",kind:"message",T:A}],{localName:"JSONElement_Counter"}),Do=O.makeMessageType("yorkie.v1.JSONElement.Tree",()=>[{no:1,name:"nodes",kind:"message",T:Ls,repeated:!0},{no:2,name:"created_at",kind:"message",T:A},{no:3,name:"moved_at",kind:"message",T:A},{no:4,name:"removed_at",kind:"message",T:A}],{localName:"JSONElement_Tree"}),Co=O.makeMessageType("yorkie.v1.RHTNode",()=>[{no:1,name:"key",kind:"scalar",T:9},{no:2,name:"element",kind:"message",T:rs}]),Rs=O.makeMessageType("yorkie.v1.RGANode",()=>[{no:1,name:"next",kind:"message",T:Rs},{no:2,name:"element",kind:"message",T:rs}]),Js=O.makeMessageType("yorkie.v1.NodeAttr",()=>[{no:1,name:"value",kind:"scalar",T:9},{no:2,name:"updated_at",kind:"message",T:A},{no:3,name:"is_removed",kind:"scalar",T:8}]),Ro=O.makeMessageType("yorkie.v1.TextNode",()=>[{no:1,name:"id",kind:"message",T:Bs},{no:2,name:"value",kind:"scalar",T:9},{no:3,name:"removed_at",kind:"message",T:A},{no:4,name:"ins_prev_id",kind:"message",T:Bs},{no:5,name:"attributes",kind:"map",K:9,V:{kind:"message",T:Js}}]),Bs=O.makeMessageType("yorkie.v1.TextNodeID",()=>[{no:1,name:"created_at",kind:"message",T:A},{no:2,name:"offset",kind:"scalar",T:5}]),Ls=O.makeMessageType("yorkie.v1.TreeNode",()=>[{no:1,name:"id",kind:"message",T:Fn},{no:2,name:"type",kind:"scalar",T:9},{no:3,name:"value",kind:"scalar",T:9},{no:4,name:"removed_at",kind:"message",T:A},{no:5,name:"ins_prev_id",kind:"message",T:Fn},{no:6,name:"ins_next_id",kind:"message",T:Fn},{no:7,name:"depth",kind:"scalar",T:5},{no:8,name:"attributes",kind:"map",K:9,V:{kind:"message",T:Js}}]),Jo=O.makeMessageType("yorkie.v1.TreeNodes",()=>[{no:1,name:"content",kind:"message",T:Ls,repeated:!0}]),Fn=O.makeMessageType("yorkie.v1.TreeNodeID",()=>[{no:1,name:"created_at",kind:"message",T:A},{no:2,name:"offset",kind:"scalar",T:5}]),gr=O.makeMessageType("yorkie.v1.TreePos",()=>[{no:1,name:"parent_id",kind:"message",T:Fn},{no:2,name:"left_sibling_id",kind:"message",T:Fn}]),ol=O.makeMessageType("yorkie.v1.User",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"username",kind:"scalar",T:9},{no:3,name:"created_at",kind:"message",T:$n}]),al=O.makeMessageType("yorkie.v1.Project",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"public_key",kind:"scalar",T:9},{no:4,name:"secret_key",kind:"scalar",T:9},{no:5,name:"auth_webhook_url",kind:"scalar",T:9},{no:6,name:"auth_webhook_methods",kind:"scalar",T:9,repeated:!0},{no:7,name:"client_deactivate_threshold",kind:"scalar",T:9},{no:8,name:"created_at",kind:"message",T:$n},{no:9,name:"updated_at",kind:"message",T:$n}]),cl=O.makeMessageType("yorkie.v1.UpdatableProjectFields",()=>[{no:1,name:"name",kind:"message",T:Cs},{no:2,name:"auth_webhook_url",kind:"message",T:Cs},{no:3,name:"auth_webhook_methods",kind:"message",T:Bo},{no:4,name:"client_deactivate_threshold",kind:"message",T:Cs}]),Bo=O.makeMessageType("yorkie.v1.UpdatableProjectFields.AuthWebhookMethods",()=>[{no:1,name:"methods",kind:"scalar",T:9,repeated:!0}],{localName:"UpdatableProjectFields_AuthWebhookMethods"}),ul=O.makeMessageType("yorkie.v1.DocumentSummary",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"key",kind:"scalar",T:9},{no:3,name:"snapshot",kind:"scalar",T:9},{no:4,name:"created_at",kind:"message",T:$n},{no:5,name:"accessed_at",kind:"message",T:$n},{no:6,name:"updated_at",kind:"message",T:$n}]),Lo=O.makeMessageType("yorkie.v1.PresenceChange",()=>[{no:1,name:"type",kind:"enum",T:O.getEnumType(Mo)},{no:2,name:"presence",kind:"message",T:Ms}]),Mo=O.makeEnum("yorkie.v1.PresenceChange.ChangeType",[{no:0,name:"CHANGE_TYPE_UNSPECIFIED",localName:"UNSPECIFIED"},{no:1,name:"CHANGE_TYPE_PUT",localName:"PUT"},{no:2,name:"CHANGE_TYPE_DELETE",localName:"DELETE"},{no:3,name:"CHANGE_TYPE_CLEAR",localName:"CLEAR"}]),Ms=O.makeMessageType("yorkie.v1.Presence",()=>[{no:1,name:"data",kind:"map",K:9,V:{kind:"scalar",T:9}}]),Uo=O.makeMessageType("yorkie.v1.Checkpoint",()=>[{no:1,name:"server_seq",kind:"scalar",T:3,L:1},{no:2,name:"client_seq",kind:"scalar",T:13}]),Tn=O.makeMessageType("yorkie.v1.TextNodePos",()=>[{no:1,name:"created_at",kind:"message",T:A},{no:2,name:"offset",kind:"scalar",T:5},{no:3,name:"relative_offset",kind:"scalar",T:5}]),A=O.makeMessageType("yorkie.v1.TimeTicket",()=>[{no:1,name:"lamport",kind:"scalar",T:3,L:1},{no:2,name:"delimiter",kind:"scalar",T:13},{no:3,name:"actor_id",kind:"scalar",T:12}]),$o=O.makeMessageType("yorkie.v1.DocEventBody",()=>[{no:1,name:"topic",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:12}]),ll=O.makeMessageType("yorkie.v1.DocEvent",()=>[{no:1,name:"type",kind:"enum",T:O.getEnumType(fo)},{no:2,name:"publisher",kind:"scalar",T:9},{no:3,name:"body",kind:"message",T:$o}]);P.ValueType=ts,P.DocEventType=fo,P.Snapshot=sl,P.ChangePack=il,P.Change=mo,P.ChangeID=go,P.Operation=po,P.Operation_Set=yo,P.Operation_Add=To,P.Operation_Move=vo,P.Operation_Remove=So,P.Operation_Edit=bo,P.Operation_Select=wo,P.Operation_Style=No,P.Operation_Increase=Eo,P.Operation_TreeEdit=Io,P.Operation_TreeStyle=ko,P.JSONElementSimple=ns,P.JSONElement=rs,P.JSONElement_JSONObject=Ao,P.JSONElement_JSONArray=_o,P.JSONElement_Primitive=Oo,P.JSONElement_Text=Po,P.JSONElement_Counter=xo,P.JSONElement_Tree=Do,P.RHTNode=Co,P.RGANode=Rs,P.NodeAttr=Js,P.TextNode=Ro,P.TextNodeID=Bs,P.TreeNode=Ls,P.TreeNodes=Jo,P.TreeNodeID=Fn,P.TreePos=gr,P.User=ol,P.Project=al,P.UpdatableProjectFields=cl,P.UpdatableProjectFields_AuthWebhookMethods=Bo,P.DocumentSummary=ul,P.PresenceChange=Lo,P.PresenceChange_ChangeType=Mo,P.Presence=Ms,P.Checkpoint=Uo,P.TextNodePos=Tn,P.TimeTicket=A,P.DocEventBody=$o,P.DocEvent=ll;const Fo=(T.exports==null?{}:T.exports).default||T.exports,C=(T.exports==null?{}:T.exports).ValueType,ss=(T.exports==null?{}:T.exports).DocEventType,qo=(T.exports==null?{}:T.exports).Snapshot,jo=(T.exports==null?{}:T.exports).ChangePack,Vo=(T.exports==null?{}:T.exports).Change,is=(T.exports==null?{}:T.exports).ChangeID,Us=(T.exports==null?{}:T.exports).Operation,Yo=(T.exports==null?{}:T.exports).Operation_Set,Ko=(T.exports==null?{}:T.exports).Operation_Add,Go=(T.exports==null?{}:T.exports).Operation_Move,zo=(T.exports==null?{}:T.exports).Operation_Remove,Wo=(T.exports==null?{}:T.exports).Operation_Edit,hl=(T.exports==null?{}:T.exports).Operation_Select,Xo=(T.exports==null?{}:T.exports).Operation_Style,Ho=(T.exports==null?{}:T.exports).Operation_Increase,Zo=(T.exports==null?{}:T.exports).Operation_TreeEdit,Qo=(T.exports==null?{}:T.exports).Operation_TreeStyle,vn=(T.exports==null?{}:T.exports).JSONElementSimple,Lt=(T.exports==null?{}:T.exports).JSONElement,ea=(T.exports==null?{}:T.exports).JSONElement_JSONObject,ta=(T.exports==null?{}:T.exports).JSONElement_JSONArray,na=(T.exports==null?{}:T.exports).JSONElement_Primitive,ra=(T.exports==null?{}:T.exports).JSONElement_Text,sa=(T.exports==null?{}:T.exports).JSONElement_Counter,ia=(T.exports==null?{}:T.exports).JSONElement_Tree,oa=(T.exports==null?{}:T.exports).RHTNode,aa=(T.exports==null?{}:T.exports).RGANode,$s=(T.exports==null?{}:T.exports).NodeAttr,ca=(T.exports==null?{}:T.exports).TextNode,ua=(T.exports==null?{}:T.exports).TextNodeID,la=(T.exports==null?{}:T.exports).TreeNode,ha=(T.exports==null?{}:T.exports).TreeNodes,fa=(T.exports==null?{}:T.exports).TreeNodeID,da=(T.exports==null?{}:T.exports).TreePos,fl=(T.exports==null?{}:T.exports).User,dl=(T.exports==null?{}:T.exports).Project,ml=(T.exports==null?{}:T.exports).UpdatableProjectFields,gl=(T.exports==null?{}:T.exports).UpdatableProjectFields_AuthWebhookMethods,pl=(T.exports==null?{}:T.exports).DocumentSummary,Fs=(T.exports==null?{}:T.exports).PresenceChange,pr=(T.exports==null?{}:T.exports).PresenceChange_ChangeType,ma=(T.exports==null?{}:T.exports).Presence,ga=(T.exports==null?{}:T.exports).Checkpoint,pa=(T.exports==null?{}:T.exports).TextNodePos,ya=(T.exports==null?{}:T.exports).TimeTicket,yl=(T.exports==null?{}:T.exports).DocEventBody,Tl=(T.exports==null?{}:T.exports).DocEvent,vl=Object.freeze(Object.defineProperty({__proto__:null,Change:Vo,ChangeID:is,ChangePack:jo,Checkpoint:ga,DocEvent:Tl,DocEventBody:yl,DocEventType:ss,DocumentSummary:pl,JSONElement:Lt,JSONElementSimple:vn,JSONElement_Counter:sa,JSONElement_JSONArray:ta,JSONElement_JSONObject:ea,JSONElement_Primitive:na,JSONElement_Text:ra,JSONElement_Tree:ia,NodeAttr:$s,Operation:Us,Operation_Add:Ko,Operation_Edit:Wo,Operation_Increase:Ho,Operation_Move:Go,Operation_Remove:zo,Operation_Select:hl,Operation_Set:Yo,Operation_Style:Xo,Operation_TreeEdit:Zo,Operation_TreeStyle:Qo,Presence:ma,PresenceChange:Fs,PresenceChange_ChangeType:pr,Project:dl,RGANode:aa,RHTNode:oa,Snapshot:qo,TextNode:ca,TextNodeID:ua,TextNodePos:pa,TimeTicket:ya,TreeNode:la,TreeNodeID:fa,TreeNodes:ha,TreePos:da,UpdatableProjectFields:ml,UpdatableProjectFields_AuthWebhookMethods:gl,User:fl,ValueType:C,default:Fo},Symbol.toStringTag,{value:"Module"}));var R={exports:{}},ae=R.exports;Object.defineProperty(ae,"__esModule",{value:!0});const{proto3:ce}=xs,{ChangePack:nn,DocEvent:Sl}=Fo||vl,bl=ce.makeMessageType("yorkie.v1.ActivateClientRequest",()=>[{no:1,name:"client_key",kind:"scalar",T:9}]),wl=ce.makeMessageType("yorkie.v1.ActivateClientResponse",()=>[{no:1,name:"client_id",kind:"scalar",T:9}]),Nl=ce.makeMessageType("yorkie.v1.DeactivateClientRequest",()=>[{no:1,name:"client_id",kind:"scalar",T:9}]),El=ce.makeMessageType("yorkie.v1.DeactivateClientResponse",[]),Il=ce.makeMessageType("yorkie.v1.AttachDocumentRequest",()=>[{no:1,name:"client_id",kind:"scalar",T:9},{no:2,name:"change_pack",kind:"message",T:nn}]),kl=ce.makeMessageType("yorkie.v1.AttachDocumentResponse",()=>[{no:1,name:"document_id",kind:"scalar",T:9},{no:2,name:"change_pack",kind:"message",T:nn}]),Al=ce.makeMessageType("yorkie.v1.DetachDocumentRequest",()=>[{no:1,name:"client_id",kind:"scalar",T:9},{no:2,name:"document_id",kind:"scalar",T:9},{no:3,name:"change_pack",kind:"message",T:nn},{no:4,name:"remove_if_not_attached",kind:"scalar",T:8}]),_l=ce.makeMessageType("yorkie.v1.DetachDocumentResponse",()=>[{no:2,name:"change_pack",kind:"message",T:nn}]),Ol=ce.makeMessageType("yorkie.v1.WatchDocumentRequest",()=>[{no:1,name:"client_id",kind:"scalar",T:9},{no:2,name:"document_id",kind:"scalar",T:9}]),Pl=ce.makeMessageType("yorkie.v1.WatchDocumentResponse",()=>[{no:1,name:"initialization",kind:"message",T:Ta,oneof:"body"},{no:2,name:"event",kind:"message",T:Sl,oneof:"body"}]),Ta=ce.makeMessageType("yorkie.v1.WatchDocumentResponse.Initialization",()=>[{no:1,name:"client_ids",kind:"scalar",T:9,repeated:!0}],{localName:"WatchDocumentResponse_Initialization"}),xl=ce.makeMessageType("yorkie.v1.RemoveDocumentRequest",()=>[{no:1,name:"client_id",kind:"scalar",T:9},{no:2,name:"document_id",kind:"scalar",T:9},{no:3,name:"change_pack",kind:"message",T:nn}]),Dl=ce.makeMessageType("yorkie.v1.RemoveDocumentResponse",()=>[{no:1,name:"change_pack",kind:"message",T:nn}]),Cl=ce.makeMessageType("yorkie.v1.PushPullChangesRequest",()=>[{no:1,name:"client_id",kind:"scalar",T:9},{no:2,name:"document_id",kind:"scalar",T:9},{no:3,name:"change_pack",kind:"message",T:nn},{no:4,name:"push_only",kind:"scalar",T:8}]),Rl=ce.makeMessageType("yorkie.v1.PushPullChangesResponse",()=>[{no:1,name:"change_pack",kind:"message",T:nn}]),Jl=ce.makeMessageType("yorkie.v1.BroadcastRequest",()=>[{no:1,name:"client_id",kind:"scalar",T:9},{no:2,name:"document_id",kind:"scalar",T:9},{no:3,name:"topic",kind:"scalar",T:9},{no:4,name:"payload",kind:"scalar",T:12}]),Bl=ce.makeMessageType("yorkie.v1.BroadcastResponse",[]);ae.ActivateClientRequest=bl,ae.ActivateClientResponse=wl,ae.DeactivateClientRequest=Nl,ae.DeactivateClientResponse=El,ae.AttachDocumentRequest=Il,ae.AttachDocumentResponse=kl,ae.DetachDocumentRequest=Al,ae.DetachDocumentResponse=_l,ae.WatchDocumentRequest=Ol,ae.WatchDocumentResponse=Pl,ae.WatchDocumentResponse_Initialization=Ta,ae.RemoveDocumentRequest=xl,ae.RemoveDocumentResponse=Dl,ae.PushPullChangesRequest=Cl,ae.PushPullChangesResponse=Rl,ae.BroadcastRequest=Jl,ae.BroadcastResponse=Bl;const va=(R.exports==null?{}:R.exports).default||R.exports,Ll=(R.exports==null?{}:R.exports).ActivateClientRequest,Ml=(R.exports==null?{}:R.exports).ActivateClientResponse,Ul=(R.exports==null?{}:R.exports).DeactivateClientRequest,$l=(R.exports==null?{}:R.exports).DeactivateClientResponse,Fl=(R.exports==null?{}:R.exports).AttachDocumentRequest,ql=(R.exports==null?{}:R.exports).AttachDocumentResponse,jl=(R.exports==null?{}:R.exports).DetachDocumentRequest,Vl=(R.exports==null?{}:R.exports).DetachDocumentResponse,Yl=(R.exports==null?{}:R.exports).WatchDocumentRequest,Kl=(R.exports==null?{}:R.exports).WatchDocumentResponse,Gl=(R.exports==null?{}:R.exports).WatchDocumentResponse_Initialization,zl=(R.exports==null?{}:R.exports).RemoveDocumentRequest,Wl=(R.exports==null?{}:R.exports).RemoveDocumentResponse,Xl=(R.exports==null?{}:R.exports).PushPullChangesRequest,Hl=(R.exports==null?{}:R.exports).PushPullChangesResponse,Zl=(R.exports==null?{}:R.exports).BroadcastRequest,Ql=(R.exports==null?{}:R.exports).BroadcastResponse,eh=Object.freeze(Object.defineProperty({__proto__:null,ActivateClientRequest:Ll,ActivateClientResponse:Ml,AttachDocumentRequest:Fl,AttachDocumentResponse:ql,BroadcastRequest:Zl,BroadcastResponse:Ql,DeactivateClientRequest:Ul,DeactivateClientResponse:$l,DetachDocumentRequest:jl,DetachDocumentResponse:Vl,PushPullChangesRequest:Xl,PushPullChangesResponse:Hl,RemoveDocumentRequest:zl,RemoveDocumentResponse:Wl,WatchDocumentRequest:Yl,WatchDocumentResponse:Kl,WatchDocumentResponse_Initialization:Gl,default:va},Symbol.toStringTag,{value:"Module"}));var qn={exports:{}},Sa=qn.exports;Object.defineProperty(Sa,"__esModule",{value:!0});const{ActivateClientRequest:th,ActivateClientResponse:nh,AttachDocumentRequest:rh,AttachDocumentResponse:sh,BroadcastRequest:ih,BroadcastResponse:oh,DeactivateClientRequest:ah,DeactivateClientResponse:ch,DetachDocumentRequest:uh,DetachDocumentResponse:lh,PushPullChangesRequest:hh,PushPullChangesResponse:fh,RemoveDocumentRequest:dh,RemoveDocumentResponse:mh,WatchDocumentRequest:gh,WatchDocumentResponse:ph}=va||eh,{MethodKind:rn}=xs,yh={typeName:"yorkie.v1.YorkieService",methods:{activateClient:{name:"ActivateClient",I:th,O:nh,kind:rn.Unary},deactivateClient:{name:"DeactivateClient",I:ah,O:ch,kind:rn.Unary},attachDocument:{name:"AttachDocument",I:rh,O:sh,kind:rn.Unary},detachDocument:{name:"DetachDocument",I:uh,O:lh,kind:rn.Unary},removeDocument:{name:"RemoveDocument",I:dh,O:mh,kind:rn.Unary},pushPullChanges:{name:"PushPullChanges",I:hh,O:fh,kind:rn.Unary},watchDocument:{name:"WatchDocument",I:gh,O:ph,kind:rn.ServerStreaming},broadcast:{name:"Broadcast",I:ih,O:oh,kind:rn.Unary}}};Sa.YorkieService=yh,(qn.exports==null?{}:qn.exports).default||qn.exports;const Th=(qn.exports==null?{}:qn.exports).YorkieService;/**
 * @license
 * Copyright 2009 The Closure Library Authors
 * Copyright 2020 Daniel Wirtz / The long.js Authors.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * SPDX-License-Identifier: Apache-2.0
 */var je=null;try{je=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function x(n,e,t){this.low=n|0,this.high=e|0,this.unsigned=!!t}x.prototype.__isLong__,Object.defineProperty(x.prototype,"__isLong__",{value:!0});function le(n){return(n&&n.__isLong__)===!0}function ba(n){var e=Math.clz32(n&-n);return n?31-e:e}x.isLong=le;var wa={},Na={};function Sn(n,e){var t,r,s;return e?(n>>>=0,(s=0<=n&&n<256)&&(r=Na[n],r)?r:(t=$(n,0,!0),s&&(Na[n]=t),t)):(n|=0,(s=-128<=n&&n<128)&&(r=wa[n],r)?r:(t=$(n,n<0?-1:0,!1),s&&(wa[n]=t),t))}x.fromInt=Sn;function Ve(n,e){if(isNaN(n))return e?Wt:He;if(e){if(n<0)return Wt;if(n>=Ia)return Pa}else{if(n<=-ka)return Te;if(n+1>=ka)return Oa}return n<0?Ve(-n,e).neg():$(n%jn|0,n/jn|0,e)}x.fromNumber=Ve;function $(n,e,t){return new x(n,e,t)}x.fromBits=$;var os=Math.pow;function qs(n,e,t){if(n.length===0)throw Error("empty string");if(typeof e=="number"?(t=e,e=!1):e=!!e,n==="NaN"||n==="Infinity"||n==="+Infinity"||n==="-Infinity")return e?Wt:He;if(t=t||10,t<2||36<t)throw RangeError("radix");var r;if((r=n.indexOf("-"))>0)throw Error("interior hyphen");if(r===0)return qs(n.substring(1),e,t).neg();for(var s=Ve(os(t,8)),i=He,o=0;o<n.length;o+=8){var a=Math.min(8,n.length-o),c=parseInt(n.substring(o,o+a),t);if(a<8){var u=Ve(os(t,a));i=i.mul(u).add(Ve(c))}else i=i.mul(s),i=i.add(Ve(c))}return i.unsigned=e,i}x.fromString=qs;function Xe(n,e){return typeof n=="number"?Ve(n,e):typeof n=="string"?qs(n,e):$(n.low,n.high,typeof e=="boolean"?e:n.unsigned)}x.fromValue=Xe;var Ea=1<<16,vh=1<<24,jn=Ea*Ea,Ia=jn*jn,ka=Ia/2,Aa=Sn(vh),He=Sn(0);x.ZERO=He;var Wt=Sn(0,!0);x.UZERO=Wt;var Vn=Sn(1);x.ONE=Vn;var _a=Sn(1,!0);x.UONE=_a;var js=Sn(-1);x.NEG_ONE=js;var Oa=$(-1,2147483647,!1);x.MAX_VALUE=Oa;var Pa=$(-1,-1,!0);x.MAX_UNSIGNED_VALUE=Pa;var Te=$(0,-2147483648,!1);x.MIN_VALUE=Te;var S=x.prototype;S.toInt=function(){return this.unsigned?this.low>>>0:this.low},S.toNumber=function(){return this.unsigned?(this.high>>>0)*jn+(this.low>>>0):this.high*jn+(this.low>>>0)},S.toString=function(e){if(e=e||10,e<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(Te)){var t=Ve(e),r=this.div(t),s=r.mul(t).sub(this);return r.toString(e)+s.toInt().toString(e)}else return"-"+this.neg().toString(e);for(var i=Ve(os(e,6),this.unsigned),o=this,a="";;){var c=o.div(i),u=o.sub(c.mul(i)).toInt()>>>0,l=u.toString(e);if(o=c,o.isZero())return l+a;for(;l.length<6;)l="0"+l;a=""+l+a}},S.getHighBits=function(){return this.high},S.getHighBitsUnsigned=function(){return this.high>>>0},S.getLowBits=function(){return this.low},S.getLowBitsUnsigned=function(){return this.low>>>0},S.getNumBitsAbs=function(){if(this.isNegative())return this.eq(Te)?64:this.neg().getNumBitsAbs();for(var e=this.high!=0?this.high:this.low,t=31;t>0&&(e&1<<t)==0;t--);return this.high!=0?t+33:t+1},S.isZero=function(){return this.high===0&&this.low===0},S.eqz=S.isZero,S.isNegative=function(){return!this.unsigned&&this.high<0},S.isPositive=function(){return this.unsigned||this.high>=0},S.isOdd=function(){return(this.low&1)===1},S.isEven=function(){return(this.low&1)===0},S.equals=function(e){return le(e)||(e=Xe(e)),this.unsigned!==e.unsigned&&this.high>>>31===1&&e.high>>>31===1?!1:this.high===e.high&&this.low===e.low},S.eq=S.equals,S.notEquals=function(e){return!this.eq(e)},S.neq=S.notEquals,S.ne=S.notEquals,S.lessThan=function(e){return this.comp(e)<0},S.lt=S.lessThan,S.lessThanOrEqual=function(e){return this.comp(e)<=0},S.lte=S.lessThanOrEqual,S.le=S.lessThanOrEqual,S.greaterThan=function(e){return this.comp(e)>0},S.gt=S.greaterThan,S.greaterThanOrEqual=function(e){return this.comp(e)>=0},S.gte=S.greaterThanOrEqual,S.ge=S.greaterThanOrEqual,S.compare=function(e){if(le(e)||(e=Xe(e)),this.eq(e))return 0;var t=this.isNegative(),r=e.isNegative();return t&&!r?-1:!t&&r?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},S.comp=S.compare,S.negate=function(){return!this.unsigned&&this.eq(Te)?Te:this.not().add(Vn)},S.neg=S.negate,S.add=function(e){le(e)||(e=Xe(e));var t=this.high>>>16,r=this.high&65535,s=this.low>>>16,i=this.low&65535,o=e.high>>>16,a=e.high&65535,c=e.low>>>16,u=e.low&65535,l=0,y=0,f=0,p=0;return p+=i+u,f+=p>>>16,p&=65535,f+=s+c,y+=f>>>16,f&=65535,y+=r+a,l+=y>>>16,y&=65535,l+=t+o,l&=65535,$(f<<16|p,l<<16|y,this.unsigned)},S.subtract=function(e){return le(e)||(e=Xe(e)),this.add(e.neg())},S.sub=S.subtract,S.multiply=function(e){if(this.isZero())return this;if(le(e)||(e=Xe(e)),je){var t=je.mul(this.low,this.high,e.low,e.high);return $(t,je.get_high(),this.unsigned)}if(e.isZero())return this.unsigned?Wt:He;if(this.eq(Te))return e.isOdd()?Te:He;if(e.eq(Te))return this.isOdd()?Te:He;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(Aa)&&e.lt(Aa))return Ve(this.toNumber()*e.toNumber(),this.unsigned);var r=this.high>>>16,s=this.high&65535,i=this.low>>>16,o=this.low&65535,a=e.high>>>16,c=e.high&65535,u=e.low>>>16,l=e.low&65535,y=0,f=0,p=0,b=0;return b+=o*l,p+=b>>>16,b&=65535,p+=i*l,f+=p>>>16,p&=65535,p+=o*u,f+=p>>>16,p&=65535,f+=s*l,y+=f>>>16,f&=65535,f+=i*u,y+=f>>>16,f&=65535,f+=o*c,y+=f>>>16,f&=65535,y+=r*l+s*u+i*c+o*a,y&=65535,$(p<<16|b,y<<16|f,this.unsigned)},S.mul=S.multiply,S.divide=function(e){if(le(e)||(e=Xe(e)),e.isZero())throw Error("division by zero");if(je){if(!this.unsigned&&this.high===-2147483648&&e.low===-1&&e.high===-1)return this;var t=(this.unsigned?je.div_u:je.div_s)(this.low,this.high,e.low,e.high);return $(t,je.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?Wt:He;var r,s,i;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return Wt;if(e.gt(this.shru(1)))return _a;i=Wt}else{if(this.eq(Te)){if(e.eq(Vn)||e.eq(js))return Te;if(e.eq(Te))return Vn;var o=this.shr(1);return r=o.div(e).shl(1),r.eq(He)?e.isNegative()?Vn:js:(s=this.sub(e.mul(r)),i=r.add(s.div(e)),i)}else if(e.eq(Te))return this.unsigned?Wt:He;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();i=He}for(s=this;s.gte(e);){r=Math.max(1,Math.floor(s.toNumber()/e.toNumber()));for(var a=Math.ceil(Math.log(r)/Math.LN2),c=a<=48?1:os(2,a-48),u=Ve(r),l=u.mul(e);l.isNegative()||l.gt(s);)r-=c,u=Ve(r,this.unsigned),l=u.mul(e);u.isZero()&&(u=Vn),i=i.add(u),s=s.sub(l)}return i},S.div=S.divide,S.modulo=function(e){if(le(e)||(e=Xe(e)),je){var t=(this.unsigned?je.rem_u:je.rem_s)(this.low,this.high,e.low,e.high);return $(t,je.get_high(),this.unsigned)}return this.sub(this.div(e).mul(e))},S.mod=S.modulo,S.rem=S.modulo,S.not=function(){return $(~this.low,~this.high,this.unsigned)},S.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32},S.clz=S.countLeadingZeros,S.countTrailingZeros=function(){return this.low?ba(this.low):ba(this.high)+32},S.ctz=S.countTrailingZeros,S.and=function(e){return le(e)||(e=Xe(e)),$(this.low&e.low,this.high&e.high,this.unsigned)},S.or=function(e){return le(e)||(e=Xe(e)),$(this.low|e.low,this.high|e.high,this.unsigned)},S.xor=function(e){return le(e)||(e=Xe(e)),$(this.low^e.low,this.high^e.high,this.unsigned)},S.shiftLeft=function(e){return le(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?$(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):$(0,this.low<<e-32,this.unsigned)},S.shl=S.shiftLeft,S.shiftRight=function(e){return le(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?$(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):$(this.high>>e-32,this.high>=0?0:-1,this.unsigned)},S.shr=S.shiftRight,S.shiftRightUnsigned=function(e){return le(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?$(this.low>>>e|this.high<<32-e,this.high>>>e,this.unsigned):e===32?$(this.high,0,this.unsigned):$(this.high>>>e-32,0,this.unsigned)},S.shru=S.shiftRightUnsigned,S.shr_u=S.shiftRightUnsigned,S.rotateLeft=function(e){var t;return le(e)&&(e=e.toInt()),(e&=63)===0?this:e===32?$(this.high,this.low,this.unsigned):e<32?(t=32-e,$(this.low<<e|this.high>>>t,this.high<<e|this.low>>>t,this.unsigned)):(e-=32,t=32-e,$(this.high<<e|this.low>>>t,this.low<<e|this.high>>>t,this.unsigned))},S.rotl=S.rotateLeft,S.rotateRight=function(e){var t;return le(e)&&(e=e.toInt()),(e&=63)===0?this:e===32?$(this.high,this.low,this.unsigned):e<32?(t=32-e,$(this.high<<t|this.low>>>e,this.low<<t|this.high>>>e,this.unsigned)):(e-=32,t=32-e,$(this.low<<t|this.high>>>e,this.high<<t|this.low>>>e,this.unsigned))},S.rotr=S.rotateRight,S.toSigned=function(){return this.unsigned?$(this.low,this.high,!1):this},S.toUnsigned=function(){return this.unsigned?this:$(this.low,this.high,!0)},S.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},S.toBytesLE=function(){var e=this.high,t=this.low;return[t&255,t>>>8&255,t>>>16&255,t>>>24,e&255,e>>>8&255,e>>>16&255,e>>>24]},S.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,e&255,t>>>24,t>>>16&255,t>>>8&255,t&255]},x.fromBytes=function(e,t,r){return r?x.fromBytesLE(e,t):x.fromBytesBE(e,t)},x.fromBytesLE=function(e,t){return new x(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)},x.fromBytesBE=function(e,t){return new x(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)};var U=(n=>(n.Ok="ok",n.ClientNotActive="client-not-active",n.Unimplemented="unimplemented",n.Unsupported="unsupported",n.DocumentNotAttached="document-not-attached",n.DocumentNotDetached="document-not-detached",n.DocumentRemoved="document-removed",n.InvalidObjectKey="invalid-object-key",n.InvalidArgument="invalid-argument",n))(U||{});class F extends Error{constructor(e,t){super(t),h(this,"name","YorkieError"),h(this,"stack"),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}function Ze(n){if(n instanceof Map){const e=Array.from(n);return new Map(JSON.parse(JSON.stringify(e)))}return JSON.parse(JSON.stringify(n))}const xa=n=>n?Object.entries(n).length===0:!0,Yn=n=>{const e={};for(const[t,r]of Object.entries(n))e[t]=JSON.stringify(r);return e},Kn=n=>{const e={};for(const[t,r]of Object.entries(n))e[t]=JSON.parse(r);return e};var sn=(n=>(n.Put="put",n.Clear="clear",n))(sn||{});class Vs{constructor(e,t){h(this,"context"),h(this,"presence"),this.context=e,this.presence=t}set(e,t){for(const r of Object.keys(e))this.presence[r]=e[r];this.context.setPresenceChange({type:"put",presence:Ze(this.presence)}),this.context.setReversePresence(e,t)}get(e){return this.presence[e]}clear(){this.presence={},this.context.setPresenceChange({type:"clear"})}}const as="000000000000000000000000",Sh="FFFFFFFFFFFFFFFFFFFFFFFF";class me{constructor(e,t,r){h(this,"lamport"),h(this,"delimiter"),h(this,"actorID"),this.lamport=e,this.delimiter=t,this.actorID=r}static of(e,t,r){return new me(e,t,r)}static fromStruct(e){return me.of(x.fromString(e.lamport,!0),e.delimiter,e.actorID)}toIDString(){return`${this.lamport.toString()}:${this.actorID}:${this.delimiter}`}toStruct(){return{lamport:this.getLamportAsString(),delimiter:this.getDelimiter(),actorID:this.getActorID()}}toTestString(){return`${this.lamport.toString()}:${this.actorID.slice(-2)}:${this.delimiter}`}setActor(e){return new me(this.lamport,this.delimiter,e)}getLamportAsString(){return this.lamport.toString()}getLamport(){return this.lamport}getDelimiter(){return this.delimiter}getActorID(){return this.actorID}after(e){return this.compare(e)>0}equals(e){return this.compare(e)===0}compare(e){if(this.lamport.greaterThan(e.lamport))return 1;if(e.lamport.greaterThan(this.lamport))return-1;const t=this.actorID.localeCompare(e.actorID);return t!==0?t:this.delimiter>e.delimiter?1:e.delimiter>this.delimiter?-1:0}}const Ys=0,bh=4294967295,wh=x.MAX_VALUE,Qe=new me(x.fromNumber(0),Ys,as);new me(x.fromNumber(1),Ys+1,as);const yr=new me(wh,bh,Sh);var we=(n=>(n[n.Trivial=0]="Trivial",n[n.Debug=1]="Debug",n[n.Info=2]="Info",n[n.Warn=3]="Warn",n[n.Error=4]="Error",n[n.Fatal=5]="Fatal",n))(we||{});let bn=2;function Nh(n){bn=n}const v={trivial:(...n)=>{bn>0||typeof console<"u"&&console.log("YORKIE T:",...n)},debug:(...n)=>{bn>1||typeof console<"u"&&console.log("YORKIE D:",...n)},info:(...n)=>{bn>2||typeof console<"u"&&console.log("YORKIE I:",...n)},warn:(...n)=>{bn>3||typeof console<"u"&&(typeof console.warn<"u"?console.warn("YORKIE W:",...n):console.log("YORKIE W:",...n))},error:(...n)=>{bn>4||typeof console<"u"&&(typeof console.error<"u"?console.error("YORKIE E:",...n):console.log("YORKIE E:",...n))},fatal:(n,...e)=>{throw typeof console<"u"&&(typeof console.error<"u"?console.error("YORKIE F:",...e):console.log("YORKIE F:",...e)),new Error(`YORKIE F: ${n}`)},isEnabled:n=>bn<=n};function Mt(n){return n.replace(/["'\\\n\r\f\b\t\u2028\u2029]/g,function(e){switch(e){case'"':case"\\":return"\\"+e;case`
`:return"\\n";case"\r":return"\\r";case"\f":return"\\f";case"\b":return"\\b";case"	":return"\\t";case"\u2028":return"\\u2028";case"\u2029":return"\\u2029";default:return e}})}class Tr{constructor(e){h(this,"createdAt"),h(this,"movedAt"),h(this,"removedAt"),this.createdAt=e}getCreatedAt(){return this.createdAt}getID(){return this.createdAt}getMovedAt(){return this.movedAt}getRemovedAt(){return this.removedAt}getPositionedAt(){return this.movedAt?this.movedAt:this.createdAt}setMovedAt(e){return!this.movedAt||e&&e.after(this.movedAt)?(this.movedAt=e,!0):!1}setRemovedAt(e){this.removedAt=e}remove(e){return e&&e.after(this.getPositionedAt())&&(!this.removedAt||e.after(this.removedAt))?(this.removedAt=e,!0):!1}isRemoved(){return!!this.removedAt}}class on extends Tr{constructor(e){super(e)}}class Ks{constructor(e,t){h(this,"strKey"),h(this,"value"),this.strKey=e,this.value=t}static of(e,t){return new Ks(e,t)}isRemoved(){return this.value.isRemoved()}getStrKey(){return this.strKey}getValue(){return this.value}remove(e){return this.value.remove(e)}}class vr{constructor(){h(this,"nodeMapByKey"),h(this,"nodeMapByCreatedAt"),this.nodeMapByKey=new Map,this.nodeMapByCreatedAt=new Map}static create(){return new vr}set(e,t,r){let s;const i=this.nodeMapByKey.get(e);i!=null&&!i.isRemoved()&&i.remove(r)&&(s=i.getValue());const o=Ks.of(e,t);return this.nodeMapByCreatedAt.set(t.getCreatedAt().toIDString(),o),(i==null||r.after(i.getValue().getPositionedAt()))&&(this.nodeMapByKey.set(e,o),t.setMovedAt(r)),s}delete(e,t){this.nodeMapByCreatedAt.has(e.toIDString())||v.fatal(`fail to find ${e.toIDString()}`);const r=this.nodeMapByCreatedAt.get(e.toIDString());return r.remove(t),r.getValue()}subPathOf(e){const t=this.nodeMapByCreatedAt.get(e.toIDString());if(!!t)return t.getStrKey()}purge(e){const t=this.nodeMapByCreatedAt.get(e.getCreatedAt().toIDString());if(!t){v.fatal(`fail to find ${e.getCreatedAt().toIDString()}`);return}const r=this.nodeMapByKey.get(t.getStrKey());t===r&&this.nodeMapByKey.delete(r.getStrKey()),this.nodeMapByCreatedAt.delete(t.getValue().getCreatedAt().toIDString())}deleteByKey(e,t){const r=this.nodeMapByKey.get(e);if(r!=null&&!!r.remove(t))return r.getValue()}has(e){const t=this.nodeMapByKey.get(e);return t==null?!1:!t.isRemoved()}getByID(e){return this.nodeMapByCreatedAt.get(e.toIDString())}get(e){const t=this.nodeMapByKey.get(e);if(!(!t||t.isRemoved()))return t}*[Symbol.iterator](){for(const[,e]of this.nodeMapByKey)yield e}}class ve extends on{constructor(e,t){super(e),h(this,"memberNodes"),this.memberNodes=t}static create(e,t){if(!t)return new ve(e,vr.create());const r=vr.create();for(const[s,i]of Object.entries(t))r.set(s,i.deepcopy(),i.getCreatedAt());return new ve(e,r)}subPathOf(e){return this.memberNodes.subPathOf(e)}purge(e){this.memberNodes.purge(e)}set(e,t,r){return this.memberNodes.set(e,t,r)}delete(e,t){return this.memberNodes.delete(e,t)}deleteByKey(e,t){return this.memberNodes.deleteByKey(e,t)}get(e){const t=this.memberNodes.get(e);return t==null?void 0:t.getValue()}getByID(e){const t=this.memberNodes.getByID(e);return t==null?void 0:t.getValue()}has(e){return this.memberNodes.has(e)}toJSON(){const e=[];for(const[t,r]of this)e.push(`"${Mt(t)}":${r.toJSON()}`);return`{${e.join(",")}}`}toJS(){return JSON.parse(this.toJSON())}toJSForTest(){const e={};for(const[t,r]of this){const{createdAt:s,value:i,type:o}=r.toJSForTest();e[t]={key:t,createdAt:s,value:i,type:o}}return{createdAt:this.getCreatedAt().toTestString(),value:e,type:"YORKIE_OBJECT"}}getKeys(){const e=Array();for(const[t]of this)e.push(t);return e}toSortedJSON(){var e;const t=Array();for(const[s]of this)t.push(s);const r=[];for(const s of t.sort()){const i=(e=this.memberNodes.get(s))==null?void 0:e.getValue();r.push(`"${Mt(s)}":${i.toSortedJSON()}`)}return`{${r.join(",")}}`}getRHT(){return this.memberNodes}deepcopy(){const e=ve.create(this.getCreatedAt());for(const t of this.memberNodes)e.memberNodes.set(t.getStrKey(),t.getValue().deepcopy(),this.getPositionedAt());return e.remove(this.getRemovedAt()),e}getDescendants(e){for(const t of this.memberNodes){const r=t.getValue();if(e(r,this))return;r instanceof on&&r.getDescendants(e)}}*[Symbol.iterator](){const e=new Set;for(const t of this.memberNodes)e.has(t.getStrKey())||(e.add(t.getStrKey()),t.isRemoved()||(yield[t.getStrKey(),t.getValue()]))}}var Y=(n=>(n.Local="local",n.Remote="remote",n.UndoRedo="undoredo",n))(Y||{});class et{constructor(e,t){h(this,"parentCreatedAt"),h(this,"executedAt"),this.parentCreatedAt=e,this.executedAt=t}getParentCreatedAt(){return this.parentCreatedAt}getExecutedAt(){if(!this.executedAt)throw new Error("executedAt has not been set yet");return this.executedAt}setActor(e){this.executedAt&&(this.executedAt=this.executedAt.setActor(e))}setExecutedAt(e){this.executedAt=e}}class Da{constructor(e){h(this,"value"),h(this,"left"),h(this,"right"),h(this,"parent"),h(this,"weight"),this.value=e,this.initWeight()}getNodeString(){return`${this.weight}${this.value}`}getValue(){return this.value}getLeftWeight(){return this.hasLeft()?this.left.getWeight():0}getRightWeight(){return this.hasRight()?this.right.getWeight():0}getWeight(){return this.weight}getLeft(){return this.left}getRight(){return this.right}getParent(){return this.parent}hasLeft(){return!!this.left}hasRight(){return!!this.right}hasParent(){return!!this.parent}setLeft(e){this.left=e}setRight(e){this.right=e}setParent(e){this.parent=e}unlink(){this.parent=void 0,this.right=void 0,this.left=void 0}hasLinks(){return this.hasParent()||this.hasLeft()||this.hasRight()}increaseWeight(e){this.weight+=e}initWeight(){this.weight=this.getLength()}}class Sr{constructor(e){h(this,"root"),this.root=e}get length(){return this.root?this.root.getWeight():0}find(e){if(!this.root||e<0)return[void 0,0];let t=this.root;for(;;)if(t.hasLeft()&&e<=t.getLeftWeight())t=t.getLeft();else if(t.hasRight()&&t.getLeftWeight()+t.getLength()<e)e-=t.getLeftWeight()+t.getLength(),t=t.getRight();else{e-=t.getLeftWeight();break}return e>t.getLength()&&v.fatal(`out of index range: pos: ${e} > node.length: ${t.getLength()}`),[t,e]}indexOf(e){if(!e||e!==this.root&&!e.hasLinks())return-1;let t=0,r=e,s;for(;r;)(!s||s===r.getRight())&&(t+=r.getLength()+(r.hasLeft()?r.getLeftWeight():0)),s=r,r=r.getParent();return t-e.getLength()}getRoot(){return this.root}insert(e){return this.insertAfter(this.root,e)}insertAfter(e,t){return e?(this.splayNode(e),this.root=t,t.setRight(e.getRight()),e.hasRight()&&e.getRight().setParent(t),t.setLeft(e),e.setParent(t),e.setRight(),this.updateWeight(e),this.updateWeight(t),t):(this.root=t,t)}updateWeight(e){e.initWeight(),e.hasLeft()&&e.increaseWeight(e.getLeftWeight()),e.hasRight()&&e.increaseWeight(e.getRightWeight())}updateTreeWeight(e){for(;e;)this.updateWeight(e),e=e.getParent()}splayNode(e){if(!!e)for(;;)if(this.isLeftChild(e.getParent())&&this.isRightChild(e))this.rotateLeft(e),this.rotateRight(e);else if(this.isRightChild(e.getParent())&&this.isLeftChild(e))this.rotateRight(e),this.rotateLeft(e);else if(this.isLeftChild(e.getParent())&&this.isLeftChild(e))this.rotateRight(e.getParent()),this.rotateRight(e);else if(this.isRightChild(e.getParent())&&this.isRightChild(e))this.rotateLeft(e.getParent()),this.rotateLeft(e);else{this.isLeftChild(e)?this.rotateRight(e):this.isRightChild(e)&&this.rotateLeft(e),this.updateWeight(e);return}}delete(e){this.splayNode(e);const t=new Sr(e.getLeft());t.root&&t.root.setParent();const r=new Sr(e.getRight());if(r.root&&r.root.setParent(),t.root){const s=t.getRightmost();t.splayNode(s),t.root.setRight(r.root),r.root&&r.root.setParent(t.root),this.root=t.root}else this.root=r.root;e.unlink(),this.root&&this.updateWeight(this.root)}deleteRange(e,t){if(!t){this.splayNode(e),this.cutOffRight(e);return}this.splayNode(e),this.splayNode(t),t.getLeft()!=e&&this.rotateRight(e),this.cutOffRight(e)}cutOffRight(e){const t=[];this.traversePostorder(e.getRight(),t);for(const r of t)r.initWeight();this.updateTreeWeight(e)}toTestString(){const e=[];return this.traverseInorder(this.root,e),e.map(t=>`[${t.getWeight()},${t.getLength()}]${t.getValue()||""}`).join("")}checkWeight(){const e=[];this.traverseInorder(this.root,e);for(const t of e)if(t.getWeight()!=t.getLength()+t.getLeftWeight()+t.getRightWeight())return!1;return!0}getRightmost(){let e=this.root;for(;e.hasRight();)e=e.getRight();return e}traverseInorder(e,t){!e||(this.traverseInorder(e.getLeft(),t),t.push(e),this.traverseInorder(e.getRight(),t))}traversePostorder(e,t){!e||(this.traversePostorder(e.getLeft(),t),this.traversePostorder(e.getRight(),t),t.push(e))}rotateLeft(e){const t=e.getParent();t.hasParent()?t===t.getParent().getLeft()?t.getParent().setLeft(e):t.getParent().setRight(e):this.root=e,e.setParent(t.getParent()),t.setRight(e.getLeft()),t.hasRight()&&t.getRight().setParent(t),e.setLeft(t),e.getLeft().setParent(e),this.updateWeight(t),this.updateWeight(e)}rotateRight(e){const t=e.getParent();t.hasParent()?t===t.getParent().getLeft()?t.getParent().setLeft(e):t.getParent().setRight(e):this.root=e,e.setParent(t.getParent()),t.setLeft(e.getRight()),t.hasLeft()&&t.getLeft().setParent(t),e.setRight(t),e.getRight().setParent(e),this.updateWeight(t),this.updateWeight(e)}isLeftChild(e){return e&&e.hasParent()?e.getParent().getLeft()===e:!1}isRightChild(e){return e&&e.hasParent()?e.getParent().getRight()===e:!1}}var ie=(n=>(n[n.Null=0]="Null",n[n.Boolean=1]="Boolean",n[n.Integer=2]="Integer",n[n.Long=3]="Long",n[n.Double=4]="Double",n[n.String=5]="String",n[n.Bytes=6]="Bytes",n[n.Date=7]="Date",n))(ie||{});class W extends Tr{constructor(e,t){super(t),h(this,"valueType"),h(this,"value"),this.valueType=W.getPrimitiveType(e),this.value=e===void 0?null:e}static of(e,t){return new W(e,t)}static valueFromBytes(e,t){switch(e){case 0:return null;case 1:return!!t[0];case 2:return t[0]|t[1]<<8|t[2]<<16|t[3]<<24;case 4:{const r=new DataView(t.buffer);return t.forEach(function(s,i){r.setUint8(i,s)}),r.getFloat64(0,!0)}case 5:return new TextDecoder("utf-8").decode(t);case 3:return x.fromBytesLE(Array.from(t));case 6:return t;case 7:return new Date(x.fromBytesLE(Array.from(t),!0).toNumber());default:throw new F(U.Unimplemented,`unimplemented type: ${e}`)}}toJSON(){return this.valueType===5?`"${Mt(this.value)}"`:`${this.value}`}toSortedJSON(){return this.toJSON()}toJSForTest(){return{createdAt:this.getCreatedAt().toTestString(),value:this.value,type:"YORKIE_PRIMITIVE"}}deepcopy(){const e=W.of(this.value,this.getCreatedAt());return e.setMovedAt(this.getMovedAt()),e.setRemovedAt(this.getRemovedAt()),e}getType(){return this.valueType}static getPrimitiveType(e){switch(typeof e){case"undefined":return 0;case"boolean":return 1;case"number":return this.isInteger(e)?2:4;case"string":return 5;case"object":if(e===null)return 0;if(e instanceof x)return 3;if(e instanceof Uint8Array)return 6;if(e instanceof Date)return 7}}static isSupport(e){return W.getPrimitiveType(e)!==void 0}static isInteger(e){return e%1===0}isNumericType(){const e=this.valueType;return e===2||e===3||e===4}getValue(){return this.value}toBytes(){switch(this.valueType){case 0:return new Uint8Array;case 1:return this.value?new Uint8Array([1]):new Uint8Array([0]);case 2:{const e=this.value;return new Uint8Array([e&255,e>>8&255,e>>16&255,e>>24&255])}case 4:{const e=this.value,t=new Uint8Array(8);return new DataView(t.buffer).setFloat64(0,e,!0),t}case 5:return new TextEncoder().encode(this.value);case 3:{const t=this.value.toBytesLE();return Uint8Array.from(t)}case 6:return this.value;case 7:{const e=this.value,t=x.fromNumber(e.getTime(),!0).toBytesLE();return Uint8Array.from(t)}default:throw new F(U.Unimplemented,`unimplemented type: ${this.valueType}`)}}}class cs extends Da{constructor(e){super(e),h(this,"prev"),h(this,"next"),this.value=e}static createAfter(e,t){const r=new cs(t),s=e.next;return e.next=r,r.prev=e,r.next=s,s&&(s.prev=r),r}remove(e){return this.value.remove(e)}getCreatedAt(){return this.value.getCreatedAt()}getPositionedAt(){return this.value.getPositionedAt()}release(){this.prev&&(this.prev.next=this.next),this.next&&(this.next.prev=this.prev),this.prev=void 0,this.next=void 0}getLength(){return this.value.isRemoved()?0:1}getPrev(){return this.prev}getNext(){return this.next}getValue(){return this.value}isRemoved(){return this.value.isRemoved()}}class br{constructor(){h(this,"dummyHead"),h(this,"last"),h(this,"nodeMapByIndex"),h(this,"nodeMapByCreatedAt");const e=W.of(0,Qe);e.setRemovedAt(Qe),this.dummyHead=new cs(e),this.last=this.dummyHead,this.nodeMapByIndex=new Sr,this.nodeMapByCreatedAt=new Map,this.nodeMapByIndex.insert(this.dummyHead),this.nodeMapByCreatedAt.set(this.dummyHead.getCreatedAt().toIDString(),this.dummyHead)}static create(){return new br}get length(){return this.nodeMapByIndex.length}findNextBeforeExecutedAt(e,t){let r=this.nodeMapByCreatedAt.get(e.toIDString());for(r||v.fatal(`cant find the given node: ${e.toIDString()}`);r.getNext()&&r.getNext().getPositionedAt().after(t);)r=r.getNext();return r}release(e){this.last===e&&(this.last=e.getPrev()),e.release(),this.nodeMapByIndex.delete(e),this.nodeMapByCreatedAt.delete(e.getValue().getCreatedAt().toIDString())}insertAfter(e,t,r=t.getCreatedAt()){const s=this.findNextBeforeExecutedAt(e,r),i=cs.createAfter(s,t);s===this.last&&(this.last=i),this.nodeMapByIndex.insertAfter(s,i),this.nodeMapByCreatedAt.set(i.getCreatedAt().toIDString(),i)}moveAfter(e,t,r){const s=this.nodeMapByCreatedAt.get(e.toIDString());s||v.fatal(`cant find the given node: ${e.toIDString()}`);const i=this.nodeMapByCreatedAt.get(t.toIDString());i||v.fatal(`cant find the given node: ${t.toIDString()}`),s!==i&&(!i.getValue().getMovedAt()||r.after(i.getValue().getMovedAt()))&&(this.release(i),this.insertAfter(s.getCreatedAt(),i.getValue(),r),i.getValue().setMovedAt(r))}insert(e){this.insertAfter(this.last.getCreatedAt(),e)}getByID(e){return this.nodeMapByCreatedAt.get(e.toIDString())}subPathOf(e){const t=this.nodeMapByCreatedAt.get(e.toIDString());if(!!t)return String(this.nodeMapByIndex.indexOf(t))}purge(e){const t=this.nodeMapByCreatedAt.get(e.getCreatedAt().toIDString());t||v.fatal(`fail to find the given createdAt: ${e.getCreatedAt().toIDString()}`),this.release(t)}getByIndex(e){if(e>=this.length)return;const[t,r]=this.nodeMapByIndex.find(e);let s=t;if(e===0&&t===this.dummyHead||r>0)do s&&(s=s.getNext());while(s&&s.isRemoved());return s}getPrevCreatedAt(e){let t=this.nodeMapByCreatedAt.get(e.toIDString());do t=t.getPrev();while(this.dummyHead!==t&&t.isRemoved());return t.getValue().getCreatedAt()}delete(e,t){const r=this.nodeMapByCreatedAt.get(e.toIDString()),s=r.isRemoved();return r.remove(t)&&!s&&this.nodeMapByIndex.splayNode(r),r.getValue()}deleteByIndex(e,t){const r=this.getByIndex(e);if(!!r)return r.remove(t)&&this.nodeMapByIndex.splayNode(r),r.getValue()}getHead(){return this.dummyHead.getValue()}getLast(){return this.last.getValue()}getLastCreatedAt(){return this.last.getCreatedAt()}toTestString(){const e=[];for(const t of this){const r=`${t.getCreatedAt().toIDString()}:${t.getValue().toJSON()}`;t.isRemoved()?e.push(`{${r}}`):e.push(`[${r}]`)}return e.join("")}*[Symbol.iterator](){let e=this.dummyHead.getNext();for(;e;)yield e,e=e.getNext()}}class Ne extends on{constructor(e,t){super(e),h(this,"elements"),this.elements=t}static create(e,t){if(!t)return new Ne(e,br.create());const r=br.create();for(const s of t)r.insertAfter(r.getLastCreatedAt(),s.deepcopy());return new Ne(e,r)}subPathOf(e){return this.elements.subPathOf(e)}purge(e){this.elements.purge(e)}insertAfter(e,t){this.elements.insertAfter(e,t)}moveAfter(e,t,r){this.elements.moveAfter(e,t,r)}get(e){const t=this.elements.getByIndex(e);return t==null?void 0:t.getValue()}getByID(e){const t=this.elements.getByID(e);return t==null?void 0:t.getValue()}getHead(){return this.elements.getHead()}getLast(){return this.elements.getLast()}getPrevCreatedAt(e){return this.elements.getPrevCreatedAt(e)}delete(e,t){return this.elements.delete(e,t)}deleteByIndex(e,t){return this.elements.deleteByIndex(e,t)}getLastCreatedAt(){return this.elements.getLastCreatedAt()}get length(){return this.elements.length}*[Symbol.iterator](){for(const e of this.elements)e.isRemoved()||(yield e.getValue())}toTestString(){return this.elements.toTestString()}getDescendants(e){for(const t of this.elements){const r=t.getValue();if(e(r,this))return;r instanceof on&&r.getDescendants(e)}}toJSON(){const e=[];for(const t of this)e.push(t.toJSON());return`[${e.join(",")}]`}toJS(){return JSON.parse(this.toJSON())}toJSForTest(){const e={};for(let t=0;t<this.length;t++){const{createdAt:r,value:s,type:i}=this.get(t).toJSForTest();e[t]={key:String(t),createdAt:r,value:s,type:i}}return{createdAt:this.getCreatedAt().toTestString(),value:e,type:"YORKIE_ARRAY"}}toSortedJSON(){return this.toJSON()}getElements(){return this.elements}deepcopy(){const e=Ne.create(this.getCreatedAt());for(const t of this.elements)e.elements.insertAfter(e.getLastCreatedAt(),t.getValue().deepcopy());return e.remove(this.getRemovedAt()),e}}class an extends et{constructor(e,t,r){super(e,r),h(this,"createdAt"),this.createdAt=t}static create(e,t,r){return new an(e,t,r)}execute(e,t){var r;const s=e.findByCreatedAt(this.getParentCreatedAt());if(s||v.fatal(`fail to find ${this.getParentCreatedAt()}`),s instanceof on||v.fatal(`only object and array can execute remove: ${s}`),t===Y.UndoRedo){let u=s.getByID(this.createdAt);for(;u;){if(u.getRemovedAt())return;u=(r=e.findElementPairByCreatedAt(u.getCreatedAt()))==null?void 0:r.parent}}const i=s.subPathOf(this.createdAt),o=this.toReverseOperation(s),a=s.delete(this.createdAt,this.getExecutedAt());return e.registerRemovedElement(a),{opInfos:s instanceof Ne?[{type:"remove",path:e.createPath(this.getParentCreatedAt()),index:Number(i)}]:[{type:"remove",path:e.createPath(this.getParentCreatedAt()),key:i}],reverseOp:o}}toReverseOperation(e){if(e instanceof ve){const t=e.subPathOf(this.createdAt);if(t!==void 0){const r=e.get(t);if(r!==void 0)return wn.create(t,r.deepcopy(),this.getParentCreatedAt())}}}getEffectedCreatedAt(){return this.getParentCreatedAt()}toTestString(){return`${this.getParentCreatedAt().toTestString()}.REMOVE.${this.createdAt.toTestString()}`}getCreatedAt(){return this.createdAt}}class wn extends et{constructor(e,t,r,s){super(r,s),h(this,"key"),h(this,"value"),this.key=e,this.value=t}static create(e,t,r,s){return new wn(e,t,r,s)}execute(e,t){var r;const s=e.findByCreatedAt(this.getParentCreatedAt());if(s||v.fatal(`fail to find ${this.getParentCreatedAt()}`),s instanceof ve||v.fatal("fail to execute, only object can execute set"),t===Y.UndoRedo){let u=s;for(;u;){if(u.getRemovedAt())return;u=(r=e.findElementPairByCreatedAt(u.getCreatedAt()))==null?void 0:r.parent}}const i=s.get(this.key),o=this.toReverseOperation(i),a=this.value.deepcopy(),c=s.set(this.key,a,this.getExecutedAt());return t===Y.UndoRedo&&e.findByCreatedAt(a.getCreatedAt())&&e.deregisterElement(a),e.registerElement(a,s),c&&e.registerRemovedElement(c),{opInfos:[{type:"set",path:e.createPath(this.getParentCreatedAt()),key:this.key}],reverseOp:o}}toReverseOperation(e){let t=an.create(this.getParentCreatedAt(),this.value.getCreatedAt());return e!==void 0&&!e.isRemoved()&&(t=wn.create(this.key,e.deepcopy(),this.getParentCreatedAt())),t}getEffectedCreatedAt(){return this.value.getCreatedAt()}toTestString(){return`${this.getParentCreatedAt().toTestString()}.SET.${this.key}=${this.value.toSortedJSON()}`}getKey(){return this.key}getValue(){return this.value}}class wr extends et{constructor(e,t,r,s){super(e,s),h(this,"prevCreatedAt"),h(this,"value"),this.prevCreatedAt=t,this.value=r}static create(e,t,r,s){return new wr(e,t,r,s)}execute(e){const t=e.findByCreatedAt(this.getParentCreatedAt());t||v.fatal(`fail to find ${this.getParentCreatedAt()}`),t instanceof Ne||v.fatal("fail to execute, only array can execute add");const r=t,s=this.value.deepcopy();return r.insertAfter(this.prevCreatedAt,s),e.registerElement(s,r),{opInfos:[{type:"add",path:e.createPath(this.getParentCreatedAt()),index:Number(r.subPathOf(this.getEffectedCreatedAt()))}]}}getEffectedCreatedAt(){return this.value.getCreatedAt()}toTestString(){return`${this.getParentCreatedAt().toTestString()}.ADD.${this.value.toJSON()}`}getPrevCreatedAt(){return this.prevCreatedAt}getValue(){return this.value}}class cn extends et{constructor(e,t,r,s){super(e,s),h(this,"prevCreatedAt"),h(this,"createdAt"),this.prevCreatedAt=t,this.createdAt=r}static create(e,t,r,s){return new cn(e,t,r,s)}execute(e){const t=e.findByCreatedAt(this.getParentCreatedAt());t||v.fatal(`fail to find ${this.getParentCreatedAt()}`),t instanceof Ne||v.fatal("fail to execute, only array can execute move");const r=t,s=Number(r.subPathOf(this.createdAt));r.moveAfter(this.prevCreatedAt,this.createdAt,this.getExecutedAt());const i=Number(r.subPathOf(this.createdAt));return{opInfos:[{type:"move",path:e.createPath(this.getParentCreatedAt()),index:i,previousIndex:s}]}}getEffectedCreatedAt(){return this.createdAt}toTestString(){return`${this.getParentCreatedAt().toTestString()}.MOVE`}getPrevCreatedAt(){return this.prevCreatedAt}getCreatedAt(){return this.createdAt}}class Nn{constructor(e,t,r,s){h(this,"key"),h(this,"value"),h(this,"updatedAt"),h(this,"_isRemoved"),this.key=e,this.value=t,this.updatedAt=r,this._isRemoved=s}static of(e,t,r,s){return new Nn(e,t,r,s)}getKey(){return this.key}getValue(){return this.value}getUpdatedAt(){return this.updatedAt}isRemoved(){return this._isRemoved}toIDString(){return`${this.updatedAt.toIDString()}:${this.key}`}getRemovedAt(){if(this._isRemoved)return this.updatedAt}}class Xt{constructor(){h(this,"nodeMapByKey"),h(this,"numberOfRemovedElement"),this.nodeMapByKey=new Map,this.numberOfRemovedElement=0}static create(){return new Xt}getNodeMapByKey(){return this.nodeMapByKey}set(e,t,r){const s=this.nodeMapByKey.get(e);if(s&&s.isRemoved()&&r.after(s.getUpdatedAt())&&(this.numberOfRemovedElement-=1),s===void 0||r.after(s.getUpdatedAt())){const i=Nn.of(e,t,r,!1);return this.nodeMapByKey.set(e,i),s!==void 0&&s.isRemoved()?[s,i]:[void 0,i]}return s.isRemoved()?[s,void 0]:[void 0,void 0]}setInternal(e,t,r,s){const i=Nn.of(e,t,r,s);this.nodeMapByKey.set(e,i),s&&this.numberOfRemovedElement++}remove(e,t){const r=this.nodeMapByKey.get(e),s=[];if(r===void 0||t.after(r.getUpdatedAt())){if(r===void 0){this.numberOfRemovedElement+=1;const a=Nn.of(e,"",t,!0);return this.nodeMapByKey.set(e,a),s.push(a),s}const i=r.isRemoved();i||(this.numberOfRemovedElement+=1),i&&s.push(r);const o=Nn.of(e,r.getValue(),t,!0);return this.nodeMapByKey.set(e,o),s.push(o),s}return s}has(e){if(this.nodeMapByKey.has(e)){const t=this.nodeMapByKey.get(e);return t!==void 0&&!t.isRemoved()}return!1}get(e){if(!!this.nodeMapByKey.has(e))return this.nodeMapByKey.get(e).getValue()}deepcopy(){const e=new Xt;for(const[,t]of this.nodeMapByKey)e.setInternal(t.getKey(),t.getValue(),t.getUpdatedAt(),t.isRemoved());return e}toJSON(){if(!this.size())return"{}";const e=[];for(const[t,r]of this.nodeMapByKey)r.isRemoved()||e.push(`"${Mt(t)}":"${Mt(r.getValue())}"`);return`{${e.join(",")}}`}size(){return this.nodeMapByKey.size-this.numberOfRemovedElement}toObject(){const e={};for(const[t,r]of this.nodeMapByKey)r.isRemoved()||(e[t]=r.getValue());return e}*[Symbol.iterator](){for(const[,e]of this.nodeMapByKey)yield e}purge(e){const t=this.nodeMapByKey.get(e.getKey());t==null||t.toIDString()!=e.toIDString()||(this.nodeMapByKey.delete(e.getKey()),this.numberOfRemovedElement--)}}class Nr{constructor(e){h(this,"attributes"),h(this,"content"),this.attributes=Xt.create(),this.content=e}static create(e){return new Nr(e)}get length(){return this.content.length}substring(e,t){const r=new Nr(this.content.substring(e,t));return r.attributes=this.attributes.deepcopy(),r}setAttr(e,t,r){return this.attributes.set(e,t,r)}getAttrs(){return this.attributes}toString(){return this.content}toJSON(){const e=Mt(this.content),t=this.attributes.toObject(),r=[];for(const[s,i]of Object.entries(t)){const o=JSON.parse(i),a=typeof o=="string"?`"${Mt(s)}":"${Mt(o)}"`:`"${Mt(s)}":${String(o)}`;r.push(a)}return r.sort(),r.length===0?`{"val":"${e}"}`:`{"attrs":{${r.join(",")}},"val":"${e}"}`}getAttributes(){return this.attributes.toObject()}getContent(){return this.content}purge(e){this.attributes&&e instanceof Nn&&this.attributes.purge(e)}getGCPairs(){const e=[];for(const t of this.attributes)t.getRemovedAt()&&e.push({parent:this,child:t});return e}}class Ye extends Tr{constructor(e,t){super(t),h(this,"rgaTreeSplit"),this.rgaTreeSplit=e}static create(e,t){return new Ye(e,t)}edit(e,t,r,s,i){const o=t?Nr.create(t):void 0;if(o&&s)for(const[f,p]of Object.entries(s))o.setAttr(f,p,r);const[a,c,u,l]=this.rgaTreeSplit.edit(e,r,o,i),y=l.map(f=>({...f,value:f.value?{attributes:Kn(f.value.getAttributes()),content:f.value.getContent()}:{attributes:void 0,content:""},type:"content"}));return[c,y,u,[a,a]]}setStyle(e,t,r,s){const[,i]=this.rgaTreeSplit.findNodeWithSplit(e[1],r),[,o]=this.rgaTreeSplit.findNodeWithSplit(e[0],r),a=[],c=this.rgaTreeSplit.findBetween(o,i),u=new Map,l=[];for(const f of c){const p=f.getCreatedAt().getActorID(),b=s!=null&&s.size?s.has(p)?s.get(p):Qe:yr;if(f.canStyle(r,b)){const N=u.get(p),E=f.getCreatedAt();(!N||E.after(N))&&u.set(p,E),l.push(f)}}const y=[];for(const f of l){if(f.isRemoved())continue;const[p,b]=this.rgaTreeSplit.findIndexesFromRange(f.createPosRange());a.push({type:"style",actor:r.getActorID(),from:p,to:b,value:{attributes:Kn(t)}});for(const[N,E]of Object.entries(t)){const[D]=f.getValue().setAttr(N,E,r);D!==void 0&&y.push({parent:f.getValue(),child:D})}}return[u,y,a]}indexRangeToPosRange(e,t){const r=this.rgaTreeSplit.indexToPos(e);return e===t?[r,r]:[r,this.rgaTreeSplit.indexToPos(t)]}get length(){return this.rgaTreeSplit.length}checkWeight(){return this.rgaTreeSplit.checkWeight()}toJSON(){const e=[];for(const t of this.rgaTreeSplit)t.isRemoved()||e.push(t.getValue().toJSON());return`[${e.join(",")}]`}toSortedJSON(){return this.toJSON()}toJSForTest(){return{createdAt:this.getCreatedAt().toTestString(),value:JSON.parse(this.toJSON()),type:"YORKIE_TEXT"}}toString(){return this.rgaTreeSplit.toString()}values(){const e=[];for(const t of this.rgaTreeSplit)if(!t.isRemoved()){const r=t.getValue();e.push({attributes:Kn(r.getAttributes()),content:r.getContent()})}return e}getRGATreeSplit(){return this.rgaTreeSplit}toTestString(){return this.rgaTreeSplit.toTestString()}deepcopy(){const e=new Ye(this.rgaTreeSplit.deepcopy(),this.getCreatedAt());return e.remove(this.getRemovedAt()),e}findIndexesFromRange(e){return this.rgaTreeSplit.findIndexesFromRange(e)}getGCPairs(){const e=[];for(const t of this.rgaTreeSplit){t.getRemovedAt()&&e.push({parent:this.rgaTreeSplit,child:t});for(const r of t.getValue().getGCPairs())e.push(r)}return e}}class Er extends et{constructor(e,t,r,s,i,o,a){super(e,a),h(this,"fromPos"),h(this,"toPos"),h(this,"maxCreatedAtMapByActor"),h(this,"content"),h(this,"attributes"),this.fromPos=t,this.toPos=r,this.maxCreatedAtMapByActor=s,this.content=i,this.attributes=o}static create(e,t,r,s,i,o,a){return new Er(e,t,r,s,i,o,a)}execute(e){const t=e.findByCreatedAt(this.getParentCreatedAt());t||v.fatal(`fail to find ${this.getParentCreatedAt()}`),t instanceof Ye||v.fatal("fail to execute, only Text can execute edit");const r=t,[,s,i]=r.edit([this.fromPos,this.toPos],this.content,this.getExecutedAt(),Object.fromEntries(this.attributes),this.maxCreatedAtMapByActor);for(const o of i)e.registerGCPair(o);return{opInfos:s.map(({from:o,to:a,value:c})=>({type:"edit",from:o,to:a,value:c,path:e.createPath(this.getParentCreatedAt())}))}}getEffectedCreatedAt(){return this.getParentCreatedAt()}toTestString(){const e=this.getParentCreatedAt().toTestString(),t=this.fromPos.toTestString(),r=this.toPos.toTestString(),s=this.content;return`${e}.EDIT(${t},${r},${s})`}getFromPos(){return this.fromPos}getToPos(){return this.toPos}getContent(){return this.content}getAttributes(){return this.attributes||new Map}getMaxCreatedAtMapByActor(){return this.maxCreatedAtMapByActor}}class Ir extends et{constructor(e,t,r,s,i,o){super(e,o),h(this,"fromPos"),h(this,"toPos"),h(this,"maxCreatedAtMapByActor"),h(this,"attributes"),this.fromPos=t,this.toPos=r,this.maxCreatedAtMapByActor=s,this.attributes=i}static create(e,t,r,s,i,o){return new Ir(e,t,r,s,i,o)}execute(e){const t=e.findByCreatedAt(this.getParentCreatedAt());t||v.fatal(`fail to find ${this.getParentCreatedAt()}`),t instanceof Ye||v.fatal("fail to execute, only Text can execute edit");const r=t,[,s,i]=r.setStyle([this.fromPos,this.toPos],this.attributes?Object.fromEntries(this.attributes):{},this.getExecutedAt(),this.maxCreatedAtMapByActor);for(const o of s)e.registerGCPair(o);return{opInfos:i.map(({from:o,to:a,value:c})=>({type:"style",from:o,to:a,value:c,path:e.createPath(this.getParentCreatedAt())}))}}getEffectedCreatedAt(){return this.getParentCreatedAt()}toTestString(){const e=this.getParentCreatedAt().toTestString(),t=this.fromPos.toTestString(),r=this.toPos.toTestString(),s=this.attributes;return`${e}.STYL(${t},${r},${JSON.stringify(s)})`}getFromPos(){return this.fromPos}getToPos(){return this.toPos}getAttributes(){return this.attributes}getMaxCreatedAtMapByActor(){return this.maxCreatedAtMapByActor}}const Eh=2,Ih="root",Ht="text";function kr(n,e){let t=0;const r=n.children;for(let s=0;s<e;s++){const i=r[s];!i||i.isRemoved||(t+=i.paddedSize)}return t}class kh{constructor(e,t=[]){if(h(this,"type"),h(this,"parent"),h(this,"_children"),h(this,"size"),this.type=e,this.size=0,this._children=t,this.isText&&this._children.length>0)throw new Error(`Text node cannot have children: ${this.type}`)}updateAncestorsSize(){let e=this.parent;const t=this.isRemoved?-1:1;for(;e;)e.size+=this.paddedSize*t,e=e.parent}updateDescendantsSize(){if(this.isRemoved)return this.size=0,0;let e=0;for(const t of this._children)e+=t.updateDescendantsSize();return this.size+=e,this.paddedSize}get isText(){return this.type===Ht}get paddedSize(){return this.size+(this.isText?0:Eh)}isAncestorOf(e){return Ah(this,e)}get nextSibling(){const e=this.parent.findOffset(this),t=this.parent.children[e+1];if(t)return t}get prevSibling(){const e=this.parent.findOffset(this),t=this.parent.children[e-1];if(t)return t}splitText(e,t){if(e===0||e===this.size)return;const r=this.value.slice(0,e),s=this.value.slice(e);if(!s.length)return;this.value=r;const i=this.cloneText(e+t);return i.value=s,this.parent.insertAfterInternal(i,this),i}get children(){return this._children.filter(e=>!e.isRemoved)}get allChildren(){return[...this._children]}hasTextChild(){return this.children.length>0&&this.children.every(e=>e.isText)}append(...e){if(this.isText)throw new Error("Text node cannot have children");this._children.push(...e);for(const t of e)t.parent=this,t.updateAncestorsSize()}prepend(...e){if(this.isText)throw new Error("Text node cannot have children");this._children.unshift(...e);for(const t of e)t.parent=this}insertBefore(e,t){if(this.isText)throw new Error("Text node cannot have children");const r=this._children.indexOf(t);if(r===-1)throw new Error("child not found");this.insertAtInternal(e,r),e.updateAncestorsSize()}insertAfter(e,t){if(this.isText)throw new Error("Text node cannot have children");const r=this._children.indexOf(t);if(r===-1)throw new Error("child not found");this.insertAtInternal(e,r+1),e.updateAncestorsSize()}insertAt(e,t){if(this.isText)throw new Error("Text node cannot have children");this.insertAtInternal(e,t),e.updateAncestorsSize()}removeChild(e){if(this.isText)throw new Error("Text node cannot have children");const t=this._children.indexOf(e);if(t===-1)throw new Error("child not found");this._children.splice(t,1),e.parent=void 0}splitElement(e,t){const r=this.cloneElement(t);this.parent.insertAfterInternal(r,this),r.updateAncestorsSize();const s=this.children.slice(0,e),i=this.children.slice(e);this._children=s,r._children=i,this.size=this._children.reduce((o,a)=>o+a.paddedSize,0),r.size=r._children.reduce((o,a)=>o+a.paddedSize,0);for(const o of r._children)o.parent=r;return r}insertAfterInternal(e,t){if(this.isText)throw new Error("Text node cannot have children");const r=this._children.indexOf(t);if(r===-1)throw new Error("child not found");this.insertAtInternal(e,r+1)}insertAtInternal(e,t){if(this.isText)throw new Error("Text node cannot have children");this._children.splice(t,0,e),e.parent=this}findOffset(e){if(this.isText)throw new Error("Text node cannot have children");if(e.isRemoved){const t=this._children.indexOf(e);return this.allChildren.splice(0,t).filter(s=>!s.isRemoved).length}return this.children.indexOf(e)}findBranchOffset(e){if(this.isText)throw new Error("Text node cannot have children");let t=e;for(;t;){const r=this._children.indexOf(t);if(r!==-1)return r;t=t.parent}return-1}}function Ah(n,e){if(n===e)return!1;for(;e.parent;){if(e.parent===n)return!0;e=e.parent}return!1}var te=(n=>(n.Start="Start",n.End="End",n.Text="Text",n))(te||{});function Ca(n,e,t,r){if(e>t)throw new Error(`from is greater than to: ${e} > ${t}`);if(e>n.size)throw new Error(`from is out of range: ${e} > ${n.size}`);if(t>n.size)throw new Error(`to is out of range: ${t} > ${n.size}`);if(e===t)return;let s=0;for(const i of n.children){if(e-i.paddedSize<s&&s<t){const o=i.isText?e-s:e-s-1,a=i.isText?t-s:t-s-1,c=!i.isText&&o<0,u=!i.isText&&a>i.size;(i.isText||c)&&r([i,i.isText?"Text":"Start"],u),Ca(i,Math.max(0,o),Math.min(a,i.size),r),u&&r([i,"End"],u)}s+=i.paddedSize}}function Ra(n,e,t=0){for(const r of n.children)Ra(r,e,t+1);e(n,t)}function us(n,e,t=0){for(const r of n._children)us(r,e,t+1);e(n,t)}function Gs(n,e,t=!0){if(e>n.size)throw new Error(`index is out of range: ${e} > ${n.size}`);if(n.isText)return{node:n,offset:e};let r=0,s=0;for(const i of n.children){if(t&&i.isText&&i.size>=e-s)return Gs(i,e-s,t);if(e===s)return{node:n,offset:r};if(!t&&i.paddedSize===e-s)return{node:n,offset:r+1};if(i.paddedSize>e-s)return Gs(i,e-s-1,t);s+=i.paddedSize,r+=1}return{node:n,offset:r}}function Ja(n){return n.isText||n.children.length===0?n:Ja(n.children[0])}function _h(n,e){if(n.size<e)throw new Error("unacceptable path");for(let t=0;t<n.children.length;t++){const r=n.children[t];if(r.size<e)e-=r.size;else{n=r;break}}return{node:n,offset:e}}class Oh{constructor(e){h(this,"root"),this.root=e}tokensBetween(e,t,r){Ca(this.root,e,t,r)}traverse(e){Ra(this.root,e,0)}traverseAll(e){us(this.root,e,0)}findTreePos(e,t=!0){return Gs(this.root,e,t)}treePosToPath(e){const t=[];let r=e.node;if(r.isText){const s=r.parent.findOffset(r);if(s===-1)throw new Error("invalid treePos");const i=kr(r.parent,s);t.push(i+e.offset),r=r.parent}else if(r.hasTextChild()){const s=kr(r,e.offset);t.push(s)}else t.push(e.offset);for(;r.parent;){const s=r.parent.findOffset(r);if(s===-1)throw new Error("invalid treePos");t.push(s),r=r.parent}return t.reverse()}pathToIndex(e){const t=this.pathToTreePos(e);return this.indexOf(t)}pathToTreePos(e){if(!e.length)throw new Error("unacceptable path");let t=this.root;for(let r=0;r<e.length-1;r++){const s=e[r];if(t=t.children[s],!t)throw new Error("unacceptable path")}if(t.hasTextChild())return _h(t,e[e.length-1]);if(t.children.length<e[e.length-1])throw new Error("unacceptable path");return{node:t,offset:e[e.length-1]}}getRoot(){return this.root}get size(){return this.root.size}findPostorderRight(e){const{node:t,offset:r}=e;if(t.isText){if(t.size===r){const s=t.nextSibling;return s||t.parent}return t}return t.children.length===r?t:Ja(t.children[r])}indexOf(e){let{node:t}=e;const{offset:r}=e;let s=0,i=1;if(t.isText){s+=r;const o=t.parent,a=o.findOffset(t);if(a===-1)throw new Error("invalid pos");s+=kr(o,a),t=t.parent}else s+=kr(t,r);for(;t!=null&&t.parent;){const o=t.parent,a=o.findOffset(t);if(a===-1)throw new Error("invalid pos");s+=kr(o,a),i++,t=t.parent}return s+i-1}indexToPath(e){const t=this.findTreePos(e);return this.treePosToPath(t)}}const Ph=(n,e)=>n===e?0:n<e?-1:1;class xh{constructor(e,t,r){h(this,"key"),h(this,"value"),h(this,"parent"),h(this,"left"),h(this,"right"),h(this,"isRed"),this.key=e,this.value=t,this.isRed=r}}class Dh{constructor(e){h(this,"stack"),this.stack=[],this.traverseInorder(e)}traverseInorder(e){!e||(this.traverseInorder(e.left),this.stack.push({key:e.key,value:e.value}),this.traverseInorder(e.right))}}class Ba{constructor(e){h(this,"root"),h(this,"comparator"),h(this,"counter"),this.comparator=typeof e<"u"?e:Ph,this.counter=0}put(e,t){return this.root=this.putInternal(e,t,this.root),this.root.isRed=!1,t}get(e){const t=this.getInternal(e,this.root);return t?t.value:void 0}remove(e){!this.isRed(this.root.left)&&!this.isRed(this.root.right)&&(this.root.isRed=!0),this.root=this.removeInternal(this.root,e),this.root&&(this.root.isRed=!1)}getIterator(){return new Dh(this.root)}values(){const e=[];for(const t of this.getIterator().stack)e.push(t.value);return e}floorEntry(e){let t=this.root;for(;t;){const r=this.comparator(e,t.key);if(r>0)if(t.right)t.right.parent=t,t=t.right;else return t;else if(r<0)if(t.left)t.left.parent=t,t=t.left;else{let s=t.parent,i=t;for(;s&&i===s.left;)i=s,s=s.parent;return s}else return t}}lastEntry(){if(!this.root)return this.root;let e=this.root;for(;e.right;)e=e.right;return e}size(){return this.counter}isEmpty(){return this.counter===0}getInternal(e,t){for(;t;){const r=this.comparator(e,t.key);if(r===0)return t;r<0?t=t.left:r>0&&(t=t.right)}}putInternal(e,t,r){if(!r)return this.counter+=1,new xh(e,t,!0);const s=this.comparator(e,r.key);return s<0?r.left=this.putInternal(e,t,r.left):s>0?r.right=this.putInternal(e,t,r.right):r.value=t,this.isRed(r.right)&&!this.isRed(r.left)&&(r=this.rotateLeft(r)),this.isRed(r.left)&&this.isRed(r.left.left)&&(r=this.rotateRight(r)),this.isRed(r.left)&&this.isRed(r.right)&&this.flipColors(r),r}removeInternal(e,t){if(this.comparator(t,e.key)<0)!this.isRed(e.left)&&!this.isRed(e.left.left)&&(e=this.moveRedLeft(e)),e.left=this.removeInternal(e.left,t);else{if(this.isRed(e.left)&&(e=this.rotateRight(e)),this.comparator(t,e.key)===0&&!e.right){this.counter-=1;return}if(!this.isRed(e.right)&&!this.isRed(e.right.left)&&(e=this.moveRedRight(e)),this.comparator(t,e.key)===0){this.counter-=1;const r=this.min(e.right);e.value=r.value,e.key=r.key,e.right=this.removeMin(e.right)}else e.right=this.removeInternal(e.right,t)}return this.fixUp(e)}min(e){return e.left?this.min(e.left):e}removeMin(e){if(!!e.left)return!this.isRed(e.left)&&!this.isRed(e.left.left)&&(e=this.moveRedLeft(e)),e.left=this.removeMin(e.left),this.fixUp(e)}fixUp(e){return this.isRed(e.right)&&(e=this.rotateLeft(e)),this.isRed(e.left)&&this.isRed(e.left.left)&&(e=this.rotateRight(e)),this.isRed(e.left)&&this.isRed(e.right)&&this.flipColors(e),e}moveRedLeft(e){return this.flipColors(e),this.isRed(e.right.left)&&(e.right=this.rotateRight(e.right),e=this.rotateLeft(e),this.flipColors(e)),e}moveRedRight(e){return this.flipColors(e),this.isRed(e.left.left)&&(e=this.rotateRight(e),this.flipColors(e)),e}isRed(e){return e&&e.isRed}rotateLeft(e){const t=e.right;return e.right=t.left,t.left=e,t.isRed=t.left.isRed,t.left.isRed=!0,t}rotateRight(e){const t=e.left;return e.left=t.right,t.right=e,t.isRed=t.right.isRed,t.right.isRed=!0,t}flipColors(e){e.isRed=!e.isRed,e.left.isRed=!e.left.isRed,e.right.isRed=!e.right.isRed}}class tt{constructor(e,t){h(this,"parentID"),h(this,"leftSiblingID"),this.parentID=e,this.leftSiblingID=t}static of(e,t){return new tt(e,t)}static fromTreePos(e){const{offset:t}=e;let{node:r}=e,s;return r.isText?(r.parent.children[0]===r&&t===0?s=r.parent:s=r,r=r.parent):t===0?s=r:s=r.children[t-1],tt.of(r.id,ue.of(s.getCreatedAt(),s.getOffset()+t))}getParentID(){return this.parentID}static fromStruct(e){return tt.of(ue.of(me.fromStruct(e.parentID.createdAt),e.parentID.offset),ue.of(me.fromStruct(e.leftSiblingID.createdAt),e.leftSiblingID.offset))}toStruct(){return{parentID:{createdAt:this.getParentID().getCreatedAt().toStruct(),offset:this.getParentID().getOffset()},leftSiblingID:{createdAt:this.getLeftSiblingID().getCreatedAt().toStruct(),offset:this.getLeftSiblingID().getOffset()}}}toTreeNodePair(e){const t=this.getParentID(),r=this.getLeftSiblingID(),s=e.findFloorNode(t);let i=e.findFloorNode(r);if(!s||!i)throw new Error(`cannot find node of CRDTTreePos(${t.toTestString()}, ${r.toTestString()})`);return!r.equals(t)&&r.getOffset()>0&&r.getOffset()===i.id.getOffset()&&i.insPrevID&&(i=e.findFloorNode(i.insPrevID)),[s,i]}getLeftSiblingID(){return this.leftSiblingID}equals(e){return this.getParentID().getCreatedAt().equals(e.getParentID().getCreatedAt())&&this.getParentID().getOffset()===e.getParentID().getOffset()&&this.getLeftSiblingID().getCreatedAt().equals(e.getLeftSiblingID().getCreatedAt())&&this.getLeftSiblingID().getOffset()===e.getLeftSiblingID().getOffset()}}class ue{constructor(e,t){h(this,"createdAt"),h(this,"offset"),this.createdAt=e,this.offset=t}static of(e,t){return new ue(e,t)}static fromStruct(e){return ue.of(me.fromStruct(e.createdAt),e.offset)}static createComparator(){return(e,t)=>{const r=e.getCreatedAt().compare(t.getCreatedAt());return r!==0?r:e.getOffset()>t.getOffset()?1:e.getOffset()<t.getOffset()?-1:0}}getCreatedAt(){return this.createdAt}equals(e){return this.createdAt.compare(e.createdAt)===0&&this.offset===e.offset}getOffset(){return this.offset}setOffset(e){this.offset=e}toStruct(){return{createdAt:this.createdAt.toStruct(),offset:this.offset}}toIDString(){return`${this.createdAt.toIDString()}:${this.offset}`}toTestString(){return`${this.createdAt.toTestString()}/${this.offset}`}}class Ee extends kh{constructor(e,t,r,s,i){super(t),h(this,"id"),h(this,"removedAt"),h(this,"attrs"),h(this,"insPrevID"),h(this,"insNextID"),h(this,"_value",""),this.id=e,this.removedAt=i,s&&(this.attrs=s),typeof r=="string"?this.value=r:Array.isArray(r)&&(this._children=r)}toIDString(){return this.id.toIDString()}getRemovedAt(){return this.removedAt}static create(e,t,r,s){return new Ee(e,t,r,s)}deepcopy(){var e;const t=new Ee(this.id,this.type);return t.removedAt=this.removedAt,t._value=this._value,t.size=this.size,t.attrs=(e=this.attrs)==null?void 0:e.deepcopy(),t._children=this._children.map(r=>{const s=r.deepcopy();return s.parent=t,s}),t.insPrevID=this.insPrevID,t.insNextID=this.insNextID,t}get value(){if(!this.isText)throw new Error(`cannot get value of element node: ${this.type}`);return this._value}set value(e){if(!this.isText)throw new Error(`cannot set value of element node: ${this.type}`);this._value=e,this.size=e.length}get isRemoved(){return!!this.removedAt}remove(e){const t=!this.removedAt;(!this.removedAt||this.removedAt.compare(e)>0)&&(this.removedAt=e),t&&(this.parent.removedAt?this.parent.size-=this.paddedSize:this.updateAncestorsSize())}cloneText(e){return new Ee(ue.of(this.id.getCreatedAt(),e),this.type,void 0,void 0,this.removedAt)}cloneElement(e){return new Ee(ue.of(e(),0),this.type,void 0,void 0,this.removedAt)}split(e,t,r){const s=this.isText?this.splitText(t,this.id.getOffset()):this.splitElement(t,r);if(s){if(s.insPrevID=this.id,this.insNextID){const i=e.findFloorNode(this.insNextID);i.insPrevID=s.id,s.insNextID=this.insNextID}this.insNextID=s.id,e.registerNode(s)}return s}getCreatedAt(){return this.id.getCreatedAt()}getOffset(){return this.id.getOffset()}canDelete(e,t){return!this.getCreatedAt().after(t)&&(!this.removedAt||e.after(this.removedAt))}canStyle(e,t){return this.isText?!1:!this.getCreatedAt().after(t)&&(!this.removedAt||e.after(this.removedAt))}setAttrs(e,t){this.attrs||(this.attrs=new Xt);const r=new Array;for(const[s,i]of Object.entries(e))r.push(this.attrs.set(s,i,t));return r}purge(e){this.attrs&&this.attrs.purge(e)}getGCPairs(){const e=[];if(!this.attrs)return e;for(const t of this.attrs)t.getRemovedAt()&&e.push({parent:this,child:t});return e}}function zs(n){var e;if(n.isText){const r=n;return{type:r.type,value:r.value}}const t={type:n.type,children:n.children.map(zs)};return n.attrs&&(t.attributes=Kn((e=n.attrs)==null?void 0:e.toObject())),t}function Ws(n){if(n.isText)return n.value;let e="";return n.attrs&&n.attrs.size()&&(e=" "+Array.from(n.attrs).filter(t=>!t.isRemoved()).sort((t,r)=>t.getKey().localeCompare(r.getKey())).map(t=>{const r=JSON.parse(t.getValue());return typeof r=="string"?`${t.getKey()}="${r}"`:`${t.getKey()}="${Mt(t.getValue())}"`}).join(" ")),`<${n.type}${e}>${n.children.map(t=>Ws(t)).join("")}</${n.type}>`}function La(n){if(n.isText){const e=n;return{type:e.type,value:e.value,size:e.size,isRemoved:e.isRemoved}}return{type:n.type,children:n.children.map(La),size:n.size,isRemoved:n.isRemoved}}class Ke extends Tr{constructor(e,t){super(t),h(this,"indexTree"),h(this,"nodeMapByID"),this.indexTree=new Oh(e),this.nodeMapByID=new Ba(ue.createComparator()),this.indexTree.traverseAll(r=>{this.nodeMapByID.put(r.id,r)})}static create(e,t){return new Ke(e,t)}findFloorNode(e){const t=this.nodeMapByID.floorEntry(e);if(!(!t||!t.key.getCreatedAt().equals(e.getCreatedAt())))return t.value}registerNode(e){this.nodeMapByID.put(e.id,e)}findNodesAndSplitText(e,t){const[r,s]=e.toTreeNodePair(this);let i=s;const o=r===i,a=i.parent&&!o?i.parent:r;if(i.isText&&i.split(this,e.getLeftSiblingID().getOffset()-i.id.getOffset()),t){const c=a.allChildren,u=o?0:c.indexOf(i)+1;for(let l=u;l<c.length;l++){const y=c[l];if(!y.id.getCreatedAt().after(t))break;i=y}}return[a,i]}style(e,t,r,s){const[i,o]=this.findNodesAndSplitText(e[0],r),[a,c]=this.findNodesAndSplitText(e[1],r),u=[],l=t?Kn(t):{},y=new Map,f=[];return this.traverseInPosRange(i,o,a,c,([p])=>{const b=p.getCreatedAt().getActorID(),N=s?s.has(b)?s.get(b):Qe:yr;if(p.canStyle(r,N)&&t){const E=y.get(b),D=p.getCreatedAt();(!E||D.after(E))&&y.set(b,D);const K=p.setAttrs(t,r),B=K.reduce((X,[,kn])=>(kn&&(X[kn.getKey()]=l[kn.getKey()]),X),{}),q=p.parent,G=p.prevSibling||p.parent;Object.keys(B).length>0&&u.push({type:"style",from:this.toIndex(q,G),to:this.toIndex(p,p),fromPath:this.toPath(q,G),toPath:this.toPath(p,p),actor:r.getActorID(),value:B});for(const[X]of K)X&&f.push({parent:p,child:X})}}),[y,f,u]}removeStyle(e,t,r,s){const[i,o]=this.findNodesAndSplitText(e[0],r),[a,c]=this.findNodesAndSplitText(e[1],r),u=[],l=new Map,y=[];return this.traverseInPosRange(i,o,a,c,([f])=>{const p=f.getCreatedAt().getActorID(),b=s?s.has(p)?s.get(p):Qe:yr;if(f.canStyle(r,b)&&t){const N=l.get(p),E=f.getCreatedAt();(!N||E.after(N))&&l.set(p,E),f.attrs||(f.attrs=new Xt);for(const B of t){const q=f.attrs.remove(B,r);for(const G of q)y.push({parent:f,child:G})}const D=f.parent,K=f.prevSibling||f.parent;u.push({actor:r.getActorID(),type:"removeStyle",from:this.toIndex(D,K),to:this.toIndex(f,f),fromPath:this.toPath(D,K),toPath:this.toPath(f,f),value:t})}}),[l,y,u]}edit(e,t,r,s,i,o){const[a,c]=this.findNodesAndSplitText(e[0],s),[u,l]=this.findNodesAndSplitText(e[1],s),y=this.toIndex(a,c),f=this.toPath(a,c),p=[],b=[],N=[],E=new Map;this.traverseInPosRange(a,c,u,l,([B,q],G)=>{if(q===te.Start&&!G)for(const An of B.children)N.push(An);const X=B.getCreatedAt().getActorID(),kn=o?o.has(X)?o.get(X):Qe:yr;if(B.canDelete(s,kn)||p.includes(B.parent)){const An=E.get(X),Br=B.getCreatedAt();(!An||Br.after(An))&&E.set(X,Br),(q===te.Text||q===te.Start)&&p.push(B),b.push([B,q])}});const D=this.makeDeletionChanges(b,s),K=[];for(const B of p)B.remove(s),B.isRemoved&&K.push({parent:this,child:B});for(const B of N)B.removedAt||a.append(B);if(r>0){let B=0,q=a,G=c;for(;B<r;)q.split(this,q.findOffset(G)+1,i),G=q,q=q.parent,B++;D.push({type:"content",from:y,to:y,fromPath:f,toPath:f,actor:s.getActorID()})}if(t!=null&&t.length){const B=[];let q=c;for(const G of t)q===a?a.insertAt(G,0):a.insertAfter(G,q),q=G,us(G,X=>{a.isRemoved&&(X.remove(s),K.push({parent:this,child:X})),this.nodeMapByID.put(X.id,X)}),G.isRemoved||B.push(G);if(B.length){const G=B.map(X=>zs(X));D.length&&D[D.length-1].from===y?D[D.length-1].value=G:D.push({type:"content",from:y,to:y,fromPath:f,toPath:f,actor:s.getActorID(),value:G})}}return[D,K,E]}editT(e,t,r,s,i){const o=this.findPos(e[0]),a=this.findPos(e[1]);this.edit([o,a],t,r,s,i)}move(e,t,r){throw new Error(`not implemented: ${e}, ${t}, ${r}`)}purge(e){var t;(t=e.parent)==null||t.removeChild(e),this.nodeMapByID.remove(e.id);const r=e.insPrevID,s=e.insNextID;if(r){const i=this.findFloorNode(r);i.insNextID=s}if(s){const i=this.findFloorNode(s);i.insPrevID=r}e.insPrevID=void 0,e.insNextID=void 0}getGCPairs(){const e=[];return this.indexTree.traverse(t=>{t.getRemovedAt()&&e.push({parent:this,child:t});for(const r of t.getGCPairs())e.push(r)}),e}findPos(e,t=!0){const r=this.indexTree.findTreePos(e,t);return tt.fromTreePos(r)}pathToPosRange(e){const t=this.pathToIndex(e);return[this.findPos(t),this.findPos(t+1)]}pathToPos(e){const t=this.indexTree.pathToIndex(e);return this.findPos(t)}getRoot(){return this.indexTree.getRoot()}getSize(){return this.indexTree.size}getNodeSize(){return this.nodeMapByID.size()}getIndexTree(){return this.indexTree}toXML(){return Ws(this.indexTree.getRoot())}toJSON(){return JSON.stringify(this.getRootTreeNode())}toJSForTest(){return{createdAt:this.getCreatedAt().toTestString(),value:JSON.parse(this.toJSON()),type:"YORKIE_TREE"}}toJSInfoForTest(){const e=this.indexTree.getRoot(),t=(r,s=void 0,i=void 0,o=0)=>{var a,c,u,l;let y,f,p;const b=r.isText?{node:r,offset:0}:s&&i?this.toTreePos(s,i):null;b&&(y=this.indexTree.indexOf(b),f=this.indexTree.treePosToPath(b),p=tt.fromTreePos(b).toStruct());const N={type:r.type,parent:s==null?void 0:s.id.toTestString(),size:r.size,id:r.id.toTestString(),removedAt:(a=r.removedAt)==null?void 0:a.toTestString(),insPrev:(c=r.insPrevID)==null?void 0:c.toTestString(),insNext:(u=r.insNextID)==null?void 0:u.toTestString(),value:r.isText?r.value:void 0,isRemoved:r.isRemoved,children:[],depth:o,attributes:r.attrs?Kn((l=r.attrs)==null?void 0:l.toObject()):void 0,index:y,path:f,pos:p};for(let E=0;E<r.allChildren.length;E++){const D=E===0?r:r.allChildren[E-1];N.children.push(t(r.allChildren[E],r,D,o+1))}return N};return t(e)}getRootTreeNode(){return zs(this.indexTree.getRoot())}toTestTreeNode(){return La(this.indexTree.getRoot())}toSortedJSON(){return this.toJSON()}deepcopy(){const e=this.getRoot();return new Ke(e.deepcopy(),this.getCreatedAt())}toPath(e,t){const r=this.toTreePos(e,t);return r?this.indexTree.treePosToPath(r):[]}toIndex(e,t){const r=this.toTreePos(e,t);return r?this.indexTree.indexOf(r):-1}indexToPath(e){return this.indexTree.indexToPath(e)}pathToIndex(e){return this.indexTree.pathToIndex(e)}indexRangeToPosRange(e){const t=this.findPos(e[0]);return e[0]===e[1]?[t,t]:[t,this.findPos(e[1])]}indexRangeToPosStructRange(e){const[t,r]=e,s=this.findPos(t);return t===r?[s.toStruct(),s.toStruct()]:[s.toStruct(),this.findPos(r).toStruct()]}posRangeToPathRange(e){const[t,r]=this.findNodesAndSplitText(e[0]),[s,i]=this.findNodesAndSplitText(e[1]);return[this.toPath(t,r),this.toPath(s,i)]}posRangeToIndexRange(e){const[t,r]=this.findNodesAndSplitText(e[0]),[s,i]=this.findNodesAndSplitText(e[1]);return[this.toIndex(t,r),this.toIndex(s,i)]}traverseInPosRange(e,t,r,s,i){const o=this.toIndex(e,t),a=this.toIndex(r,s);return this.indexTree.tokensBetween(o,a,i)}toTreePos(e,t){if(!e||!t)return;if(e.isRemoved){let s;for(;e.isRemoved;)s=e,e=s.parent;const i=e.findOffset(s);return{node:e,offset:i}}if(e===t)return{node:e,offset:0};let r=e.findOffset(t);if(!t.isRemoved){if(t.isText)return{node:t,offset:t.paddedSize};r++}return{node:e,offset:r}}makeDeletionChanges(e,t){const r=[],s=[];let i=null,o=null;for(let a=0;a<e.length;a++){const c=e[a],u=e[a+1];i||(i=c),o=c;const l=this.findRightToken(c);(!l||!u||l[0]!==u[0]||l[1]!==u[1])&&(s.push([i,o]),i=null,o=null)}for(const a of s){const[c,u]=a,[l,y]=this.findLeftToken(c),[f,p]=u,b=y===te.Start?l:l.parent,N=p===te.Start?f:f.parent,E=this.toIndex(b,l),D=this.toIndex(N,f);E<D&&(r.length>0&&E===r[r.length-1].to?(r[r.length-1].to=D,r[r.length-1].toPath=this.toPath(N,f)):r.push({type:"content",from:E,to:D,fromPath:this.toPath(b,l),toPath:this.toPath(N,f),actor:t.getActorID()}))}return r.reverse()}findRightToken([e,t]){if(t===te.Start){const a=e.allChildren;return a.length>0?[a[0],a[0].isText?te.Text:te.Start]:[e,te.End]}const r=e.parent,s=r.allChildren,i=s.indexOf(e);if(r&&i===s.length-1)return[r,te.End];const o=s[i+1];return[o,o.isText?te.Text:te.Start]}findLeftToken([e,t]){if(t===te.End){const a=e.allChildren;if(a.length>0){const c=a[a.length-1];return[c,c.isText?te.Text:te.End]}return[e,te.Start]}const r=e.parent,s=r.allChildren,i=s.indexOf(e);if(r&&i===0)return[r,te.Start];const o=s[i-1];return[o,o.isText?te.Text:te.End]}}class Ar extends et{constructor(e,t,r,s,i,o,a){super(e,a),h(this,"fromPos"),h(this,"toPos"),h(this,"contents"),h(this,"splitLevel"),h(this,"maxCreatedAtMapByActor"),this.fromPos=t,this.toPos=r,this.contents=s,this.splitLevel=i,this.maxCreatedAtMapByActor=o}static create(e,t,r,s,i,o,a){return new Ar(e,t,r,s,i,o,a)}execute(e){var t;const r=e.findByCreatedAt(this.getParentCreatedAt());r||v.fatal(`fail to find ${this.getParentCreatedAt()}`),r instanceof Ke||v.fatal("fail to execute, only Tree can execute edit");const s=this.getExecutedAt(),i=r,[o,a]=i.edit([this.fromPos,this.toPos],(t=this.contents)==null?void 0:t.map(c=>c.deepcopy()),this.splitLevel,s,(()=>{let c=s.getDelimiter();return this.contents!==void 0&&(c+=this.contents.length),()=>me.of(s.getLamport(),++c,s.getActorID())})(),this.maxCreatedAtMapByActor);for(const c of a)e.registerGCPair(c);return{opInfos:o.map(({from:c,to:u,value:l,splitLevel:y,fromPath:f,toPath:p})=>({type:"tree-edit",path:e.createPath(this.getParentCreatedAt()),from:c,to:u,value:l,splitLevel:y,fromPath:f,toPath:p}))}}getEffectedCreatedAt(){return this.getParentCreatedAt()}toTestString(){const e=this.getParentCreatedAt().toTestString(),t=`${this.fromPos.getLeftSiblingID().getCreatedAt().toTestString()}/${this.fromPos.getLeftSiblingID().getOffset()}`,r=`${this.toPos.getLeftSiblingID().getCreatedAt().toTestString()}/${this.toPos.getLeftSiblingID().getOffset()}`,s=this.contents||[];return`${e}.EDIT(${t},${r},${s.map(i=>Ws(i)).join("")})`}getFromPos(){return this.fromPos}getToPos(){return this.toPos}getContents(){return this.contents}getSplitLevel(){return this.splitLevel}getMaxCreatedAtMapByActor(){return this.maxCreatedAtMapByActor}}class un{constructor(e,t,r,s){h(this,"clientSeq"),h(this,"serverSeq"),h(this,"lamport"),h(this,"actor"),this.clientSeq=e,this.serverSeq=s,this.lamport=t,this.actor=r}static of(e,t,r,s){return new un(e,t,r,s)}next(){return new un(this.clientSeq+1,this.lamport.add(1),this.actor)}syncLamport(e){return e.greaterThan(this.lamport)?new un(this.clientSeq,e,this.actor):new un(this.clientSeq,this.lamport.add(1),this.actor)}createTimeTicket(e){return me.of(this.lamport,e,this.actor)}setActor(e){return new un(this.clientSeq,this.lamport,e,this.serverSeq)}getClientSeq(){return this.clientSeq}getServerSeq(){return this.serverSeq?this.serverSeq.toString():""}getLamport(){return this.lamport}getLamportAsString(){return this.lamport.toString()}getActorID(){return this.actor}toTestString(){return`${this.lamport.toString()}:${this.actor.slice(-2)}:${this.clientSeq}`}}const Ch=new un(0,x.fromInt(0,!0),as);class En{constructor({id:e,operations:t,presenceChange:r,message:s}){h(this,"id"),h(this,"operations"),h(this,"presenceChange"),h(this,"message"),this.id=e,this.operations=t||[],this.presenceChange=r,this.message=s}static create({id:e,operations:t,presenceChange:r,message:s}){return new En({id:e,operations:t,presenceChange:r,message:s})}getID(){return this.id}getMessage(){return this.message}hasOperations(){return this.operations.length>0}getOperations(){return this.operations}setActor(e){for(const t of this.operations)t.setActor(e);this.id=this.id.setActor(e)}hasPresenceChange(){return this.presenceChange!==void 0}getPresenceChange(){return this.presenceChange}execute(e,t,r){const s=[],i=[];for(const o of this.operations){const a=o.execute(e,r);if(!a)continue;const{opInfos:c,reverseOp:u}=a;s.push(...c),u&&i.unshift(u)}return this.presenceChange&&(this.presenceChange.type===sn.Put?t.set(this.id.getActorID(),Ze(this.presenceChange.presence)):t.delete(this.id.getActorID())),{opInfos:s,reverseOps:i}}toTestString(){return`${this.operations.map(e=>e.toTestString()).join(",")}`}toStruct(){return{changeID:ne.bytesToHex(ne.toChangeID(this.getID()).toBinary()),message:this.getMessage(),operations:this.getOperations().map(e=>ne.bytesToHex(ne.toOperation(e).toBinary())),presenceChange:this.getPresenceChange()}}static fromStruct(e){const{changeID:t,operations:r,presenceChange:s,message:i}=e;return En.create({id:ne.bytesToChangeID(ne.hexToBytes(t)),operations:r==null?void 0:r.map(o=>ne.bytesToOperation(ne.hexToBytes(o))),presenceChange:s,message:i})}}class ls{constructor(e,t,r,s,i,o){h(this,"documentKey"),h(this,"checkpoint"),h(this,"isRemoved"),h(this,"changes"),h(this,"snapshot"),h(this,"minSyncedTicket"),this.documentKey=e,this.checkpoint=t,this.isRemoved=r,this.changes=s,this.snapshot=i,this.minSyncedTicket=o}static create(e,t,r,s,i,o){return new ls(e,t,r,s,i,o)}getDocumentKey(){return this.documentKey}getCheckpoint(){return this.checkpoint}getIsRemoved(){return this.isRemoved}getChanges(){return this.changes}hasChanges(){return this.changes.length>0}getChangeSize(){return this.changes.length}hasSnapshot(){return!!this.snapshot&&!!this.snapshot.length}getSnapshot(){return this.snapshot}getMinSyncedTicket(){return this.minSyncedTicket}}class Gn{constructor(e,t){h(this,"serverSeq"),h(this,"clientSeq"),this.serverSeq=e,this.clientSeq=t}static of(e,t){return new Gn(e,t)}increaseClientSeq(e){return e===0?this:new Gn(this.serverSeq,this.clientSeq+e)}forward(e){if(this.equals(e))return this;const t=this.serverSeq.greaterThan(e.serverSeq)?this.serverSeq:e.serverSeq,r=Math.max(this.clientSeq,e.clientSeq);return Gn.of(t,r)}getServerSeqAsString(){return this.serverSeq.toString()}getClientSeq(){return this.clientSeq}getServerSeq(){return this.serverSeq}equals(e){return this.clientSeq===e.clientSeq&&this.serverSeq.equals(e.serverSeq)}toTestString(){return`serverSeq=${this.serverSeq}, clientSeq=${this.clientSeq}`}}const Rh=new Gn(x.fromInt(0,!0),0);class Ut{constructor(e,t){h(this,"createdAt"),h(this,"offset"),this.createdAt=e,this.offset=t}static of(e,t){return new Ut(e,t)}static fromStruct(e){return Ut.of(me.fromStruct(e.createdAt),e.offset)}getCreatedAt(){return this.createdAt}getOffset(){return this.offset}equals(e){return this.createdAt.compare(e.createdAt)===0&&this.offset===e.offset}hasSameCreatedAt(e){return this.createdAt.compare(e.createdAt)===0}split(e){return new Ut(this.createdAt,this.offset+e)}toStruct(){return{createdAt:this.createdAt.toStruct(),offset:this.offset}}toTestString(){return`${this.createdAt.toTestString()}:${this.offset}`}toIDString(){return`${this.createdAt.toIDString()}:${this.offset}`}}const Jh=Ut.of(Qe,0);class nt{constructor(e,t){h(this,"id"),h(this,"relativeOffset"),this.id=e,this.relativeOffset=t}static of(e,t){return new nt(e,t)}static fromStruct(e){const t=Ut.fromStruct(e.id);return nt.of(t,e.relativeOffset)}getID(){return this.id}getRelativeOffset(){return this.relativeOffset}getAbsoluteID(){return Ut.of(this.id.getCreatedAt(),this.id.getOffset()+this.relativeOffset)}toTestString(){return`${this.id.toTestString()}:${this.relativeOffset}`}toStruct(){return{id:this.id.toStruct(),relativeOffset:this.relativeOffset}}equals(e){return this.id.equals(e.id)?this.relativeOffset===e.relativeOffset:!1}}class ln extends Da{constructor(e,t,r){super(t),h(this,"id"),h(this,"removedAt"),h(this,"prev"),h(this,"next"),h(this,"insPrev"),h(this,"insNext"),this.id=e,this.removedAt=r}static create(e,t){return new ln(e,t)}static createComparator(){return(e,t)=>{const r=e.getCreatedAt().compare(t.getCreatedAt());return r!==0?r:e.getOffset()>t.getOffset()?1:e.getOffset()<t.getOffset()?-1:0}}getID(){return this.id}getCreatedAt(){return this.id.getCreatedAt()}getLength(){return this.removedAt?0:this.getContentLength()}getContentLength(){return this.value&&this.value.length||0}getPrev(){return this.prev}getNext(){return this.next}getInsPrev(){return this.insPrev}getInsNext(){return this.insNext}getInsPrevID(){return this.insPrev.getID()}setPrev(e){this.prev=e,e&&(e.next=this)}setNext(e){this.next=e,e&&(e.prev=this)}setInsPrev(e){this.insPrev=e,e&&(e.insNext=this)}setInsNext(e){this.insNext=e,e&&(e.insPrev=this)}hasNext(){return!!this.next}hasInsPrev(){return!!this.insPrev}isRemoved(){return!!this.removedAt}getRemovedAt(){return this.removedAt}split(e){return new ln(this.id.split(e),this.splitValue(e),this.removedAt)}canDelete(e,t){const r=!this.removedAt;return!this.getCreatedAt().after(t)&&(!this.removedAt||e.after(this.removedAt))?r:!1}canStyle(e,t){return!this.getCreatedAt().after(t)&&(!this.removedAt||e.after(this.removedAt))}remove(e){this.removedAt=e}createPosRange(){return[nt.of(this.id,0),nt.of(this.id,this.getLength())]}deepcopy(){return new ln(this.id,this.value,this.removedAt)}toTestString(){return`${this.id.toTestString()} ${this.value?this.value:""}`}splitValue(e){const t=this.value;return this.value=t.substring(0,e),t.substring(e,t.length)}toIDString(){return this.id.toIDString()}}class zn{constructor(){h(this,"head"),h(this,"treeByIndex"),h(this,"treeByID"),this.head=ln.create(Jh),this.treeByIndex=new Sr,this.treeByID=new Ba(ln.createComparator()),this.treeByIndex.insert(this.head),this.treeByID.put(this.head.getID(),this.head)}static create(){return new zn}edit(e,t,r,s){const[i,o]=this.findNodeWithSplit(e[1],t),[a,c]=this.findNodeWithSplit(e[0],t),u=this.findBetween(c,o),[l,y,f]=this.deleteNodes(u,t,s),p=o?o.getID():i.getID();let b=nt.of(p,0);if(r){const E=this.posToIndex(a.createPosRange()[1],!0),D=this.insertAfter(a,ln.create(Ut.of(t,0),r));l.length&&l[l.length-1].from===E?l[l.length-1].value=r:l.push({actor:t.getActorID(),from:E,to:E,value:r}),b=nt.of(D.getID(),D.getContentLength())}const N=[];for(const[,E]of f)N.push({parent:this,child:E});return[b,y,N,l]}indexToPos(e){const[t,r]=this.treeByIndex.find(e),s=t;return nt.of(s.getID(),r)}findIndexesFromRange(e){const[t,r]=e;return[this.posToIndex(t,!1),this.posToIndex(r,!0)]}posToIndex(e,t){const r=e.getAbsoluteID(),s=t?this.findFloorNodePreferToLeft(r):this.findFloorNode(r);s||v.fatal(`the node of the given id should be found: ${r.toTestString()}`);const i=this.treeByIndex.indexOf(s),o=s.isRemoved()?0:r.getOffset()-s.getID().getOffset();return i+o}findNode(e){return this.findFloorNode(e)}get length(){return this.treeByIndex.length}checkWeight(){return this.treeByIndex.checkWeight()}toString(){const e=[];for(const t of this)t.isRemoved()||e.push(t.getValue());return e.join("")}*[Symbol.iterator](){let e=this.head.getNext();for(;e;)yield e,e=e.getNext()}getHead(){return this.head}deepcopy(){const e=new zn;let t=this.head.getNext(),r=e.head,s;for(;t;){if(s=e.insertAfter(r,t.deepcopy()),t.hasInsPrev()){const i=e.findNode(t.getInsPrevID());s.setInsPrev(i)}r=s,t=t.getNext()}return e}toTestString(){const e=[];let t=this.head;for(;t;)t.isRemoved()?e.push(`{${t.toTestString()}}`):e.push(`[${t.toTestString()}]`),t=t.getNext();return e.join("")}insertAfter(e,t){const r=e.getNext();return t.setPrev(e),r&&r.setPrev(t),this.treeByID.put(t.getID(),t),this.treeByIndex.insertAfter(e,t),t}findNodeWithSplit(e,t){const r=e.getAbsoluteID();let s=this.findFloorNodePreferToLeft(r);const i=r.getOffset()-s.getID().getOffset();for(this.splitNode(s,i);s.hasNext()&&s.getNext().getCreatedAt().after(t);)s=s.getNext();return[s,s.getNext()]}findFloorNodePreferToLeft(e){let t=this.findFloorNode(e);if(t||v.fatal(`the node of the given id should be found: ${e.toTestString()}`),e.getOffset()>0&&t.getID().getOffset()==e.getOffset()){if(!t.hasInsPrev())return t;t=t.getInsPrev()}return t}findFloorNode(e){const t=this.treeByID.floorEntry(e);if(!!t&&!(!t.key.equals(e)&&!t.key.hasSameCreatedAt(e)))return t.value}findBetween(e,t){const r=[];let s=e;for(;s&&s!==t;)r.push(s),s=s.getNext();return r}splitNode(e,t){if(t>e.getContentLength()&&v.fatal("offset should be less than or equal to length"),t===0)return e;if(t===e.getContentLength())return e.getNext();const r=e.split(t);this.treeByIndex.updateWeight(r),this.insertAfter(e,r);const s=e.getInsNext();return s&&s.setInsPrev(r),r.setInsPrev(e),r}deleteNodes(e,t,r){if(!e.length)return[[],new Map,new Map];const[s,i]=this.filterNodes(e,t,r),o=new Map,a=new Map,c=this.makeChanges(i,t);for(const u of s){const l=u.getCreatedAt().getActorID();(!o.has(l)||u.getID().getCreatedAt().after(o.get(l)))&&o.set(l,u.getID().getCreatedAt()),a.set(u.getID().toIDString(),u),u.remove(t)}return this.deleteIndexNodes(i),[c,o,a]}filterNodes(e,t,r){const s=!!r,i=[],o=[],[a,c]=this.findEdgesOfCandidates(e);o.push(a);for(const u of e){const l=u.getCreatedAt().getActorID(),y=s?r.has(l)?r.get(l):Qe:yr;u.canDelete(t,y)?i.push(u):o.push(u)}return o.push(c),[i,o]}findEdgesOfCandidates(e){return[e[0].getPrev(),e[e.length-1].getNext()]}makeChanges(e,t){const r=[];let s,i;for(let o=0;o<e.length-1;o++){const a=e[o],c=e[o+1];a.getNext()!=c&&([s]=this.findIndexesFromRange(a.getNext().createPosRange()),c?[,i]=this.findIndexesFromRange(c.getPrev().createPosRange()):i=this.treeByIndex.length,s<i&&r.push({actor:t.getActorID(),from:s,to:i}))}return r.reverse()}deleteIndexNodes(e){for(let t=0;t<e.length-1;t++){const r=e[t],s=e[t+1];r.getNext()!=s&&this.treeByIndex.deleteRange(r,s)}}purge(e){const t=e.getPrev(),r=e.getNext(),s=e.getInsPrev(),i=e.getInsNext();t&&t.setNext(r),r&&r.setPrev(t),e.setPrev(void 0),e.setNext(void 0),s&&s.setInsNext(i),i&&i.setInsPrev(s),e.setInsPrev(void 0),e.setInsNext(void 0)}}const Ma=n=>n<0?Math.ceil(n):Math.floor(n);var $t=(n=>(n[n.IntegerCnt=0]="IntegerCnt",n[n.LongCnt=1]="LongCnt",n))($t||{});class Ie extends Tr{constructor(e,t,r){switch(super(r),h(this,"valueType"),h(this,"value"),this.valueType=e,e){case 0:typeof t=="number"?t>Math.pow(2,31)-1||t<-Math.pow(2,31)?this.value=x.fromNumber(t).toInt():this.value=Ma(t):this.value=t.toInt();break;case 1:typeof t=="number"?this.value=x.fromNumber(t):this.value=t;break;default:throw new F(U.Unimplemented,`unimplemented type: ${e}`)}}static create(e,t,r){return new Ie(e,t,r)}static valueFromBytes(e,t){switch(e){case 0:return t[0]|t[1]<<8|t[2]<<16|t[3]<<24;case 1:return x.fromBytesLE(Array.from(t));default:throw new F(U.Unimplemented,`unimplemented type: ${e}`)}}toJSON(){return`${this.value}`}toSortedJSON(){return this.toJSON()}toJSForTest(){return{createdAt:this.getCreatedAt().toTestString(),value:this.value,type:"YORKIE_COUNTER"}}deepcopy(){const e=Ie.create(this.valueType,this.value,this.getCreatedAt());return e.setMovedAt(this.getMovedAt()),e}getType(){return this.valueType}static getCounterType(e){switch(typeof e){case"object":return e instanceof x?1:void 0;case"number":return e>Math.pow(2,31)-1||e<-Math.pow(2,31)?1:0;default:return}}static isSupport(e){return!!Ie.getCounterType(e)}static isInteger(e){return e%1===0}isNumericType(){const e=this.valueType;return e===0||e===1}getValueType(){return this.valueType}getValue(){return this.value}toBytes(){switch(this.valueType){case 0:{const e=this.value;return new Uint8Array([e&255,e>>8&255,e>>16&255,e>>24&255])}case 1:{const t=this.value.toBytesLE();return Uint8Array.from(t)}default:throw new F(U.Unimplemented,`unimplemented type: ${this.valueType}`)}}increase(e){function t(r){if(!r.isNumericType())throw new TypeError(`Unsupported type of value: ${typeof r.getValue()}`)}return t(this),t(e),this.valueType===1?this.value=this.value.add(e.getValue()):e.getType()===ie.Long?this.value=this.value+e.getValue().toInt():this.value=x.fromNumber(this.value+Ma(e.getValue())).toInt(),this}}class Wn extends et{constructor(e,t,r){super(e,r),h(this,"value"),this.value=t}static create(e,t,r){return new Wn(e,t,r)}execute(e){const t=e.findByCreatedAt(this.getParentCreatedAt());t||v.fatal(`fail to find ${this.getParentCreatedAt()}`),t instanceof Ie||v.fatal("fail to execute, only Counter can execute increase");const r=t,s=this.value.deepcopy();return r.increase(s),{opInfos:[{type:"increase",path:e.createPath(this.getParentCreatedAt()),value:s.getValue()}],reverseOp:this.toReverseOperation()}}toReverseOperation(){const e=this.value.deepcopy(),r=e.getType()===ie.Long?e.getValue().multiply(-1):e.getValue()*-1;return Wn.create(this.getParentCreatedAt(),W.of(r,e.getCreatedAt()))}getEffectedCreatedAt(){return this.getParentCreatedAt()}toTestString(){return`${this.getParentCreatedAt().toTestString()}.INCREASE.${this.value.toJSON()}`}getValue(){return this.value}}class Zt extends et{constructor(e,t,r,s,i,o,a){super(e,a),h(this,"fromPos"),h(this,"toPos"),h(this,"maxCreatedAtMapByActor"),h(this,"attributes"),h(this,"attributesToRemove"),this.fromPos=t,this.toPos=r,this.maxCreatedAtMapByActor=s,this.attributes=i,this.attributesToRemove=o}static create(e,t,r,s,i,o){return new Zt(e,t,r,s,i,new Array,o)}static createTreeRemoveStyleOperation(e,t,r,s,i,o){return new Zt(e,t,r,s,new Map,i,o)}execute(e){const t=e.findByCreatedAt(this.getParentCreatedAt());t||v.fatal(`fail to find ${this.getParentCreatedAt()}`),t instanceof Ke||v.fatal("fail to execute, only Tree can execute edit");const r=t;let s,i;if(this.attributes.size){const o={};[...this.attributes].forEach(([a,c])=>o[a]=c),[,i,s]=r.style([this.fromPos,this.toPos],o,this.getExecutedAt(),this.maxCreatedAtMapByActor)}else{const o=this.attributesToRemove;[,i,s]=r.removeStyle([this.fromPos,this.toPos],o,this.getExecutedAt(),this.maxCreatedAtMapByActor)}for(const o of i)e.registerGCPair(o);return{opInfos:s.map(({from:o,to:a,value:c,fromPath:u,toPath:l})=>({type:"tree-style",from:o,to:a,value:this.attributes.size?{attributes:c}:{attributesToRemove:c},fromPath:u,toPath:l,path:e.createPath(this.getParentCreatedAt())}))}}getEffectedCreatedAt(){return this.getParentCreatedAt()}toTestString(){const e=this.getParentCreatedAt().toTestString(),t=`${this.fromPos.getLeftSiblingID().getCreatedAt().toTestString()}:${this.fromPos.getLeftSiblingID().getOffset()}`,r=`${this.toPos.getLeftSiblingID().getCreatedAt().toTestString()}:${this.toPos.getLeftSiblingID().getOffset()}`;return`${e}.STYLE(${t},${r},${Object.entries(this.attributes||{}).map(([s,i])=>`${s}:"${i}"`).join(" ")})`}getFromPos(){return this.fromPos}getToPos(){return this.toPos}getAttributes(){return this.attributes}getAttributesToRemove(){return this.attributesToRemove}getMaxCreatedAtMapByActor(){return this.maxCreatedAtMapByActor}}function Bh(n){const e=new ma,t=e.data;for(const[r,s]of Object.entries(n))t[r]=JSON.stringify(s);return e}function Lh(n){if(n.type===sn.Put)return new Fs({type:pr.PUT,presence:Bh(n.presence)});if(n.type===sn.Clear)return new Fs({type:pr.CLEAR});throw new F(U.Unimplemented,"unimplemented type")}function Mh(n){return new ga({serverSeq:n.getServerSeqAsString(),clientSeq:n.getClientSeq()})}function Ua(n){return new is({clientSeq:n.getClientSeq(),lamport:n.getLamportAsString(),actorId:ni(n.getActorID())})}function I(n){if(!!n)return new ya({lamport:n.getLamportAsString(),delimiter:n.getDelimiter(),actorId:ni(n.getActorID())})}function $a(n){switch(n){case ie.Null:return C.NULL;case ie.Boolean:return C.BOOLEAN;case ie.Integer:return C.INTEGER;case ie.Long:return C.LONG;case ie.Double:return C.DOUBLE;case ie.String:return C.STRING;case ie.Bytes:return C.BYTES;case ie.Date:return C.DATE;default:throw new F(U.Unsupported,`unsupported type: ${n}`)}}function Fa(n){switch(n){case $t.IntegerCnt:return C.INTEGER_CNT;case $t.LongCnt:return C.LONG_CNT;default:throw new F(U.Unsupported,`unsupported type: ${n}`)}}function Xs(n){if(n instanceof ve)return new vn({type:C.JSON_OBJECT,createdAt:I(n.getCreatedAt()),value:nc(n)});if(n instanceof Ne)return new vn({type:C.JSON_ARRAY,createdAt:I(n.getCreatedAt()),value:mf(n)});if(n instanceof Ye)return new vn({type:C.TEXT,createdAt:I(n.getCreatedAt())});if(n instanceof W)return new vn({type:$a(n.getType()),createdAt:I(n.getCreatedAt()),value:n.toBytes()});if(n instanceof Ie)return new vn({type:Fa(n.getType()),createdAt:I(n.getCreatedAt()),value:n.toBytes()});if(n instanceof Ke)return new vn({type:C.TREE,createdAt:I(n.getCreatedAt()),value:pf(n)});throw new F(U.Unimplemented,"unimplemented element")}function Uh(n){return new ua({createdAt:I(n.getCreatedAt()),offset:n.getOffset()})}function hs(n){return new pa({createdAt:I(n.getID().getCreatedAt()),offset:n.getID().getOffset(),relativeOffset:n.getRelativeOffset()})}function fs(n){return new da({parentId:_r(n.getParentID()),leftSiblingId:_r(n.getLeftSiblingID())})}function _r(n){return new fa({createdAt:I(n.getCreatedAt()),offset:n.getOffset()})}function qa(n){const e=new Us;if(n instanceof wn){const t=n,r=new Yo;r.parentCreatedAt=I(t.getParentCreatedAt()),r.key=t.getKey(),r.value=Xs(t.getValue()),r.executedAt=I(t.getExecutedAt()),e.body.case="set",e.body.value=r}else if(n instanceof wr){const t=n,r=new Ko;r.parentCreatedAt=I(t.getParentCreatedAt()),r.prevCreatedAt=I(t.getPrevCreatedAt()),r.value=Xs(t.getValue()),r.executedAt=I(t.getExecutedAt()),e.body.case="add",e.body.value=r}else if(n instanceof cn){const t=n,r=new Go;r.parentCreatedAt=I(t.getParentCreatedAt()),r.prevCreatedAt=I(t.getPrevCreatedAt()),r.createdAt=I(t.getCreatedAt()),r.executedAt=I(t.getExecutedAt()),e.body.case="move",e.body.value=r}else if(n instanceof an){const t=n,r=new zo;r.parentCreatedAt=I(t.getParentCreatedAt()),r.createdAt=I(t.getCreatedAt()),r.executedAt=I(t.getExecutedAt()),e.body.case="remove",e.body.value=r}else if(n instanceof Er){const t=n,r=new Wo;r.parentCreatedAt=I(t.getParentCreatedAt()),r.from=hs(t.getFromPos()),r.to=hs(t.getToPos());const s=r.createdAtMapByActor;for(const[o,a]of t.getMaxCreatedAtMapByActor())s[o]=I(a);r.content=t.getContent();const i=r.attributes;for(const[o,a]of t.getAttributes())i[o]=a;r.executedAt=I(t.getExecutedAt()),e.body.case="edit",e.body.value=r}else if(n instanceof Ir){const t=n,r=new Xo;r.parentCreatedAt=I(t.getParentCreatedAt()),r.from=hs(t.getFromPos()),r.to=hs(t.getToPos());const s=r.createdAtMapByActor;for(const[o,a]of t.getMaxCreatedAtMapByActor())s[o]=I(a);const i=r.attributes;for(const[o,a]of t.getAttributes())i[o]=a;r.executedAt=I(t.getExecutedAt()),e.body.case="style",e.body.value=r}else if(n instanceof Wn){const t=n,r=new Ho;r.parentCreatedAt=I(t.getParentCreatedAt()),r.value=Xs(t.getValue()),r.executedAt=I(t.getExecutedAt()),e.body.case="increase",e.body.value=r}else if(n instanceof Ar){const t=n,r=new Zo,s=r.createdAtMapByActor;for(const[i,o]of t.getMaxCreatedAtMapByActor())s[i]=I(o);r.parentCreatedAt=I(t.getParentCreatedAt()),r.from=fs(t.getFromPos()),r.to=fs(t.getToPos()),r.contents=Kh(t.getContents()),r.splitLevel=t.getSplitLevel(),r.executedAt=I(t.getExecutedAt()),e.body.case="treeEdit",e.body.value=r}else if(n instanceof Zt){const t=n,r=new Qo;r.parentCreatedAt=I(t.getParentCreatedAt()),r.from=fs(t.getFromPos()),r.to=fs(t.getToPos());const s=r.createdAtMapByActor;for(const[o,a]of t.getMaxCreatedAtMapByActor())s[o]=I(a);const i=t.getAttributesToRemove();if(i.length>0)r.attributesToRemove=i;else{const o=r.attributes;for(const[a,c]of t.getAttributes())o[a]=c}r.executedAt=I(t.getExecutedAt()),e.body.case="treeStyle",e.body.value=r}else throw new F(U.Unimplemented,"unimplemented operation");return e}function $h(n){const e=[];for(const t of n)e.push(qa(t));return e}function Fh(n){const e=new Vo({id:Ua(n.getID()),message:n.getMessage()});return n.hasOperations()&&(e.operations=$h(n.getOperations())),n.hasPresenceChange()&&(e.presenceChange=Lh(n.getPresenceChange())),e}function qh(n){const e=[];for(const t of n)e.push(Fh(t));return e}function jh(n){const e=[];for(const t of n)e.push(new oa({key:t.getStrKey(),element:Hs(t.getValue())}));return e}function Vh(n){const e=[];for(const t of n)e.push(new aa({element:Hs(t.getValue())}));return e}function Yh(n){const e=[];for(const t of n){const r=new ca;r.id=Uh(t.getID()),r.value=t.getValue().getContent(),r.removedAt=I(t.getRemovedAt());const s=r.attributes,i=t.getValue().getAttrs();for(const o of i){const a=new $s;a.value=o.getValue(),a.updatedAt=I(o.getUpdatedAt()),s[o.getKey()]=a}e.push(r)}return e}function Kh(n){const e=[];if(!n||!n.length)return e;for(const t of n)e.push(new ha({content:ja(t)}));return e}function Gh(n){const e={};for(const t of n)e[t.getKey()]=new $s({value:t.getValue(),updatedAt:I(t.getUpdatedAt()),isRemoved:t.isRemoved()});return e}function ja(n){if(!n)return[];const e=[];return us(n,(t,r)=>{const s=new la({id:_r(t.id),type:t.type,removedAt:I(t.removedAt),depth:r});t.isText&&(s.value=t.value),t.insPrevID&&(s.insPrevId=_r(t.insPrevID)),t.insNextID&&(s.insNextId=_r(t.insNextID)),t.attrs&&(s.attributes=Gh(t.attrs)),e.push(s)}),e}function zh(n){const e=new Lt;return e.body.case="jsonObject",e.body.value=new ea({nodes:jh(n.getRHT()),createdAt:I(n.getCreatedAt()),movedAt:I(n.getMovedAt()),removedAt:I(n.getRemovedAt())}),e}function Va(n){const e=new Lt;return e.body.case="jsonArray",e.body.value=new ta({nodes:Vh(n.getElements()),createdAt:I(n.getCreatedAt()),movedAt:I(n.getMovedAt()),removedAt:I(n.getRemovedAt())}),e}function Wh(n){const e=new Lt;return e.body.case="primitive",e.body.value=new na({type:$a(n.getType()),value:n.toBytes(),createdAt:I(n.getCreatedAt()),movedAt:I(n.getMovedAt()),removedAt:I(n.getRemovedAt())}),e}function Xh(n){const e=new Lt;return e.body.case="text",e.body.value=new ra({nodes:Yh(n.getRGATreeSplit()),createdAt:I(n.getCreatedAt()),movedAt:I(n.getMovedAt()),removedAt:I(n.getRemovedAt())}),e}function Hh(n){const e=new Lt;return e.body.case="counter",e.body.value=new sa({type:Fa(n.getType()),value:n.toBytes(),createdAt:I(n.getCreatedAt()),movedAt:I(n.getMovedAt()),removedAt:I(n.getRemovedAt())}),e}function Ya(n){const e=new Lt;return e.body.case="tree",e.body.value=new ia({nodes:ja(n.getRoot()),createdAt:I(n.getCreatedAt()),movedAt:I(n.getMovedAt()),removedAt:I(n.getRemovedAt())}),e}function Hs(n){if(n instanceof ve)return zh(n);if(n instanceof Ne)return Va(n);if(n instanceof W)return Wh(n);if(n instanceof Ye)return Xh(n);if(n instanceof Ie)return Hh(n);if(n instanceof Ke)return Ya(n);throw new F(U.Unimplemented,"unimplemented element")}function Zh(n){return new jo({documentKey:n.getDocumentKey(),checkpoint:Mh(n.getCheckpoint()),isRemoved:n.getIsRemoved(),changes:qh(n.getChanges()),snapshot:n.getSnapshot(),minSyncedTicket:I(n.getMinSyncedTicket())})}function Ka(n){let e;return n.serverSeq&&(e=x.fromString(n.serverSeq,!0)),un.of(n.clientSeq,x.fromString(n.lamport,!0),ti(n.actorId),e)}function _(n){if(!!n)return me.of(x.fromString(n.lamport,!0),n.delimiter,ti(n.actorId))}function Zs(n){const e={};return Object.entries(n.data).forEach(([t,r])=>{e[t]=JSON.parse(r)}),e}function Qh(n){const e=n.type;if(e===pr.PUT){const t=Zs(n.presence);return{type:sn.Put,presence:t}}if(e===pr.CLEAR)return{type:sn.Clear};throw new F(U.Unsupported,`unsupported type: ${e}`)}function ef(n){const e=new Map;return Object.entries(n).forEach(([t,r])=>{e.set(t,Zs(r))}),e}function Ga(n){switch(n){case C.NULL:return ie.Null;case C.BOOLEAN:return ie.Boolean;case C.INTEGER:return ie.Integer;case C.LONG:return ie.Long;case C.DOUBLE:return ie.Double;case C.STRING:return ie.String;case C.BYTES:return ie.Bytes;case C.DATE:return ie.Date}throw new F(U.Unimplemented,`unimplemented value type: ${n}`)}function ds(n){switch(n){case C.INTEGER_CNT:return $t.IntegerCnt;case C.LONG_CNT:return $t.LongCnt}throw new F(U.Unimplemented,`unimplemented value type: ${n}`)}function Qs(n){switch(n.type){case C.JSON_OBJECT:return n.value?tc(n.value):ve.create(_(n.createdAt));case C.JSON_ARRAY:return n.value?df(n.value):Ne.create(_(n.createdAt));case C.TEXT:return Ye.create(zn.create(),_(n.createdAt));case C.TREE:return gf(n.value);case C.NULL:case C.BOOLEAN:case C.INTEGER:case C.LONG:case C.DOUBLE:case C.STRING:case C.BYTES:case C.DATE:return W.of(W.valueFromBytes(Ga(n.type),n.value),_(n.createdAt));case C.INTEGER_CNT:case C.LONG_CNT:return Ie.create(ds(n.type),Ie.valueFromBytes(ds(n.type),n.value),_(n.createdAt))}}function ms(n){return nt.of(Ut.of(_(n.createdAt),n.offset),n.relativeOffset)}function za(n){return Ut.of(_(n.createdAt),n.offset)}function tf(n){const e=Nr.create(n.value);Object.entries(n.attributes).forEach(([r,s])=>{e.setAttr(r,s.value,_(s.updatedAt))});const t=ln.create(za(n.id),e);return t.remove(_(n.removedAt)),t}function Xn(n){return tt.of(Or(n.parentId),Or(n.leftSiblingId))}function Or(n){return ue.of(_(n.createdAt),n.offset)}function nf(n){if(!n.length)return;const e=[];return n.forEach(t=>{const r=Wa(t.content);e.push(r)}),e}function Wa(n){if(n.length===0)return;const e=[];for(const r of n)e.push(sf(r));const t=e[e.length-1];for(let r=e.length-2;r>=0;r--){let s;for(let i=r+1;i<e.length;i++)if(n[r].depth-1===n[i].depth){s=e[i];break}s.prepend(e[r])}return t.updateDescendantsSize(),Ke.create(t,Qe).getRoot()}function rf(n){const e=Xt.create();for(const[t,r]of Object.entries(n))e.setInternal(t,r.value,_(r.updatedAt),r.isRemoved);return e}function sf(n){const e=Or(n.id),t=Ee.create(e,n.type),r=Object.entries(n.attributes);return t.isText?t.value=n.value:r.length&&(t.attrs=rf(n.attributes)),n.insPrevId&&(t.insPrevID=Or(n.insPrevId)),n.insNextId&&(t.insNextID=Or(n.insNextId)),t.removedAt=_(n.removedAt),t}function Xa(n){if(n.body.case==="set"){const e=n.body.value;return wn.create(e.key,Qs(e.value),_(e.parentCreatedAt),_(e.executedAt))}else if(n.body.case==="add"){const e=n.body.value;return wr.create(_(e.parentCreatedAt),_(e.prevCreatedAt),Qs(e.value),_(e.executedAt))}else if(n.body.case==="move"){const e=n.body.value;return cn.create(_(e.parentCreatedAt),_(e.prevCreatedAt),_(e.createdAt),_(e.executedAt))}else if(n.body.case==="remove"){const e=n.body.value;return an.create(_(e.parentCreatedAt),_(e.createdAt),_(e.executedAt))}else if(n.body.case==="edit"){const e=n.body.value,t=new Map;Object.entries(e.createdAtMapByActor).forEach(([s,i])=>{t.set(s,_(i))});const r=new Map;return Object.entries(e.attributes).forEach(([s,i])=>{r.set(s,i)}),Er.create(_(e.parentCreatedAt),ms(e.from),ms(e.to),t,e.content,r,_(e.executedAt))}else if(n.body.case==="style"){const e=n.body.value,t=new Map;Object.entries(e.createdAtMapByActor).forEach(([s,i])=>{t.set(s,_(i))});const r=new Map;return Object.entries(e.attributes).forEach(([s,i])=>{r.set(s,i)}),Ir.create(_(e.parentCreatedAt),ms(e.from),ms(e.to),t,r,_(e.executedAt))}else{if(n.body.case==="select")return;if(n.body.case==="increase"){const e=n.body.value;return Wn.create(_(e.parentCreatedAt),Qs(e.value),_(e.executedAt))}else if(n.body.case==="treeEdit"){const e=n.body.value,t=new Map;return Object.entries(e.createdAtMapByActor).forEach(([r,s])=>{t.set(r,_(s))}),Ar.create(_(e.parentCreatedAt),Xn(e.from),Xn(e.to),nf(e.contents),e.splitLevel,t,_(e.executedAt))}else if(n.body.case==="treeStyle"){const e=n.body.value,t=new Map,r=e.attributesToRemove,s=new Map;return e!=null&&e.createdAtMapByActor&&Object.entries(e.createdAtMapByActor).forEach(([i,o])=>{s.set(i,_(o))}),(r==null?void 0:r.length)>0?Zt.createTreeRemoveStyleOperation(_(e.parentCreatedAt),Xn(e.from),Xn(e.to),s,r,_(e.executedAt)):(Object.entries(e.attributes).forEach(([i,o])=>{t.set(i,o)}),Zt.create(_(e.parentCreatedAt),Xn(e.from),Xn(e.to),s,t,_(e.executedAt)))}else throw new F(U.Unimplemented,"unimplemented operation")}}function of(n){const e=[];for(const t of n){const r=Xa(t);r&&e.push(r)}return e}function Ha(n){const e=[];for(const t of n)e.push(En.create({id:Ka(t.id),operations:of(t.operations),presenceChange:t.presenceChange?Qh(t.presenceChange):void 0,message:t.message}));return e}function af(n){return Gn.of(x.fromString(n.serverSeq,!0),n.clientSeq)}function cf(n){return ls.create(n.documentKey,af(n.checkpoint),n.isRemoved,Ha(n.changes),n.snapshot,_(n.minSyncedTicket))}function Za(n){const e=new vr;for(const r of n.nodes){const s=ei(r.element);e.set(r.key,s,s.getPositionedAt())}const t=new ve(_(n.createdAt),e);return t.setMovedAt(_(n.movedAt)),t.setRemovedAt(_(n.removedAt)),t}function Qa(n){const e=new br;for(const r of n.nodes)e.insert(ei(r.element));const t=new Ne(_(n.createdAt),e);return t.setMovedAt(_(n.movedAt)),t.setRemovedAt(_(n.removedAt)),t}function uf(n){const e=W.of(W.valueFromBytes(Ga(n.type),n.value),_(n.createdAt));return e.setMovedAt(_(n.movedAt)),e.setRemovedAt(_(n.removedAt)),e}function lf(n){const e=new zn;let t=e.getHead();for(const s of n.nodes){const i=e.insertAfter(t,tf(s));s.insPrevId&&i.setInsPrev(e.findNode(za(s.insPrevId))),t=i}const r=new Ye(e,_(n.createdAt));return r.setMovedAt(_(n.movedAt)),r.setRemovedAt(_(n.removedAt)),r}function hf(n){const e=Ie.create(ds(n.type),Ie.valueFromBytes(ds(n.type),n.value),_(n.createdAt));return e.setMovedAt(_(n.movedAt)),e.setRemovedAt(_(n.removedAt)),e}function ec(n){const e=Wa(n.nodes);return Ke.create(e,_(n.createdAt))}function ei(n){if(n.body.case==="jsonObject")return Za(n.body.value);if(n.body.case==="jsonArray")return Qa(n.body.value);if(n.body.case==="primitive")return uf(n.body.value);if(n.body.case==="text")return lf(n.body.value);if(n.body.case==="counter")return hf(n.body.value);if(n.body.case==="tree")return ec(n.body.value);throw new F(U.Unimplemented,"unimplemented element")}function ff(n){if(!n)return{root:ve.create(Qe),presences:new Map};const e=qo.fromBinary(n);return{root:ei(e.root),presences:ef(e.presences)}}function tc(n){if(!n)throw new Error("bytes is empty");const e=Lt.fromBinary(n);return Za(e.body.value)}function nc(n){return Hs(n).toBinary()}function df(n){if(!n)throw new Error("bytes is empty");const e=Lt.fromBinary(n);return Qa(e.body.value)}function mf(n){return Va(n).toBinary()}function gf(n){if(!n)throw new Error("bytes is empty");const e=Lt.fromBinary(n);return ec(e.body.value)}function pf(n){return Ya(n).toBinary()}function rc(n){return n?Array.from(n).map(e=>e.toString(16).padStart(2,"0")).join(""):""}function ti(n){return rc(n)}function sc(n){return new Uint8Array(n.match(/.{1,2}/g).map(e=>parseInt(e,16)))}function ni(n){return sc(n)}function yf(n){const e=is.fromBinary(n);return Ka(e)}function Tf(n){const e=Us.fromBinary(n);return Xa(e)}const ne={fromPresence:Zs,toChangePack:Zh,fromChangePack:cf,fromChanges:Ha,objectToBytes:nc,bytesToObject:tc,bytesToSnapshot:ff,bytesToHex:rc,hexToBytes:sc,toHexString:ti,toUint8Array:ni,toOperation:qa,toChangeID:Ua,PbChangeID:is,bytesToChangeID:yf,bytesToOperation:Tf};function ic(){return"xxxxxxxx-xxxx-4xxxy-xxxx-xxxxxxxxxxx".replace(/[xy]/g,n=>{const e=Math.random()*16|0;return(n==="x"?e:e&3|8).toString(16)})}class vf{constructor(e,t,r,s){h(this,"reconnectStreamDelay"),h(this,"doc"),h(this,"docID"),h(this,"syncMode"),h(this,"remoteChangeEventReceived"),h(this,"watchStream"),h(this,"watchLoopTimerID"),h(this,"watchAbortController"),this.reconnectStreamDelay=e,this.doc=t,this.docID=r,this.syncMode=s,this.remoteChangeEventReceived=!1}changeSyncMode(e){this.syncMode=e}needRealtimeSync(){return this.syncMode===Jr.RealtimeSyncOff?!1:this.syncMode===Jr.RealtimePushOnly?this.doc.hasLocalChanges():this.syncMode!==Jr.Manual&&(this.doc.hasLocalChanges()||this.remoteChangeEventReceived)}async runWatchLoop(e){const t=async()=>{if(this.watchStream)return Promise.resolve();this.watchLoopTimerID&&(clearTimeout(this.watchLoopTimerID),this.watchLoopTimerID=void 0);try{[this.watchStream,this.watchAbortController]=await e(()=>{this.watchStream=void 0,this.watchAbortController=void 0,this.watchLoopTimerID=setTimeout(t,this.reconnectStreamDelay)})}catch{}};await t()}cancelWatchStream(){this.watchStream&&this.watchAbortController&&(this.watchAbortController.abort(),this.watchStream=void 0,this.watchAbortController=void 0),clearTimeout(this.watchLoopTimerID),this.watchLoopTimerID=void 0}}const ri=()=>{};class Sf{constructor(e){h(this,"finalized",!1),h(this,"observers",[]),h(this,"finalError");try{e(this)}catch(t){this.error(t)}}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let s;e||v.fatal("missing observer"),this.finalized&&v.fatal("observable is finalized due to previous error"),typeof e=="object"?s=e:s={next:e,error:t,complete:r},s.next===void 0&&(s.next=ri),s.error===void 0&&(s.error=ri),s.complete===void 0&&(s.complete=ri);const i=ic(),o=this.unsubscribeOne.bind(this,i);if(this.observers.push({subscriptionID:i,observer:s}),this.finalized)try{this.finalError?s.error(this.finalError):s.complete()}catch(a){v.warn(a)}return o}unsubscribeOne(e){var t;this.observers=(t=this.observers)==null?void 0:t.filter(r=>r.subscriptionID!==e)}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e].observer)}catch(r){v.error(r)}}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.observers=void 0)}}function bf(n){const e=new Sf(n);return{subscribe:e.subscribe.bind(e),getProxy:()=>e}}class Hn{constructor(e,t,r,s){h(this,"id"),h(this,"delimiter"),h(this,"message"),h(this,"root"),h(this,"operations"),h(this,"presenceChange"),h(this,"previousPresence"),h(this,"reversePresenceKeys"),this.id=e,this.delimiter=Ys,this.root=t,this.operations=[],this.previousPresence=Ze(r),this.presenceChange=void 0,this.reversePresenceKeys=new Set,this.message=s}static create(e,t,r,s){return new Hn(e,t,r,s)}push(e){this.operations.push(e)}registerElement(e,t){this.root.registerElement(e,t)}registerRemovedElement(e){this.root.registerRemovedElement(e)}registerGCPair(e){this.root.registerGCPair(e)}getChange(){return En.create({id:this.id,operations:this.operations,presenceChange:this.presenceChange,message:this.message})}hasChange(){return this.operations.length>0||this.presenceChange!==void 0}setPresenceChange(e){this.presenceChange=e}setReversePresence(e,t){for(const r of Object.keys(e))t!=null&&t.addToHistory?this.reversePresenceKeys.add(r):this.reversePresenceKeys.delete(r)}getReversePresence(){if(this.reversePresenceKeys.size===0)return;const e={};for(const t of this.reversePresenceKeys)e[t]=this.previousPresence[t];return e}issueTimeTicket(){return this.delimiter+=1,this.id.createTimeTicket(this.delimiter)}getLastTimeTicket(){return this.id.createTimeTicket(this.delimiter)}}class Pr{constructor(e){h(this,"rootObject"),h(this,"elementPairMapByCreatedAt"),h(this,"gcElementSetByCreatedAt"),h(this,"gcPairMap"),this.rootObject=e,this.elementPairMapByCreatedAt=new Map,this.gcElementSetByCreatedAt=new Set,this.gcPairMap=new Map,this.registerElement(e,void 0),e.getDescendants(t=>{if(t.getRemovedAt()&&this.registerRemovedElement(t),t instanceof Ye||t instanceof Ke)for(const r of t.getGCPairs())this.registerGCPair(r);return!1})}static create(){return new Pr(ve.create(Qe))}findByCreatedAt(e){const t=this.elementPairMapByCreatedAt.get(e.toIDString());if(!!t)return t.element}findElementPairByCreatedAt(e){return this.elementPairMapByCreatedAt.get(e.toIDString())}createSubPaths(e){let t=this.elementPairMapByCreatedAt.get(e.toIDString());if(!t)return[];const r=[];for(;t.parent;){const s=t.element.getCreatedAt(),i=t.parent.subPathOf(s);i===void 0&&v.fatal(`cant find the given element: ${s.toIDString()}`),r.unshift(i),t=this.elementPairMapByCreatedAt.get(t.parent.getCreatedAt().toIDString())}return r.unshift("$"),r}createPath(e){return this.createSubPaths(e).join(".")}registerElement(e,t){this.elementPairMapByCreatedAt.set(e.getCreatedAt().toIDString(),{parent:t,element:e}),e instanceof on&&e.getDescendants((r,s)=>(this.registerElement(r,s),!1))}deregisterElement(e){let t=0;const r=s=>{const i=s.getCreatedAt().toIDString();this.elementPairMapByCreatedAt.delete(i),this.gcElementSetByCreatedAt.delete(i),t++};return r(e),e instanceof on&&e.getDescendants(s=>(r(s),!1)),t}registerRemovedElement(e){this.gcElementSetByCreatedAt.add(e.getCreatedAt().toIDString())}registerGCPair(e){if(this.gcPairMap.get(e.child.toIDString())){this.gcPairMap.delete(e.child.toIDString());return}this.gcPairMap.set(e.child.toIDString(),e)}getElementMapSize(){return this.elementPairMapByCreatedAt.size}getGarbageElementSetSize(){const e=new Set;for(const t of this.gcElementSetByCreatedAt){e.add(t);const r=this.elementPairMapByCreatedAt.get(t);r.element instanceof on&&r.element.getDescendants(s=>(e.add(s.getCreatedAt().toIDString()),!1))}return e.size}getObject(){return this.rootObject}getGarbageLen(){return this.getGarbageElementSetSize()+this.gcPairMap.size}deepcopy(){return new Pr(this.rootObject.deepcopy())}garbageCollect(e){let t=0;for(const r of this.gcElementSetByCreatedAt){const s=this.elementPairMapByCreatedAt.get(r);s.element.getRemovedAt()&&e.compare(s.element.getRemovedAt())>=0&&(s.parent.purge(s.element),t+=this.deregisterElement(s.element))}for(const[,r]of this.gcPairMap){const s=r.child.getRemovedAt();s!==void 0&&e.compare(s)>=0&&(r.parent.purge(r.child),this.gcPairMap.delete(r.child.toIDString()),t+=1)}return t}toJSON(){return this.rootObject.toJSON()}toSortedJSON(){return this.rootObject.toSortedJSON()}}function oc(n,e){const t=new xr(n);return new Proxy(e,t.getHandlers())}class xr{constructor(e){h(this,"context"),h(this,"handlers"),this.context=e,this.handlers={set:(t,r,s)=>(v.isEnabled(we.Trivial)&&v.trivial(`obj[${r}]=${JSON.stringify(s)}`),xr.setInternal(e,t,r,s),!0),get:(t,r)=>(v.isEnabled(we.Trivial)&&v.trivial(`obj[${r}]`),r==="getID"?()=>t.getCreatedAt():r==="toJSON"||r==="toString"?()=>t.toJSON():r==="toJS"?()=>t.toJS():r==="toJSForTest"?()=>t.toJSForTest():In(e,t.get(r))),ownKeys:t=>t.getKeys(),getOwnPropertyDescriptor:()=>({enumerable:!0,configurable:!0}),deleteProperty:(t,r)=>(v.isEnabled(we.Trivial)&&v.trivial(`obj[${r}]`),xr.deleteInternal(e,t,r),!0)}}static setInternal(e,t,r,s){if(r.includes("."))throw new F(U.InvalidObjectKey,"key must not contain the '.'.");const i=e.issueTimeTicket(),o=gs(e,s,i),a=t.set(r,o,i);e.registerElement(o,t),a&&e.registerRemovedElement(a),e.push(wn.create(r,o.deepcopy(),t.getCreatedAt(),i))}static buildObjectMembers(e,t){const r={};for(const[s,i]of Object.entries(t)){if(s.includes("."))throw new F(U.InvalidObjectKey,"key must not contain the '.'.");const o=e.issueTimeTicket(),a=gs(e,i,o);r[s]=a}return r}static deleteInternal(e,t,r){const s=e.issueTimeTicket(),i=t.deleteByKey(r,s);!i||(e.push(an.create(t.getCreatedAt(),i.getCreatedAt(),s)),e.registerRemovedElement(i))}getHandlers(){return this.handlers}}function wf(n,e){const t=new Q(n,e);return new Proxy(e,t.getHandlers())}function Nf(n){return typeof n=="string"||n instanceof String?!isNaN(n):!1}function Ef(n){return["concat","entries","every","filter","find","findIndex","forEach","join","keys","map","reduce","reduceRight","slice","some","toLocaleString","toString","values"].includes(n)}class Q{constructor(e,t){h(this,"context"),h(this,"handlers"),h(this,"array"),this.context=e,this.array=t,this.handlers={get:(r,s,i)=>s==="getID"?()=>r.getCreatedAt():s==="getElementByID"?o=>{const a=r.getByID(o);if(!(!a||a.isRemoved()))return hn(e,a)}:s==="getElementByIndex"?o=>{const a=r.get(o);return hn(e,a)}:s==="getLast"?()=>hn(e,r.getLast()):s==="deleteByID"?o=>{const a=Q.deleteInternalByID(e,r,o);return hn(e,a)}:s==="insertAfter"?(o,a)=>{const c=Q.insertAfterInternal(e,r,o,a);return hn(e,c)}:s==="insertBefore"?(o,a)=>{const c=Q.insertBeforeInternal(e,r,o,a);return hn(e,c)}:s==="moveBefore"?(o,a)=>{Q.moveBeforeInternal(e,r,o,a)}:s==="moveAfter"?(o,a)=>{Q.moveAfterInternal(e,r,o,a)}:s==="moveFront"?o=>{Q.moveFrontInternal(e,r,o)}:s==="moveLast"?o=>{Q.moveLastInternal(e,r,o)}:Nf(s)?In(e,r.get(Number(s))):s==="push"?o=>Q.pushInternal(e,r,o):s==="splice"?(o,a,...c)=>Q.splice(e,r,o,a,...c):s==="length"?r.length:typeof s=="symbol"&&s===Symbol.iterator?Q.iteratorInternal.bind(this,e,r):s==="includes"?(o,a)=>Q.includes(e,r,o,a):s==="indexOf"?(o,a)=>Q.indexOf(e,r,o,a):s==="lastIndexOf"?(o,a)=>Q.lastIndexOf(e,r,o,a):s==="toJSForTest"?()=>r.toJSForTest():s==="toTestString"?()=>Q.toTestString(r):typeof s=="string"&&Ef(s)?(...o)=>{const a=Array.from(r).map(c=>In(e,c));return Array.prototype[s].apply(a,o)}:Reflect.get(r,s,i),deleteProperty:(r,s)=>(v.isEnabled(we.Trivial)&&v.trivial(`array[${s}]`),Q.deleteInternalByIndex(e,r,Number.parseInt(s)),!0)}}static*iteratorInternal(e,t){for(const r of t)yield hn(e,r)}static buildArrayElements(e,t){const r=[];for(const s of t){const i=e.issueTimeTicket(),o=gs(e,s,i);r.push(o)}return r}static pushInternal(e,t,r){return Q.insertAfterInternal(e,t,t.getLastCreatedAt(),r),t.length}static moveBeforeInternal(e,t,r,s){const i=e.issueTimeTicket(),o=t.getPrevCreatedAt(r);t.moveAfter(o,s,i),e.push(cn.create(t.getCreatedAt(),o,s,i))}static moveAfterInternal(e,t,r,s){const i=e.issueTimeTicket();t.moveAfter(r,s,i),e.push(cn.create(t.getCreatedAt(),r,s,i))}static moveFrontInternal(e,t,r){const s=e.issueTimeTicket(),i=t.getHead();t.moveAfter(i.getCreatedAt(),r,s),e.push(cn.create(t.getCreatedAt(),i.getCreatedAt(),r,s))}static moveLastInternal(e,t,r){const s=e.issueTimeTicket(),i=t.getLastCreatedAt();t.moveAfter(i,r,s),e.push(cn.create(t.getCreatedAt(),i,r,s))}static insertAfterInternal(e,t,r,s){const i=e.issueTimeTicket(),o=gs(e,s,i);return t.insertAfter(r,o),e.registerElement(o,t),e.push(wr.create(t.getCreatedAt(),r,o.deepcopy(),i)),o}static insertBeforeInternal(e,t,r,s){return Q.insertAfterInternal(e,t,t.getPrevCreatedAt(r),s)}static deleteInternalByIndex(e,t,r){const s=e.issueTimeTicket(),i=t.deleteByIndex(r,s);if(!!i)return e.push(an.create(t.getCreatedAt(),i.getCreatedAt(),s)),e.registerRemovedElement(i),i}static deleteInternalByID(e,t,r){const s=e.issueTimeTicket(),i=t.delete(r,s);return e.push(an.create(t.getCreatedAt(),i.getCreatedAt(),s)),e.registerRemovedElement(i),i}static splice(e,t,r,s,...i){const o=t.length,a=r>=0?Math.min(r,o):Math.max(o+r,0),c=s===void 0?o:s<0?a:Math.min(a+s,o),u=[];for(let l=a;l<c;l++){const y=Q.deleteInternalByIndex(e,t,a);if(y){const f=y.deepcopy();f.setRemovedAt(),u.push(In(e,f))}}if(i){let l=a===0?t.getHead().getID():t.get(a-1).getID();for(const y of i)l=Q.insertAfterInternal(e,t,l,y).getID()}return u}static includes(e,t,r,s){var i;const o=t.length,a=s===void 0?0:s<0?Math.max(s+o,0):s;if(a>=o)return!1;if(W.isSupport(r))return Array.from(t).map(u=>In(e,u)).includes(r,a);for(let c=a;c<o;c++)if(((i=t.get(c))==null?void 0:i.getID())===r.getID())return!0;return!1}static indexOf(e,t,r,s){var i;const o=t.length,a=s===void 0?0:s<0?Math.max(s+o,0):s;if(a>=o)return-1;if(W.isSupport(r))return Array.from(t).map(u=>In(e,u)).indexOf(r,a);for(let c=a;c<o;c++)if(((i=t.get(c))==null?void 0:i.getID())===r.getID())return c;return-1}static lastIndexOf(e,t,r,s){var i;const o=t.length,a=s===void 0||s>=o?o-1:s<0?s+o:s;if(a<0)return-1;if(W.isSupport(r))return Array.from(t).map(u=>In(e,u)).lastIndexOf(r,a);for(let c=a;c>0;c--)if(((i=t.get(c))==null?void 0:i.getID())===r.getID())return c;return-1}static toTestString(e){return e.toTestString()}getHandlers(){return this.handlers}}class Dr{constructor(e,t){h(this,"context"),h(this,"text"),this.context=e,this.text=t}initialize(e,t){this.context=e,this.text=t}getID(){return this.text.getID()}edit(e,t,r,s){if(!this.context||!this.text){v.fatal("it is not initialized yet");return}if(e>t){v.fatal("from should be less than or equal to to");return}const i=this.text.indexRangeToPosRange(e,t);v.isEnabled(we.Debug)&&v.debug(`EDIT: f:${e}->${i[0].toTestString()}, t:${t}->${i[1].toTestString()} c:${r}`);const o=s?Yn(s):void 0,a=this.context.issueTimeTicket(),[c,,u,l]=this.text.edit(i,r,a,o);for(const y of u)this.context.registerGCPair(y);return this.context.push(new Er(this.text.getCreatedAt(),i[0],i[1],c,r,o?new Map(Object.entries(o)):new Map,a)),this.text.findIndexesFromRange(l)}delete(e,t){return this.edit(e,t,"")}empty(){return this.edit(0,this.length,"")}setStyle(e,t,r){if(!this.context||!this.text)return v.fatal("it is not initialized yet"),!1;if(e>t)return v.fatal("from should be less than or equal to to"),!1;const s=this.text.indexRangeToPosRange(e,t);v.isEnabled(we.Debug)&&v.debug(`STYL: f:${e}->${s[0].toTestString()}, t:${t}->${s[1].toTestString()} a:${JSON.stringify(r)}`);const i=Yn(r),o=this.context.issueTimeTicket(),[a,c]=this.text.setStyle(s,i,o);for(const u of c)this.context.registerGCPair(u);return this.context.push(new Ir(this.text.getCreatedAt(),s[0],s[1],a,new Map(Object.entries(i)),o)),!0}indexRangeToPosRange(e){if(!this.context||!this.text){v.fatal("it is not initialized yet");return}const t=this.text.indexRangeToPosRange(e[0],e[1]);return[t[0].toStruct(),t[1].toStruct()]}posRangeToIndexRange(e){if(!this.context||!this.text){v.fatal("it is not initialized yet");return}const t=this.text.findIndexesFromRange([nt.fromStruct(e[0]),nt.fromStruct(e[1])]);return[t[0],t[1]]}toTestString(){if(!this.context||!this.text){v.fatal("it is not initialized yet");return}return this.text.toTestString()}values(){if(!this.context||!this.text){v.fatal("it is not initialized yet");return}return this.text.values()}get length(){return this.text.length}checkWeight(){return this.text.checkWeight()}toString(){return!this.context||!this.text?(v.fatal("it is not initialized yet"),""):this.text.toString()}toJSON(){if(!this.context||!this.text)throw new Error("it is not initialized yet");return this.text.toJSON()}toJSForTest(){if(!this.context||!this.text)throw new Error("it is not initialized yet");return this.text.toJSForTest()}createRangeForTest(e,t){if(!this.context||!this.text){v.fatal("it is not initialized yet");return}return this.text.indexRangeToPosRange(e,t)}}class Cr{constructor(e,t){h(this,"valueType"),h(this,"value"),h(this,"context"),h(this,"counter"),this.valueType=e,this.value=t}initialize(e,t){this.valueType=t.getValueType(),this.context=e,this.counter=t,this.value=t.getValue()}getID(){return this.counter.getID()}getValue(){return this.value}getValueType(){return this.valueType}increase(e){if(!this.context||!this.counter){v.fatal("it is not initialized yet");return}const t=this.context.issueTimeTicket(),r=W.of(e,t);if(!r.isNumericType())throw new TypeError(`Unsupported type of value: ${typeof r.getValue()}`);return this.counter.increase(r),this.context.push(Wn.create(this.counter.getCreatedAt(),r,t)),this}toJSForTest(){if(!this.context||!this.counter)throw new Error("it is not initialized yet");return this.counter.toJSForTest()}}function si(n,e,t){const{type:r}=n,s=t.issueTimeTicket();if(r===Ht){ac(n);const{value:i}=n,o=Ee.create(ue.of(s,0),r,i);e.append(o)}else{const{children:i=[]}=n;let{attributes:o}=n,a;if(typeof o=="object"&&!xa(o)){o=Yn(o),a=new Xt;for(const[u,l]of Object.entries(o))a.set(u,l,s)}const c=Ee.create(ue.of(s,0),r,void 0,a);e.append(c);for(const u of i)si(u,c,t)}}function If(n,e){const{type:t}=e,r=n.issueTimeTicket();let s;if(e.type===Ht){const{value:i}=e;s=Ee.create(ue.of(r,0),t,i)}else if(e){const{children:i=[]}=e;let{attributes:o}=e,a;if(typeof o=="object"&&!xa(o)){o=Yn(o),a=new Xt;for(const[c,u]of Object.entries(o))a.set(c,u,r)}s=Ee.create(ue.of(n.issueTimeTicket(),0),t,void 0,a);for(const c of i)si(c,s,n)}return s}function ac(n){if(!n.value.length)throw new Error("text node cannot have empty value");return!0}function cc(n){if(!n.length)return!0;if(n[0].type===Ht)for(const t of n){const{type:r}=t;if(r!==Ht)throw new Error("element node and text node cannot be passed together");ac(t)}else for(const t of n){const{type:r}=t;if(r===Ht)throw new Error("element node and text node cannot be passed together")}return!0}class Rr{constructor(e){h(this,"initialRoot"),h(this,"context"),h(this,"tree"),this.initialRoot=e}initialize(e,t){this.context=e,this.tree=t}getID(){return this.tree.getID()}buildRoot(e){if(!this.initialRoot)return Ee.create(ue.of(e.issueTimeTicket(),0),Ih);const t=Ee.create(ue.of(e.issueTimeTicket(),0),this.initialRoot.type);for(const r of this.initialRoot.children)si(r,t,e);return t}getSize(){if(!this.context||!this.tree)throw new Error("it is not initialized yet");return this.tree.getSize()}getNodeSize(){if(!this.context||!this.tree)throw new Error("it is not initialized yet");return this.tree.getNodeSize()}getIndexTree(){if(!this.context||!this.tree)throw new Error("it is not initialized yet");return this.tree.getIndexTree()}styleByPath(e,t){if(!this.context||!this.tree)throw new Error("it is not initialized yet");if(!e.length)throw new Error("path should not be empty");const[r,s]=this.tree.pathToPosRange(e),i=this.context.issueTimeTicket(),o=t?Yn(t):void 0,[a]=this.tree.style([r,s],o,i);this.context.push(Zt.create(this.tree.getCreatedAt(),r,s,a,o?new Map(Object.entries(o)):new Map,i))}style(e,t,r){if(!this.context||!this.tree)throw new Error("it is not initialized yet");if(e>t)throw new Error("from should be less than or equal to to");const s=this.tree.findPos(e),i=this.tree.findPos(t),o=this.context.issueTimeTicket(),a=r?Yn(r):void 0,[c,u]=this.tree.style([s,i],a,o);for(const l of u)this.context.registerGCPair(l);this.context.push(Zt.create(this.tree.getCreatedAt(),s,i,c,a?new Map(Object.entries(a)):new Map,o))}removeStyle(e,t,r){if(!this.context||!this.tree)throw new Error("it is not initialized yet");if(e>t)throw new Error("from should be less than or equal to to");const s=this.tree.findPos(e),i=this.tree.findPos(t),o=this.context.issueTimeTicket(),[a,c]=this.tree.removeStyle([s,i],r,o);for(const u of c)this.context.registerGCPair(u);this.context.push(Zt.createTreeRemoveStyleOperation(this.tree.getCreatedAt(),s,i,a,r,o))}editInternal(e,t,r,s=0){var i;if(r.length!==0&&r[0]&&(cc(r),r[0].type!==Ht))for(const l of r){const{children:y=[]}=l;cc(y)}const o=this.context.getLastTimeTicket();let a=new Array;if(((i=r[0])==null?void 0:i.type)===Ht){let l="";for(const y of r){const{value:f}=y;l+=f}a.push(Ee.create(ue.of(this.context.issueTimeTicket(),0),Ht,l))}else a=r.map(l=>l&&If(this.context,l)).filter(l=>l);const[,c,u]=this.tree.edit([e,t],a.length?a.map(l=>l==null?void 0:l.deepcopy()):void 0,s,o,()=>this.context.issueTimeTicket());for(const l of c)this.context.registerGCPair(l);return this.context.push(Ar.create(this.tree.getCreatedAt(),e,t,a.length?a:void 0,s,u,o)),!0}editByPath(e,t,r,s=0){if(!this.context||!this.tree)throw new Error("it is not initialized yet");if(e.length!==t.length)throw new Error("path length should be equal");if(!e.length||!t.length)throw new Error("path should not be empty");const i=this.tree.pathToPos(e),o=this.tree.pathToPos(t);return this.editInternal(i,o,r?[r]:[],s)}editBulkByPath(e,t,r,s=0){if(!this.context||!this.tree)throw new Error("it is not initialized yet");if(e.length!==t.length)throw new Error("path length should be equal");if(!e.length||!t.length)throw new Error("path should not be empty");const i=this.tree.pathToPos(e),o=this.tree.pathToPos(t);return this.editInternal(i,o,r,s)}edit(e,t,r,s=0){if(!this.context||!this.tree)throw new Error("it is not initialized yet");if(e>t)throw new Error("from should be less than or equal to to");const i=this.tree.findPos(e),o=this.tree.findPos(t);return this.editInternal(i,o,r?[r]:[],s)}editBulk(e,t,r,s=0){if(!this.context||!this.tree)throw new Error("it is not initialized yet");if(e>t)throw new Error("from should be less than or equal to to");const i=this.tree.findPos(e),o=this.tree.findPos(t);return this.editInternal(i,o,r,s)}toXML(){if(!this.context||!this.tree)throw new Error("it is not initialized yet");return this.tree.toXML()}toJSON(){if(!this.context||!this.tree)throw new Error("it is not initialized yet");return this.tree.toJSON()}toJSForTest(){if(!this.context||!this.tree)throw new Error("it is not initialized yet");return this.tree.toJSForTest()}toJSInfoForTest(){if(!this.context||!this.tree)throw new Error("it is not initialized yet");return this.tree.toJSInfoForTest()}getRootTreeNode(){if(!this.context||!this.tree)throw new Error("it is not initialized yet");return this.tree.getRootTreeNode()}indexToPath(e){if(!this.context||!this.tree)throw new Error("it is not initialized yet");return this.tree.indexToPath(e)}pathToIndex(e){if(!this.context||!this.tree)throw new Error("it is not initialized yet");return this.tree.pathToIndex(e)}pathRangeToPosRange(e){if(!this.context||!this.tree){v.fatal("it is not initialized yet");return}const t=[this.tree.pathToIndex(e[0]),this.tree.pathToIndex(e[1])],r=this.tree.indexRangeToPosRange(t);return[r[0].toStruct(),r[1].toStruct()]}indexRangeToPosRange(e){if(!this.context||!this.tree){v.fatal("it is not initialized yet");return}return this.tree.indexRangeToPosStructRange(e)}posRangeToIndexRange(e){if(!this.context||!this.tree){v.fatal("it is not initialized yet");return}const t=[tt.fromStruct(e[0]),tt.fromStruct(e[1])];return this.tree.posRangeToIndexRange(t)}posRangeToPathRange(e){if(!this.context||!this.tree){v.fatal("it is not initialized yet");return}const t=[tt.fromStruct(e[0]),tt.fromStruct(e[1])];return this.tree.posRangeToPathRange(t)}}function uc(n,e){return oc(n,e)}function hn(n,e){if(e){if(e instanceof W)return e;if(e instanceof ve)return oc(n,e);if(e instanceof Ne)return wf(n,e);if(e instanceof Ye)return new Dr(n,e);if(e instanceof Ie){const t=new Cr($t.IntegerCnt,0);return t.initialize(n,e),t}else if(e instanceof Ke){const t=new Rr;return t.initialize(n,e),t}}else return;throw new TypeError(`Unsupported type of element: ${typeof e}`)}function In(n,e){const t=hn(n,e);return t instanceof W?t.getValue():t}function gs(n,e,t){let r;if(W.isSupport(e))r=W.of(e,t);else if(Array.isArray(e))r=Ne.create(t,Q.buildArrayElements(n,e));else if(typeof e=="object")e instanceof Dr?(r=Ye.create(zn.create(),t),e.initialize(n,r)):e instanceof Cr?(r=Ie.create(e.getValueType(),e.getValue(),t),e.initialize(n,r)):e instanceof Rr?(r=Ke.create(e.buildRoot(n),t),e.initialize(n,r)):r=ve.create(t,xr.buildObjectMembers(n,e));else throw new TypeError(`Unsupported type of value: ${typeof e}`);return r}const lc=50;class kf{constructor(){h(this,"undoStack",[]),h(this,"redoStack",[])}hasUndo(){return this.undoStack.length>0}hasRedo(){return this.redoStack.length>0}pushUndo(e){this.undoStack.length>=lc&&this.undoStack.shift(),this.undoStack.push(e)}popUndo(){return this.undoStack.pop()}pushRedo(e){this.redoStack.length>=lc&&this.redoStack.shift(),this.redoStack.push(e)}popRedo(){return this.redoStack.pop()}clearRedo(){this.redoStack=[]}getUndoStackForTest(){return this.undoStack}getRedoStackForTest(){return this.redoStack}}const hc="yorkie-devtools-panel",fc="yorkie-devtools-sdk";let Zn="disconnected";const dc=new Map,ps=new Map;typeof window<"u"&&(window.transactionEventsByDocKey=ps);function ys(n,e){!((e==null?void 0:e.force)||Zn!=="disconnected")||window.postMessage({source:fc,...n},"*")}function Af(n){if(!n.isEnableDevtools()||typeof window>"u"||dc.has(n.getKey()))return;ps.set(n.getKey(),[]);const e=n.subscribe("all",t=>{t.some(r=>r.type!==ge.StatusChanged&&r.type!==ge.Snapshot&&r.type!==ge.LocalChange&&r.type!==ge.RemoteChange&&r.type!==ge.Initialized&&r.type!==ge.Watched&&r.type!==ge.Unwatched&&r.type!==ge.PresenceChanged)||(ps.get(n.getKey()).push(t),Zn==="synced"&&ys({msg:"doc::sync::partial",docKey:n.getKey(),event:t}))});dc.set(n.getKey(),[e]),ys({msg:"refresh-devtools"},{force:!0}),window.addEventListener("message",t=>{var r;if(((r=t.data)==null?void 0:r.source)!==hc)return;switch(t.data.msg){case"devtools::connect":if(Zn!=="disconnected")break;Zn="connected",ys({msg:"doc::available",docKey:n.getKey()}),v.info(`[YD] Devtools connected. Doc: ${n.getKey()}`);break;case"devtools::disconnect":Zn="disconnected",v.info(`[YD] Devtools disconnected. Doc: ${n.getKey()}`);break;case"devtools::subscribe":Zn="synced",ys({msg:"doc::sync::full",docKey:n.getKey(),events:ps.get(n.getKey())}),v.info(`[YD] Devtools subscribed. Doc: ${n.getKey()}`);break}})}var fn=(n=>(n.Detached="detached",n.Attached="attached",n.Removed="removed",n))(fn||{}),ge=(n=>(n.StatusChanged="status-changed",n.ConnectionChanged="connection-changed",n.SyncStatusChanged="sync-status-changed",n.Snapshot="snapshot",n.LocalChange="local-change",n.RemoteChange="remote-change",n.Initialized="initialized",n.Watched="watched",n.Unwatched="unwatched",n.PresenceChanged="presence-changed",n))(ge||{}),Ts=(n=>(n.Connected="connected",n.Disconnected="disconnected",n))(Ts||{}),vs=(n=>(n.Synced="synced",n.SyncFailed="sync-failed",n))(vs||{});class ii{constructor(e,t){h(this,"key"),h(this,"status"),h(this,"opts"),h(this,"changeID"),h(this,"checkpoint"),h(this,"localChanges"),h(this,"root"),h(this,"clone"),h(this,"eventStream"),h(this,"eventStreamObserver"),h(this,"onlineClients"),h(this,"presences"),h(this,"history"),h(this,"internalHistory"),h(this,"isUpdating"),this.opts=t||{},this.key=e,this.status="detached",this.root=Pr.create(),this.changeID=Ch,this.checkpoint=Rh,this.localChanges=[],this.eventStream=bf(r=>{this.eventStreamObserver=r}),this.onlineClients=new Set,this.presences=new Map,this.isUpdating=!1,this.internalHistory=new kf,this.history={canUndo:this.canUndo.bind(this),canRedo:this.canRedo.bind(this),undo:this.undo.bind(this),redo:this.redo.bind(this)},Af(this)}update(e,t){if(this.getStatus()==="removed")throw new F(U.DocumentRemoved,`${this.key} is removed`);this.ensureClone();const r=this.changeID.getActorID(),s=Hn.create(this.changeID.next(),this.clone.root,this.clone.presences.get(r)||{},t);try{const i=uc(s,this.clone.root.getObject());this.presences.has(r)||this.clone.presences.set(r,{}),this.isUpdating=!0,e(i,new Vs(s,this.clone.presences.get(r)))}catch(i){throw this.clone=void 0,v.error(i),i}finally{this.isUpdating=!1}if(s.hasChange()){v.isEnabled(we.Trivial)&&v.trivial(`trying to update a local change: ${this.toJSON()}`);const i=s.getChange(),{opInfos:o,reverseOps:a}=i.execute(this.root,this.presences,Y.Local),c=s.getReversePresence();c&&a.push({type:"presence",value:c}),this.localChanges.push(i),a.length>0&&this.internalHistory.pushUndo(a),o.length>0&&this.internalHistory.clearRedo(),this.changeID=i.getID();const u=[];o.length>0&&u.push({type:"local-change",source:Y.Local,value:{message:i.getMessage()||"",operations:o,actor:r,clientSeq:i.getID().getClientSeq(),serverSeq:i.getID().getServerSeq()},rawChange:this.isEnableDevtools()?i.toStruct():void 0}),i.hasPresenceChange()&&u.push({type:"presence-changed",source:Y.Local,value:{clientID:r,presence:this.getPresence(r)}}),this.publish(u),v.isEnabled(we.Trivial)&&v.trivial(`after update a local change: ${this.toJSON()}`)}}subscribe(e,t,r,s){if(typeof e=="string"){if(typeof t!="function")throw new Error("Second argument must be a callback function");if(e==="presence"){const a=t;return this.eventStream.subscribe(c=>{for(const u of c)u.type!=="initialized"&&u.type!=="watched"&&u.type!=="unwatched"&&u.type!=="presence-changed"||a(u)},r,s)}if(e==="my-presence"){const a=t;return this.eventStream.subscribe(c=>{for(const u of c)u.type!=="initialized"&&u.type!=="presence-changed"||u.type==="presence-changed"&&u.value.clientID!==this.changeID.getActorID()||a(u)},r,s)}if(e==="others"){const a=t;return this.eventStream.subscribe(c=>{for(const u of c)u.type!=="watched"&&u.type!=="unwatched"&&u.type!=="presence-changed"||u.value.clientID!==this.changeID.getActorID()&&a(u)},r,s)}if(e==="connection"){const a=t;return this.eventStream.subscribe(c=>{for(const u of c)u.type==="connection-changed"&&a(u)},r,s)}if(e==="sync"){const a=t;return this.eventStream.subscribe(c=>{for(const u of c)u.type==="sync-status-changed"&&a(u)},r,s)}if(e==="all"){const a=t;return this.eventStream.subscribe(a,r,s)}const i=e,o=t;return this.eventStream.subscribe(a=>{for(const c of a){if(c.type!=="local-change"&&c.type!=="remote-change")continue;const u=[];for(const l of c.value.operations)this.isSameElementOrChildOf(l.path,i)&&u.push(l);u.length&&o({...c,value:{...c.value,operations:u}})}},r,s)}if(typeof e=="function"){const i=e,o=t,a=r;return this.eventStream.subscribe(c=>{for(const u of c)u.type!=="snapshot"&&u.type!=="local-change"&&u.type!=="remote-change"||i(u)},o,a)}throw new Error(`"${e}" is not a valid`)}publish(e){this.eventStreamObserver&&this.eventStreamObserver.next(e)}isSameElementOrChildOf(e,t){if(t===e)return!0;const r=e.split(".");return t.split(".").every((i,o)=>i===r[o])}applyChangePack(e){for(e.hasSnapshot()?this.applySnapshot(e.getCheckpoint().getServerSeq(),e.getSnapshot()):e.hasChanges()&&this.applyChanges(e.getChanges(),Y.Remote);this.localChanges.length&&!(this.localChanges[0].getID().getClientSeq()>e.getCheckpoint().getClientSeq());)this.localChanges.shift();this.checkpoint=this.checkpoint.forward(e.getCheckpoint()),this.garbageCollect(e.getMinSyncedTicket()),e.getIsRemoved()&&this.applyStatus("removed"),v.isEnabled(we.Trivial)&&v.trivial(`${this.root.toJSON()}`)}getCheckpoint(){return this.checkpoint}getChangeID(){return this.changeID}hasLocalChanges(){return this.localChanges.length>0}ensureClone(){this.clone||(this.clone={root:this.root.deepcopy(),presences:Ze(this.presences)})}createChangePack(){const e=Array.from(this.localChanges),t=this.checkpoint.increaseClientSeq(e.length);return ls.create(this.key,t,!1,e)}setActor(e){for(const t of this.localChanges)t.setActor(e);this.changeID=this.changeID.setActor(e)}isEnableDevtools(){return!!this.opts.enableDevtools}getKey(){return this.key}getStatus(){return this.status}getCloneRoot(){if(!!this.clone)return this.clone.root.getObject()}getRoot(){this.ensureClone();const e=Hn.create(this.changeID.next(),this.clone.root,this.clone.presences.get(this.changeID.getActorID())||{});return uc(e,this.clone.root.getObject())}garbageCollect(e){return this.opts.disableGC?0:(this.clone&&this.clone.root.garbageCollect(e),this.root.garbageCollect(e))}getRootObject(){return this.root.getObject()}getGarbageLen(){return this.root.getGarbageLen()}getGarbageLenFromClone(){return this.clone.root.getGarbageLen()}toJSON(){return this.root.toJSON()}toSortedJSON(){return this.root.toSortedJSON()}toJSForTest(){return{...this.getRoot().toJSForTest(),key:"root"}}applySnapshot(e,t){const{root:r,presences:s}=ne.bytesToSnapshot(t);this.root=new Pr(r),this.presences=s,this.changeID=this.changeID.syncLamport(e),this.clone=void 0,this.publish([{type:"snapshot",source:Y.Remote,value:{snapshot:this.isEnableDevtools()?ne.bytesToHex(t):void 0,serverSeq:e.toString()}}])}applyChanges(e,t){v.isEnabled(we.Debug)&&v.debug(`trying to apply ${e.length} remote changes.elements:${this.root.getElementMapSize()}, removeds:${this.root.getGarbageElementSetSize()}`),v.isEnabled(we.Trivial)&&v.trivial(e.map(r=>`${r.getID().toTestString()}	${r.toTestString()}`).join(`
`));for(const r of e)this.applyChange(r,t);v.isEnabled(we.Debug)&&v.debug(`after appling ${e.length} remote changes.elements:${this.root.getElementMapSize()},  removeds:${this.root.getGarbageElementSetSize()}`)}applyChange(e,t){this.ensureClone(),e.execute(this.clone.root,this.clone.presences,t);const r=[],s=e.getID().getActorID();if(e.hasPresenceChange()&&this.onlineClients.has(s)){const o=e.getPresenceChange();switch(o.type){case sn.Put:r.push(this.presences.has(s)?{type:"presence-changed",source:t,value:{clientID:s,presence:o.presence}}:{type:"watched",source:Y.Remote,value:{clientID:s,presence:o.presence}});break;case sn.Clear:r.push({type:"unwatched",source:Y.Remote,value:{clientID:s,presence:this.getPresence(s)}}),this.removeOnlineClient(s);break}}const{opInfos:i}=e.execute(this.root,this.presences,t);if(this.changeID=this.changeID.syncLamport(e.getID().getLamport()),i.length>0){const o=this.isEnableDevtools()?e.toStruct():void 0;r.push(t===Y.Remote?{type:"remote-change",source:t,value:{actor:s,clientSeq:e.getID().getClientSeq(),serverSeq:e.getID().getServerSeq(),message:e.getMessage()||"",operations:i},rawChange:o}:{type:"local-change",source:t,value:{actor:s,clientSeq:e.getID().getClientSeq(),serverSeq:e.getID().getServerSeq(),message:e.getMessage()||"",operations:i},rawChange:o})}r.length>0&&this.publish(r)}applyWatchStream(e){if(e.body.case==="initialization"){const t=e.body.value.clientIds,r=new Set;for(const s of t)s!==this.changeID.getActorID()&&r.add(s);this.setOnlineClients(r),this.publish([{type:"initialized",source:Y.Local,value:this.getPresences()}]);return}if(e.body.case==="event"){const{type:t,publisher:r}=e.body.value,s=[];if(t===ss.DOCUMENT_WATCHED)this.addOnlineClient(r),this.hasPresence(r)&&s.push({type:"watched",source:Y.Remote,value:{clientID:r,presence:this.getPresence(r)}});else if(t===ss.DOCUMENT_UNWATCHED){const i=this.getPresence(r);this.removeOnlineClient(r),i&&s.push({type:"unwatched",source:Y.Remote,value:{clientID:r,presence:i}})}s.length>0&&this.publish(s)}}applyStatus(e){this.status=e,e==="detached"&&this.setActor(as),this.publish([{source:e==="removed"?Y.Remote:Y.Local,type:"status-changed",value:e==="attached"?{status:e,actorID:this.changeID.getActorID()}:{status:e}}])}applyDocEvent(e){if(e.type==="status-changed"){this.applyStatus(e.value.status),e.value.status==="attached"&&this.setActor(e.value.actorID);return}if(e.type==="snapshot"){const{snapshot:t,serverSeq:r}=e.value;if(!t)return;this.applySnapshot(x.fromString(r),ne.hexToBytes(t));return}if(e.type==="local-change"||e.type==="remote-change"){if(!e.rawChange)return;const t=En.fromStruct(e.rawChange);this.applyChange(t,e.source)}if(e.type==="initialized"){const t=new Set;for(const{clientID:r,presence:s}of e.value)t.add(r),this.presences.set(r,s);this.setOnlineClients(t);return}if(e.type==="watched"){const{clientID:t,presence:r}=e.value;this.addOnlineClient(t),this.presences.set(t,r);return}if(e.type==="unwatched"){const{clientID:t}=e.value;this.removeOnlineClient(t),this.presences.delete(t)}if(e.type==="presence-changed"){const{clientID:t,presence:r}=e.value;this.presences.set(t,r)}}applyTransactionEvent(e){for(const t of e)this.applyDocEvent(t)}getValueByPath(e){if(!e.startsWith("$"))throw new F(U.InvalidArgument,'path must start with "$"');const t=e.split(".");t.shift();let r=this.getRoot();for(const s of t)if(r=r[s],r===void 0)return;return r}setOnlineClients(e){this.onlineClients=e}resetOnlineClients(){this.onlineClients=new Set}addOnlineClient(e){this.onlineClients.add(e)}removeOnlineClient(e){this.onlineClients.delete(e)}hasPresence(e){return this.presences.has(e)}getMyPresence(){if(this.status!=="attached")return{};const e=this.presences.get(this.changeID.getActorID());return e?Ze(e):{}}getPresence(e){if(e===this.changeID.getActorID())return this.getMyPresence();if(!this.onlineClients.has(e))return;const t=this.presences.get(e);return t?Ze(t):void 0}getPresenceForTest(e){const t=this.presences.get(e);return t?Ze(t):void 0}getPresences(){const e=[];e.push({clientID:this.changeID.getActorID(),presence:Ze(this.getMyPresence())});for(const t of this.onlineClients)this.presences.has(t)&&e.push({clientID:t,presence:Ze(this.presences.get(t))});return e}getSelfForTest(){return{clientID:this.getChangeID().getActorID(),presence:this.getMyPresence()}}getOthersForTest(){const e=this.getChangeID().getActorID();return this.getPresences().filter(t=>t.clientID!==e).sort((t,r)=>t.clientID>r.clientID?1:-1)}canUndo(){return this.internalHistory.hasUndo()&&!this.isUpdating}canRedo(){return this.internalHistory.hasRedo()&&!this.isUpdating}undo(){if(this.isUpdating)throw new Error("Undo is not allowed during an update");const e=this.internalHistory.popUndo();if(e===void 0)throw new Error("There is no operation to be undone");this.ensureClone();const t=Hn.create(this.changeID.next(),this.clone.root,this.clone.presences.get(this.changeID.getActorID())||{});for(const u of e){if(!(u instanceof et)){new Vs(t,Ze(this.clone.presences.get(this.changeID.getActorID()))).set(u.value,{addToHistory:!0});continue}const l=t.issueTimeTicket();u.setExecutedAt(l),t.push(u)}const r=t.getChange();r.execute(this.clone.root,this.clone.presences,Y.UndoRedo);const{opInfos:s,reverseOps:i}=r.execute(this.root,this.presences,Y.UndoRedo),o=t.getReversePresence();if(o&&i.push({type:"presence",value:o}),i.length>0&&this.internalHistory.pushRedo(i),!r.hasPresenceChange()&&s.length===0)return;this.localChanges.push(r),this.changeID=r.getID();const a=this.changeID.getActorID(),c=[];s.length>0&&c.push({type:"local-change",source:Y.UndoRedo,value:{message:r.getMessage()||"",operations:s,actor:a,clientSeq:r.getID().getClientSeq(),serverSeq:r.getID().getServerSeq()},rawChange:this.isEnableDevtools()?r.toStruct():void 0}),r.hasPresenceChange()&&c.push({type:"presence-changed",source:Y.UndoRedo,value:{clientID:a,presence:this.getPresence(a)}}),this.publish(c)}redo(){if(this.isUpdating)throw new Error("Redo is not allowed during an update");const e=this.internalHistory.popRedo();if(e===void 0)throw new Error("There is no operation to be redone");this.ensureClone();const t=Hn.create(this.changeID.next(),this.clone.root,this.clone.presences.get(this.changeID.getActorID())||{});for(const u of e){if(!(u instanceof et)){new Vs(t,Ze(this.clone.presences.get(this.changeID.getActorID()))).set(u.value,{addToHistory:!0});continue}const l=t.issueTimeTicket();u.setExecutedAt(l),t.push(u)}const r=t.getChange();r.execute(this.clone.root,this.clone.presences,Y.UndoRedo);const{opInfos:s,reverseOps:i}=r.execute(this.root,this.presences,Y.UndoRedo),o=t.getReversePresence();if(o&&i.push({type:"presence",value:o}),i.length>0&&this.internalHistory.pushUndo(i),!r.hasPresenceChange()&&s.length===0)return;this.localChanges.push(r),this.changeID=r.getID();const a=this.changeID.getActorID(),c=[];s.length>0&&c.push({type:"local-change",source:Y.UndoRedo,value:{message:r.getMessage()||"",operations:s,actor:a,clientSeq:r.getID().getClientSeq(),serverSeq:r.getID().getServerSeq()},rawChange:this.isEnableDevtools()?r.toStruct():void 0}),r.hasPresenceChange()&&c.push({type:"presence-changed",source:Y.UndoRedo,value:{clientID:a,presence:this.getPresence(a)}}),this.publish(c)}getUndoStackForTest(){return this.internalHistory.getUndoStackForTest()}getRedoStackForTest(){return this.internalHistory.getRedoStackForTest()}}function _f(n,e){return t=>async r=>(n&&r.header.set("x-api-key",n),e&&r.header.set("authorization",e),await t(r))}const mc={name:"yorkie-js-sdk",version:"0.4.22",description:"Yorkie JS SDK",main:"./dist/yorkie-js-sdk.js",typings:"./dist/yorkie-js-sdk.d.ts",files:["dist"],scripts:{build:"tsc && vite build","build:proto":"npx buf generate","build:docs":"typedoc","build:examples":"npm run build --workspace examples","build:ghpages":"mkdir -p ghpages/examples && cp -r docs ghpages/api-reference && find examples -name 'dist' -type d -exec sh -c 'cp -r {} ghpages/examples/$(basename $(dirname {}))' \\;",dev:"vite build -c vite.preview.ts && vite preview",test:"vitest run","test:watch":"vitest","test:bench":"vitest bench","test:ci":"vitest run --coverage","test:yorkie.dev":"TEST_RPC_ADDR=https://api.yorkie.dev vitest run --coverage",lint:"eslint . --fix --max-warnings=0 --ext .ts",prepare:"npm run build"},engines:{node:">=18.0.0",npm:">=7.1.0"},repository:{type:"git",url:"git+https://github.com/yorkie-team/yorkie-js-sdk.git"},author:{name:"hackerwins",email:"susukang98@gmail.com"},license:"Apache-2.0",bugs:{url:"https://github.com/yorkie-team/yorkie-js-sdk/issues"},homepage:"https://github.com/yorkie-team/yorkie-js-sdk#readme",devDependencies:{"@bufbuild/buf":"^1.28.1","@bufbuild/protoc-gen-es":"^1.6.0","@connectrpc/protoc-gen-connect-es":"^1.2.0","@types/google-protobuf":"^3.15.5","@types/jsdom":"^21.1.3","@types/long":"^4.0.1","@typescript-eslint/eslint-plugin":"^5.30.6","@typescript-eslint/parser":"^5.30.6","@vitest/coverage-istanbul":"^0.34.5","@vitest/coverage-v8":"^0.34.5",eslint:"^8.19.0","eslint-plugin-jsdoc":"^39.3.3","eslint-plugin-prettier":"^4.2.1","eslint-plugin-tsdoc":"^0.2.16",husky:"^8.0.3",jsdom:"^22.1.0",prettier:"^2.7.1","ts-node":"^10.9.1",typedoc:"^0.25.13",typescript:"^4.7.4","typescript-transform-paths":"^3.3.1",vite:"^4.4.9","vite-plugin-commonjs":"^0.10.1","vite-plugin-dts":"^3.9.1","vite-tsconfig-paths":"^4.2.1",vitest:"^0.34.5","vitest-environment-custom-jsdom":"file:test/vitest/env"},dependencies:{"@bufbuild/protobuf":"^1.6.0","@connectrpc/connect":"^1.2.0","@connectrpc/connect-web":"^1.2.0",long:"^5.2.0"},husky:{hooks:{"pre-commit":"npm run lint"}},workspaces:["examples/*"]};function Of(){return n=>async e=>(e.header.set("x-yorkie-user-agent",mc.name+"/"+mc.version),await n(e))}var Jr=(n=>(n.Manual="manual",n.Realtime="realtime",n.RealtimePushOnly="realtime-pushonly",n.RealtimeSyncOff="realtime-syncoff",n))(Jr||{}),gc=(n=>(n.Deactivated="deactivated",n.Activated="activated",n))(gc||{});const Ss={syncLoopDuration:50,retrySyncLoopDelay:1e3,reconnectStreamDelay:1e3};class oi{constructor(e,t){h(this,"id"),h(this,"key"),h(this,"status"),h(this,"attachmentMap"),h(this,"apiKey"),h(this,"syncLoopDuration"),h(this,"reconnectStreamDelay"),h(this,"retrySyncLoopDelay"),h(this,"rpcClient"),t=t||Ss,this.key=t.key?t.key:ic(),this.status="deactivated",this.attachmentMap=new Map,this.apiKey=t.apiKey||"",this.syncLoopDuration=t.syncLoopDuration||Ss.syncLoopDuration,this.reconnectStreamDelay=t.reconnectStreamDelay||Ss.reconnectStreamDelay,this.retrySyncLoopDelay=t.retrySyncLoopDelay||Ss.retrySyncLoopDelay,this.rpcClient=Ru(Th,rl({baseUrl:e,interceptors:[_f(t.apiKey,t.token),Of()]}))}activate(){return this.isActive()?Promise.resolve():this.rpcClient.activateClient({clientKey:this.key},{headers:{"x-shard-key":this.apiKey}}).then(e=>{this.id=e.clientId,this.status="activated",this.runSyncLoop(),v.info(`[AC] c:"${this.getKey()}" activated, id:"${this.id}"`)}).catch(e=>{throw v.error(`[AC] c:"${this.getKey()}" err :`,e),e})}deactivate(){if(this.status==="deactivated")return Promise.resolve();for(const[e]of this.attachmentMap)this.detachInternal(e);return this.rpcClient.deactivateClient({clientId:this.id},{headers:{"x-shard-key":this.apiKey}}).then(()=>{this.status="deactivated",v.info(`[DC] c"${this.getKey()}" deactivated`)}).catch(e=>{throw v.error(`[DC] c:"${this.getKey()}" err :`,e),e})}attach(e,t={}){var s;if(!this.isActive())throw new F(U.ClientNotActive,`${this.key} is not active`);if(e.getStatus()!==fn.Detached)throw new F(U.DocumentNotDetached,`${e.getKey()} is not detached`);e.setActor(this.id),e.update((i,o)=>o.set(t.initialPresence||{}));const r=(s=t.syncMode)!=null?s:"realtime";return this.rpcClient.attachDocument({clientId:this.id,changePack:ne.toChangePack(e.createChangePack())},{headers:{"x-shard-key":`${this.apiKey}/${e.getKey()}`}}).then(async i=>{const o=ne.fromChangePack(i.changePack);return e.applyChangePack(o),e.getStatus()===fn.Removed||(e.applyStatus(fn.Attached),this.attachmentMap.set(e.getKey(),new vf(this.reconnectStreamDelay,e,i.documentId,r)),r!=="manual"&&await this.runWatchLoop(e.getKey()),v.info(`[AD] c:"${this.getKey()}" attaches d:"${e.getKey()}"`)),e}).catch(i=>{throw v.error(`[AD] c:"${this.getKey()}" err :`,i),i})}detach(e,t={}){var s;if(!this.isActive())throw new F(U.ClientNotActive,`${this.key} is not active`);const r=this.attachmentMap.get(e.getKey());if(!r)throw new F(U.DocumentNotAttached,`${e.getKey()} is not attached`);return e.update((i,o)=>o.clear()),this.rpcClient.detachDocument({clientId:this.id,documentId:r.docID,changePack:ne.toChangePack(e.createChangePack()),removeIfNotAttached:(s=t.removeIfNotAttached)!=null?s:!1},{headers:{"x-shard-key":`${this.apiKey}/${e.getKey()}`}}).then(i=>{const o=ne.fromChangePack(i.changePack);return e.applyChangePack(o),e.getStatus()!==fn.Removed&&e.applyStatus(fn.Detached),this.detachInternal(e.getKey()),v.info(`[DD] c:"${this.getKey()}" detaches d:"${e.getKey()}"`),e}).catch(i=>{throw v.error(`[DD] c:"${this.getKey()}" err :`,i),i})}async changeSyncMode(e,t){if(!this.isActive())throw new F(U.ClientNotActive,`${this.key} is not active`);const r=this.attachmentMap.get(e.getKey());if(!r)throw new F(U.DocumentNotAttached,`${e.getKey()} is not attached`);const s=r.syncMode;return s===t?e:(r.changeSyncMode(t),t==="manual"?(r.cancelWatchStream(),e):(t==="realtime"&&(r.remoteChangeEventReceived=!0),s==="manual"&&await this.runWatchLoop(e.getKey()),e))}sync(e){if(!this.isActive())throw new F(U.ClientNotActive,`${this.key} is not active`);const t=[];if(e){const r=this.attachmentMap.get(e.getKey());if(!r)throw new F(U.DocumentNotAttached,`${e.getKey()} is not attached`);t.push(this.syncInternal(r,"realtime"))}else this.attachmentMap.forEach(r=>{t.push(this.syncInternal(r,r.syncMode))});return Promise.all(t)}remove(e){if(!this.isActive())throw new F(U.ClientNotActive,`${this.key} is not active`);const t=this.attachmentMap.get(e.getKey());if(!t)throw new F(U.DocumentNotAttached,`${e.getKey()} is not attached`);e.setActor(this.id);const r=ne.toChangePack(e.createChangePack());return r.isRemoved=!0,this.rpcClient.removeDocument({clientId:this.id,documentId:t.docID,changePack:r},{headers:{"x-shard-key":`${this.apiKey}/${e.getKey()}`}}).then(s=>{const i=ne.fromChangePack(s.changePack);e.applyChangePack(i),this.detachInternal(e.getKey()),v.info(`[RD] c:"${this.getKey()}" removes d:"${e.getKey()}"`)}).catch(s=>{throw v.error(`[RD] c:"${this.getKey()}" err :`,s),s})}getID(){return this.id}getKey(){return this.key}isActive(){return this.status==="activated"}getStatus(){return this.status}runSyncLoop(){const e=()=>{if(!this.isActive()){v.debug(`[SL] c:"${this.getKey()}" exit sync loop`);return}const t=[];for(const[,r]of this.attachmentMap)r.needRealtimeSync()&&(r.remoteChangeEventReceived=!1,t.push(this.syncInternal(r,r.syncMode)));Promise.all(t).then(()=>setTimeout(e,this.syncLoopDuration)).catch(r=>{v.error(`[SL] c:"${this.getKey()}" sync failed:`,r),setTimeout(e,this.retrySyncLoopDelay)})};v.debug(`[SL] c:"${this.getKey()}" run sync loop`),e()}async runWatchLoop(e){const t=this.attachmentMap.get(e);if(!t)throw new F(U.DocumentNotAttached,`${e} is not attached`);return t.runWatchLoop(r=>{if(!this.isActive())return Promise.reject(new F(U.ClientNotActive,`${this.key} is not active`));const s=new AbortController,i=this.rpcClient.watchDocument({clientId:this.id,documentId:t.docID},{headers:{"x-shard-key":`${this.apiKey}/${e}`},signal:s.signal});return t.doc.publish([{type:ge.ConnectionChanged,value:Ts.Connected}]),v.info(`[WD] c:"${this.getKey()}" watches d:"${e}"`),new Promise((o,a)=>{(async()=>{try{for await(const u of i)this.handleWatchDocumentsResponse(t,u),u.body.case==="initialization"&&o([i,s])}catch(u){t.doc.resetOnlineClients(),t.doc.publish([{type:ge.Initialized,source:Y.Local,value:t.doc.getPresences()}]),t.doc.publish([{type:ge.ConnectionChanged,value:Ts.Disconnected}]),v.debug(`[WD] c:"${this.getKey()}" unwatches`),u instanceof se&&u.code!=L.Canceled&&r(),a(u)}})()})})}handleWatchDocumentsResponse(e,t){if(t.body.case==="event"&&t.body.value.type===ss.DOCUMENT_CHANGED){e.remoteChangeEventReceived=!0;return}e.doc.applyWatchStream(t)}detachInternal(e){const t=this.attachmentMap.get(e);!t||(t.cancelWatchStream(),v.debug(`[WD] c:"${this.getKey()}" unwatches`),this.attachmentMap.delete(e))}syncInternal(e,t){const{doc:r,docID:s}=e,i=r.createChangePack();return this.rpcClient.pushPullChanges({clientId:this.id,documentId:s,changePack:ne.toChangePack(i),pushOnly:t==="realtime-pushonly"},{headers:{"x-shard-key":`${this.apiKey}/${r.getKey()}`}}).then(o=>{const a=ne.fromChangePack(o.changePack);if(a.hasChanges()&&(e.syncMode==="realtime-pushonly"||e.syncMode==="realtime-syncoff"))return r;r.applyChangePack(a),e.doc.publish([{type:ge.SyncStatusChanged,value:vs.Synced}]),r.getStatus()===fn.Removed&&this.detachInternal(r.getKey());const c=r.getKey(),u=a.getChangeSize();return v.info(`[PP] c:"${this.getKey()}" sync d:"${c}", push:${i.getChangeSize()} pull:${u} cp:${a.getCheckpoint().toTestString()}`),r}).catch(o=>{throw r.publish([{type:ge.SyncStatusChanged,value:vs.SyncFailed}]),v.error(`[PP] c:"${this.getKey()}" err :`,o),o})}}const Pf=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"})),xf={Client:oi,Document:ii,Primitive:W,Text:Dr,Counter:Cr,Tree:Rr,IntType:$t.IntegerCnt,LongType:$t.LongCnt};typeof globalThis<"u"&&(globalThis.yorkie={Client:oi,Document:ii,Primitive:W,Text:Dr,Counter:Cr,Tree:Rr,IntType:$t.IntegerCnt,LongType:$t.LongCnt}),M.Change=En,M.Client=oi,M.ClientStatus=gc,M.Counter=Cr,M.Devtools=Pf,M.DocEventType=ge,M.Document=ii,M.DocumentStatus=fn,M.DocumentSyncStatus=vs,M.EventSourceDevPanel=hc,M.EventSourceSDK=fc,M.OpSource=Y,M.Primitive=W,M.StreamConnectionStatus=Ts,M.SyncMode=Jr,M.Text=Dr,M.TimeTicket=me,M.Tree=Rr,M.converter=ne,M.default=xf,M.setLogLevel=Nh,Object.defineProperties(M,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})})(bs,bs.exports);const pc=Jf(bs.exports),yc=["Ali","Beatriz","Charles","Diya","Eric","Fatima","Gabriel","Hanna","Johnson","Perry","Parker","Kelly"],Bf=()=>{const H=Math.floor(Math.random()*yc.length);return yc[H]},Tc=["red","yellow","orange","green","blue","purple"],Lf=()=>{const H=Math.floor(Math.random()*Tc.length);return Tc[H]};async function Mf(){const H=new pc.Client("https://api.yorkie.dev",{apiKey:"cedaovjuioqlk4pjqn6g"});await H.activate();const he=new pc.Document("profile-stack",{enableDevtools:!0});he.subscribe("presence",M=>{M.type!==bs.exports.DocEventType.PresenceChanged&&Uf(he.getPresences(),H.getID())}),await H.attach(he,{initialPresence:{name:Bf(),color:Lf()}}),window.addEventListener("beforeunload",()=>{H.deactivate()})}const ai=4,ci=(H,he,M)=>{const pe=document.createElement("div");return pe.className="peer",M==="main"?pe.innerHTML=`
    <div class="profile">
      <img src="./images/profile-${he}.svg" alt="profile" class="profile-img"/>
    </div>
    <div class="name speech-bubbles">${H}</div>
  `:M==="more"&&(pe.innerHTML=`
    <img src="./images/profile-${he}.svg" alt="profile" class="profile-img"/>
    <span class="name">${H}</span>
  `),pe},Uf=(H,he)=>{const M=H.filter(({clientID:ke,presence:On})=>ke!==he&&On.name&&On.color),pe=M.length+1,re=pe>ai,h=document.getElementById("peerList");h.innerHTML="";const L=document.createElement("div");L.className="peer-more-list speech-bubbles";const k=H.find(({clientID:ke})=>ke===he).presence,Mr=ci(`${k.name} (me)`,k.color,"main");if(Mr.classList.add("me"),h.appendChild(Mr),M.forEach((ke,On)=>{const{name:Ur,color:$r}=ke.presence;if(On<ai-1){const Qn=ci(Ur,$r,"main");h.appendChild(Qn);return}const Pn=ci(Ur,$r,"more");L.appendChild(Pn)}),re){const ke=document.createElement("div");ke.className="peer more",ke.innerHTML=`
      <div class="profile">
      +${pe-ai}
      </div>
    `,ke.appendChild(L),h.appendChild(ke)}};Mf();
