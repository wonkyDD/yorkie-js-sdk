(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const d of document.querySelectorAll('link[rel="modulepreload"]'))h(d);new MutationObserver(d=>{for(const u of d)if(u.type==="childList")for(const p of u.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&h(p)}).observe(document,{childList:!0,subtree:!0});function l(d){const u={};return d.integrity&&(u.integrity=d.integrity),d.referrerpolicy&&(u.referrerPolicy=d.referrerpolicy),d.crossorigin==="use-credentials"?u.credentials="include":d.crossorigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function h(d){if(d.ep)return;d.ep=!0;const u=l(d);fetch(d.href,u)}})();function ao(i,o){const l=Object.create(null),h=i.split(",");for(let d=0;d<h.length;d++)l[h[d]]=!0;return o?d=>!!l[d.toLowerCase()]:d=>!!l[d]}const Te={},vr=[],Ot=()=>{},Mf=()=>!1,Bf=/^on[^a-z]/,ei=i=>Bf.test(i),co=i=>i.startsWith("onUpdate:"),je=Object.assign,lo=(i,o)=>{const l=i.indexOf(o);l>-1&&i.splice(l,1)},Lf=Object.prototype.hasOwnProperty,ce=(i,o)=>Lf.call(i,o),Z=Array.isArray,Tr=i=>ti(i)==="[object Map]",il=i=>ti(i)==="[object Set]",re=i=>typeof i=="function",$e=i=>typeof i=="string",uo=i=>typeof i=="symbol",Ce=i=>i!==null&&typeof i=="object",ol=i=>Ce(i)&&re(i.then)&&re(i.catch),al=Object.prototype.toString,ti=i=>al.call(i),$f=i=>ti(i).slice(8,-1),cl=i=>ti(i)==="[object Object]",ho=i=>$e(i)&&i!=="NaN"&&i[0]!=="-"&&""+parseInt(i,10)===i,Ks=ao(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),ni=i=>{const o=Object.create(null);return l=>o[l]||(o[l]=i(l))},Ff=/-(\w)/g,Ar=ni(i=>i.replace(Ff,(o,l)=>l?l.toUpperCase():"")),Uf=/\B([A-Z])/g,er=ni(i=>i.replace(Uf,"-$1").toLowerCase()),ll=ni(i=>i.charAt(0).toUpperCase()+i.slice(1)),Fi=ni(i=>i?`on${ll(i)}`:""),Gs=(i,o)=>!Object.is(i,o),Vs=(i,o)=>{for(let l=0;l<i.length;l++)i[l](o)},Ys=(i,o,l)=>{Object.defineProperty(i,o,{configurable:!0,enumerable:!1,value:l})},zi=i=>{const o=parseFloat(i);return isNaN(o)?i:o};let Ic;const Wi=()=>Ic||(Ic=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function fo(i){if(Z(i)){const o={};for(let l=0;l<i.length;l++){const h=i[l],d=$e(h)?Kf(h):fo(h);if(d)for(const u in d)o[u]=d[u]}return o}else{if($e(i))return i;if(Ce(i))return i}}const Jf=/;(?![^(]*\))/g,jf=/:([^]+)/,qf=/\/\*[^]*?\*\//g;function Kf(i){const o={};return i.replace(qf,"").split(Jf).forEach(l=>{if(l){const h=l.split(jf);h.length>1&&(o[h[0].trim()]=h[1].trim())}}),o}function go(i){let o="";if($e(i))o=i;else if(Z(i))for(let l=0;l<i.length;l++){const h=go(i[l]);h&&(o+=h+" ")}else if(Ce(i))for(const l in i)i[l]&&(o+=l+" ");return o.trim()}const Vf="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",zf=ao(Vf);function ul(i){return!!i||i===""}const kc=i=>$e(i)?i:i==null?"":Z(i)||Ce(i)&&(i.toString===al||!re(i.toString))?JSON.stringify(i,hl,2):String(i),hl=(i,o)=>o&&o.__v_isRef?hl(i,o.value):Tr(o)?{[`Map(${o.size})`]:[...o.entries()].reduce((l,[h,d])=>(l[`${h} =>`]=d,l),{})}:il(o)?{[`Set(${o.size})`]:[...o.values()]}:Ce(o)&&!Z(o)&&!cl(o)?String(o):o;let Et;class Wf{constructor(o=!1){this.detached=o,this._active=!0,this.effects=[],this.cleanups=[],this.parent=Et,!o&&Et&&(this.index=(Et.scopes||(Et.scopes=[])).push(this)-1)}get active(){return this._active}run(o){if(this._active){const l=Et;try{return Et=this,o()}finally{Et=l}}}on(){Et=this}off(){Et=this.parent}stop(o){if(this._active){let l,h;for(l=0,h=this.effects.length;l<h;l++)this.effects[l].stop();for(l=0,h=this.cleanups.length;l<h;l++)this.cleanups[l]();if(this.scopes)for(l=0,h=this.scopes.length;l<h;l++)this.scopes[l].stop(!0);if(!this.detached&&this.parent&&!o){const d=this.parent.scopes.pop();d&&d!==this&&(this.parent.scopes[this.index]=d,d.index=this.index)}this.parent=void 0,this._active=!1}}}function Hf(i,o=Et){o&&o.active&&o.effects.push(i)}function Gf(){return Et}const po=i=>{const o=new Set(i);return o.w=0,o.n=0,o},fl=i=>(i.w&Dn)>0,dl=i=>(i.n&Dn)>0,Yf=({deps:i})=>{if(i.length)for(let o=0;o<i.length;o++)i[o].w|=Dn},Xf=i=>{const{deps:o}=i;if(o.length){let l=0;for(let h=0;h<o.length;h++){const d=o[h];fl(d)&&!dl(d)?d.delete(i):o[l++]=d,d.w&=~Dn,d.n&=~Dn}o.length=l}},Hi=new WeakMap;let ts=0,Dn=1;const Gi=30;let Ct;const Xn=Symbol(""),Yi=Symbol("");class mo{constructor(o,l=null,h){this.fn=o,this.scheduler=l,this.active=!0,this.deps=[],this.parent=void 0,Hf(this,h)}run(){if(!this.active)return this.fn();let o=Ct,l=On;for(;o;){if(o===this)return;o=o.parent}try{return this.parent=Ct,Ct=this,On=!0,Dn=1<<++ts,ts<=Gi?Yf(this):Ec(this),this.fn()}finally{ts<=Gi&&Xf(this),Dn=1<<--ts,Ct=this.parent,On=l,this.parent=void 0,this.deferStop&&this.stop()}}stop(){Ct===this?this.deferStop=!0:this.active&&(Ec(this),this.onStop&&this.onStop(),this.active=!1)}}function Ec(i){const{deps:o}=i;if(o.length){for(let l=0;l<o.length;l++)o[l].delete(i);o.length=0}}let On=!0;const gl=[];function kr(){gl.push(On),On=!1}function Er(){const i=gl.pop();On=i===void 0?!0:i}function rt(i,o,l){if(On&&Ct){let h=Hi.get(i);h||Hi.set(i,h=new Map);let d=h.get(l);d||h.set(l,d=po()),pl(d)}}function pl(i,o){let l=!1;ts<=Gi?dl(i)||(i.n|=Dn,l=!fl(i)):l=!i.has(Ct),l&&(i.add(Ct),Ct.deps.push(i))}function pn(i,o,l,h,d,u){const p=Hi.get(i);if(!p)return;let T=[];if(o==="clear")T=[...p.values()];else if(l==="length"&&Z(i)){const v=Number(h);p.forEach((k,N)=>{(N==="length"||N>=v)&&T.push(k)})}else switch(l!==void 0&&T.push(p.get(l)),o){case"add":Z(i)?ho(l)&&T.push(p.get("length")):(T.push(p.get(Xn)),Tr(i)&&T.push(p.get(Yi)));break;case"delete":Z(i)||(T.push(p.get(Xn)),Tr(i)&&T.push(p.get(Yi)));break;case"set":Tr(i)&&T.push(p.get(Xn));break}if(T.length===1)T[0]&&Xi(T[0]);else{const v=[];for(const k of T)k&&v.push(...k);Xi(po(v))}}function Xi(i,o){const l=Z(i)?i:[...i];for(const h of l)h.computed&&Cc(h);for(const h of l)h.computed||Cc(h)}function Cc(i,o){(i!==Ct||i.allowRecurse)&&(i.scheduler?i.scheduler():i.run())}const Zf=ao("__proto__,__v_isRef,__isVue"),ml=new Set(Object.getOwnPropertyNames(Symbol).filter(i=>i!=="arguments"&&i!=="caller").map(i=>Symbol[i]).filter(uo)),Qf=yo(),ed=yo(!1,!0),td=yo(!0),Nc=nd();function nd(){const i={};return["includes","indexOf","lastIndexOf"].forEach(o=>{i[o]=function(...l){const h=ge(this);for(let u=0,p=this.length;u<p;u++)rt(h,"get",u+"");const d=h[o](...l);return d===-1||d===!1?h[o](...l.map(ge)):d}}),["push","pop","shift","unshift","splice"].forEach(o=>{i[o]=function(...l){kr();const h=ge(this)[o].apply(this,l);return Er(),h}}),i}function rd(i){const o=ge(this);return rt(o,"has",i),o.hasOwnProperty(i)}function yo(i=!1,o=!1){return function(h,d,u){if(d==="__v_isReactive")return!i;if(d==="__v_isReadonly")return i;if(d==="__v_isShallow")return o;if(d==="__v_raw"&&u===(i?o?Td:wl:o?bl:Tl).get(h))return h;const p=Z(h);if(!i){if(p&&ce(Nc,d))return Reflect.get(Nc,d,u);if(d==="hasOwnProperty")return rd}const T=Reflect.get(h,d,u);return(uo(d)?ml.has(d):Zf(d))||(i||rt(h,"get",d),o)?T:Qe(T)?p&&ho(d)?T:T.value:Ce(T)?i?Al(T):bo(T):T}}const sd=yl(),id=yl(!0);function yl(i=!1){return function(l,h,d,u){let p=l[h];if(is(p)&&Qe(p)&&!Qe(d))return!1;if(!i&&(!Zi(d)&&!is(d)&&(p=ge(p),d=ge(d)),!Z(l)&&Qe(p)&&!Qe(d)))return p.value=d,!0;const T=Z(l)&&ho(h)?Number(h)<l.length:ce(l,h),v=Reflect.set(l,h,d,u);return l===ge(u)&&(T?Gs(d,p)&&pn(l,"set",h,d):pn(l,"add",h,d)),v}}function od(i,o){const l=ce(i,o);i[o];const h=Reflect.deleteProperty(i,o);return h&&l&&pn(i,"delete",o,void 0),h}function ad(i,o){const l=Reflect.has(i,o);return(!uo(o)||!ml.has(o))&&rt(i,"has",o),l}function cd(i){return rt(i,"iterate",Z(i)?"length":Xn),Reflect.ownKeys(i)}const vl={get:Qf,set:sd,deleteProperty:od,has:ad,ownKeys:cd},ld={get:td,set(i,o){return!0},deleteProperty(i,o){return!0}},ud=je({},vl,{get:ed,set:id}),vo=i=>i,ri=i=>Reflect.getPrototypeOf(i);function Ls(i,o,l=!1,h=!1){i=i.__v_raw;const d=ge(i),u=ge(o);l||(o!==u&&rt(d,"get",o),rt(d,"get",u));const{has:p}=ri(d),T=h?vo:l?So:Ao;if(p.call(d,o))return T(i.get(o));if(p.call(d,u))return T(i.get(u));i!==d&&i.get(o)}function $s(i,o=!1){const l=this.__v_raw,h=ge(l),d=ge(i);return o||(i!==d&&rt(h,"has",i),rt(h,"has",d)),i===d?l.has(i):l.has(i)||l.has(d)}function Fs(i,o=!1){return i=i.__v_raw,!o&&rt(ge(i),"iterate",Xn),Reflect.get(i,"size",i)}function xc(i){i=ge(i);const o=ge(this);return ri(o).has.call(o,i)||(o.add(i),pn(o,"add",i,i)),this}function Oc(i,o){o=ge(o);const l=ge(this),{has:h,get:d}=ri(l);let u=h.call(l,i);u||(i=ge(i),u=h.call(l,i));const p=d.call(l,i);return l.set(i,o),u?Gs(o,p)&&pn(l,"set",i,o):pn(l,"add",i,o),this}function Pc(i){const o=ge(this),{has:l,get:h}=ri(o);let d=l.call(o,i);d||(i=ge(i),d=l.call(o,i)),h&&h.call(o,i);const u=o.delete(i);return d&&pn(o,"delete",i,void 0),u}function Dc(){const i=ge(this),o=i.size!==0,l=i.clear();return o&&pn(i,"clear",void 0,void 0),l}function Us(i,o){return function(h,d){const u=this,p=u.__v_raw,T=ge(p),v=o?vo:i?So:Ao;return!i&&rt(T,"iterate",Xn),p.forEach((k,N)=>h.call(d,v(k),v(N),u))}}function Js(i,o,l){return function(...h){const d=this.__v_raw,u=ge(d),p=Tr(u),T=i==="entries"||i===Symbol.iterator&&p,v=i==="keys"&&p,k=d[i](...h),N=l?vo:o?So:Ao;return!o&&rt(u,"iterate",v?Yi:Xn),{next(){const{value:U,done:j}=k.next();return j?{value:U,done:j}:{value:T?[N(U[0]),N(U[1])]:N(U),done:j}},[Symbol.iterator](){return this}}}}function Cn(i){return function(...o){return i==="delete"?!1:this}}function hd(){const i={get(u){return Ls(this,u)},get size(){return Fs(this)},has:$s,add:xc,set:Oc,delete:Pc,clear:Dc,forEach:Us(!1,!1)},o={get(u){return Ls(this,u,!1,!0)},get size(){return Fs(this)},has:$s,add:xc,set:Oc,delete:Pc,clear:Dc,forEach:Us(!1,!0)},l={get(u){return Ls(this,u,!0)},get size(){return Fs(this,!0)},has(u){return $s.call(this,u,!0)},add:Cn("add"),set:Cn("set"),delete:Cn("delete"),clear:Cn("clear"),forEach:Us(!0,!1)},h={get(u){return Ls(this,u,!0,!0)},get size(){return Fs(this,!0)},has(u){return $s.call(this,u,!0)},add:Cn("add"),set:Cn("set"),delete:Cn("delete"),clear:Cn("clear"),forEach:Us(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(u=>{i[u]=Js(u,!1,!1),l[u]=Js(u,!0,!1),o[u]=Js(u,!1,!0),h[u]=Js(u,!0,!0)}),[i,l,o,h]}const[fd,dd,gd,pd]=hd();function To(i,o){const l=o?i?pd:gd:i?dd:fd;return(h,d,u)=>d==="__v_isReactive"?!i:d==="__v_isReadonly"?i:d==="__v_raw"?h:Reflect.get(ce(l,d)&&d in h?l:h,d,u)}const md={get:To(!1,!1)},yd={get:To(!1,!0)},vd={get:To(!0,!1)},Tl=new WeakMap,bl=new WeakMap,wl=new WeakMap,Td=new WeakMap;function bd(i){switch(i){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function wd(i){return i.__v_skip||!Object.isExtensible(i)?0:bd($f(i))}function bo(i){return is(i)?i:wo(i,!1,vl,md,Tl)}function Ad(i){return wo(i,!1,ud,yd,bl)}function Al(i){return wo(i,!0,ld,vd,wl)}function wo(i,o,l,h,d){if(!Ce(i)||i.__v_raw&&!(o&&i.__v_isReactive))return i;const u=d.get(i);if(u)return u;const p=wd(i);if(p===0)return i;const T=new Proxy(i,p===2?h:l);return d.set(i,T),T}function br(i){return is(i)?br(i.__v_raw):!!(i&&i.__v_isReactive)}function is(i){return!!(i&&i.__v_isReadonly)}function Zi(i){return!!(i&&i.__v_isShallow)}function Sl(i){return br(i)||is(i)}function ge(i){const o=i&&i.__v_raw;return o?ge(o):i}function Il(i){return Ys(i,"__v_skip",!0),i}const Ao=i=>Ce(i)?bo(i):i,So=i=>Ce(i)?Al(i):i;function Sd(i){On&&Ct&&(i=ge(i),pl(i.dep||(i.dep=po())))}function Id(i,o){i=ge(i);const l=i.dep;l&&Xi(l)}function Qe(i){return!!(i&&i.__v_isRef===!0)}function kd(i){return Qe(i)?i.value:i}const Ed={get:(i,o,l)=>kd(Reflect.get(i,o,l)),set:(i,o,l,h)=>{const d=i[o];return Qe(d)&&!Qe(l)?(d.value=l,!0):Reflect.set(i,o,l,h)}};function kl(i){return br(i)?i:new Proxy(i,Ed)}class Cd{constructor(o,l,h,d){this._setter=l,this.dep=void 0,this.__v_isRef=!0,this.__v_isReadonly=!1,this._dirty=!0,this.effect=new mo(o,()=>{this._dirty||(this._dirty=!0,Id(this))}),this.effect.computed=this,this.effect.active=this._cacheable=!d,this.__v_isReadonly=h}get value(){const o=ge(this);return Sd(o),(o._dirty||!o._cacheable)&&(o._dirty=!1,o._value=o.effect.run()),o._value}set value(o){this._setter(o)}}function Nd(i,o,l=!1){let h,d;const u=re(i);return u?(h=i,d=Ot):(h=i.get,d=i.set),new Cd(h,d,u||!d,l)}function Pn(i,o,l,h){let d;try{d=h?i(...h):i()}catch(u){si(u,o,l)}return d}function Pt(i,o,l,h){if(re(i)){const u=Pn(i,o,l,h);return u&&ol(u)&&u.catch(p=>{si(p,o,l)}),u}const d=[];for(let u=0;u<i.length;u++)d.push(Pt(i[u],o,l,h));return d}function si(i,o,l,h=!0){const d=o?o.vnode:null;if(o){let u=o.parent;const p=o.proxy,T=l;for(;u;){const k=u.ec;if(k){for(let N=0;N<k.length;N++)if(k[N](i,p,T)===!1)return}u=u.parent}const v=o.appContext.config.errorHandler;if(v){Pn(v,null,10,[i,p,T]);return}}xd(i,l,d,h)}function xd(i,o,l,h=!0){console.error(i)}let os=!1,Qi=!1;const ze=[];let Yt=0;const wr=[];let gn=null,Hn=0;const El=Promise.resolve();let Io=null;function Od(i){const o=Io||El;return i?o.then(this?i.bind(this):i):o}function Pd(i){let o=Yt+1,l=ze.length;for(;o<l;){const h=o+l>>>1;as(ze[h])<i?o=h+1:l=h}return o}function ko(i){(!ze.length||!ze.includes(i,os&&i.allowRecurse?Yt+1:Yt))&&(i.id==null?ze.push(i):ze.splice(Pd(i.id),0,i),Cl())}function Cl(){!os&&!Qi&&(Qi=!0,Io=El.then(xl))}function Dd(i){const o=ze.indexOf(i);o>Yt&&ze.splice(o,1)}function Rd(i){Z(i)?wr.push(...i):(!gn||!gn.includes(i,i.allowRecurse?Hn+1:Hn))&&wr.push(i),Cl()}function Rc(i,o=os?Yt+1:0){for(;o<ze.length;o++){const l=ze[o];l&&l.pre&&(ze.splice(o,1),o--,l())}}function Nl(i){if(wr.length){const o=[...new Set(wr)];if(wr.length=0,gn){gn.push(...o);return}for(gn=o,gn.sort((l,h)=>as(l)-as(h)),Hn=0;Hn<gn.length;Hn++)gn[Hn]();gn=null,Hn=0}}const as=i=>i.id==null?1/0:i.id,_d=(i,o)=>{const l=as(i)-as(o);if(l===0){if(i.pre&&!o.pre)return-1;if(o.pre&&!i.pre)return 1}return l};function xl(i){Qi=!1,os=!0,ze.sort(_d);const o=Ot;try{for(Yt=0;Yt<ze.length;Yt++){const l=ze[Yt];l&&l.active!==!1&&Pn(l,null,14)}}finally{Yt=0,ze.length=0,Nl(),os=!1,Io=null,(ze.length||wr.length)&&xl()}}function Md(i,o,...l){if(i.isUnmounted)return;const h=i.vnode.props||Te;let d=l;const u=o.startsWith("update:"),p=u&&o.slice(7);if(p&&p in h){const N=`${p==="modelValue"?"model":p}Modifiers`,{number:U,trim:j}=h[N]||Te;j&&(d=l.map(ee=>$e(ee)?ee.trim():ee)),U&&(d=l.map(zi))}let T,v=h[T=Fi(o)]||h[T=Fi(Ar(o))];!v&&u&&(v=h[T=Fi(er(o))]),v&&Pt(v,i,6,d);const k=h[T+"Once"];if(k){if(!i.emitted)i.emitted={};else if(i.emitted[T])return;i.emitted[T]=!0,Pt(k,i,6,d)}}function Ol(i,o,l=!1){const h=o.emitsCache,d=h.get(i);if(d!==void 0)return d;const u=i.emits;let p={},T=!1;if(!re(i)){const v=k=>{const N=Ol(k,o,!0);N&&(T=!0,je(p,N))};!l&&o.mixins.length&&o.mixins.forEach(v),i.extends&&v(i.extends),i.mixins&&i.mixins.forEach(v)}return!u&&!T?(Ce(i)&&h.set(i,null),null):(Z(u)?u.forEach(v=>p[v]=null):je(p,u),Ce(i)&&h.set(i,p),p)}function ii(i,o){return!i||!ei(o)?!1:(o=o.slice(2).replace(/Once$/,""),ce(i,o[0].toLowerCase()+o.slice(1))||ce(i,er(o))||ce(i,o))}let Nt=null,Pl=null;function Xs(i){const o=Nt;return Nt=i,Pl=i&&i.type.__scopeId||null,o}function Bd(i,o=Nt,l){if(!o||i._n)return i;const h=(...d)=>{h._d&&Vc(-1);const u=Xs(o);let p;try{p=i(...d)}finally{Xs(u),h._d&&Vc(1)}return p};return h._n=!0,h._c=!0,h._d=!0,h}function Ui(i){const{type:o,vnode:l,proxy:h,withProxy:d,props:u,propsOptions:[p],slots:T,attrs:v,emit:k,render:N,renderCache:U,data:j,setupState:ee,ctx:Ne,inheritAttrs:ie}=i;let ke,Pe;const _e=Xs(i);try{if(l.shapeFlag&4){const ne=d||h;ke=Gt(N.call(ne,ne,U,u,ee,j,Ne)),Pe=v}else{const ne=o;ke=Gt(ne.length>1?ne(u,{attrs:v,slots:T,emit:k}):ne(u,null)),Pe=o.props?v:Ld(v)}}catch(ne){ss.length=0,si(ne,i,1),ke=Zn(cs)}let Me=ke;if(Pe&&ie!==!1){const ne=Object.keys(Pe),{shapeFlag:vt}=Me;ne.length&&vt&7&&(p&&ne.some(co)&&(Pe=$d(Pe,p)),Me=Sr(Me,Pe))}return l.dirs&&(Me=Sr(Me),Me.dirs=Me.dirs?Me.dirs.concat(l.dirs):l.dirs),l.transition&&(Me.transition=l.transition),ke=Me,Xs(_e),ke}const Ld=i=>{let o;for(const l in i)(l==="class"||l==="style"||ei(l))&&((o||(o={}))[l]=i[l]);return o},$d=(i,o)=>{const l={};for(const h in i)(!co(h)||!(h.slice(9)in o))&&(l[h]=i[h]);return l};function Fd(i,o,l){const{props:h,children:d,component:u}=i,{props:p,children:T,patchFlag:v}=o,k=u.emitsOptions;if(o.dirs||o.transition)return!0;if(l&&v>=0){if(v&1024)return!0;if(v&16)return h?_c(h,p,k):!!p;if(v&8){const N=o.dynamicProps;for(let U=0;U<N.length;U++){const j=N[U];if(p[j]!==h[j]&&!ii(k,j))return!0}}}else return(d||T)&&(!T||!T.$stable)?!0:h===p?!1:h?p?_c(h,p,k):!0:!!p;return!1}function _c(i,o,l){const h=Object.keys(o);if(h.length!==Object.keys(i).length)return!0;for(let d=0;d<h.length;d++){const u=h[d];if(o[u]!==i[u]&&!ii(l,u))return!0}return!1}function Ud({vnode:i,parent:o},l){for(;o&&o.subTree===i;)(i=o.vnode).el=l,o=o.parent}const Jd=i=>i.__isSuspense;function jd(i,o){o&&o.pendingBranch?Z(i)?o.effects.push(...i):o.effects.push(i):Rd(i)}const js={};function Ji(i,o,l){return Dl(i,o,l)}function Dl(i,o,{immediate:l,deep:h,flush:d,onTrack:u,onTrigger:p}=Te){var T;const v=Gf()===((T=We)==null?void 0:T.scope)?We:null;let k,N=!1,U=!1;if(Qe(i)?(k=()=>i.value,N=Zi(i)):br(i)?(k=()=>i,h=!0):Z(i)?(U=!0,N=i.some(ne=>br(ne)||Zi(ne)),k=()=>i.map(ne=>{if(Qe(ne))return ne.value;if(br(ne))return Yn(ne);if(re(ne))return Pn(ne,v,2)})):re(i)?o?k=()=>Pn(i,v,2):k=()=>{if(!(v&&v.isUnmounted))return j&&j(),Pt(i,v,3,[ee])}:k=Ot,o&&h){const ne=k;k=()=>Yn(ne())}let j,ee=ne=>{j=_e.onStop=()=>{Pn(ne,v,4)}},Ne;if(us)if(ee=Ot,o?l&&Pt(o,v,3,[k(),U?[]:void 0,ee]):k(),d==="sync"){const ne=Lg();Ne=ne.__watcherHandles||(ne.__watcherHandles=[])}else return Ot;let ie=U?new Array(i.length).fill(js):js;const ke=()=>{if(!!_e.active)if(o){const ne=_e.run();(h||N||(U?ne.some((vt,yn)=>Gs(vt,ie[yn])):Gs(ne,ie)))&&(j&&j(),Pt(o,v,3,[ne,ie===js?void 0:U&&ie[0]===js?[]:ie,ee]),ie=ne)}else _e.run()};ke.allowRecurse=!!o;let Pe;d==="sync"?Pe=ke:d==="post"?Pe=()=>nt(ke,v&&v.suspense):(ke.pre=!0,v&&(ke.id=v.uid),Pe=()=>ko(ke));const _e=new mo(k,Pe);o?l?ke():ie=_e.run():d==="post"?nt(_e.run.bind(_e),v&&v.suspense):_e.run();const Me=()=>{_e.stop(),v&&v.scope&&lo(v.scope.effects,_e)};return Ne&&Ne.push(Me),Me}function qd(i,o,l){const h=this.proxy,d=$e(i)?i.includes(".")?Rl(h,i):()=>h[i]:i.bind(h,h);let u;re(o)?u=o:(u=o.handler,l=o);const p=We;Ir(this);const T=Dl(d,u.bind(h),l);return p?Ir(p):Qn(),T}function Rl(i,o){const l=o.split(".");return()=>{let h=i;for(let d=0;d<l.length&&h;d++)h=h[l[d]];return h}}function Yn(i,o){if(!Ce(i)||i.__v_skip||(o=o||new Set,o.has(i)))return i;if(o.add(i),Qe(i))Yn(i.value,o);else if(Z(i))for(let l=0;l<i.length;l++)Yn(i[l],o);else if(il(i)||Tr(i))i.forEach(l=>{Yn(l,o)});else if(cl(i))for(const l in i)Yn(i[l],o);return i}function Mc(i,o){const l=Nt;if(l===null)return i;const h=li(l)||l.proxy,d=i.dirs||(i.dirs=[]);for(let u=0;u<o.length;u++){let[p,T,v,k=Te]=o[u];p&&(re(p)&&(p={mounted:p,updated:p}),p.deep&&Yn(T),d.push({dir:p,instance:h,value:T,oldValue:void 0,arg:v,modifiers:k}))}return i}function zn(i,o,l,h){const d=i.dirs,u=o&&o.dirs;for(let p=0;p<d.length;p++){const T=d[p];u&&(T.oldValue=u[p].value);let v=T.dir[h];v&&(kr(),Pt(v,l,8,[i.el,T,i,o]),Er())}}const zs=i=>!!i.type.__asyncLoader,_l=i=>i.type.__isKeepAlive;function Kd(i,o){Ml(i,"a",o)}function Vd(i,o){Ml(i,"da",o)}function Ml(i,o,l=We){const h=i.__wdc||(i.__wdc=()=>{let d=l;for(;d;){if(d.isDeactivated)return;d=d.parent}return i()});if(oi(o,h,l),l){let d=l.parent;for(;d&&d.parent;)_l(d.parent.vnode)&&zd(h,o,l,d),d=d.parent}}function zd(i,o,l,h){const d=oi(o,i,h,!0);Bl(()=>{lo(h[o],d)},l)}function oi(i,o,l=We,h=!1){if(l){const d=l[i]||(l[i]=[]),u=o.__weh||(o.__weh=(...p)=>{if(l.isUnmounted)return;kr(),Ir(l);const T=Pt(o,l,i,p);return Qn(),Er(),T});return h?d.unshift(u):d.push(u),u}}const mn=i=>(o,l=We)=>(!us||i==="sp")&&oi(i,(...h)=>o(...h),l),Wd=mn("bm"),Hd=mn("m"),Gd=mn("bu"),Yd=mn("u"),Xd=mn("bum"),Bl=mn("um"),Zd=mn("sp"),Qd=mn("rtg"),eg=mn("rtc");function tg(i,o=We){oi("ec",i,o)}const ng=Symbol.for("v-ndc");function Bc(i,o,l,h){let d;const u=l&&l[h];if(Z(i)||$e(i)){d=new Array(i.length);for(let p=0,T=i.length;p<T;p++)d[p]=o(i[p],p,void 0,u&&u[p])}else if(typeof i=="number"){d=new Array(i);for(let p=0;p<i;p++)d[p]=o(p+1,p,void 0,u&&u[p])}else if(Ce(i))if(i[Symbol.iterator])d=Array.from(i,(p,T)=>o(p,T,void 0,u&&u[T]));else{const p=Object.keys(i);d=new Array(p.length);for(let T=0,v=p.length;T<v;T++){const k=p[T];d[T]=o(i[k],k,T,u&&u[T])}}else d=[];return l&&(l[h]=d),d}const eo=i=>i?Wl(i)?li(i)||i.proxy:eo(i.parent):null,rs=je(Object.create(null),{$:i=>i,$el:i=>i.vnode.el,$data:i=>i.data,$props:i=>i.props,$attrs:i=>i.attrs,$slots:i=>i.slots,$refs:i=>i.refs,$parent:i=>eo(i.parent),$root:i=>eo(i.root),$emit:i=>i.emit,$options:i=>Eo(i),$forceUpdate:i=>i.f||(i.f=()=>ko(i.update)),$nextTick:i=>i.n||(i.n=Od.bind(i.proxy)),$watch:i=>qd.bind(i)}),ji=(i,o)=>i!==Te&&!i.__isScriptSetup&&ce(i,o),rg={get({_:i},o){const{ctx:l,setupState:h,data:d,props:u,accessCache:p,type:T,appContext:v}=i;let k;if(o[0]!=="$"){const ee=p[o];if(ee!==void 0)switch(ee){case 1:return h[o];case 2:return d[o];case 4:return l[o];case 3:return u[o]}else{if(ji(h,o))return p[o]=1,h[o];if(d!==Te&&ce(d,o))return p[o]=2,d[o];if((k=i.propsOptions[0])&&ce(k,o))return p[o]=3,u[o];if(l!==Te&&ce(l,o))return p[o]=4,l[o];to&&(p[o]=0)}}const N=rs[o];let U,j;if(N)return o==="$attrs"&&rt(i,"get",o),N(i);if((U=T.__cssModules)&&(U=U[o]))return U;if(l!==Te&&ce(l,o))return p[o]=4,l[o];if(j=v.config.globalProperties,ce(j,o))return j[o]},set({_:i},o,l){const{data:h,setupState:d,ctx:u}=i;return ji(d,o)?(d[o]=l,!0):h!==Te&&ce(h,o)?(h[o]=l,!0):ce(i.props,o)||o[0]==="$"&&o.slice(1)in i?!1:(u[o]=l,!0)},has({_:{data:i,setupState:o,accessCache:l,ctx:h,appContext:d,propsOptions:u}},p){let T;return!!l[p]||i!==Te&&ce(i,p)||ji(o,p)||(T=u[0])&&ce(T,p)||ce(h,p)||ce(rs,p)||ce(d.config.globalProperties,p)},defineProperty(i,o,l){return l.get!=null?i._.accessCache[o]=0:ce(l,"value")&&this.set(i,o,l.value,null),Reflect.defineProperty(i,o,l)}};function Lc(i){return Z(i)?i.reduce((o,l)=>(o[l]=null,o),{}):i}let to=!0;function sg(i){const o=Eo(i),l=i.proxy,h=i.ctx;to=!1,o.beforeCreate&&$c(o.beforeCreate,i,"bc");const{data:d,computed:u,methods:p,watch:T,provide:v,inject:k,created:N,beforeMount:U,mounted:j,beforeUpdate:ee,updated:Ne,activated:ie,deactivated:ke,beforeDestroy:Pe,beforeUnmount:_e,destroyed:Me,unmounted:ne,render:vt,renderTracked:yn,renderTriggered:tr,errorCaptured:Dt,serverPrefetch:Be,expose:Xt,inheritAttrs:Rn,components:vn,directives:Zt,filters:nr}=o;if(k&&ig(k,h,null),p)for(const be in p){const fe=p[be];re(fe)&&(h[be]=fe.bind(l))}if(d){const be=d.call(l,l);Ce(be)&&(i.data=bo(be))}if(to=!0,u)for(const be in u){const fe=u[be],Rt=re(fe)?fe.bind(l,l):re(fe.get)?fe.get.bind(l,l):Ot,_n=!re(fe)&&re(fe.set)?fe.set.bind(l):Ot,_t=Mg({get:Rt,set:_n});Object.defineProperty(h,be,{enumerable:!0,configurable:!0,get:()=>_t.value,set:ht=>_t.value=ht})}if(T)for(const be in T)Ll(T[be],h,l,be);if(v){const be=re(v)?v.call(l):v;Reflect.ownKeys(be).forEach(fe=>{hg(fe,be[fe])})}N&&$c(N,i,"c");function Fe(be,fe){Z(fe)?fe.forEach(Rt=>be(Rt.bind(l))):fe&&be(fe.bind(l))}if(Fe(Wd,U),Fe(Hd,j),Fe(Gd,ee),Fe(Yd,Ne),Fe(Kd,ie),Fe(Vd,ke),Fe(tg,Dt),Fe(eg,yn),Fe(Qd,tr),Fe(Xd,_e),Fe(Bl,ne),Fe(Zd,Be),Z(Xt))if(Xt.length){const be=i.exposed||(i.exposed={});Xt.forEach(fe=>{Object.defineProperty(be,fe,{get:()=>l[fe],set:Rt=>l[fe]=Rt})})}else i.exposed||(i.exposed={});vt&&i.render===Ot&&(i.render=vt),Rn!=null&&(i.inheritAttrs=Rn),vn&&(i.components=vn),Zt&&(i.directives=Zt)}function ig(i,o,l=Ot){Z(i)&&(i=no(i));for(const h in i){const d=i[h];let u;Ce(d)?"default"in d?u=Ws(d.from||h,d.default,!0):u=Ws(d.from||h):u=Ws(d),Qe(u)?Object.defineProperty(o,h,{enumerable:!0,configurable:!0,get:()=>u.value,set:p=>u.value=p}):o[h]=u}}function $c(i,o,l){Pt(Z(i)?i.map(h=>h.bind(o.proxy)):i.bind(o.proxy),o,l)}function Ll(i,o,l,h){const d=h.includes(".")?Rl(l,h):()=>l[h];if($e(i)){const u=o[i];re(u)&&Ji(d,u)}else if(re(i))Ji(d,i.bind(l));else if(Ce(i))if(Z(i))i.forEach(u=>Ll(u,o,l,h));else{const u=re(i.handler)?i.handler.bind(l):o[i.handler];re(u)&&Ji(d,u,i)}}function Eo(i){const o=i.type,{mixins:l,extends:h}=o,{mixins:d,optionsCache:u,config:{optionMergeStrategies:p}}=i.appContext,T=u.get(o);let v;return T?v=T:!d.length&&!l&&!h?v=o:(v={},d.length&&d.forEach(k=>Zs(v,k,p,!0)),Zs(v,o,p)),Ce(o)&&u.set(o,v),v}function Zs(i,o,l,h=!1){const{mixins:d,extends:u}=o;u&&Zs(i,u,l,!0),d&&d.forEach(p=>Zs(i,p,l,!0));for(const p in o)if(!(h&&p==="expose")){const T=og[p]||l&&l[p];i[p]=T?T(i[p],o[p]):o[p]}return i}const og={data:Fc,props:Uc,emits:Uc,methods:ns,computed:ns,beforeCreate:Xe,created:Xe,beforeMount:Xe,mounted:Xe,beforeUpdate:Xe,updated:Xe,beforeDestroy:Xe,beforeUnmount:Xe,destroyed:Xe,unmounted:Xe,activated:Xe,deactivated:Xe,errorCaptured:Xe,serverPrefetch:Xe,components:ns,directives:ns,watch:cg,provide:Fc,inject:ag};function Fc(i,o){return o?i?function(){return je(re(i)?i.call(this,this):i,re(o)?o.call(this,this):o)}:o:i}function ag(i,o){return ns(no(i),no(o))}function no(i){if(Z(i)){const o={};for(let l=0;l<i.length;l++)o[i[l]]=i[l];return o}return i}function Xe(i,o){return i?[...new Set([].concat(i,o))]:o}function ns(i,o){return i?je(Object.create(null),i,o):o}function Uc(i,o){return i?Z(i)&&Z(o)?[...new Set([...i,...o])]:je(Object.create(null),Lc(i),Lc(o!=null?o:{})):o}function cg(i,o){if(!i)return o;if(!o)return i;const l=je(Object.create(null),i);for(const h in o)l[h]=Xe(i[h],o[h]);return l}function $l(){return{app:null,config:{isNativeTag:Mf,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let lg=0;function ug(i,o){return function(h,d=null){re(h)||(h=je({},h)),d!=null&&!Ce(d)&&(d=null);const u=$l(),p=new Set;let T=!1;const v=u.app={_uid:lg++,_component:h,_props:d,_container:null,_context:u,_instance:null,version:$g,get config(){return u.config},set config(k){},use(k,...N){return p.has(k)||(k&&re(k.install)?(p.add(k),k.install(v,...N)):re(k)&&(p.add(k),k(v,...N))),v},mixin(k){return u.mixins.includes(k)||u.mixins.push(k),v},component(k,N){return N?(u.components[k]=N,v):u.components[k]},directive(k,N){return N?(u.directives[k]=N,v):u.directives[k]},mount(k,N,U){if(!T){const j=Zn(h,d);return j.appContext=u,N&&o?o(j,k):i(j,k,U),T=!0,v._container=k,k.__vue_app__=v,li(j.component)||j.component.proxy}},unmount(){T&&(i(null,v._container),delete v._container.__vue_app__)},provide(k,N){return u.provides[k]=N,v},runWithContext(k){Qs=v;try{return k()}finally{Qs=null}}};return v}}let Qs=null;function hg(i,o){if(We){let l=We.provides;const h=We.parent&&We.parent.provides;h===l&&(l=We.provides=Object.create(h)),l[i]=o}}function Ws(i,o,l=!1){const h=We||Nt;if(h||Qs){const d=h?h.parent==null?h.vnode.appContext&&h.vnode.appContext.provides:h.parent.provides:Qs._context.provides;if(d&&i in d)return d[i];if(arguments.length>1)return l&&re(o)?o.call(h&&h.proxy):o}}function fg(i,o,l,h=!1){const d={},u={};Ys(u,ci,1),i.propsDefaults=Object.create(null),Fl(i,o,d,u);for(const p in i.propsOptions[0])p in d||(d[p]=void 0);l?i.props=h?d:Ad(d):i.type.props?i.props=d:i.props=u,i.attrs=u}function dg(i,o,l,h){const{props:d,attrs:u,vnode:{patchFlag:p}}=i,T=ge(d),[v]=i.propsOptions;let k=!1;if((h||p>0)&&!(p&16)){if(p&8){const N=i.vnode.dynamicProps;for(let U=0;U<N.length;U++){let j=N[U];if(ii(i.emitsOptions,j))continue;const ee=o[j];if(v)if(ce(u,j))ee!==u[j]&&(u[j]=ee,k=!0);else{const Ne=Ar(j);d[Ne]=ro(v,T,Ne,ee,i,!1)}else ee!==u[j]&&(u[j]=ee,k=!0)}}}else{Fl(i,o,d,u)&&(k=!0);let N;for(const U in T)(!o||!ce(o,U)&&((N=er(U))===U||!ce(o,N)))&&(v?l&&(l[U]!==void 0||l[N]!==void 0)&&(d[U]=ro(v,T,U,void 0,i,!0)):delete d[U]);if(u!==T)for(const U in u)(!o||!ce(o,U)&&!0)&&(delete u[U],k=!0)}k&&pn(i,"set","$attrs")}function Fl(i,o,l,h){const[d,u]=i.propsOptions;let p=!1,T;if(o)for(let v in o){if(Ks(v))continue;const k=o[v];let N;d&&ce(d,N=Ar(v))?!u||!u.includes(N)?l[N]=k:(T||(T={}))[N]=k:ii(i.emitsOptions,v)||(!(v in h)||k!==h[v])&&(h[v]=k,p=!0)}if(u){const v=ge(l),k=T||Te;for(let N=0;N<u.length;N++){const U=u[N];l[U]=ro(d,v,U,k[U],i,!ce(k,U))}}return p}function ro(i,o,l,h,d,u){const p=i[l];if(p!=null){const T=ce(p,"default");if(T&&h===void 0){const v=p.default;if(p.type!==Function&&!p.skipFactory&&re(v)){const{propsDefaults:k}=d;l in k?h=k[l]:(Ir(d),h=k[l]=v.call(null,o),Qn())}else h=v}p[0]&&(u&&!T?h=!1:p[1]&&(h===""||h===er(l))&&(h=!0))}return h}function Ul(i,o,l=!1){const h=o.propsCache,d=h.get(i);if(d)return d;const u=i.props,p={},T=[];let v=!1;if(!re(i)){const N=U=>{v=!0;const[j,ee]=Ul(U,o,!0);je(p,j),ee&&T.push(...ee)};!l&&o.mixins.length&&o.mixins.forEach(N),i.extends&&N(i.extends),i.mixins&&i.mixins.forEach(N)}if(!u&&!v)return Ce(i)&&h.set(i,vr),vr;if(Z(u))for(let N=0;N<u.length;N++){const U=Ar(u[N]);Jc(U)&&(p[U]=Te)}else if(u)for(const N in u){const U=Ar(N);if(Jc(U)){const j=u[N],ee=p[U]=Z(j)||re(j)?{type:j}:je({},j);if(ee){const Ne=Kc(Boolean,ee.type),ie=Kc(String,ee.type);ee[0]=Ne>-1,ee[1]=ie<0||Ne<ie,(Ne>-1||ce(ee,"default"))&&T.push(U)}}}const k=[p,T];return Ce(i)&&h.set(i,k),k}function Jc(i){return i[0]!=="$"}function jc(i){const o=i&&i.toString().match(/^\s*(function|class) (\w+)/);return o?o[2]:i===null?"null":""}function qc(i,o){return jc(i)===jc(o)}function Kc(i,o){return Z(o)?o.findIndex(l=>qc(l,i)):re(o)&&qc(o,i)?0:-1}const Jl=i=>i[0]==="_"||i==="$stable",Co=i=>Z(i)?i.map(Gt):[Gt(i)],gg=(i,o,l)=>{if(o._n)return o;const h=Bd((...d)=>Co(o(...d)),l);return h._c=!1,h},jl=(i,o,l)=>{const h=i._ctx;for(const d in i){if(Jl(d))continue;const u=i[d];if(re(u))o[d]=gg(d,u,h);else if(u!=null){const p=Co(u);o[d]=()=>p}}},ql=(i,o)=>{const l=Co(o);i.slots.default=()=>l},pg=(i,o)=>{if(i.vnode.shapeFlag&32){const l=o._;l?(i.slots=ge(o),Ys(o,"_",l)):jl(o,i.slots={})}else i.slots={},o&&ql(i,o);Ys(i.slots,ci,1)},mg=(i,o,l)=>{const{vnode:h,slots:d}=i;let u=!0,p=Te;if(h.shapeFlag&32){const T=o._;T?l&&T===1?u=!1:(je(d,o),!l&&T===1&&delete d._):(u=!o.$stable,jl(o,d)),p=o}else o&&(ql(i,o),p={default:1});if(u)for(const T in d)!Jl(T)&&!(T in p)&&delete d[T]};function so(i,o,l,h,d=!1){if(Z(i)){i.forEach((j,ee)=>so(j,o&&(Z(o)?o[ee]:o),l,h,d));return}if(zs(h)&&!d)return;const u=h.shapeFlag&4?li(h.component)||h.component.proxy:h.el,p=d?null:u,{i:T,r:v}=i,k=o&&o.r,N=T.refs===Te?T.refs={}:T.refs,U=T.setupState;if(k!=null&&k!==v&&($e(k)?(N[k]=null,ce(U,k)&&(U[k]=null)):Qe(k)&&(k.value=null)),re(v))Pn(v,T,12,[p,N]);else{const j=$e(v),ee=Qe(v);if(j||ee){const Ne=()=>{if(i.f){const ie=j?ce(U,v)?U[v]:N[v]:v.value;d?Z(ie)&&lo(ie,u):Z(ie)?ie.includes(u)||ie.push(u):j?(N[v]=[u],ce(U,v)&&(U[v]=N[v])):(v.value=[u],i.k&&(N[i.k]=v.value))}else j?(N[v]=p,ce(U,v)&&(U[v]=p)):ee&&(v.value=p,i.k&&(N[i.k]=p))};p?(Ne.id=-1,nt(Ne,l)):Ne()}}}const nt=jd;function yg(i){return vg(i)}function vg(i,o){const l=Wi();l.__VUE__=!0;const{insert:h,remove:d,patchProp:u,createElement:p,createText:T,createComment:v,setText:k,setElementText:N,parentNode:U,nextSibling:j,setScopeId:ee=Ot,insertStaticContent:Ne}=i,ie=(y,w,E,P=null,O=null,_=null,$=!1,B=null,L=!!w.dynamicChildren)=>{if(y===w)return;y&&!es(y,w)&&(P=st(y),ht(y,O,_,!0),y=null),w.patchFlag===-2&&(L=!1,w.dynamicChildren=null);const{type:D,ref:z,shapeFlag:J}=w;switch(D){case ai:ke(y,w,E,P);break;case cs:Pe(y,w,E,P);break;case qi:y==null&&_e(w,E,P,$);break;case yt:vn(y,w,E,P,O,_,$,B,L);break;default:J&1?vt(y,w,E,P,O,_,$,B,L):J&6?Zt(y,w,E,P,O,_,$,B,L):(J&64||J&128)&&D.process(y,w,E,P,O,_,$,B,L,en)}z!=null&&O&&so(z,y&&y.ref,_,w||y,!w)},ke=(y,w,E,P)=>{if(y==null)h(w.el=T(w.children),E,P);else{const O=w.el=y.el;w.children!==y.children&&k(O,w.children)}},Pe=(y,w,E,P)=>{y==null?h(w.el=v(w.children||""),E,P):w.el=y.el},_e=(y,w,E,P)=>{[y.el,y.anchor]=Ne(y.children,w,E,P,y.el,y.anchor)},Me=({el:y,anchor:w},E,P)=>{let O;for(;y&&y!==w;)O=j(y),h(y,E,P),y=O;h(w,E,P)},ne=({el:y,anchor:w})=>{let E;for(;y&&y!==w;)E=j(y),d(y),y=E;d(w)},vt=(y,w,E,P,O,_,$,B,L)=>{$=$||w.type==="svg",y==null?yn(w,E,P,O,_,$,B,L):Be(y,w,O,_,$,B,L)},yn=(y,w,E,P,O,_,$,B)=>{let L,D;const{type:z,props:J,shapeFlag:W,transition:Y,dirs:Q}=y;if(L=y.el=p(y.type,_,J&&J.is,J),W&8?N(L,y.children):W&16&&Dt(y.children,L,null,P,O,_&&z!=="foreignObject",$,B),Q&&zn(y,null,P,"created"),tr(L,y,y.scopeId,$,P),J){for(const he in J)he!=="value"&&!Ks(he)&&u(L,he,null,J[he],_,y.children,P,O,Ue);"value"in J&&u(L,"value",null,J.value),(D=J.onVnodeBeforeMount)&&Ht(D,P,y)}Q&&zn(y,null,P,"beforeMount");const de=(!O||O&&!O.pendingBranch)&&Y&&!Y.persisted;de&&Y.beforeEnter(L),h(L,w,E),((D=J&&J.onVnodeMounted)||de||Q)&&nt(()=>{D&&Ht(D,P,y),de&&Y.enter(L),Q&&zn(y,null,P,"mounted")},O)},tr=(y,w,E,P,O)=>{if(E&&ee(y,E),P)for(let _=0;_<P.length;_++)ee(y,P[_]);if(O){let _=O.subTree;if(w===_){const $=O.vnode;tr(y,$,$.scopeId,$.slotScopeIds,O.parent)}}},Dt=(y,w,E,P,O,_,$,B,L=0)=>{for(let D=L;D<y.length;D++){const z=y[D]=B?xn(y[D]):Gt(y[D]);ie(null,z,w,E,P,O,_,$,B)}},Be=(y,w,E,P,O,_,$)=>{const B=w.el=y.el;let{patchFlag:L,dynamicChildren:D,dirs:z}=w;L|=y.patchFlag&16;const J=y.props||Te,W=w.props||Te;let Y;E&&Wn(E,!1),(Y=W.onVnodeBeforeUpdate)&&Ht(Y,E,w,y),z&&zn(w,y,E,"beforeUpdate"),E&&Wn(E,!0);const Q=O&&w.type!=="foreignObject";if(D?Xt(y.dynamicChildren,D,B,E,P,Q,_):$||fe(y,w,B,null,E,P,Q,_,!1),L>0){if(L&16)Rn(B,w,J,W,E,P,O);else if(L&2&&J.class!==W.class&&u(B,"class",null,W.class,O),L&4&&u(B,"style",J.style,W.style,O),L&8){const de=w.dynamicProps;for(let he=0;he<de.length;he++){const Ee=de[he],it=J[Ee],Tn=W[Ee];(Tn!==it||Ee==="value")&&u(B,Ee,it,Tn,O,y.children,E,P,Ue)}}L&1&&y.children!==w.children&&N(B,w.children)}else!$&&D==null&&Rn(B,w,J,W,E,P,O);((Y=W.onVnodeUpdated)||z)&&nt(()=>{Y&&Ht(Y,E,w,y),z&&zn(w,y,E,"updated")},P)},Xt=(y,w,E,P,O,_,$)=>{for(let B=0;B<w.length;B++){const L=y[B],D=w[B],z=L.el&&(L.type===yt||!es(L,D)||L.shapeFlag&70)?U(L.el):E;ie(L,D,z,null,P,O,_,$,!0)}},Rn=(y,w,E,P,O,_,$)=>{if(E!==P){if(E!==Te)for(const B in E)!Ks(B)&&!(B in P)&&u(y,B,E[B],null,$,w.children,O,_,Ue);for(const B in P){if(Ks(B))continue;const L=P[B],D=E[B];L!==D&&B!=="value"&&u(y,B,D,L,$,w.children,O,_,Ue)}"value"in P&&u(y,"value",E.value,P.value)}},vn=(y,w,E,P,O,_,$,B,L)=>{const D=w.el=y?y.el:T(""),z=w.anchor=y?y.anchor:T("");let{patchFlag:J,dynamicChildren:W,slotScopeIds:Y}=w;Y&&(B=B?B.concat(Y):Y),y==null?(h(D,E,P),h(z,E,P),Dt(w.children,E,z,O,_,$,B,L)):J>0&&J&64&&W&&y.dynamicChildren?(Xt(y.dynamicChildren,W,E,O,_,$,B),(w.key!=null||O&&w===O.subTree)&&Kl(y,w,!0)):fe(y,w,E,z,O,_,$,B,L)},Zt=(y,w,E,P,O,_,$,B,L)=>{w.slotScopeIds=B,y==null?w.shapeFlag&512?O.ctx.activate(w,E,P,$,L):nr(w,E,P,O,_,$,L):hs(y,w,L)},nr=(y,w,E,P,O,_,$)=>{const B=y.component=xg(y,P,O);if(_l(y)&&(B.ctx.renderer=en),Og(B),B.asyncDep){if(O&&O.registerDep(B,Fe),!y.el){const L=B.subTree=Zn(cs);Pe(null,L,w,E)}return}Fe(B,y,w,E,O,_,$)},hs=(y,w,E)=>{const P=w.component=y.component;if(Fd(y,w,E))if(P.asyncDep&&!P.asyncResolved){be(P,w,E);return}else P.next=w,Dd(P.update),P.update();else w.el=y.el,P.vnode=w},Fe=(y,w,E,P,O,_,$)=>{const B=()=>{if(y.isMounted){let{next:z,bu:J,u:W,parent:Y,vnode:Q}=y,de=z,he;Wn(y,!1),z?(z.el=Q.el,be(y,z,$)):z=Q,J&&Vs(J),(he=z.props&&z.props.onVnodeBeforeUpdate)&&Ht(he,Y,z,Q),Wn(y,!0);const Ee=Ui(y),it=y.subTree;y.subTree=Ee,ie(it,Ee,U(it.el),st(it),y,O,_),z.el=Ee.el,de===null&&Ud(y,Ee.el),W&&nt(W,O),(he=z.props&&z.props.onVnodeUpdated)&&nt(()=>Ht(he,Y,z,Q),O)}else{let z;const{el:J,props:W}=w,{bm:Y,m:Q,parent:de}=y,he=zs(w);if(Wn(y,!1),Y&&Vs(Y),!he&&(z=W&&W.onVnodeBeforeMount)&&Ht(z,de,w),Wn(y,!0),J&&Cr){const Ee=()=>{y.subTree=Ui(y),Cr(J,y.subTree,y,O,null)};he?w.type.__asyncLoader().then(()=>!y.isUnmounted&&Ee()):Ee()}else{const Ee=y.subTree=Ui(y);ie(null,Ee,E,P,y,O,_),w.el=Ee.el}if(Q&&nt(Q,O),!he&&(z=W&&W.onVnodeMounted)){const Ee=w;nt(()=>Ht(z,de,Ee),O)}(w.shapeFlag&256||de&&zs(de.vnode)&&de.vnode.shapeFlag&256)&&y.a&&nt(y.a,O),y.isMounted=!0,w=E=P=null}},L=y.effect=new mo(B,()=>ko(D),y.scope),D=y.update=()=>L.run();D.id=y.uid,Wn(y,!0),D()},be=(y,w,E)=>{w.component=y;const P=y.vnode.props;y.vnode=w,y.next=null,dg(y,w.props,P,E),mg(y,w.children,E),kr(),Rc(),Er()},fe=(y,w,E,P,O,_,$,B,L=!1)=>{const D=y&&y.children,z=y?y.shapeFlag:0,J=w.children,{patchFlag:W,shapeFlag:Y}=w;if(W>0){if(W&128){_n(D,J,E,P,O,_,$,B,L);return}else if(W&256){Rt(D,J,E,P,O,_,$,B,L);return}}Y&8?(z&16&&Ue(D,O,_),J!==D&&N(E,J)):z&16?Y&16?_n(D,J,E,P,O,_,$,B,L):Ue(D,O,_,!0):(z&8&&N(E,""),Y&16&&Dt(J,E,P,O,_,$,B,L))},Rt=(y,w,E,P,O,_,$,B,L)=>{y=y||vr,w=w||vr;const D=y.length,z=w.length,J=Math.min(D,z);let W;for(W=0;W<J;W++){const Y=w[W]=L?xn(w[W]):Gt(w[W]);ie(y[W],Y,E,null,O,_,$,B,L)}D>z?Ue(y,O,_,!0,!1,J):Dt(w,E,P,O,_,$,B,L,J)},_n=(y,w,E,P,O,_,$,B,L)=>{let D=0;const z=w.length;let J=y.length-1,W=z-1;for(;D<=J&&D<=W;){const Y=y[D],Q=w[D]=L?xn(w[D]):Gt(w[D]);if(es(Y,Q))ie(Y,Q,E,null,O,_,$,B,L);else break;D++}for(;D<=J&&D<=W;){const Y=y[J],Q=w[W]=L?xn(w[W]):Gt(w[W]);if(es(Y,Q))ie(Y,Q,E,null,O,_,$,B,L);else break;J--,W--}if(D>J){if(D<=W){const Y=W+1,Q=Y<z?w[Y].el:P;for(;D<=W;)ie(null,w[D]=L?xn(w[D]):Gt(w[D]),E,Q,O,_,$,B,L),D++}}else if(D>W)for(;D<=J;)ht(y[D],O,_,!0),D++;else{const Y=D,Q=D,de=new Map;for(D=Q;D<=W;D++){const we=w[D]=L?xn(w[D]):Gt(w[D]);we.key!=null&&de.set(we.key,D)}let he,Ee=0;const it=W-Q+1;let Tn=!1,Mn=0;const Mt=new Array(it);for(D=0;D<it;D++)Mt[D]=0;for(D=Y;D<=J;D++){const we=y[D];if(Ee>=it){ht(we,O,_,!0);continue}let ot;if(we.key!=null)ot=de.get(we.key);else for(he=Q;he<=W;he++)if(Mt[he-Q]===0&&es(we,w[he])){ot=he;break}ot===void 0?ht(we,O,_,!0):(Mt[ot-Q]=D+1,ot>=Mn?Mn=ot:Tn=!0,ie(we,w[ot],E,null,O,_,$,B,L),Ee++)}const ds=Tn?Tg(Mt):vr;for(he=ds.length-1,D=it-1;D>=0;D--){const we=Q+D,ot=w[we],gs=we+1<z?w[we+1].el:P;Mt[D]===0?ie(null,ot,E,gs,O,_,$,B,L):Tn&&(he<0||D!==ds[he]?_t(ot,E,gs,2):he--)}}},_t=(y,w,E,P,O=null)=>{const{el:_,type:$,transition:B,children:L,shapeFlag:D}=y;if(D&6){_t(y.component.subTree,w,E,P);return}if(D&128){y.suspense.move(w,E,P);return}if(D&64){$.move(y,w,E,en);return}if($===yt){h(_,w,E);for(let J=0;J<L.length;J++)_t(L[J],w,E,P);h(y.anchor,w,E);return}if($===qi){Me(y,w,E);return}if(P!==2&&D&1&&B)if(P===0)B.beforeEnter(_),h(_,w,E),nt(()=>B.enter(_),O);else{const{leave:J,delayLeave:W,afterLeave:Y}=B,Q=()=>h(_,w,E),de=()=>{J(_,()=>{Q(),Y&&Y()})};W?W(_,Q,de):de()}else h(_,w,E)},ht=(y,w,E,P=!1,O=!1)=>{const{type:_,props:$,ref:B,children:L,dynamicChildren:D,shapeFlag:z,patchFlag:J,dirs:W}=y;if(B!=null&&so(B,null,E,y,!0),z&256){w.ctx.deactivate(y);return}const Y=z&1&&W,Q=!zs(y);let de;if(Q&&(de=$&&$.onVnodeBeforeUnmount)&&Ht(de,w,y),z&6)I(y.component,E,P);else{if(z&128){y.suspense.unmount(E,P);return}Y&&zn(y,null,w,"beforeUnmount"),z&64?y.type.remove(y,w,E,O,en,P):D&&(_!==yt||J>0&&J&64)?Ue(D,w,E,!1,!0):(_===yt&&J&384||!O&&z&16)&&Ue(L,w,E),P&&fs(y)}(Q&&(de=$&&$.onVnodeUnmounted)||Y)&&nt(()=>{de&&Ht(de,w,y),Y&&zn(y,null,w,"unmounted")},E)},fs=y=>{const{type:w,el:E,anchor:P,transition:O}=y;if(w===yt){xe(E,P);return}if(w===qi){ne(y);return}const _=()=>{d(E),O&&!O.persisted&&O.afterLeave&&O.afterLeave()};if(y.shapeFlag&1&&O&&!O.persisted){const{leave:$,delayLeave:B}=O,L=()=>$(E,_);B?B(y.el,_,L):L()}else _()},xe=(y,w)=>{let E;for(;y!==w;)E=j(y),d(y),y=E;d(w)},I=(y,w,E)=>{const{bum:P,scope:O,update:_,subTree:$,um:B}=y;P&&Vs(P),O.stop(),_&&(_.active=!1,ht($,y,w,E)),B&&nt(B,w),nt(()=>{y.isUnmounted=!0},w),w&&w.pendingBranch&&!w.isUnmounted&&y.asyncDep&&!y.asyncResolved&&y.suspenseId===w.pendingId&&(w.deps--,w.deps===0&&w.resolve())},Ue=(y,w,E,P=!1,O=!1,_=0)=>{for(let $=_;$<y.length;$++)ht(y[$],w,E,P,O)},st=y=>y.shapeFlag&6?st(y.component.subTree):y.shapeFlag&128?y.suspense.next():j(y.anchor||y.el),Qt=(y,w,E)=>{y==null?w._vnode&&ht(w._vnode,null,null,!0):ie(w._vnode||null,y,w,null,null,null,E),Rc(),Nl(),w._vnode=y},en={p:ie,um:ht,m:_t,r:fs,mt:nr,mc:Dt,pc:fe,pbc:Xt,n:st,o:i};let ve,Cr;return o&&([ve,Cr]=o(en)),{render:Qt,hydrate:ve,createApp:ug(Qt,ve)}}function Wn({effect:i,update:o},l){i.allowRecurse=o.allowRecurse=l}function Kl(i,o,l=!1){const h=i.children,d=o.children;if(Z(h)&&Z(d))for(let u=0;u<h.length;u++){const p=h[u];let T=d[u];T.shapeFlag&1&&!T.dynamicChildren&&((T.patchFlag<=0||T.patchFlag===32)&&(T=d[u]=xn(d[u]),T.el=p.el),l||Kl(p,T)),T.type===ai&&(T.el=p.el)}}function Tg(i){const o=i.slice(),l=[0];let h,d,u,p,T;const v=i.length;for(h=0;h<v;h++){const k=i[h];if(k!==0){if(d=l[l.length-1],i[d]<k){o[h]=d,l.push(h);continue}for(u=0,p=l.length-1;u<p;)T=u+p>>1,i[l[T]]<k?u=T+1:p=T;k<i[l[u]]&&(u>0&&(o[h]=l[u-1]),l[u]=h)}}for(u=l.length,p=l[u-1];u-- >0;)l[u]=p,p=o[p];return l}const bg=i=>i.__isTeleport,yt=Symbol.for("v-fgt"),ai=Symbol.for("v-txt"),cs=Symbol.for("v-cmt"),qi=Symbol.for("v-stc"),ss=[];let xt=null;function hn(i=!1){ss.push(xt=i?null:[])}function wg(){ss.pop(),xt=ss[ss.length-1]||null}let ls=1;function Vc(i){ls+=i}function Ag(i){return i.dynamicChildren=ls>0?xt||vr:null,wg(),ls>0&&xt&&xt.push(i),i}function fn(i,o,l,h,d,u){return Ag(Ze(i,o,l,h,d,u,!0))}function Sg(i){return i?i.__v_isVNode===!0:!1}function es(i,o){return i.type===o.type&&i.key===o.key}const ci="__vInternal",Vl=({key:i})=>i!=null?i:null,Hs=({ref:i,ref_key:o,ref_for:l})=>(typeof i=="number"&&(i=""+i),i!=null?$e(i)||Qe(i)||re(i)?{i:Nt,r:i,k:o,f:!!l}:i:null);function Ze(i,o=null,l=null,h=0,d=null,u=i===yt?0:1,p=!1,T=!1){const v={__v_isVNode:!0,__v_skip:!0,type:i,props:o,key:o&&Vl(o),ref:o&&Hs(o),scopeId:Pl,slotScopeIds:null,children:l,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetAnchor:null,staticCount:0,shapeFlag:u,patchFlag:h,dynamicProps:d,dynamicChildren:null,appContext:null,ctx:Nt};return T?(No(v,l),u&128&&i.normalize(v)):l&&(v.shapeFlag|=$e(l)?8:16),ls>0&&!p&&xt&&(v.patchFlag>0||u&6)&&v.patchFlag!==32&&xt.push(v),v}const Zn=Ig;function Ig(i,o=null,l=null,h=0,d=null,u=!1){if((!i||i===ng)&&(i=cs),Sg(i)){const T=Sr(i,o,!0);return l&&No(T,l),ls>0&&!u&&xt&&(T.shapeFlag&6?xt[xt.indexOf(i)]=T:xt.push(T)),T.patchFlag|=-2,T}if(_g(i)&&(i=i.__vccOpts),o){o=kg(o);let{class:T,style:v}=o;T&&!$e(T)&&(o.class=go(T)),Ce(v)&&(Sl(v)&&!Z(v)&&(v=je({},v)),o.style=fo(v))}const p=$e(i)?1:Jd(i)?128:bg(i)?64:Ce(i)?4:re(i)?2:0;return Ze(i,o,l,h,d,p,u,!0)}function kg(i){return i?Sl(i)||ci in i?je({},i):i:null}function Sr(i,o,l=!1){const{props:h,ref:d,patchFlag:u,children:p}=i,T=o?Eg(h||{},o):h;return{__v_isVNode:!0,__v_skip:!0,type:i.type,props:T,key:T&&Vl(T),ref:o&&o.ref?l&&d?Z(d)?d.concat(Hs(o)):[d,Hs(o)]:Hs(o):d,scopeId:i.scopeId,slotScopeIds:i.slotScopeIds,children:p,target:i.target,targetAnchor:i.targetAnchor,staticCount:i.staticCount,shapeFlag:i.shapeFlag,patchFlag:o&&i.type!==yt?u===-1?16:u|16:u,dynamicProps:i.dynamicProps,dynamicChildren:i.dynamicChildren,appContext:i.appContext,dirs:i.dirs,transition:i.transition,component:i.component,suspense:i.suspense,ssContent:i.ssContent&&Sr(i.ssContent),ssFallback:i.ssFallback&&Sr(i.ssFallback),el:i.el,anchor:i.anchor,ctx:i.ctx,ce:i.ce}}function zl(i=" ",o=0){return Zn(ai,null,i,o)}function Gt(i){return i==null||typeof i=="boolean"?Zn(cs):Z(i)?Zn(yt,null,i.slice()):typeof i=="object"?xn(i):Zn(ai,null,String(i))}function xn(i){return i.el===null&&i.patchFlag!==-1||i.memo?i:Sr(i)}function No(i,o){let l=0;const{shapeFlag:h}=i;if(o==null)o=null;else if(Z(o))l=16;else if(typeof o=="object")if(h&65){const d=o.default;d&&(d._c&&(d._d=!1),No(i,d()),d._c&&(d._d=!0));return}else{l=32;const d=o._;!d&&!(ci in o)?o._ctx=Nt:d===3&&Nt&&(Nt.slots._===1?o._=1:(o._=2,i.patchFlag|=1024))}else re(o)?(o={default:o,_ctx:Nt},l=32):(o=String(o),h&64?(l=16,o=[zl(o)]):l=8);i.children=o,i.shapeFlag|=l}function Eg(...i){const o={};for(let l=0;l<i.length;l++){const h=i[l];for(const d in h)if(d==="class")o.class!==h.class&&(o.class=go([o.class,h.class]));else if(d==="style")o.style=fo([o.style,h.style]);else if(ei(d)){const u=o[d],p=h[d];p&&u!==p&&!(Z(u)&&u.includes(p))&&(o[d]=u?[].concat(u,p):p)}else d!==""&&(o[d]=h[d])}return o}function Ht(i,o,l,h=null){Pt(i,o,7,[l,h])}const Cg=$l();let Ng=0;function xg(i,o,l){const h=i.type,d=(o?o.appContext:i.appContext)||Cg,u={uid:Ng++,vnode:i,type:h,parent:o,appContext:d,root:null,next:null,subTree:null,effect:null,update:null,scope:new Wf(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:o?o.provides:Object.create(d.provides),accessCache:null,renderCache:[],components:null,directives:null,propsOptions:Ul(h,d),emitsOptions:Ol(h,d),emit:null,emitted:null,propsDefaults:Te,inheritAttrs:h.inheritAttrs,ctx:Te,data:Te,props:Te,attrs:Te,slots:Te,refs:Te,setupState:Te,setupContext:null,attrsProxy:null,slotsProxy:null,suspense:l,suspenseId:l?l.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return u.ctx={_:u},u.root=o?o.root:u,u.emit=Md.bind(null,u),i.ce&&i.ce(u),u}let We=null,xo,mr,zc="__VUE_INSTANCE_SETTERS__";(mr=Wi()[zc])||(mr=Wi()[zc]=[]),mr.push(i=>We=i),xo=i=>{mr.length>1?mr.forEach(o=>o(i)):mr[0](i)};const Ir=i=>{xo(i),i.scope.on()},Qn=()=>{We&&We.scope.off(),xo(null)};function Wl(i){return i.vnode.shapeFlag&4}let us=!1;function Og(i,o=!1){us=o;const{props:l,children:h}=i.vnode,d=Wl(i);fg(i,l,d,o),pg(i,h);const u=d?Pg(i,o):void 0;return us=!1,u}function Pg(i,o){const l=i.type;i.accessCache=Object.create(null),i.proxy=Il(new Proxy(i.ctx,rg));const{setup:h}=l;if(h){const d=i.setupContext=h.length>1?Rg(i):null;Ir(i),kr();const u=Pn(h,i,0,[i.props,d]);if(Er(),Qn(),ol(u)){if(u.then(Qn,Qn),o)return u.then(p=>{Wc(i,p,o)}).catch(p=>{si(p,i,0)});i.asyncDep=u}else Wc(i,u,o)}else Hl(i,o)}function Wc(i,o,l){re(o)?i.type.__ssrInlineRender?i.ssrRender=o:i.render=o:Ce(o)&&(i.setupState=kl(o)),Hl(i,l)}let Hc;function Hl(i,o,l){const h=i.type;if(!i.render){if(!o&&Hc&&!h.render){const d=h.template||Eo(i).template;if(d){const{isCustomElement:u,compilerOptions:p}=i.appContext.config,{delimiters:T,compilerOptions:v}=h,k=je(je({isCustomElement:u,delimiters:T},p),v);h.render=Hc(d,k)}}i.render=h.render||Ot}Ir(i),kr(),sg(i),Er(),Qn()}function Dg(i){return i.attrsProxy||(i.attrsProxy=new Proxy(i.attrs,{get(o,l){return rt(i,"get","$attrs"),o[l]}}))}function Rg(i){const o=l=>{i.exposed=l||{}};return{get attrs(){return Dg(i)},slots:i.slots,emit:i.emit,expose:o}}function li(i){if(i.exposed)return i.exposeProxy||(i.exposeProxy=new Proxy(kl(Il(i.exposed)),{get(o,l){if(l in o)return o[l];if(l in rs)return rs[l](i)},has(o,l){return l in o||l in rs}}))}function _g(i){return re(i)&&"__vccOpts"in i}const Mg=(i,o)=>Nd(i,o,us),Bg=Symbol.for("v-scx"),Lg=()=>Ws(Bg),$g="3.3.4",Fg="http://www.w3.org/2000/svg",Gn=typeof document<"u"?document:null,Gc=Gn&&Gn.createElement("template"),Ug={insert:(i,o,l)=>{o.insertBefore(i,l||null)},remove:i=>{const o=i.parentNode;o&&o.removeChild(i)},createElement:(i,o,l,h)=>{const d=o?Gn.createElementNS(Fg,i):Gn.createElement(i,l?{is:l}:void 0);return i==="select"&&h&&h.multiple!=null&&d.setAttribute("multiple",h.multiple),d},createText:i=>Gn.createTextNode(i),createComment:i=>Gn.createComment(i),setText:(i,o)=>{i.nodeValue=o},setElementText:(i,o)=>{i.textContent=o},parentNode:i=>i.parentNode,nextSibling:i=>i.nextSibling,querySelector:i=>Gn.querySelector(i),setScopeId(i,o){i.setAttribute(o,"")},insertStaticContent(i,o,l,h,d,u){const p=l?l.previousSibling:o.lastChild;if(d&&(d===u||d.nextSibling))for(;o.insertBefore(d.cloneNode(!0),l),!(d===u||!(d=d.nextSibling)););else{Gc.innerHTML=h?`<svg>${i}</svg>`:i;const T=Gc.content;if(h){const v=T.firstChild;for(;v.firstChild;)T.appendChild(v.firstChild);T.removeChild(v)}o.insertBefore(T,l)}return[p?p.nextSibling:o.firstChild,l?l.previousSibling:o.lastChild]}};function Jg(i,o,l){const h=i._vtc;h&&(o=(o?[o,...h]:[...h]).join(" ")),o==null?i.removeAttribute("class"):l?i.setAttribute("class",o):i.className=o}function jg(i,o,l){const h=i.style,d=$e(l);if(l&&!d){if(o&&!$e(o))for(const u in o)l[u]==null&&io(h,u,"");for(const u in l)io(h,u,l[u])}else{const u=h.display;d?o!==l&&(h.cssText=l):o&&i.removeAttribute("style"),"_vod"in i&&(h.display=u)}}const Yc=/\s*!important$/;function io(i,o,l){if(Z(l))l.forEach(h=>io(i,o,h));else if(l==null&&(l=""),o.startsWith("--"))i.setProperty(o,l);else{const h=qg(i,o);Yc.test(l)?i.setProperty(er(h),l.replace(Yc,""),"important"):i[h]=l}}const Xc=["Webkit","Moz","ms"],Ki={};function qg(i,o){const l=Ki[o];if(l)return l;let h=Ar(o);if(h!=="filter"&&h in i)return Ki[o]=h;h=ll(h);for(let d=0;d<Xc.length;d++){const u=Xc[d]+h;if(u in i)return Ki[o]=u}return o}const Zc="http://www.w3.org/1999/xlink";function Kg(i,o,l,h,d){if(h&&o.startsWith("xlink:"))l==null?i.removeAttributeNS(Zc,o.slice(6,o.length)):i.setAttributeNS(Zc,o,l);else{const u=zf(o);l==null||u&&!ul(l)?i.removeAttribute(o):i.setAttribute(o,u?"":l)}}function Vg(i,o,l,h,d,u,p){if(o==="innerHTML"||o==="textContent"){h&&p(h,d,u),i[o]=l==null?"":l;return}const T=i.tagName;if(o==="value"&&T!=="PROGRESS"&&!T.includes("-")){i._value=l;const k=T==="OPTION"?i.getAttribute("value"):i.value,N=l==null?"":l;k!==N&&(i.value=N),l==null&&i.removeAttribute(o);return}let v=!1;if(l===""||l==null){const k=typeof i[o];k==="boolean"?l=ul(l):l==null&&k==="string"?(l="",v=!0):k==="number"&&(l=0,v=!0)}try{i[o]=l}catch{}v&&i.removeAttribute(o)}function yr(i,o,l,h){i.addEventListener(o,l,h)}function zg(i,o,l,h){i.removeEventListener(o,l,h)}function Wg(i,o,l,h,d=null){const u=i._vei||(i._vei={}),p=u[o];if(h&&p)p.value=h;else{const[T,v]=Hg(o);if(h){const k=u[o]=Xg(h,d);yr(i,T,k,v)}else p&&(zg(i,T,p,v),u[o]=void 0)}}const Qc=/(?:Once|Passive|Capture)$/;function Hg(i){let o;if(Qc.test(i)){o={};let h;for(;h=i.match(Qc);)i=i.slice(0,i.length-h[0].length),o[h[0].toLowerCase()]=!0}return[i[2]===":"?i.slice(3):er(i.slice(2)),o]}let Vi=0;const Gg=Promise.resolve(),Yg=()=>Vi||(Gg.then(()=>Vi=0),Vi=Date.now());function Xg(i,o){const l=h=>{if(!h._vts)h._vts=Date.now();else if(h._vts<=l.attached)return;Pt(Zg(h,l.value),o,5,[h])};return l.value=i,l.attached=Yg(),l}function Zg(i,o){if(Z(o)){const l=i.stopImmediatePropagation;return i.stopImmediatePropagation=()=>{l.call(i),i._stopped=!0},o.map(h=>d=>!d._stopped&&h&&h(d))}else return o}const el=/^on[a-z]/,Qg=(i,o,l,h,d=!1,u,p,T,v)=>{o==="class"?Jg(i,h,d):o==="style"?jg(i,l,h):ei(o)?co(o)||Wg(i,o,l,h,p):(o[0]==="."?(o=o.slice(1),!0):o[0]==="^"?(o=o.slice(1),!1):ep(i,o,h,d))?Vg(i,o,h,u,p,T,v):(o==="true-value"?i._trueValue=h:o==="false-value"&&(i._falseValue=h),Kg(i,o,h,d))};function ep(i,o,l,h){return h?!!(o==="innerHTML"||o==="textContent"||o in i&&el.test(o)&&re(l)):o==="spellcheck"||o==="draggable"||o==="translate"||o==="form"||o==="list"&&i.tagName==="INPUT"||o==="type"&&i.tagName==="TEXTAREA"||el.test(o)&&$e(l)?!1:o in i}const tl=i=>{const o=i.props["onUpdate:modelValue"]||!1;return Z(o)?l=>Vs(o,l):o};function tp(i){i.target.composing=!0}function nl(i){const o=i.target;o.composing&&(o.composing=!1,o.dispatchEvent(new Event("input")))}const rl={created(i,{modifiers:{lazy:o,trim:l,number:h}},d){i._assign=tl(d);const u=h||d.props&&d.props.type==="number";yr(i,o?"change":"input",p=>{if(p.target.composing)return;let T=i.value;l&&(T=T.trim()),u&&(T=zi(T)),i._assign(T)}),l&&yr(i,"change",()=>{i.value=i.value.trim()}),o||(yr(i,"compositionstart",tp),yr(i,"compositionend",nl),yr(i,"change",nl))},mounted(i,{value:o}){i.value=o==null?"":o},beforeUpdate(i,{value:o,modifiers:{lazy:l,trim:h,number:d}},u){if(i._assign=tl(u),i.composing||document.activeElement===i&&i.type!=="range"&&(l||h&&i.value.trim()===o||(d||i.type==="number")&&zi(i.value)===o))return;const p=o==null?"":o;i.value!==p&&(i.value=p)}},np={esc:"escape",space:" ",up:"arrow-up",left:"arrow-left",right:"arrow-right",down:"arrow-down",delete:"backspace"},qs=(i,o)=>l=>{if(!("key"in l))return;const h=er(l.key);if(o.some(d=>d===h||np[d]===h))return i(l)},rp=je({patchProp:Qg},Ug);let sl;function sp(){return sl||(sl=yg(rp))}const ip=(...i)=>{const o=sp().createApp(...i),{mount:l}=o;return o.mount=h=>{const d=op(h);if(!d)return;const u=o._component;!re(u)&&!u.render&&!u.template&&(u.template=d.innerHTML),d.innerHTML="";const p=l(d,!1,d instanceof SVGElement);return d instanceof Element&&(d.removeAttribute("v-cloak"),d.setAttribute("data-v-app","")),p},o};function op(i){return $e(i)?document.querySelector(i):i}var ap=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function cp(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var oo={exports:{}};(function(i,o){(function(l,h){h(o)})(ap,function(l){var h=Object.defineProperty,d=(r,e,t)=>e in r?h(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,u=(r,e,t)=>(d(r,typeof e!="symbol"?e+"":e,t),t),p;(function(r){r[r.Canceled=1]="Canceled",r[r.Unknown=2]="Unknown",r[r.InvalidArgument=3]="InvalidArgument",r[r.DeadlineExceeded=4]="DeadlineExceeded",r[r.NotFound=5]="NotFound",r[r.AlreadyExists=6]="AlreadyExists",r[r.PermissionDenied=7]="PermissionDenied",r[r.ResourceExhausted=8]="ResourceExhausted",r[r.FailedPrecondition=9]="FailedPrecondition",r[r.Aborted=10]="Aborted",r[r.OutOfRange=11]="OutOfRange",r[r.Unimplemented=12]="Unimplemented",r[r.Internal=13]="Internal",r[r.Unavailable=14]="Unavailable",r[r.DataLoss=15]="DataLoss",r[r.Unauthenticated=16]="Unauthenticated"})(p||(p={}));function T(r){const e=p[r];return typeof e!="string"?r.toString():e[0].toLowerCase()+e.substring(1).replace(/[A-Z]/g,t=>"_"+t.toLowerCase())}class v extends Error{constructor(e,t=p.Unknown,n,s,a){super(k(e,t)),this.name="ConnectError",Object.setPrototypeOf(this,new.target.prototype),this.rawMessage=e,this.code=t,this.metadata=new Headers(n!=null?n:{}),this.details=s!=null?s:[],this.cause=a}static from(e,t=p.Unknown){return e instanceof v?e:e instanceof Error?e.name=="AbortError"?new v(e.message,p.Canceled):new v(e.message,t,void 0,void 0,e):new v(String(e),t,void 0,void 0,e)}static[Symbol.hasInstance](e){return e instanceof Error?Object.getPrototypeOf(e)===v.prototype?!0:e.name==="ConnectError"&&"code"in e&&typeof e.code=="number"&&"metadata"in e&&"details"in e&&Array.isArray(e.details)&&"rawMessage"in e&&typeof e.rawMessage=="string"&&"cause"in e:!1}findDetails(e){const t="typeName"in e?{findMessage:s=>s===e.typeName?e:void 0}:e,n=[];for(const s of this.details){if("getType"in s){t.findMessage(s.getType().typeName)&&n.push(s);continue}const a=t.findMessage(s.type);if(a)try{n.push(a.fromBinary(s.value))}catch{}}return n}}function k(r,e){return r.length?`[${T(e)}] ${r}`:`[${T(e)}]`}function N(r,e){if(!r)throw new Error(e)}const U=34028234663852886e22,j=-34028234663852886e22,ee=4294967295,Ne=2147483647,ie=-2147483648;function ke(r){if(typeof r!="number")throw new Error("invalid int 32: "+typeof r);if(!Number.isInteger(r)||r>Ne||r<ie)throw new Error("invalid int 32: "+r)}function Pe(r){if(typeof r!="number")throw new Error("invalid uint 32: "+typeof r);if(!Number.isInteger(r)||r>ee||r<0)throw new Error("invalid uint 32: "+r)}function _e(r){if(typeof r!="number")throw new Error("invalid float 32: "+typeof r);if(!!Number.isFinite(r)&&(r>U||r<j))throw new Error("invalid float 32: "+r)}const Me=Symbol("@bufbuild/protobuf/enum-type");function ne(r){const e=r[Me];return N(e,"missing enum type on enum object"),e}function vt(r,e,t,n){r[Me]=yn(e,t.map(s=>({no:s.no,name:s.name,localName:r[s.no]})))}function yn(r,e,t){const n=Object.create(null),s=Object.create(null),a=[];for(const c of e){const f=Dt(c);a.push(f),n[c.name]=f,s[c.no]=f}return{typeName:r,values:a,findName(c){return n[c]},findNumber(c){return s[c]}}}function tr(r,e,t){const n={};for(const s of e){const a=Dt(s);n[a.localName]=a.no,n[a.no]=a.localName}return vt(n,r,e),n}function Dt(r){return"localName"in r?r:Object.assign(Object.assign({},r),{localName:r.name})}class Be{equals(e){return this.getType().runtime.util.equals(this.getType(),this,e)}clone(){return this.getType().runtime.util.clone(this)}fromBinary(e,t){const n=this.getType(),s=n.runtime.bin,a=s.makeReadOptions(t);return s.readMessage(this,a.readerFactory(e),e.byteLength,a),this}fromJson(e,t){const n=this.getType(),s=n.runtime.json,a=s.makeReadOptions(t);return s.readMessage(n,e,a,this),this}fromJsonString(e,t){let n;try{n=JSON.parse(e)}catch(s){throw new Error(`cannot decode ${this.getType().typeName} from JSON: ${s instanceof Error?s.message:String(s)}`)}return this.fromJson(n,t)}toBinary(e){const t=this.getType(),n=t.runtime.bin,s=n.makeWriteOptions(e),a=s.writerFactory();return n.writeMessage(this,a,s),a.finish()}toJson(e){const t=this.getType(),n=t.runtime.json,s=n.makeWriteOptions(e);return n.writeMessage(this,s)}toJsonString(e){var t;const n=this.toJson(e);return JSON.stringify(n,null,(t=e==null?void 0:e.prettySpaces)!==null&&t!==void 0?t:0)}toJSON(){return this.toJson({emitDefaultValues:!0})}getType(){return Object.getPrototypeOf(this).constructor}}function Xt(r,e,t,n){var s;const a=(s=n==null?void 0:n.localName)!==null&&s!==void 0?s:e.substring(e.lastIndexOf(".")+1),c={[a]:function(f){r.util.initFields(this),r.util.initPartial(f,this)}}[a];return Object.setPrototypeOf(c.prototype,new Be),Object.assign(c,{runtime:r,typeName:e,fields:r.util.newFieldList(t),fromBinary(f,g){return new c().fromBinary(f,g)},fromJson(f,g){return new c().fromJson(f,g)},fromJsonString(f,g){return new c().fromJsonString(f,g)},equals(f,g){return r.util.equals(c,f,g)}}),c}function Rn(){let r=0,e=0;for(let n=0;n<28;n+=7){let s=this.buf[this.pos++];if(r|=(s&127)<<n,(s&128)==0)return this.assertBounds(),[r,e]}let t=this.buf[this.pos++];if(r|=(t&15)<<28,e=(t&112)>>4,(t&128)==0)return this.assertBounds(),[r,e];for(let n=3;n<=31;n+=7){let s=this.buf[this.pos++];if(e|=(s&127)<<n,(s&128)==0)return this.assertBounds(),[r,e]}throw new Error("invalid varint")}function vn(r,e,t){for(let a=0;a<28;a=a+7){const c=r>>>a,f=!(c>>>7==0&&e==0),g=(f?c|128:c)&255;if(t.push(g),!f)return}const n=r>>>28&15|(e&7)<<4,s=e>>3!=0;if(t.push((s?n|128:n)&255),!!s){for(let a=3;a<31;a=a+7){const c=e>>>a,f=c>>>7!=0,g=(f?c|128:c)&255;if(t.push(g),!f)return}t.push(e>>>31&1)}}const Zt=4294967296;function nr(r){const e=r[0]==="-";e&&(r=r.slice(1));const t=1e6;let n=0,s=0;function a(c,f){const g=Number(r.slice(c,f));s*=t,n=n*t+g,n>=Zt&&(s=s+(n/Zt|0),n=n%Zt)}return a(-24,-18),a(-18,-12),a(-12,-6),a(-6),e?Rt(n,s):fe(n,s)}function hs(r,e){let t=fe(r,e);const n=t.hi&2147483648;n&&(t=Rt(t.lo,t.hi));const s=Fe(t.lo,t.hi);return n?"-"+s:s}function Fe(r,e){if({lo:r,hi:e}=be(r,e),e<=2097151)return String(Zt*e+r);const t=r&16777215,n=(r>>>24|e<<8)&16777215,s=e>>16&65535;let a=t+n*6777216+s*6710656,c=n+s*8147497,f=s*2;const g=1e7;return a>=g&&(c+=Math.floor(a/g),a%=g),c>=g&&(f+=Math.floor(c/g),c%=g),f.toString()+_n(c)+_n(a)}function be(r,e){return{lo:r>>>0,hi:e>>>0}}function fe(r,e){return{lo:r|0,hi:e|0}}function Rt(r,e){return e=~e,r?r=~r+1:e+=1,fe(r,e)}const _n=r=>{const e=String(r);return"0000000".slice(e.length)+e};function _t(r,e){if(r>=0){for(;r>127;)e.push(r&127|128),r=r>>>7;e.push(r)}else{for(let t=0;t<9;t++)e.push(r&127|128),r=r>>7;e.push(1)}}function ht(){let r=this.buf[this.pos++],e=r&127;if((r&128)==0)return this.assertBounds(),e;if(r=this.buf[this.pos++],e|=(r&127)<<7,(r&128)==0)return this.assertBounds(),e;if(r=this.buf[this.pos++],e|=(r&127)<<14,(r&128)==0)return this.assertBounds(),e;if(r=this.buf[this.pos++],e|=(r&127)<<21,(r&128)==0)return this.assertBounds(),e;r=this.buf[this.pos++],e|=(r&15)<<28;for(let t=5;(r&128)!==0&&t<10;t++)r=this.buf[this.pos++];if((r&128)!=0)throw new Error("invalid varint");return this.assertBounds(),e>>>0}function fs(){const r=new DataView(new ArrayBuffer(8));if(typeof BigInt=="function"&&typeof r.getBigInt64=="function"&&typeof r.getBigUint64=="function"&&typeof r.setBigInt64=="function"&&typeof r.setBigUint64=="function"&&(typeof process!="object"||typeof process.env!="object"||{}.BUF_BIGINT_DISABLE!=="1")){const s=BigInt("-9223372036854775808"),a=BigInt("9223372036854775807"),c=BigInt("0"),f=BigInt("18446744073709551615");return{zero:BigInt(0),supported:!0,parse(g){const m=typeof g=="bigint"?g:BigInt(g);if(m>a||m<s)throw new Error(`int64 invalid: ${g}`);return m},uParse(g){const m=typeof g=="bigint"?g:BigInt(g);if(m>f||m<c)throw new Error(`uint64 invalid: ${g}`);return m},enc(g){return r.setBigInt64(0,this.parse(g),!0),{lo:r.getInt32(0,!0),hi:r.getInt32(4,!0)}},uEnc(g){return r.setBigInt64(0,this.uParse(g),!0),{lo:r.getInt32(0,!0),hi:r.getInt32(4,!0)}},dec(g,m){return r.setInt32(0,g,!0),r.setInt32(4,m,!0),r.getBigInt64(0,!0)},uDec(g,m){return r.setInt32(0,g,!0),r.setInt32(4,m,!0),r.getBigUint64(0,!0)}}}const t=s=>N(/^-?[0-9]+$/.test(s),`int64 invalid: ${s}`),n=s=>N(/^[0-9]+$/.test(s),`uint64 invalid: ${s}`);return{zero:"0",supported:!1,parse(s){return typeof s!="string"&&(s=s.toString()),t(s),s},uParse(s){return typeof s!="string"&&(s=s.toString()),n(s),s},enc(s){return typeof s!="string"&&(s=s.toString()),t(s),nr(s)},uEnc(s){return typeof s!="string"&&(s=s.toString()),n(s),nr(s)},dec(s,a){return hs(s,a)},uDec(s,a){return Fe(s,a)}}}const xe=fs();var I;(function(r){r[r.DOUBLE=1]="DOUBLE",r[r.FLOAT=2]="FLOAT",r[r.INT64=3]="INT64",r[r.UINT64=4]="UINT64",r[r.INT32=5]="INT32",r[r.FIXED64=6]="FIXED64",r[r.FIXED32=7]="FIXED32",r[r.BOOL=8]="BOOL",r[r.STRING=9]="STRING",r[r.BYTES=12]="BYTES",r[r.UINT32=13]="UINT32",r[r.SFIXED32=15]="SFIXED32",r[r.SFIXED64=16]="SFIXED64",r[r.SINT32=17]="SINT32",r[r.SINT64=18]="SINT64"})(I||(I={}));var Ue;(function(r){r[r.BIGINT=0]="BIGINT",r[r.STRING=1]="STRING"})(Ue||(Ue={}));function st(r,e,t){if(e===t)return!0;if(r==I.BYTES){if(!(e instanceof Uint8Array)||!(t instanceof Uint8Array)||e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}switch(r){case I.UINT64:case I.FIXED64:case I.INT64:case I.SFIXED64:case I.SINT64:return e==t}return!1}function Qt(r,e){switch(r){case I.BOOL:return!1;case I.UINT64:case I.FIXED64:case I.INT64:case I.SFIXED64:case I.SINT64:return e==0?xe.zero:"0";case I.DOUBLE:case I.FLOAT:return 0;case I.BYTES:return new Uint8Array(0);case I.STRING:return"";default:return 0}}function en(r,e){switch(r){case I.BOOL:return e===!1;case I.STRING:return e==="";case I.BYTES:return e instanceof Uint8Array&&!e.byteLength;default:return e==0}}var ve;(function(r){r[r.Varint=0]="Varint",r[r.Bit64=1]="Bit64",r[r.LengthDelimited=2]="LengthDelimited",r[r.StartGroup=3]="StartGroup",r[r.EndGroup=4]="EndGroup",r[r.Bit32=5]="Bit32"})(ve||(ve={}));class Cr{constructor(e){this.stack=[],this.textEncoder=e!=null?e:new TextEncoder,this.chunks=[],this.buf=[]}finish(){this.chunks.push(new Uint8Array(this.buf));let e=0;for(let s=0;s<this.chunks.length;s++)e+=this.chunks[s].length;let t=new Uint8Array(e),n=0;for(let s=0;s<this.chunks.length;s++)t.set(this.chunks[s],n),n+=this.chunks[s].length;return this.chunks=[],t}fork(){return this.stack.push({chunks:this.chunks,buf:this.buf}),this.chunks=[],this.buf=[],this}join(){let e=this.finish(),t=this.stack.pop();if(!t)throw new Error("invalid state, fork stack empty");return this.chunks=t.chunks,this.buf=t.buf,this.uint32(e.byteLength),this.raw(e)}tag(e,t){return this.uint32((e<<3|t)>>>0)}raw(e){return this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]),this.chunks.push(e),this}uint32(e){for(Pe(e);e>127;)this.buf.push(e&127|128),e=e>>>7;return this.buf.push(e),this}int32(e){return ke(e),_t(e,this.buf),this}bool(e){return this.buf.push(e?1:0),this}bytes(e){return this.uint32(e.byteLength),this.raw(e)}string(e){let t=this.textEncoder.encode(e);return this.uint32(t.byteLength),this.raw(t)}float(e){_e(e);let t=new Uint8Array(4);return new DataView(t.buffer).setFloat32(0,e,!0),this.raw(t)}double(e){let t=new Uint8Array(8);return new DataView(t.buffer).setFloat64(0,e,!0),this.raw(t)}fixed32(e){Pe(e);let t=new Uint8Array(4);return new DataView(t.buffer).setUint32(0,e,!0),this.raw(t)}sfixed32(e){ke(e);let t=new Uint8Array(4);return new DataView(t.buffer).setInt32(0,e,!0),this.raw(t)}sint32(e){return ke(e),e=(e<<1^e>>31)>>>0,_t(e,this.buf),this}sfixed64(e){let t=new Uint8Array(8),n=new DataView(t.buffer),s=xe.enc(e);return n.setInt32(0,s.lo,!0),n.setInt32(4,s.hi,!0),this.raw(t)}fixed64(e){let t=new Uint8Array(8),n=new DataView(t.buffer),s=xe.uEnc(e);return n.setInt32(0,s.lo,!0),n.setInt32(4,s.hi,!0),this.raw(t)}int64(e){let t=xe.enc(e);return vn(t.lo,t.hi,this.buf),this}sint64(e){let t=xe.enc(e),n=t.hi>>31,s=t.lo<<1^n,a=(t.hi<<1|t.lo>>>31)^n;return vn(s,a,this.buf),this}uint64(e){let t=xe.uEnc(e);return vn(t.lo,t.hi,this.buf),this}}class y{constructor(e,t){this.varint64=Rn,this.uint32=ht,this.buf=e,this.len=e.length,this.pos=0,this.view=new DataView(e.buffer,e.byteOffset,e.byteLength),this.textDecoder=t!=null?t:new TextDecoder}tag(){let e=this.uint32(),t=e>>>3,n=e&7;if(t<=0||n<0||n>5)throw new Error("illegal tag: field no "+t+" wire type "+n);return[t,n]}skip(e,t){let n=this.pos;switch(e){case ve.Varint:for(;this.buf[this.pos++]&128;);break;case ve.Bit64:this.pos+=4;case ve.Bit32:this.pos+=4;break;case ve.LengthDelimited:let s=this.uint32();this.pos+=s;break;case ve.StartGroup:for(;;){const[a,c]=this.tag();if(c===ve.EndGroup){if(t!==void 0&&a!==t)throw new Error("invalid end group tag");break}this.skip(c,a)}break;default:throw new Error("cant skip wire type "+e)}return this.assertBounds(),this.buf.subarray(n,this.pos)}assertBounds(){if(this.pos>this.len)throw new RangeError("premature EOF")}int32(){return this.uint32()|0}sint32(){let e=this.uint32();return e>>>1^-(e&1)}int64(){return xe.dec(...this.varint64())}uint64(){return xe.uDec(...this.varint64())}sint64(){let[e,t]=this.varint64(),n=-(e&1);return e=(e>>>1|(t&1)<<31)^n,t=t>>>1^n,xe.dec(e,t)}bool(){let[e,t]=this.varint64();return e!==0||t!==0}fixed32(){return this.view.getUint32((this.pos+=4)-4,!0)}sfixed32(){return this.view.getInt32((this.pos+=4)-4,!0)}fixed64(){return xe.uDec(this.sfixed32(),this.sfixed32())}sfixed64(){return xe.dec(this.sfixed32(),this.sfixed32())}float(){return this.view.getFloat32((this.pos+=4)-4,!0)}double(){return this.view.getFloat64((this.pos+=8)-8,!0)}bytes(){let e=this.uint32(),t=this.pos;return this.pos+=e,this.assertBounds(),this.buf.subarray(t,t+e)}string(){return this.textDecoder.decode(this.bytes())}}function w(r,e,t,n){let s;return{typeName:e,extendee:t,get field(){if(!s){const a=typeof n=="function"?n():n;a.name=e.split(".").pop(),a.jsonName=`[${e}]`,s=r.util.newFieldList([a]).list()[0]}return s},runtime:r}}function E(r){const e=r.field.localName,t=Object.create(null);return t[e]=P(r),[t,()=>t[e]]}function P(r){const e=r.field;if(e.repeated)return[];if(e.default!==void 0)return e.default;switch(e.kind){case"enum":return e.T.values[0].no;case"scalar":return Qt(e.T,e.L);case"message":const t=e.T,n=new t;return t.fieldWrapper?t.fieldWrapper.unwrapField(n):n;case"map":throw"map fields are not allowed to be extensions"}}function O(r,e){if(!e.repeated&&(e.kind=="enum"||e.kind=="scalar")){for(let t=r.length-1;t>=0;--t)if(r[t].no==e.no)return[r[t]];return[]}return r.filter(t=>t.no===e.no)}let _="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),$=[];for(let r=0;r<_.length;r++)$[_[r].charCodeAt(0)]=r;$["-".charCodeAt(0)]=_.indexOf("+"),$["_".charCodeAt(0)]=_.indexOf("/");const B={dec(r){let e=r.length*3/4;r[r.length-2]=="="?e-=2:r[r.length-1]=="="&&(e-=1);let t=new Uint8Array(e),n=0,s=0,a,c=0;for(let f=0;f<r.length;f++){if(a=$[r.charCodeAt(f)],a===void 0)switch(r[f]){case"=":s=0;case`
`:case"\r":case"	":case" ":continue;default:throw Error("invalid base64 string.")}switch(s){case 0:c=a,s=1;break;case 1:t[n++]=c<<2|(a&48)>>4,c=a,s=2;break;case 2:t[n++]=(c&15)<<4|(a&60)>>2,c=a,s=3;break;case 3:t[n++]=(c&3)<<6|a,s=0;break}}if(s==1)throw Error("invalid base64 string.");return t.subarray(0,n)},enc(r){let e="",t=0,n,s=0;for(let a=0;a<r.length;a++)switch(n=r[a],t){case 0:e+=_[n>>2],s=(n&3)<<4,t=1;break;case 1:e+=_[s|n>>4],s=(n&15)<<2,t=2;break;case 2:e+=_[s|n>>6],e+=_[n&63],t=0;break}return t&&(e+=_[s],e+="=",t==1&&(e+="=")),e}};function L(r,e,t){J(e,r);const n=e.runtime.bin.makeReadOptions(t),s=O(r.getType().runtime.bin.listUnknownFields(r),e.field),[a,c]=E(e);for(const f of s)e.runtime.bin.readField(a,n.readerFactory(f.data),e.field,f.wireType,n);return c()}function D(r,e,t,n){J(e,r);const s=e.runtime.bin.makeReadOptions(n),a=e.runtime.bin.makeWriteOptions(n);if(z(r,e)){const m=r.getType().runtime.bin.listUnknownFields(r).filter(b=>b.no!=e.field.no);r.getType().runtime.bin.discardUnknownFields(r);for(const b of m)r.getType().runtime.bin.onUnknownField(r,b.no,b.wireType,b.data)}const c=a.writerFactory();let f=e.field;!f.opt&&!f.repeated&&(f.kind=="enum"||f.kind=="scalar")&&(f=Object.assign(Object.assign({},e.field),{opt:!0})),e.runtime.bin.writeField(f,t,c,a);const g=s.readerFactory(c.finish());for(;g.pos<g.len;){const[m,b]=g.tag(),x=g.skip(b,m);r.getType().runtime.bin.onUnknownField(r,m,b,x)}}function z(r,e){const t=r.getType();return e.extendee.typeName===t.typeName&&!!t.runtime.bin.listUnknownFields(r).find(n=>n.no==e.field.no)}function J(r,e){N(r.extendee.typeName==e.getType().typeName,`extension ${r.typeName} can only be applied to message ${r.extendee.typeName}`)}function W(r,e){const t=r.localName;if(r.repeated)return e[t].length>0;if(r.oneof)return e[r.oneof.localName].case===t;switch(r.kind){case"enum":case"scalar":return r.opt||r.req?e[t]!==void 0:r.kind=="enum"?e[t]!==r.T.values[0].no:!en(r.T,e[t]);case"message":return e[t]!==void 0;case"map":return Object.keys(e[t]).length>0}}function Y(r,e){const t=r.localName,n=!r.opt&&!r.req;if(r.repeated)e[t]=[];else if(r.oneof)e[r.oneof.localName]={case:void 0};else switch(r.kind){case"map":e[t]={};break;case"enum":e[t]=n?r.T.values[0].no:void 0;break;case"scalar":e[t]=n?Qt(r.T,r.L):void 0;break;case"message":e[t]=void 0;break}}function Q(r,e){if(r===null||typeof r!="object"||!Object.getOwnPropertyNames(Be.prototype).every(n=>n in r&&typeof r[n]=="function"))return!1;const t=r.getType();return t===null||typeof t!="function"||!("typeName"in t)||typeof t.typeName!="string"?!1:e===void 0?!0:t.typeName==e.typeName}function de(r,e){return Q(e)||!r.fieldWrapper?e:r.fieldWrapper.wrapField(e)}I.DOUBLE,I.FLOAT,I.INT64,I.UINT64,I.INT32,I.UINT32,I.BOOL,I.STRING,I.BYTES;const he={ignoreUnknownFields:!1},Ee={emitDefaultValues:!1,enumAsInteger:!1,useProtoFieldName:!1,prettySpaces:0};function it(r){return r?Object.assign(Object.assign({},he),r):he}function Tn(r){return r?Object.assign(Object.assign({},Ee),r):Ee}const Mn=Symbol(),Mt=Symbol();function ds(){return{makeReadOptions:it,makeWriteOptions:Tn,readMessage(r,e,t,n){if(e==null||Array.isArray(e)||typeof e!="object")throw new Error(`cannot decode message ${r.typeName} from JSON: ${we(e)}`);n=n!=null?n:new r;const s=new Map,a=t.typeRegistry;for(const[c,f]of Object.entries(e)){const g=r.fields.findJsonName(c);if(g){if(g.oneof){if(f===null&&g.kind=="scalar")continue;const m=s.get(g.oneof);if(m!==void 0)throw new Error(`cannot decode message ${r.typeName} from JSON: multiple keys for oneof "${g.oneof.name}" present: "${m}", "${c}"`);s.set(g.oneof,c)}ot(n,f,g,t,r)}else{let m=!1;if((a==null?void 0:a.findExtension)&&c.startsWith("[")&&c.endsWith("]")){const b=a.findExtension(c.substring(1,c.length-1));if(b&&b.extendee.typeName==r.typeName){m=!0;const[x,C]=E(b);ot(x,f,b.field,t,b),D(n,b,C(),t)}}if(!m&&!t.ignoreUnknownFields)throw new Error(`cannot decode message ${r.typeName} from JSON: key "${c}" is unknown`)}}return n},writeMessage(r,e){const t=r.getType(),n={};let s;try{for(s of t.fields.byNumber()){if(!W(s,r)){if(s.req)throw"required field not set";if(!e.emitDefaultValues||!Yl(s))continue}const c=s.oneof?r[s.oneof.localName].value:r[s.localName],f=Oo(s,c,e);f!==void 0&&(n[e.useProtoFieldName?s.name:s.jsonName]=f)}const a=e.typeRegistry;if(a!=null&&a.findExtensionFor)for(const c of t.runtime.bin.listUnknownFields(r)){const f=a.findExtensionFor(t.typeName,c.no);if(f&&z(r,f)){const g=L(r,f,e),m=Oo(f.field,g,e);m!==void 0&&(n[f.field.jsonName]=m)}}}catch(a){const c=s?`cannot encode field ${t.typeName}.${s.name} to JSON`:`cannot encode message ${t.typeName} to JSON`,f=a instanceof Error?a.message:String(a);throw new Error(c+(f.length>0?`: ${f}`:""))}return n},readScalar(r,e,t){return Nr(r,e,t!=null?t:Ue.BIGINT,!0)},writeScalar(r,e,t){if(e!==void 0&&(t||en(r,e)))return ps(r,e)},debug:we}}function we(r){if(r===null)return"null";switch(typeof r){case"object":return Array.isArray(r)?"array":"object";case"string":return r.length>100?"string":`"${r.split('"').join('\\"')}"`;default:return String(r)}}function ot(r,e,t,n,s){let a=t.localName;if(t.repeated){if(N(t.kind!="map"),e===null)return;if(!Array.isArray(e))throw new Error(`cannot decode field ${s.typeName}.${t.name} from JSON: ${we(e)}`);const c=r[a];for(const f of e){if(f===null)throw new Error(`cannot decode field ${s.typeName}.${t.name} from JSON: ${we(f)}`);switch(t.kind){case"message":c.push(t.T.fromJson(f,n));break;case"enum":const g=ui(t.T,f,n.ignoreUnknownFields,!0);g!==Mt&&c.push(g);break;case"scalar":try{c.push(Nr(t.T,f,t.L,!0))}catch(m){let b=`cannot decode field ${s.typeName}.${t.name} from JSON: ${we(f)}`;throw m instanceof Error&&m.message.length>0&&(b+=`: ${m.message}`),new Error(b)}break}}}else if(t.kind=="map"){if(e===null)return;if(typeof e!="object"||Array.isArray(e))throw new Error(`cannot decode field ${s.typeName}.${t.name} from JSON: ${we(e)}`);const c=r[a];for(const[f,g]of Object.entries(e)){if(g===null)throw new Error(`cannot decode field ${s.typeName}.${t.name} from JSON: map value null`);let m;try{m=gs(t.K,f)}catch(b){let x=`cannot decode map key for field ${s.typeName}.${t.name} from JSON: ${we(e)}`;throw b instanceof Error&&b.message.length>0&&(x+=`: ${b.message}`),new Error(x)}switch(t.V.kind){case"message":c[m]=t.V.T.fromJson(g,n);break;case"enum":const b=ui(t.V.T,g,n.ignoreUnknownFields,!0);b!==Mt&&(c[m]=b);break;case"scalar":try{c[m]=Nr(t.V.T,g,Ue.BIGINT,!0)}catch(x){let C=`cannot decode map value for field ${s.typeName}.${t.name} from JSON: ${we(e)}`;throw x instanceof Error&&x.message.length>0&&(C+=`: ${x.message}`),new Error(C)}break}}}else switch(t.oneof&&(r=r[t.oneof.localName]={case:a},a="value"),t.kind){case"message":const c=t.T;if(e===null&&c.typeName!="google.protobuf.Value")return;let f=r[a];Q(f)?f.fromJson(e,n):(r[a]=f=c.fromJson(e,n),c.fieldWrapper&&!t.oneof&&(r[a]=c.fieldWrapper.unwrapField(f)));break;case"enum":const g=ui(t.T,e,n.ignoreUnknownFields,!1);switch(g){case Mn:Y(t,r);break;case Mt:break;default:r[a]=g;break}break;case"scalar":try{const m=Nr(t.T,e,t.L,!1);switch(m){case Mn:Y(t,r);break;default:r[a]=m;break}}catch(m){let b=`cannot decode field ${s.typeName}.${t.name} from JSON: ${we(e)}`;throw m instanceof Error&&m.message.length>0&&(b+=`: ${m.message}`),new Error(b)}break}}function gs(r,e){if(r===I.BOOL)switch(e){case"true":e=!0;break;case"false":e=!1;break}return Nr(r,e,Ue.BIGINT,!0).toString()}function Nr(r,e,t,n){if(e===null)return n?Qt(r,t):Mn;switch(r){case I.DOUBLE:case I.FLOAT:if(e==="NaN")return Number.NaN;if(e==="Infinity")return Number.POSITIVE_INFINITY;if(e==="-Infinity")return Number.NEGATIVE_INFINITY;if(e===""||typeof e=="string"&&e.trim().length!==e.length||typeof e!="string"&&typeof e!="number")break;const s=Number(e);if(Number.isNaN(s)||!Number.isFinite(s))break;return r==I.FLOAT&&_e(s),s;case I.INT32:case I.FIXED32:case I.SFIXED32:case I.SINT32:case I.UINT32:let a;if(typeof e=="number"?a=e:typeof e=="string"&&e.length>0&&e.trim().length===e.length&&(a=Number(e)),a===void 0)break;return r==I.UINT32||r==I.FIXED32?Pe(a):ke(a),a;case I.INT64:case I.SFIXED64:case I.SINT64:if(typeof e!="number"&&typeof e!="string")break;const c=xe.parse(e);return t?c.toString():c;case I.FIXED64:case I.UINT64:if(typeof e!="number"&&typeof e!="string")break;const f=xe.uParse(e);return t?f.toString():f;case I.BOOL:if(typeof e!="boolean")break;return e;case I.STRING:if(typeof e!="string")break;try{encodeURIComponent(e)}catch{throw new Error("invalid UTF8")}return e;case I.BYTES:if(e==="")return new Uint8Array(0);if(typeof e!="string")break;return B.dec(e)}throw new Error}function ui(r,e,t,n){if(e===null)return r.typeName=="google.protobuf.NullValue"?0:n?r.values[0].no:Mn;switch(typeof e){case"number":if(Number.isInteger(e))return e;break;case"string":const s=r.findName(e);if(s!==void 0)return s.no;if(t)return Mt;break}throw new Error(`cannot decode enum ${r.typeName} from JSON: ${we(e)}`)}function Yl(r){return r.repeated||r.kind=="map"?!0:!(r.oneof||r.kind=="message"||r.opt||r.req)}function Oo(r,e,t){if(r.kind=="map"){N(typeof e=="object"&&e!=null);const n={},s=Object.entries(e);switch(r.V.kind){case"scalar":for(const[c,f]of s)n[c.toString()]=ps(r.V.T,f);break;case"message":for(const[c,f]of s)n[c.toString()]=f.toJson(t);break;case"enum":const a=r.V.T;for(const[c,f]of s)n[c.toString()]=hi(a,f,t.enumAsInteger);break}return t.emitDefaultValues||s.length>0?n:void 0}if(r.repeated){N(Array.isArray(e));const n=[];switch(r.kind){case"scalar":for(let s=0;s<e.length;s++)n.push(ps(r.T,e[s]));break;case"enum":for(let s=0;s<e.length;s++)n.push(hi(r.T,e[s],t.enumAsInteger));break;case"message":for(let s=0;s<e.length;s++)n.push(e[s].toJson(t));break}return t.emitDefaultValues||n.length>0?n:void 0}switch(r.kind){case"scalar":return ps(r.T,e);case"enum":return hi(r.T,e,t.enumAsInteger);case"message":return de(r.T,e).toJson(t)}}function hi(r,e,t){var n;if(N(typeof e=="number"),r.typeName=="google.protobuf.NullValue")return null;if(t)return e;const s=r.findNumber(e);return(n=s==null?void 0:s.name)!==null&&n!==void 0?n:e}function ps(r,e){switch(r){case I.INT32:case I.SFIXED32:case I.SINT32:case I.FIXED32:case I.UINT32:return N(typeof e=="number"),e;case I.FLOAT:case I.DOUBLE:return N(typeof e=="number"),Number.isNaN(e)?"NaN":e===Number.POSITIVE_INFINITY?"Infinity":e===Number.NEGATIVE_INFINITY?"-Infinity":e;case I.STRING:return N(typeof e=="string"),e;case I.BOOL:return N(typeof e=="boolean"),e;case I.UINT64:case I.FIXED64:case I.INT64:case I.SFIXED64:case I.SINT64:return N(typeof e=="bigint"||typeof e=="string"||typeof e=="number"),e.toString();case I.BYTES:return N(e instanceof Uint8Array),B.enc(e)}}const rr=Symbol("@bufbuild/protobuf/unknown-fields"),Po={readUnknownFields:!0,readerFactory:r=>new y(r)},Do={writeUnknownFields:!0,writerFactory:()=>new Cr};function Xl(r){return r?Object.assign(Object.assign({},Po),r):Po}function Zl(r){return r?Object.assign(Object.assign({},Do),r):Do}function Ql(){return{makeReadOptions:Xl,makeWriteOptions:Zl,listUnknownFields(r){var e;return(e=r[rr])!==null&&e!==void 0?e:[]},discardUnknownFields(r){delete r[rr]},writeUnknownFields(r,e){const n=r[rr];if(n)for(const s of n)e.tag(s.no,s.wireType).raw(s.data)},onUnknownField(r,e,t,n){const s=r;Array.isArray(s[rr])||(s[rr]=[]),s[rr].push({no:e,wireType:t,data:n})},readMessage(r,e,t,n,s){const a=r.getType(),c=s?e.len:e.pos+t;let f,g;for(;e.pos<c&&([f,g]=e.tag(),!(s===!0&&g==ve.EndGroup));){const m=a.fields.find(f);if(!m){const b=e.skip(g,f);n.readUnknownFields&&this.onUnknownField(r,f,g,b);continue}Ro(r,e,m,g,n)}if(s&&(g!=ve.EndGroup||f!==t))throw new Error("invalid end group tag")},readField:Ro,writeMessage(r,e,t){const n=r.getType();for(const s of n.fields.byNumber()){if(!W(s,r)){if(s.req)throw new Error(`cannot encode field ${n.typeName}.${s.name} to binary: required field not set`);continue}const a=s.oneof?r[s.oneof.localName].value:r[s.localName];_o(s,a,e,t)}return t.writeUnknownFields&&this.writeUnknownFields(r,e),e},writeField(r,e,t,n){e!==void 0&&_o(r,e,t,n)}}}function Ro(r,e,t,n,s){let{repeated:a,localName:c}=t;switch(t.oneof&&(r=r[t.oneof.localName],r.case!=c&&delete r.value,r.case=c,c="value"),t.kind){case"scalar":case"enum":const f=t.kind=="enum"?I.INT32:t.T;let g=ys;if(t.kind=="scalar"&&t.L>0&&(g=tu),a){let C=r[c];if(n==ve.LengthDelimited&&f!=I.STRING&&f!=I.BYTES){let F=e.uint32()+e.pos;for(;e.pos<F;)C.push(g(e,f))}else C.push(g(e,f))}else r[c]=g(e,f);break;case"message":const m=t.T;a?r[c].push(ms(e,new m,s,t)):Q(r[c])?ms(e,r[c],s,t):(r[c]=ms(e,new m,s,t),m.fieldWrapper&&!t.oneof&&!t.repeated&&(r[c]=m.fieldWrapper.unwrapField(r[c])));break;case"map":let[b,x]=eu(t,e,s);r[c][b]=x;break}}function ms(r,e,t,n){const s=e.getType().runtime.bin,a=n==null?void 0:n.delimited;return s.readMessage(e,r,a?n.no:r.uint32(),t,a),e}function eu(r,e,t){const n=e.uint32(),s=e.pos+n;let a,c;for(;e.pos<s;){const[f]=e.tag();switch(f){case 1:a=ys(e,r.K);break;case 2:switch(r.V.kind){case"scalar":c=ys(e,r.V.T);break;case"enum":c=e.int32();break;case"message":c=ms(e,new r.V.T,t,void 0);break}break}}if(a===void 0&&(a=Qt(r.K,Ue.BIGINT)),typeof a!="string"&&typeof a!="number"&&(a=a.toString()),c===void 0)switch(r.V.kind){case"scalar":c=Qt(r.V.T,Ue.BIGINT);break;case"enum":c=r.V.T.values[0].no;break;case"message":c=new r.V.T;break}return[a,c]}function tu(r,e){const t=ys(r,e);return typeof t=="bigint"?t.toString():t}function ys(r,e){switch(e){case I.STRING:return r.string();case I.BOOL:return r.bool();case I.DOUBLE:return r.double();case I.FLOAT:return r.float();case I.INT32:return r.int32();case I.INT64:return r.int64();case I.UINT64:return r.uint64();case I.FIXED64:return r.fixed64();case I.BYTES:return r.bytes();case I.FIXED32:return r.fixed32();case I.SFIXED32:return r.sfixed32();case I.SFIXED64:return r.sfixed64();case I.SINT64:return r.sint64();case I.UINT32:return r.uint32();case I.SINT32:return r.sint32()}}function _o(r,e,t,n){N(e!==void 0);const s=r.repeated;switch(r.kind){case"scalar":case"enum":let a=r.kind=="enum"?I.INT32:r.T;if(s)if(N(Array.isArray(e)),r.packed)ru(t,a,r.no,e);else for(const c of e)xr(t,a,r.no,c);else xr(t,a,r.no,e);break;case"message":if(s){N(Array.isArray(e));for(const c of e)Mo(t,n,r,c)}else Mo(t,n,r,e);break;case"map":N(typeof e=="object"&&e!=null);for(const[c,f]of Object.entries(e))nu(t,n,r,c,f);break}}function nu(r,e,t,n,s){r.tag(t.no,ve.LengthDelimited),r.fork();let a=n;switch(t.K){case I.INT32:case I.FIXED32:case I.UINT32:case I.SFIXED32:case I.SINT32:a=Number.parseInt(n);break;case I.BOOL:N(n=="true"||n=="false"),a=n=="true";break}switch(xr(r,t.K,1,a),t.V.kind){case"scalar":xr(r,t.V.T,2,s);break;case"enum":xr(r,I.INT32,2,s);break;case"message":N(s!==void 0),r.tag(2,ve.LengthDelimited).bytes(s.toBinary(e));break}r.join()}function Mo(r,e,t,n){const s=de(t.T,n);t.delimited?r.tag(t.no,ve.StartGroup).raw(s.toBinary(e)).tag(t.no,ve.EndGroup):r.tag(t.no,ve.LengthDelimited).bytes(s.toBinary(e))}function xr(r,e,t,n){N(n!==void 0);let[s,a]=Bo(e);r.tag(t,s)[a](n)}function ru(r,e,t,n){if(!n.length)return;r.tag(t,ve.LengthDelimited).fork();let[,s]=Bo(e);for(let a=0;a<n.length;a++)r[s](n[a]);r.join()}function Bo(r){let e=ve.Varint;switch(r){case I.BYTES:case I.STRING:e=ve.LengthDelimited;break;case I.DOUBLE:case I.FIXED64:case I.SFIXED64:e=ve.Bit64;break;case I.FIXED32:case I.SFIXED32:case I.FLOAT:e=ve.Bit32;break}const t=I[r].toLowerCase();return[e,t]}function su(){return{setEnumType:vt,initPartial(r,e){if(r===void 0)return;const t=e.getType();for(const n of t.fields.byMember()){const s=n.localName,a=e,c=r;if(c[s]!=null)switch(n.kind){case"oneof":const f=c[s].case;if(f===void 0)continue;const g=n.findField(f);let m=c[s].value;g&&g.kind=="message"&&!Q(m,g.T)?m=new g.T(m):g&&g.kind==="scalar"&&g.T===I.BYTES&&(m=Or(m)),a[s]={case:f,value:m};break;case"scalar":case"enum":let b=c[s];n.T===I.BYTES&&(b=n.repeated?b.map(Or):Or(b)),a[s]=b;break;case"map":switch(n.V.kind){case"scalar":case"enum":if(n.V.T===I.BYTES)for(const[S,F]of Object.entries(c[s]))a[s][S]=Or(F);else Object.assign(a[s],c[s]);break;case"message":const C=n.V.T;for(const S of Object.keys(c[s])){let F=c[s][S];C.fieldWrapper||(F=new C(F)),a[s][S]=F}break}break;case"message":const x=n.T;if(n.repeated)a[s]=c[s].map(C=>Q(C,x)?C:new x(C));else{const C=c[s];x.fieldWrapper?x.typeName==="google.protobuf.BytesValue"?a[s]=Or(C):a[s]=C:a[s]=Q(C,x)?C:new x(C)}break}}},equals(r,e,t){return e===t?!0:!e||!t?!1:r.fields.byMember().every(n=>{const s=e[n.localName],a=t[n.localName];if(n.repeated){if(s.length!==a.length)return!1;switch(n.kind){case"message":return s.every((c,f)=>n.T.equals(c,a[f]));case"scalar":return s.every((c,f)=>st(n.T,c,a[f]));case"enum":return s.every((c,f)=>st(I.INT32,c,a[f]))}throw new Error(`repeated cannot contain ${n.kind}`)}switch(n.kind){case"message":return n.T.equals(s,a);case"enum":return st(I.INT32,s,a);case"scalar":return st(n.T,s,a);case"oneof":if(s.case!==a.case)return!1;const c=n.findField(s.case);if(c===void 0)return!0;switch(c.kind){case"message":return c.T.equals(s.value,a.value);case"enum":return st(I.INT32,s.value,a.value);case"scalar":return st(c.T,s.value,a.value)}throw new Error(`oneof cannot contain ${c.kind}`);case"map":const f=Object.keys(s).concat(Object.keys(a));switch(n.V.kind){case"message":const g=n.V.T;return f.every(b=>g.equals(s[b],a[b]));case"enum":return f.every(b=>st(I.INT32,s[b],a[b]));case"scalar":const m=n.V.T;return f.every(b=>st(m,s[b],a[b]))}break}})},clone(r){const e=r.getType(),t=new e,n=t;for(const s of e.fields.byMember()){const a=r[s.localName];let c;if(s.repeated)c=a.map(vs);else if(s.kind=="map"){c=n[s.localName];for(const[f,g]of Object.entries(a))c[f]=vs(g)}else s.kind=="oneof"?c=s.findField(a.case)?{case:a.case,value:vs(a.value)}:{case:void 0}:c=vs(a);n[s.localName]=c}for(const s of e.runtime.bin.listUnknownFields(r))e.runtime.bin.onUnknownField(n,s.no,s.wireType,s.data);return t}}}function vs(r){if(r===void 0)return r;if(Q(r))return r.clone();if(r instanceof Uint8Array){const e=new Uint8Array(r.byteLength);return e.set(r),e}return r}function Or(r){return r instanceof Uint8Array?r:new Uint8Array(r)}function iu(r,e,t){return{syntax:r,json:ds(),bin:Ql(),util:Object.assign(Object.assign({},su()),{newFieldList:e,initFields:t}),makeMessageType(n,s,a){return Xt(this,n,s,a)},makeEnum:tr,makeEnumType:yn,getEnumType:ne,makeExtension(n,s,a){return w(this,n,s,a)}}}class ou{constructor(e,t){this._fields=e,this._normalizer=t}findJsonName(e){if(!this.jsonNames){const t={};for(const n of this.list())t[n.jsonName]=t[n.name]=n;this.jsonNames=t}return this.jsonNames[e]}find(e){if(!this.numbers){const t={};for(const n of this.list())t[n.no]=n;this.numbers=t}return this.numbers[e]}list(){return this.all||(this.all=this._normalizer(this._fields)),this.all}byNumber(){return this.numbersAsc||(this.numbersAsc=this.list().concat().sort((e,t)=>e.no-t.no)),this.numbersAsc}byMember(){if(!this.members){this.members=[];const e=this.members;let t;for(const n of this.list())n.oneof?n.oneof!==t&&(t=n.oneof,e.push(t)):e.push(n)}return this.members}}function Lo(r,e){const t=$o(r);return e?t:fu(hu(t))}function au(r){return Lo(r,!1)}const cu=$o;function $o(r){let e=!1;const t=[];for(let n=0;n<r.length;n++){let s=r.charAt(n);switch(s){case"_":e=!0;break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":t.push(s),e=!1;break;default:e&&(e=!1,s=s.toUpperCase()),t.push(s);break}}return t.join("")}const lu=new Set(["constructor","toString","toJSON","valueOf"]),uu=new Set(["getType","clone","equals","fromBinary","fromJson","fromJsonString","toBinary","toJson","toJsonString","toObject"]),Fo=r=>`${r}$`,hu=r=>uu.has(r)?Fo(r):r,fu=r=>lu.has(r)?Fo(r):r;class du{constructor(e){this.kind="oneof",this.repeated=!1,this.packed=!1,this.opt=!1,this.req=!1,this.default=void 0,this.fields=[],this.name=e,this.localName=au(e)}addField(e){N(e.oneof===this,`field ${e.name} not one of ${this.name}`),this.fields.push(e)}findField(e){if(!this._lookup){this._lookup=Object.create(null);for(let t=0;t<this.fields.length;t++)this._lookup[this.fields[t].localName]=this.fields[t]}return this._lookup[e]}}function gu(r,e){var t,n,s,a,c,f;const g=[];let m;for(const b of typeof r=="function"?r():r){const x=b;if(x.localName=Lo(b.name,b.oneof!==void 0),x.jsonName=(t=b.jsonName)!==null&&t!==void 0?t:cu(b.name),x.repeated=(n=b.repeated)!==null&&n!==void 0?n:!1,b.kind=="scalar"&&(x.L=(s=b.L)!==null&&s!==void 0?s:Ue.BIGINT),x.delimited=(a=b.delimited)!==null&&a!==void 0?a:!1,x.req=(c=b.req)!==null&&c!==void 0?c:!1,x.opt=(f=b.opt)!==null&&f!==void 0?f:!1,b.packed===void 0&&(e?x.packed=b.kind=="enum"||b.kind=="scalar"&&b.T!=I.BYTES&&b.T!=I.STRING:x.packed=!1),b.oneof!==void 0){const C=typeof b.oneof=="string"?b.oneof:b.oneof.name;(!m||m.name!=C)&&(m=new du(C)),x.oneof=m,m.addField(x)}g.push(x)}return g}const A=iu("proto3",r=>new ou(r,e=>gu(e,!0)),r=>{for(const e of r.getType().fields.byMember()){if(e.opt)continue;const t=e.localName,n=r;if(e.repeated){n[t]=[];continue}switch(e.kind){case"oneof":n[t]={case:void 0};break;case"enum":n[t]=0;break;case"map":n[t]={};break;case"scalar":n[t]=Qt(e.T,e.L);break}}});var He;(function(r){r[r.Unary=0]="Unary",r[r.ServerStreaming=1]="ServerStreaming",r[r.ClientStreaming=2]="ClientStreaming",r[r.BiDiStreaming=3]="BiDiStreaming"})(He||(He={}));var Uo;(function(r){r[r.NoSideEffects=1]="NoSideEffects",r[r.Idempotent=2]="Idempotent"})(Uo||(Uo={}));class qe extends Be{constructor(e){super(),this.seconds=xe.zero,this.nanos=0,A.util.initPartial(e,this)}fromJson(e,t){if(typeof e!="string")throw new Error(`cannot decode google.protobuf.Timestamp from JSON: ${A.json.debug(e)}`);const n=e.match(/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2}):([0-9]{2})(?:Z|\.([0-9]{3,9})Z|([+-][0-9][0-9]:[0-9][0-9]))$/);if(!n)throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");const s=Date.parse(n[1]+"-"+n[2]+"-"+n[3]+"T"+n[4]+":"+n[5]+":"+n[6]+(n[8]?n[8]:"Z"));if(Number.isNaN(s))throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");if(s<Date.parse("0001-01-01T00:00:00Z")||s>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot decode message google.protobuf.Timestamp from JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");return this.seconds=xe.parse(s/1e3),this.nanos=0,n[7]&&(this.nanos=parseInt("1"+n[7]+"0".repeat(9-n[7].length))-1e9),this}toJson(e){const t=Number(this.seconds)*1e3;if(t<Date.parse("0001-01-01T00:00:00Z")||t>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot encode google.protobuf.Timestamp to JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");if(this.nanos<0)throw new Error("cannot encode google.protobuf.Timestamp to JSON: nanos must not be negative");let n="Z";if(this.nanos>0){const s=(this.nanos+1e9).toString().substring(1);s.substring(3)==="000000"?n="."+s.substring(0,3)+"Z":s.substring(6)==="000"?n="."+s.substring(0,6)+"Z":n="."+s+"Z"}return new Date(t).toISOString().replace(".000Z",n)}toDate(){return new Date(Number(this.seconds)*1e3+Math.ceil(this.nanos/1e6))}static now(){return qe.fromDate(new Date)}static fromDate(e){const t=e.getTime();return new qe({seconds:xe.parse(Math.floor(t/1e3)),nanos:t%1e3*1e6})}static fromBinary(e,t){return new qe().fromBinary(e,t)}static fromJson(e,t){return new qe().fromJson(e,t)}static fromJsonString(e,t){return new qe().fromJsonString(e,t)}static equals(e,t){return A.util.equals(qe,e,t)}}qe.runtime=A,qe.typeName="google.protobuf.Timestamp",qe.fields=A.util.newFieldList(()=>[{no:1,name:"seconds",kind:"scalar",T:3},{no:2,name:"nanos",kind:"scalar",T:5}]);class tn extends Be{constructor(e){super(),this.seconds=xe.zero,this.nanos=0,A.util.initPartial(e,this)}fromJson(e,t){if(typeof e!="string")throw new Error(`cannot decode google.protobuf.Duration from JSON: ${A.json.debug(e)}`);const n=e.match(/^(-?[0-9]+)(?:\.([0-9]+))?s/);if(n===null)throw new Error(`cannot decode google.protobuf.Duration from JSON: ${A.json.debug(e)}`);const s=Number(n[1]);if(s>315576e6||s<-315576e6)throw new Error(`cannot decode google.protobuf.Duration from JSON: ${A.json.debug(e)}`);if(this.seconds=xe.parse(s),typeof n[2]=="string"){const a=n[2]+"0".repeat(9-n[2].length);this.nanos=parseInt(a),(s<0||Object.is(s,-0))&&(this.nanos=-this.nanos)}return this}toJson(e){if(Number(this.seconds)>315576e6||Number(this.seconds)<-315576e6)throw new Error("cannot encode google.protobuf.Duration to JSON: value out of range");let t=this.seconds.toString();if(this.nanos!==0){let n=Math.abs(this.nanos).toString();n="0".repeat(9-n.length)+n,n.substring(3)==="000000"?n=n.substring(0,3):n.substring(6)==="000"&&(n=n.substring(0,6)),t+="."+n,this.nanos<0&&Number(this.seconds)==0&&(t="-"+t)}return t+"s"}static fromBinary(e,t){return new tn().fromBinary(e,t)}static fromJson(e,t){return new tn().fromJson(e,t)}static fromJsonString(e,t){return new tn().fromJsonString(e,t)}static equals(e,t){return A.util.equals(tn,e,t)}}tn.runtime=A,tn.typeName="google.protobuf.Duration",tn.fields=A.util.newFieldList(()=>[{no:1,name:"seconds",kind:"scalar",T:3},{no:2,name:"nanos",kind:"scalar",T:5}]);class Bt extends Be{constructor(e){super(),this.typeUrl="",this.value=new Uint8Array(0),A.util.initPartial(e,this)}toJson(e){var t;if(this.typeUrl==="")return{};const n=this.typeUrlToName(this.typeUrl),s=(t=e==null?void 0:e.typeRegistry)===null||t===void 0?void 0:t.findMessage(n);if(!s)throw new Error(`cannot encode message google.protobuf.Any to JSON: "${this.typeUrl}" is not in the type registry`);let c=s.fromBinary(this.value).toJson(e);return(n.startsWith("google.protobuf.")||c===null||Array.isArray(c)||typeof c!="object")&&(c={value:c}),c["@type"]=this.typeUrl,c}fromJson(e,t){var n;if(e===null||Array.isArray(e)||typeof e!="object")throw new Error(`cannot decode message google.protobuf.Any from JSON: expected object but got ${e===null?"null":Array.isArray(e)?"array":typeof e}`);if(Object.keys(e).length==0)return this;const s=e["@type"];if(typeof s!="string"||s=="")throw new Error('cannot decode message google.protobuf.Any from JSON: "@type" is empty');const a=this.typeUrlToName(s),c=(n=t==null?void 0:t.typeRegistry)===null||n===void 0?void 0:n.findMessage(a);if(!c)throw new Error(`cannot decode message google.protobuf.Any from JSON: ${s} is not in the type registry`);let f;if(a.startsWith("google.protobuf.")&&Object.prototype.hasOwnProperty.call(e,"value"))f=c.fromJson(e.value,t);else{const g=Object.assign({},e);delete g["@type"],f=c.fromJson(g,t)}return this.packFrom(f),this}packFrom(e){this.value=e.toBinary(),this.typeUrl=this.typeNameToUrl(e.getType().typeName)}unpackTo(e){return this.is(e.getType())?(e.fromBinary(this.value),!0):!1}unpack(e){if(this.typeUrl==="")return;const t=e.findMessage(this.typeUrlToName(this.typeUrl));if(!!t)return t.fromBinary(this.value)}is(e){if(this.typeUrl==="")return!1;const t=this.typeUrlToName(this.typeUrl);let n="";return typeof e=="string"?n=e:n=e.typeName,t===n}typeNameToUrl(e){return`type.googleapis.com/${e}`}typeUrlToName(e){if(!e.length)throw new Error(`invalid type url: ${e}`);const t=e.lastIndexOf("/"),n=t>=0?e.substring(t+1):e;if(!n.length)throw new Error(`invalid type url: ${e}`);return n}static pack(e){const t=new Bt;return t.packFrom(e),t}static fromBinary(e,t){return new Bt().fromBinary(e,t)}static fromJson(e,t){return new Bt().fromJson(e,t)}static fromJsonString(e,t){return new Bt().fromJsonString(e,t)}static equals(e,t){return A.util.equals(Bt,e,t)}}Bt.runtime=A,Bt.typeName="google.protobuf.Any",Bt.fields=A.util.newFieldList(()=>[{no:1,name:"type_url",kind:"scalar",T:9},{no:2,name:"value",kind:"scalar",T:12}]);class Lt extends Be{constructor(e){super(),this.value=0,A.util.initPartial(e,this)}toJson(e){return A.json.writeScalar(I.DOUBLE,this.value,!0)}fromJson(e,t){try{this.value=A.json.readScalar(I.DOUBLE,e)}catch(n){let s='cannot decode message google.protobuf.DoubleValue from JSON"';throw n instanceof Error&&n.message.length>0&&(s+=`: ${n.message}`),new Error(s)}return this}static fromBinary(e,t){return new Lt().fromBinary(e,t)}static fromJson(e,t){return new Lt().fromJson(e,t)}static fromJsonString(e,t){return new Lt().fromJsonString(e,t)}static equals(e,t){return A.util.equals(Lt,e,t)}}Lt.runtime=A,Lt.typeName="google.protobuf.DoubleValue",Lt.fields=A.util.newFieldList(()=>[{no:1,name:"value",kind:"scalar",T:1}]),Lt.fieldWrapper={wrapField(r){return new Lt({value:r})},unwrapField(r){return r.value}};class $t extends Be{constructor(e){super(),this.value=0,A.util.initPartial(e,this)}toJson(e){return A.json.writeScalar(I.FLOAT,this.value,!0)}fromJson(e,t){try{this.value=A.json.readScalar(I.FLOAT,e)}catch(n){let s='cannot decode message google.protobuf.FloatValue from JSON"';throw n instanceof Error&&n.message.length>0&&(s+=`: ${n.message}`),new Error(s)}return this}static fromBinary(e,t){return new $t().fromBinary(e,t)}static fromJson(e,t){return new $t().fromJson(e,t)}static fromJsonString(e,t){return new $t().fromJsonString(e,t)}static equals(e,t){return A.util.equals($t,e,t)}}$t.runtime=A,$t.typeName="google.protobuf.FloatValue",$t.fields=A.util.newFieldList(()=>[{no:1,name:"value",kind:"scalar",T:2}]),$t.fieldWrapper={wrapField(r){return new $t({value:r})},unwrapField(r){return r.value}};class Ft extends Be{constructor(e){super(),this.value=xe.zero,A.util.initPartial(e,this)}toJson(e){return A.json.writeScalar(I.INT64,this.value,!0)}fromJson(e,t){try{this.value=A.json.readScalar(I.INT64,e)}catch(n){let s='cannot decode message google.protobuf.Int64Value from JSON"';throw n instanceof Error&&n.message.length>0&&(s+=`: ${n.message}`),new Error(s)}return this}static fromBinary(e,t){return new Ft().fromBinary(e,t)}static fromJson(e,t){return new Ft().fromJson(e,t)}static fromJsonString(e,t){return new Ft().fromJsonString(e,t)}static equals(e,t){return A.util.equals(Ft,e,t)}}Ft.runtime=A,Ft.typeName="google.protobuf.Int64Value",Ft.fields=A.util.newFieldList(()=>[{no:1,name:"value",kind:"scalar",T:3}]),Ft.fieldWrapper={wrapField(r){return new Ft({value:r})},unwrapField(r){return r.value}};class Ut extends Be{constructor(e){super(),this.value=xe.zero,A.util.initPartial(e,this)}toJson(e){return A.json.writeScalar(I.UINT64,this.value,!0)}fromJson(e,t){try{this.value=A.json.readScalar(I.UINT64,e)}catch(n){let s='cannot decode message google.protobuf.UInt64Value from JSON"';throw n instanceof Error&&n.message.length>0&&(s+=`: ${n.message}`),new Error(s)}return this}static fromBinary(e,t){return new Ut().fromBinary(e,t)}static fromJson(e,t){return new Ut().fromJson(e,t)}static fromJsonString(e,t){return new Ut().fromJsonString(e,t)}static equals(e,t){return A.util.equals(Ut,e,t)}}Ut.runtime=A,Ut.typeName="google.protobuf.UInt64Value",Ut.fields=A.util.newFieldList(()=>[{no:1,name:"value",kind:"scalar",T:4}]),Ut.fieldWrapper={wrapField(r){return new Ut({value:r})},unwrapField(r){return r.value}};class Jt extends Be{constructor(e){super(),this.value=0,A.util.initPartial(e,this)}toJson(e){return A.json.writeScalar(I.INT32,this.value,!0)}fromJson(e,t){try{this.value=A.json.readScalar(I.INT32,e)}catch(n){let s='cannot decode message google.protobuf.Int32Value from JSON"';throw n instanceof Error&&n.message.length>0&&(s+=`: ${n.message}`),new Error(s)}return this}static fromBinary(e,t){return new Jt().fromBinary(e,t)}static fromJson(e,t){return new Jt().fromJson(e,t)}static fromJsonString(e,t){return new Jt().fromJsonString(e,t)}static equals(e,t){return A.util.equals(Jt,e,t)}}Jt.runtime=A,Jt.typeName="google.protobuf.Int32Value",Jt.fields=A.util.newFieldList(()=>[{no:1,name:"value",kind:"scalar",T:5}]),Jt.fieldWrapper={wrapField(r){return new Jt({value:r})},unwrapField(r){return r.value}};class jt extends Be{constructor(e){super(),this.value=0,A.util.initPartial(e,this)}toJson(e){return A.json.writeScalar(I.UINT32,this.value,!0)}fromJson(e,t){try{this.value=A.json.readScalar(I.UINT32,e)}catch(n){let s='cannot decode message google.protobuf.UInt32Value from JSON"';throw n instanceof Error&&n.message.length>0&&(s+=`: ${n.message}`),new Error(s)}return this}static fromBinary(e,t){return new jt().fromBinary(e,t)}static fromJson(e,t){return new jt().fromJson(e,t)}static fromJsonString(e,t){return new jt().fromJsonString(e,t)}static equals(e,t){return A.util.equals(jt,e,t)}}jt.runtime=A,jt.typeName="google.protobuf.UInt32Value",jt.fields=A.util.newFieldList(()=>[{no:1,name:"value",kind:"scalar",T:13}]),jt.fieldWrapper={wrapField(r){return new jt({value:r})},unwrapField(r){return r.value}};class qt extends Be{constructor(e){super(),this.value=!1,A.util.initPartial(e,this)}toJson(e){return A.json.writeScalar(I.BOOL,this.value,!0)}fromJson(e,t){try{this.value=A.json.readScalar(I.BOOL,e)}catch(n){let s='cannot decode message google.protobuf.BoolValue from JSON"';throw n instanceof Error&&n.message.length>0&&(s+=`: ${n.message}`),new Error(s)}return this}static fromBinary(e,t){return new qt().fromBinary(e,t)}static fromJson(e,t){return new qt().fromJson(e,t)}static fromJsonString(e,t){return new qt().fromJsonString(e,t)}static equals(e,t){return A.util.equals(qt,e,t)}}qt.runtime=A,qt.typeName="google.protobuf.BoolValue",qt.fields=A.util.newFieldList(()=>[{no:1,name:"value",kind:"scalar",T:8}]),qt.fieldWrapper={wrapField(r){return new qt({value:r})},unwrapField(r){return r.value}};class at extends Be{constructor(e){super(),this.value="",A.util.initPartial(e,this)}toJson(e){return A.json.writeScalar(I.STRING,this.value,!0)}fromJson(e,t){try{this.value=A.json.readScalar(I.STRING,e)}catch(n){let s='cannot decode message google.protobuf.StringValue from JSON"';throw n instanceof Error&&n.message.length>0&&(s+=`: ${n.message}`),new Error(s)}return this}static fromBinary(e,t){return new at().fromBinary(e,t)}static fromJson(e,t){return new at().fromJson(e,t)}static fromJsonString(e,t){return new at().fromJsonString(e,t)}static equals(e,t){return A.util.equals(at,e,t)}}at.runtime=A,at.typeName="google.protobuf.StringValue",at.fields=A.util.newFieldList(()=>[{no:1,name:"value",kind:"scalar",T:9}]),at.fieldWrapper={wrapField(r){return new at({value:r})},unwrapField(r){return r.value}};class Kt extends Be{constructor(e){super(),this.value=new Uint8Array(0),A.util.initPartial(e,this)}toJson(e){return A.json.writeScalar(I.BYTES,this.value,!0)}fromJson(e,t){try{this.value=A.json.readScalar(I.BYTES,e)}catch(n){let s='cannot decode message google.protobuf.BytesValue from JSON"';throw n instanceof Error&&n.message.length>0&&(s+=`: ${n.message}`),new Error(s)}return this}static fromBinary(e,t){return new Kt().fromBinary(e,t)}static fromJson(e,t){return new Kt().fromJson(e,t)}static fromJsonString(e,t){return new Kt().fromJsonString(e,t)}static equals(e,t){return A.util.equals(Kt,e,t)}}Kt.runtime=A,Kt.typeName="google.protobuf.BytesValue",Kt.fields=A.util.newFieldList(()=>[{no:1,name:"value",kind:"scalar",T:12}]),Kt.fieldWrapper={wrapField(r){return new Kt({value:r})},unwrapField(r){return r.value}};function pu(r,e,t){try{const n=B.dec(r);return e?e.fromBinary(n,t):n}catch(n){throw v.from(n,p.DataLoss)}}function mu(r,e){const t={};for(const[n,s]of Object.entries(r.methods)){const a=e(Object.assign(Object.assign({},s),{localName:n,service:r}));a!=null&&(t[n]=a)}return t}function Jo(r){let e,t=new Uint8Array(0);function n(s){const a=new Uint8Array(t.length+s.length);a.set(t),a.set(s,t.length),t=a}return new ReadableStream({start(){e=r.getReader()},async pull(s){let a;for(;;){if(a===void 0&&t.byteLength>=5){let g=0;for(let m=1;m<5;m++)g=(g<<8)+t[m];a={flags:t[0],length:g}}if(a!==void 0&&t.byteLength>=a.length+5)break;const f=await e.read();if(f.done)break;n(f.value)}if(a===void 0){if(t.byteLength==0){s.close();return}s.error(new v("premature end of stream",p.DataLoss));return}const c=t.subarray(5,5+a.length);t=t.subarray(5+a.length),s.enqueue({flags:a.flags,data:c})}})}function jo(r,e){const t=new Uint8Array(e.length+5);t.set(e,5);const n=new DataView(t.buffer,t.byteOffset,t.byteLength);return n.setUint8(0,r),n.setUint32(1,e.length),t}var yu=globalThis&&globalThis.__asyncValues||function(r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=r[Symbol.asyncIterator],t;return e?e.call(r):(r=typeof __values=="function"?__values(r):r[Symbol.iterator](),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(a){t[a]=r[a]&&function(c){return new Promise(function(f,g){c=r[a](c),s(f,g,c.done,c.value)})}}function s(a,c,f,g){Promise.resolve(g).then(function(m){a({value:m,done:f})},c)}},Pr=globalThis&&globalThis.__await||function(r){return this instanceof Pr?(this.v=r,this):new Pr(r)},vu=globalThis&&globalThis.__asyncGenerator||function(r,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=t.apply(r,e||[]),s,a=[];return s={},f("next"),f("throw"),f("return",c),s[Symbol.asyncIterator]=function(){return this},s;function c(S){return function(F){return Promise.resolve(F).then(S,x)}}function f(S,F){n[S]&&(s[S]=function(G){return new Promise(function(H,se){a.push([S,G,H,se])>1||g(S,G)})},F&&(s[S]=F(s[S])))}function g(S,F){try{m(n[S](F))}catch(G){C(a[0][3],G)}}function m(S){S.value instanceof Pr?Promise.resolve(S.value.v).then(b,x):C(a[0][2],S)}function b(S){g("next",S)}function x(S){g("throw",S)}function C(S,F){S(F),a.shift(),a.length&&g(a[0][0],a[0][1])}},Tu=globalThis&&globalThis.__asyncDelegator||function(r){var e,t;return e={},n("next"),n("throw",function(s){throw s}),n("return"),e[Symbol.iterator]=function(){return this},e;function n(s,a){e[s]=r[s]?function(c){return(t=!t)?{value:Pr(r[s](c)),done:!1}:a?a(c):c}:a}};function bu(r){return vu(this,arguments,function*(){yield Pr(yield*Tu(yu(r)))})}var qo=globalThis&&globalThis.__asyncValues||function(r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=r[Symbol.asyncIterator],t;return e?e.call(r):(r=typeof __values=="function"?__values(r):r[Symbol.iterator](),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(a){t[a]=r[a]&&function(c){return new Promise(function(f,g){c=r[a](c),s(f,g,c.done,c.value)})}}function s(a,c,f,g){Promise.resolve(g).then(function(m){a({value:m,done:f})},c)}},sr=globalThis&&globalThis.__await||function(r){return this instanceof sr?(this.v=r,this):new sr(r)},wu=globalThis&&globalThis.__asyncDelegator||function(r){var e,t;return e={},n("next"),n("throw",function(s){throw s}),n("return"),e[Symbol.iterator]=function(){return this},e;function n(s,a){e[s]=r[s]?function(c){return(t=!t)?{value:sr(r[s](c)),done:!1}:a?a(c):c}:a}},Au=globalThis&&globalThis.__asyncGenerator||function(r,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=t.apply(r,e||[]),s,a=[];return s={},f("next"),f("throw"),f("return",c),s[Symbol.asyncIterator]=function(){return this},s;function c(S){return function(F){return Promise.resolve(F).then(S,x)}}function f(S,F){n[S]&&(s[S]=function(G){return new Promise(function(H,se){a.push([S,G,H,se])>1||g(S,G)})},F&&(s[S]=F(s[S])))}function g(S,F){try{m(n[S](F))}catch(G){C(a[0][3],G)}}function m(S){S.value instanceof sr?Promise.resolve(S.value.v).then(b,x):C(a[0][2],S)}function b(S){g("next",S)}function x(S){g("throw",S)}function C(S,F){S(F),a.shift(),a.length&&g(a[0][0],a[0][1])}};function Su(r,e){return mu(r,t=>{switch(t.kind){case He.Unary:return Iu(e,r,t);case He.ServerStreaming:return ku(e,r,t);case He.ClientStreaming:return Eu(e,r,t);case He.BiDiStreaming:return Cu(e,r,t);default:return null}})}function Iu(r,e,t){return async function(n,s){var a,c;const f=await r.unary(e,t,s==null?void 0:s.signal,s==null?void 0:s.timeoutMs,s==null?void 0:s.headers,n,s==null?void 0:s.contextValues);return(a=s==null?void 0:s.onHeader)===null||a===void 0||a.call(s,f.header),(c=s==null?void 0:s.onTrailer)===null||c===void 0||c.call(s,f.trailer),f.message}}function ku(r,e,t){return function(n,s){return Ko(r.stream(e,t,s==null?void 0:s.signal,s==null?void 0:s.timeoutMs,s==null?void 0:s.headers,bu([n]),s==null?void 0:s.contextValues),s)}}function Eu(r,e,t){return async function(n,s){var a,c,f,g,m,b;const x=await r.stream(e,t,s==null?void 0:s.signal,s==null?void 0:s.timeoutMs,s==null?void 0:s.headers,n,s==null?void 0:s.contextValues);(m=s==null?void 0:s.onHeader)===null||m===void 0||m.call(s,x.header);let C;try{for(var S=!0,F=qo(x.message),G;G=await F.next(),a=G.done,!a;S=!0)g=G.value,S=!1,C=g}catch(H){c={error:H}}finally{try{!S&&!a&&(f=F.return)&&await f.call(F)}finally{if(c)throw c.error}}if(!C)throw new v("protocol error: missing response message",p.Internal);return(b=s==null?void 0:s.onTrailer)===null||b===void 0||b.call(s,x.trailer),C}}function Cu(r,e,t){return function(n,s){return Ko(r.stream(e,t,s==null?void 0:s.signal,s==null?void 0:s.timeoutMs,s==null?void 0:s.headers,n,s==null?void 0:s.contextValues),s)}}function Ko(r,e){const t=function(){var n,s;return Au(this,arguments,function*(){const a=yield sr(r);(n=e==null?void 0:e.onHeader)===null||n===void 0||n.call(e,a.header),yield sr(yield*wu(qo(a.message))),(s=e==null?void 0:e.onTrailer)===null||s===void 0||s.call(e,a.trailer)})}()[Symbol.asyncIterator]();return{[Symbol.asyncIterator]:()=>({next:()=>t.next()})}}function Nu(...r){const e=new AbortController,t=r.filter(s=>s!==void 0).concat(e.signal);for(const s of t){if(s.aborted){n.apply(s);break}s.addEventListener("abort",n)}function n(){e.signal.aborted||e.abort(Vo(this));for(const s of t)s.removeEventListener("abort",n)}return e}function xu(r){const e=new AbortController,t=()=>{e.abort(new v("the operation timed out",p.DeadlineExceeded))};let n;return r!==void 0&&(r<=0?t():n=setTimeout(t,r)),{signal:e.signal,cleanup:()=>clearTimeout(n)}}function Vo(r){if(!r.aborted)return;if(r.reason!==void 0)return r.reason;const e=new Error("This operation was aborted");return e.name="AbortError",e}function zo(){return{get(r){return r.id in this?this[r.id]:r.defaultValue},set(r,e){return this[r.id]=e,this},delete(r){return delete this[r.id],this}}}const fi=128;function Wo(r){const e=new Headers,t=new TextDecoder().decode(r).split(`\r
`);for(const n of t){if(n==="")continue;const s=n.indexOf(":");if(s>0){const a=n.substring(0,s).trim(),c=n.substring(s+1).trim();e.append(a,c)}}return e}const Ou="Content-Type",Pu="Grpc-Timeout",Ho="Grpc-Status",Go="Grpc-Message",Du="Grpc-Status-Details-Bin",Ru="User-Agent",_u="X-User-Agent",Mu="X-Grpc-Web",Bu="application/grpc-web+proto",Lu="application/grpc-web+json";class nn extends Be{constructor(e){super(),this.code=0,this.message="",this.details=[],A.util.initPartial(e,this)}static fromBinary(e,t){return new nn().fromBinary(e,t)}static fromJson(e,t){return new nn().fromJson(e,t)}static fromJsonString(e,t){return new nn().fromJsonString(e,t)}static equals(e,t){return A.util.equals(nn,e,t)}}nn.runtime=A,nn.typeName="google.rpc.Status",nn.fields=A.util.newFieldList(()=>[{no:1,name:"code",kind:"scalar",T:5},{no:2,name:"message",kind:"scalar",T:9},{no:3,name:"details",kind:"message",T:Bt,repeated:!0}]);const $u="0";function Yo(r){var e;const t=r.get(Du);if(t!=null){const s=pu(t,nn);if(s.code==0)return;const a=new v(s.message,s.code,r);return a.details=s.details.map(c=>({type:c.typeUrl.substring(c.typeUrl.lastIndexOf("/")+1),value:c.value})),a}const n=r.get(Ho);if(n!=null){if(n===$u)return;const s=parseInt(n,10);return s in p?new v(decodeURIComponent((e=r.get(Go))!==null&&e!==void 0?e:""),s,r):new v(`invalid grpc-status: ${n}`,p.Internal,r)}}function Xo(r,e,t){const n=typeof e=="string"?e:e.typeName,s=typeof t=="string"?t:t.name;return r.toString().replace(/\/?$/,`/${n}/${s}`)}function Zo(r,e){return e instanceof r?e:new r(e)}function Fu(r,e){function t(n){return n.done===!0?n:{done:n.done,value:Zo(r,n.value)}}return{[Symbol.asyncIterator](){const n=e[Symbol.asyncIterator](),s={next:()=>n.next().then(t)};return n.throw!==void 0&&(s.throw=a=>n.throw(a).then(t)),n.return!==void 0&&(s.return=a=>n.return(a).then(t)),s}}}function Qo(r,e){var t;return(t=e==null?void 0:e.concat().reverse().reduce((n,s)=>s(n),r))!==null&&t!==void 0?t:r}function Uu(r){var e;const t=Object.assign({},r);return(e=t.ignoreUnknownFields)!==null&&e!==void 0||(t.ignoreUnknownFields=!0),t}function ea(r,e,t,n){const s=e?ta(r.I,n):na(r.I,t);return{parse:(e?ta(r.O,n):na(r.O,t)).parse,serialize:s.serialize}}function ta(r,e){return{parse(t){try{return r.fromBinary(t,e)}catch(n){const s=n instanceof Error?n.message:String(n);throw new v(`parse binary: ${s}`,p.InvalidArgument)}},serialize(t){try{return t.toBinary(e)}catch(n){const s=n instanceof Error?n.message:String(n);throw new v(`serialize binary: ${s}`,p.Internal)}}}}function na(r,e){var t,n;const s=(t=e==null?void 0:e.textEncoder)!==null&&t!==void 0?t:new TextEncoder,a=(n=e==null?void 0:e.textDecoder)!==null&&n!==void 0?n:new TextDecoder,c=Uu(e);return{parse(f){try{const g=a.decode(f);return r.fromJsonString(g,c)}catch(g){throw v.from(g,p.InvalidArgument)}},serialize(f){try{const g=f.toJsonString(c);return s.encode(g)}catch(g){throw v.from(g,p.Internal)}}}}function Ju(r){const e=Qo(r.next,r.interceptors),[t,n,s]=ra(r),a=Object.assign(Object.assign({},r.req),{message:Zo(r.req.method.I,r.req.message),signal:t});return e(a).then(c=>(s(),c),n)}function ju(r){const e=Qo(r.next,r.interceptors),[t,n,s]=ra(r),a=Object.assign(Object.assign({},r.req),{message:Fu(r.req.method.I,r.req.message),signal:t});let c=!1;return t.addEventListener("abort",function(){var f,g;const m=r.req.message[Symbol.asyncIterator]();c||(f=m.throw)===null||f===void 0||f.call(m,this.reason).catch(()=>{}),(g=m.return)===null||g===void 0||g.call(m).catch(()=>{})}),e(a).then(f=>Object.assign(Object.assign({},f),{message:{[Symbol.asyncIterator](){const g=f.message[Symbol.asyncIterator]();return{next(){return g.next().then(m=>(m.done==!0&&(c=!0,s()),m),n)}}}}}),n)}function ra(r){const{signal:e,cleanup:t}=xu(r.timeoutMs),n=Nu(r.signal,e);return[n.signal,function(a){const c=v.from(e.aborted?Vo(e):a);return n.abort(c),t(),Promise.reject(c)},function(){t(),n.abort()}]}function qu(){try{new Headers}catch{throw new Error("connect-web requires the fetch API. Are you running on an old version of Node.js? Node.js is not supported in Connect for Web - please stay tuned for Connect for Node.")}}function sa(r,e){const t=Yo(r);if(t)throw e.forEach((n,s)=>{t.metadata.append(s,n)}),t}function ia(r,e,t,n){const s=new Headers(t!=null?t:{});return s.set(Ou,r?Bu:Lu),s.set(Mu,"1"),s.set(_u,"connect-es/1.4.0"),n&&s.set(Ru,"connect-es/1.4.0"),e!==void 0&&s.set(Pu,`${e}m`),s}function Ku(r){switch(r){case 400:return p.Internal;case 401:return p.Unauthenticated;case 403:return p.PermissionDenied;case 404:return p.Unimplemented;case 429:return p.Unavailable;case 502:return p.Unavailable;case 503:return p.Unavailable;case 504:return p.Unavailable;default:return p.Unknown}}function oa(r,e){var t;if(r>=200&&r<300){const n=Yo(e);if(n)throw n;return{foundStatus:e.has(Ho)}}throw new v(decodeURIComponent((t=e.get(Go))!==null&&t!==void 0?t:`HTTP ${r}`),Ku(r),e)}var Bn=globalThis&&globalThis.__await||function(r){return this instanceof Bn?(this.v=r,this):new Bn(r)},Vu=globalThis&&globalThis.__asyncGenerator||function(r,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=t.apply(r,e||[]),s,a=[];return s={},f("next"),f("throw"),f("return",c),s[Symbol.asyncIterator]=function(){return this},s;function c(S){return function(F){return Promise.resolve(F).then(S,x)}}function f(S,F){n[S]&&(s[S]=function(G){return new Promise(function(H,se){a.push([S,G,H,se])>1||g(S,G)})},F&&(s[S]=F(s[S])))}function g(S,F){try{m(n[S](F))}catch(G){C(a[0][3],G)}}function m(S){S.value instanceof Bn?Promise.resolve(S.value.v).then(b,x):C(a[0][2],S)}function b(S){g("next",S)}function x(S){g("throw",S)}function C(S,F){S(F),a.shift(),a.length&&g(a[0][0],a[0][1])}};function zu(r){var e;qu();const t=(e=r.useBinaryFormat)!==null&&e!==void 0?e:!0;return{async unary(n,s,a,c,f,g,m){var b;const{serialize:x,parse:C}=ea(s,t,r.jsonOptions,r.binaryOptions);return c=c===void 0?r.defaultTimeoutMs:c<=0?void 0:c,await Ju({interceptors:r.interceptors,signal:a,timeoutMs:c,req:{stream:!1,service:n,method:s,url:Xo(r.baseUrl,n,s),init:{method:"POST",credentials:(b=r.credentials)!==null&&b!==void 0?b:"same-origin",redirect:"error",mode:"cors"},header:ia(t,c,f,!1),contextValues:m!=null?m:zo(),message:g},next:async S=>{var F;const H=await((F=r.fetch)!==null&&F!==void 0?F:globalThis.fetch)(S.url,Object.assign(Object.assign({},S.init),{headers:S.header,signal:S.signal,body:jo(0,x(S.message))}));if(oa(H.status,H.headers),!H.body)throw"missing response body";const se=Jo(H.body).getReader();let Se,ae;for(;;){const me=await se.read();if(me.done)break;const{flags:ye,data:Ie}=me.value;if(ye===fi){if(Se!==void 0)throw"extra trailer";Se=Wo(Ie);continue}if(ae!==void 0)throw"extra message";ae=C(Ie)}if(Se===void 0)throw"missing trailer";if(sa(Se,H.headers),ae===void 0)throw"missing message";return{stream:!1,service:n,method:s,header:H.headers,message:ae,trailer:Se}}})},async stream(n,s,a,c,f,g,m){var b;const{serialize:x,parse:C}=ea(s,t,r.jsonOptions,r.binaryOptions);function S(G,H,se,Se){return Vu(this,arguments,function*(){const me=Jo(G).getReader();if(H){if(!(yield Bn(me.read())).done)throw"extra data for trailers-only";return yield Bn(void 0)}let ye=!1;for(;;){const Ie=yield Bn(me.read());if(Ie.done)break;const{flags:Kn,data:Vn}=Ie.value;if((Kn&fi)===fi){if(ye)throw"extra trailer";ye=!0;const Qr=Wo(Vn);sa(Qr,Se),Qr.forEach((Rf,_f)=>se.set(_f,Rf));continue}if(ye)throw"extra message";yield yield Bn(C(Vn))}if(!ye)throw"missing trailer"})}async function F(G){if(s.kind!=He.ServerStreaming)throw"The fetch API does not support streaming request bodies";const H=await G[Symbol.asyncIterator]().next();if(H.done==!0)throw"missing request message";return jo(0,x(H.value))}return c=c===void 0?r.defaultTimeoutMs:c<=0?void 0:c,ju({interceptors:r.interceptors,signal:a,timeoutMs:c,req:{stream:!0,service:n,method:s,url:Xo(r.baseUrl,n,s),init:{method:"POST",credentials:(b=r.credentials)!==null&&b!==void 0?b:"same-origin",redirect:"error",mode:"cors"},header:ia(t,c,f,!1),contextValues:m!=null?m:zo(),message:g},next:async G=>{var H;const Se=await((H=r.fetch)!==null&&H!==void 0?H:globalThis.fetch)(G.url,Object.assign(Object.assign({},G.init),{headers:G.header,signal:G.signal,body:await F(G.message)})),{foundStatus:ae}=oa(Se.status,Se.headers);if(!Se.body)throw"missing response body";const me=new Headers;return Object.assign(Object.assign({},G),{header:Se.headers,trailer:me,message:S(Se.body,ae,me,Se.headers)})}})}}}const te=A.makeEnum("yorkie.v1.ValueType",[{no:0,name:"VALUE_TYPE_NULL",localName:"NULL"},{no:1,name:"VALUE_TYPE_BOOLEAN",localName:"BOOLEAN"},{no:2,name:"VALUE_TYPE_INTEGER",localName:"INTEGER"},{no:3,name:"VALUE_TYPE_LONG",localName:"LONG"},{no:4,name:"VALUE_TYPE_DOUBLE",localName:"DOUBLE"},{no:5,name:"VALUE_TYPE_STRING",localName:"STRING"},{no:6,name:"VALUE_TYPE_BYTES",localName:"BYTES"},{no:7,name:"VALUE_TYPE_DATE",localName:"DATE"},{no:8,name:"VALUE_TYPE_JSON_OBJECT",localName:"JSON_OBJECT"},{no:9,name:"VALUE_TYPE_JSON_ARRAY",localName:"JSON_ARRAY"},{no:10,name:"VALUE_TYPE_TEXT",localName:"TEXT"},{no:11,name:"VALUE_TYPE_INTEGER_CNT",localName:"INTEGER_CNT"},{no:12,name:"VALUE_TYPE_LONG_CNT",localName:"LONG_CNT"},{no:13,name:"VALUE_TYPE_TREE",localName:"TREE"}]),Ts=A.makeEnum("yorkie.v1.DocEventType",[{no:0,name:"DOC_EVENT_TYPE_DOCUMENT_CHANGED",localName:"DOCUMENT_CHANGED"},{no:1,name:"DOC_EVENT_TYPE_DOCUMENT_WATCHED",localName:"DOCUMENT_WATCHED"},{no:2,name:"DOC_EVENT_TYPE_DOCUMENT_UNWATCHED",localName:"DOCUMENT_UNWATCHED"},{no:3,name:"DOC_EVENT_TYPE_DOCUMENT_BROADCAST",localName:"DOCUMENT_BROADCAST"}]),Wu=A.makeMessageType("yorkie.v1.Snapshot",()=>[{no:1,name:"root",kind:"message",T:ft},{no:2,name:"presences",kind:"map",K:9,V:{kind:"message",T:vi}}]),rn=A.makeMessageType("yorkie.v1.ChangePack",()=>[{no:1,name:"document_key",kind:"scalar",T:9},{no:2,name:"checkpoint",kind:"message",T:Ea},{no:3,name:"snapshot",kind:"scalar",T:12},{no:4,name:"changes",kind:"message",T:aa,repeated:!0},{no:5,name:"min_synced_ticket",kind:"message",T:K},{no:6,name:"is_removed",kind:"scalar",T:8}]),aa=A.makeMessageType("yorkie.v1.Change",()=>[{no:1,name:"id",kind:"message",T:bs},{no:2,name:"message",kind:"scalar",T:9},{no:3,name:"operations",kind:"message",T:di,repeated:!0},{no:4,name:"presence_change",kind:"message",T:yi}]),bs=A.makeMessageType("yorkie.v1.ChangeID",()=>[{no:1,name:"client_seq",kind:"scalar",T:13},{no:2,name:"server_seq",kind:"scalar",T:3,L:1},{no:3,name:"lamport",kind:"scalar",T:3,L:1},{no:4,name:"actor_id",kind:"scalar",T:12}]),di=A.makeMessageType("yorkie.v1.Operation",()=>[{no:1,name:"set",kind:"message",T:ca,oneof:"body"},{no:2,name:"add",kind:"message",T:la,oneof:"body"},{no:3,name:"move",kind:"message",T:ua,oneof:"body"},{no:4,name:"remove",kind:"message",T:ha,oneof:"body"},{no:5,name:"edit",kind:"message",T:fa,oneof:"body"},{no:6,name:"select",kind:"message",T:Hu,oneof:"body"},{no:7,name:"style",kind:"message",T:da,oneof:"body"},{no:8,name:"increase",kind:"message",T:ga,oneof:"body"},{no:9,name:"tree_edit",kind:"message",T:pa,oneof:"body"},{no:10,name:"tree_style",kind:"message",T:ma,oneof:"body"}]),ca=A.makeMessageType("yorkie.v1.Operation.Set",()=>[{no:1,name:"parent_created_at",kind:"message",T:K},{no:2,name:"key",kind:"scalar",T:9},{no:3,name:"value",kind:"message",T:sn},{no:4,name:"executed_at",kind:"message",T:K}],{localName:"Operation_Set"}),la=A.makeMessageType("yorkie.v1.Operation.Add",()=>[{no:1,name:"parent_created_at",kind:"message",T:K},{no:2,name:"prev_created_at",kind:"message",T:K},{no:3,name:"value",kind:"message",T:sn},{no:4,name:"executed_at",kind:"message",T:K}],{localName:"Operation_Add"}),ua=A.makeMessageType("yorkie.v1.Operation.Move",()=>[{no:1,name:"parent_created_at",kind:"message",T:K},{no:2,name:"prev_created_at",kind:"message",T:K},{no:3,name:"created_at",kind:"message",T:K},{no:4,name:"executed_at",kind:"message",T:K}],{localName:"Operation_Move"}),ha=A.makeMessageType("yorkie.v1.Operation.Remove",()=>[{no:1,name:"parent_created_at",kind:"message",T:K},{no:2,name:"created_at",kind:"message",T:K},{no:3,name:"executed_at",kind:"message",T:K}],{localName:"Operation_Remove"}),fa=A.makeMessageType("yorkie.v1.Operation.Edit",()=>[{no:1,name:"parent_created_at",kind:"message",T:K},{no:2,name:"from",kind:"message",T:Ln},{no:3,name:"to",kind:"message",T:Ln},{no:4,name:"created_at_map_by_actor",kind:"map",K:9,V:{kind:"message",T:K}},{no:5,name:"content",kind:"scalar",T:9},{no:6,name:"executed_at",kind:"message",T:K},{no:7,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}}],{localName:"Operation_Edit"}),Hu=A.makeMessageType("yorkie.v1.Operation.Select",()=>[{no:1,name:"parent_created_at",kind:"message",T:K},{no:2,name:"from",kind:"message",T:Ln},{no:3,name:"to",kind:"message",T:Ln},{no:4,name:"executed_at",kind:"message",T:K}],{localName:"Operation_Select"}),da=A.makeMessageType("yorkie.v1.Operation.Style",()=>[{no:1,name:"parent_created_at",kind:"message",T:K},{no:2,name:"from",kind:"message",T:Ln},{no:3,name:"to",kind:"message",T:Ln},{no:4,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:5,name:"executed_at",kind:"message",T:K},{no:6,name:"created_at_map_by_actor",kind:"map",K:9,V:{kind:"message",T:K}}],{localName:"Operation_Style"}),ga=A.makeMessageType("yorkie.v1.Operation.Increase",()=>[{no:1,name:"parent_created_at",kind:"message",T:K},{no:2,name:"value",kind:"message",T:sn},{no:3,name:"executed_at",kind:"message",T:K}],{localName:"Operation_Increase"}),pa=A.makeMessageType("yorkie.v1.Operation.TreeEdit",()=>[{no:1,name:"parent_created_at",kind:"message",T:K},{no:2,name:"from",kind:"message",T:Dr},{no:3,name:"to",kind:"message",T:Dr},{no:4,name:"created_at_map_by_actor",kind:"map",K:9,V:{kind:"message",T:K}},{no:5,name:"contents",kind:"message",T:ka,repeated:!0},{no:7,name:"split_level",kind:"scalar",T:5},{no:6,name:"executed_at",kind:"message",T:K}],{localName:"Operation_TreeEdit"}),ma=A.makeMessageType("yorkie.v1.Operation.TreeStyle",()=>[{no:1,name:"parent_created_at",kind:"message",T:K},{no:2,name:"from",kind:"message",T:Dr},{no:3,name:"to",kind:"message",T:Dr},{no:4,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:5,name:"executed_at",kind:"message",T:K},{no:6,name:"attributes_to_remove",kind:"scalar",T:9,repeated:!0},{no:7,name:"created_at_map_by_actor",kind:"map",K:9,V:{kind:"message",T:K}}],{localName:"Operation_TreeStyle"}),sn=A.makeMessageType("yorkie.v1.JSONElementSimple",()=>[{no:1,name:"created_at",kind:"message",T:K},{no:2,name:"moved_at",kind:"message",T:K},{no:3,name:"removed_at",kind:"message",T:K},{no:4,name:"type",kind:"enum",T:A.getEnumType(te)},{no:5,name:"value",kind:"scalar",T:12}]),ft=A.makeMessageType("yorkie.v1.JSONElement",()=>[{no:1,name:"json_object",kind:"message",T:ya,oneof:"body"},{no:2,name:"json_array",kind:"message",T:va,oneof:"body"},{no:3,name:"primitive",kind:"message",T:Ta,oneof:"body"},{no:5,name:"text",kind:"message",T:ba,oneof:"body"},{no:6,name:"counter",kind:"message",T:wa,oneof:"body"},{no:7,name:"tree",kind:"message",T:Aa,oneof:"body"}]),ya=A.makeMessageType("yorkie.v1.JSONElement.JSONObject",()=>[{no:1,name:"nodes",kind:"message",T:Sa,repeated:!0},{no:2,name:"created_at",kind:"message",T:K},{no:3,name:"moved_at",kind:"message",T:K},{no:4,name:"removed_at",kind:"message",T:K}],{localName:"JSONElement_JSONObject"}),va=A.makeMessageType("yorkie.v1.JSONElement.JSONArray",()=>[{no:1,name:"nodes",kind:"message",T:gi,repeated:!0},{no:2,name:"created_at",kind:"message",T:K},{no:3,name:"moved_at",kind:"message",T:K},{no:4,name:"removed_at",kind:"message",T:K}],{localName:"JSONElement_JSONArray"}),Ta=A.makeMessageType("yorkie.v1.JSONElement.Primitive",()=>[{no:1,name:"type",kind:"enum",T:A.getEnumType(te)},{no:2,name:"value",kind:"scalar",T:12},{no:3,name:"created_at",kind:"message",T:K},{no:4,name:"moved_at",kind:"message",T:K},{no:5,name:"removed_at",kind:"message",T:K}],{localName:"JSONElement_Primitive"}),ba=A.makeMessageType("yorkie.v1.JSONElement.Text",()=>[{no:1,name:"nodes",kind:"message",T:Ia,repeated:!0},{no:2,name:"created_at",kind:"message",T:K},{no:3,name:"moved_at",kind:"message",T:K},{no:4,name:"removed_at",kind:"message",T:K}],{localName:"JSONElement_Text"}),wa=A.makeMessageType("yorkie.v1.JSONElement.Counter",()=>[{no:1,name:"type",kind:"enum",T:A.getEnumType(te)},{no:2,name:"value",kind:"scalar",T:12},{no:3,name:"created_at",kind:"message",T:K},{no:4,name:"moved_at",kind:"message",T:K},{no:5,name:"removed_at",kind:"message",T:K}],{localName:"JSONElement_Counter"}),Aa=A.makeMessageType("yorkie.v1.JSONElement.Tree",()=>[{no:1,name:"nodes",kind:"message",T:mi,repeated:!0},{no:2,name:"created_at",kind:"message",T:K},{no:3,name:"moved_at",kind:"message",T:K},{no:4,name:"removed_at",kind:"message",T:K}],{localName:"JSONElement_Tree"}),Sa=A.makeMessageType("yorkie.v1.RHTNode",()=>[{no:1,name:"key",kind:"scalar",T:9},{no:2,name:"element",kind:"message",T:ft}]),gi=A.makeMessageType("yorkie.v1.RGANode",()=>[{no:1,name:"next",kind:"message",T:gi},{no:2,name:"element",kind:"message",T:ft}]),ws=A.makeMessageType("yorkie.v1.NodeAttr",()=>[{no:1,name:"value",kind:"scalar",T:9},{no:2,name:"updated_at",kind:"message",T:K},{no:3,name:"is_removed",kind:"scalar",T:8}]),Ia=A.makeMessageType("yorkie.v1.TextNode",()=>[{no:1,name:"id",kind:"message",T:pi},{no:2,name:"value",kind:"scalar",T:9},{no:3,name:"removed_at",kind:"message",T:K},{no:4,name:"ins_prev_id",kind:"message",T:pi},{no:5,name:"attributes",kind:"map",K:9,V:{kind:"message",T:ws}}]),pi=A.makeMessageType("yorkie.v1.TextNodeID",()=>[{no:1,name:"created_at",kind:"message",T:K},{no:2,name:"offset",kind:"scalar",T:5}]),mi=A.makeMessageType("yorkie.v1.TreeNode",()=>[{no:1,name:"id",kind:"message",T:ir},{no:2,name:"type",kind:"scalar",T:9},{no:3,name:"value",kind:"scalar",T:9},{no:4,name:"removed_at",kind:"message",T:K},{no:5,name:"ins_prev_id",kind:"message",T:ir},{no:6,name:"ins_next_id",kind:"message",T:ir},{no:7,name:"depth",kind:"scalar",T:5},{no:8,name:"attributes",kind:"map",K:9,V:{kind:"message",T:ws}}]),ka=A.makeMessageType("yorkie.v1.TreeNodes",()=>[{no:1,name:"content",kind:"message",T:mi,repeated:!0}]),ir=A.makeMessageType("yorkie.v1.TreeNodeID",()=>[{no:1,name:"created_at",kind:"message",T:K},{no:2,name:"offset",kind:"scalar",T:5}]),Dr=A.makeMessageType("yorkie.v1.TreePos",()=>[{no:1,name:"parent_id",kind:"message",T:ir},{no:2,name:"left_sibling_id",kind:"message",T:ir}]);A.makeMessageType("yorkie.v1.User",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"username",kind:"scalar",T:9},{no:3,name:"created_at",kind:"message",T:qe}]),A.makeMessageType("yorkie.v1.Project",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"public_key",kind:"scalar",T:9},{no:4,name:"secret_key",kind:"scalar",T:9},{no:5,name:"auth_webhook_url",kind:"scalar",T:9},{no:6,name:"auth_webhook_methods",kind:"scalar",T:9,repeated:!0},{no:7,name:"client_deactivate_threshold",kind:"scalar",T:9},{no:8,name:"created_at",kind:"message",T:qe},{no:9,name:"updated_at",kind:"message",T:qe}]),A.makeMessageType("yorkie.v1.UpdatableProjectFields",()=>[{no:1,name:"name",kind:"message",T:at},{no:2,name:"auth_webhook_url",kind:"message",T:at},{no:3,name:"auth_webhook_methods",kind:"message",T:Gu},{no:4,name:"client_deactivate_threshold",kind:"message",T:at}]);const Gu=A.makeMessageType("yorkie.v1.UpdatableProjectFields.AuthWebhookMethods",()=>[{no:1,name:"methods",kind:"scalar",T:9,repeated:!0}],{localName:"UpdatableProjectFields_AuthWebhookMethods"});A.makeMessageType("yorkie.v1.DocumentSummary",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"key",kind:"scalar",T:9},{no:3,name:"snapshot",kind:"scalar",T:9},{no:4,name:"created_at",kind:"message",T:qe},{no:5,name:"accessed_at",kind:"message",T:qe},{no:6,name:"updated_at",kind:"message",T:qe}]);const yi=A.makeMessageType("yorkie.v1.PresenceChange",()=>[{no:1,name:"type",kind:"enum",T:A.getEnumType(Rr)},{no:2,name:"presence",kind:"message",T:vi}]),Rr=A.makeEnum("yorkie.v1.PresenceChange.ChangeType",[{no:0,name:"CHANGE_TYPE_UNSPECIFIED",localName:"UNSPECIFIED"},{no:1,name:"CHANGE_TYPE_PUT",localName:"PUT"},{no:2,name:"CHANGE_TYPE_DELETE",localName:"DELETE"},{no:3,name:"CHANGE_TYPE_CLEAR",localName:"CLEAR"}]),vi=A.makeMessageType("yorkie.v1.Presence",()=>[{no:1,name:"data",kind:"map",K:9,V:{kind:"scalar",T:9}}]),Ea=A.makeMessageType("yorkie.v1.Checkpoint",()=>[{no:1,name:"server_seq",kind:"scalar",T:3,L:1},{no:2,name:"client_seq",kind:"scalar",T:13}]),Ln=A.makeMessageType("yorkie.v1.TextNodePos",()=>[{no:1,name:"created_at",kind:"message",T:K},{no:2,name:"offset",kind:"scalar",T:5},{no:3,name:"relative_offset",kind:"scalar",T:5}]),K=A.makeMessageType("yorkie.v1.TimeTicket",()=>[{no:1,name:"lamport",kind:"scalar",T:3,L:1},{no:2,name:"delimiter",kind:"scalar",T:13},{no:3,name:"actor_id",kind:"scalar",T:12}]),Yu=A.makeMessageType("yorkie.v1.DocEventBody",()=>[{no:1,name:"topic",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:12}]),Xu=A.makeMessageType("yorkie.v1.DocEvent",()=>[{no:1,name:"type",kind:"enum",T:A.getEnumType(Ts)},{no:2,name:"publisher",kind:"scalar",T:9},{no:3,name:"body",kind:"message",T:Yu}]),Zu=A.makeMessageType("yorkie.v1.ActivateClientRequest",()=>[{no:1,name:"client_key",kind:"scalar",T:9}]),Qu=A.makeMessageType("yorkie.v1.ActivateClientResponse",()=>[{no:1,name:"client_id",kind:"scalar",T:9}]),eh=A.makeMessageType("yorkie.v1.DeactivateClientRequest",()=>[{no:1,name:"client_id",kind:"scalar",T:9}]),th=A.makeMessageType("yorkie.v1.DeactivateClientResponse",[]),nh=A.makeMessageType("yorkie.v1.AttachDocumentRequest",()=>[{no:1,name:"client_id",kind:"scalar",T:9},{no:2,name:"change_pack",kind:"message",T:rn}]),rh=A.makeMessageType("yorkie.v1.AttachDocumentResponse",()=>[{no:1,name:"document_id",kind:"scalar",T:9},{no:2,name:"change_pack",kind:"message",T:rn}]),sh=A.makeMessageType("yorkie.v1.DetachDocumentRequest",()=>[{no:1,name:"client_id",kind:"scalar",T:9},{no:2,name:"document_id",kind:"scalar",T:9},{no:3,name:"change_pack",kind:"message",T:rn},{no:4,name:"remove_if_not_attached",kind:"scalar",T:8}]),ih=A.makeMessageType("yorkie.v1.DetachDocumentResponse",()=>[{no:2,name:"change_pack",kind:"message",T:rn}]),oh=A.makeMessageType("yorkie.v1.WatchDocumentRequest",()=>[{no:1,name:"client_id",kind:"scalar",T:9},{no:2,name:"document_id",kind:"scalar",T:9}]),ah=A.makeMessageType("yorkie.v1.WatchDocumentResponse",()=>[{no:1,name:"initialization",kind:"message",T:ch,oneof:"body"},{no:2,name:"event",kind:"message",T:Xu,oneof:"body"}]),ch=A.makeMessageType("yorkie.v1.WatchDocumentResponse.Initialization",()=>[{no:1,name:"client_ids",kind:"scalar",T:9,repeated:!0}],{localName:"WatchDocumentResponse_Initialization"}),lh=A.makeMessageType("yorkie.v1.RemoveDocumentRequest",()=>[{no:1,name:"client_id",kind:"scalar",T:9},{no:2,name:"document_id",kind:"scalar",T:9},{no:3,name:"change_pack",kind:"message",T:rn}]),uh=A.makeMessageType("yorkie.v1.RemoveDocumentResponse",()=>[{no:1,name:"change_pack",kind:"message",T:rn}]),hh=A.makeMessageType("yorkie.v1.PushPullChangesRequest",()=>[{no:1,name:"client_id",kind:"scalar",T:9},{no:2,name:"document_id",kind:"scalar",T:9},{no:3,name:"change_pack",kind:"message",T:rn},{no:4,name:"push_only",kind:"scalar",T:8}]),fh=A.makeMessageType("yorkie.v1.PushPullChangesResponse",()=>[{no:1,name:"change_pack",kind:"message",T:rn}]),dh=A.makeMessageType("yorkie.v1.BroadcastRequest",()=>[{no:1,name:"client_id",kind:"scalar",T:9},{no:2,name:"document_id",kind:"scalar",T:9},{no:3,name:"topic",kind:"scalar",T:9},{no:4,name:"payload",kind:"scalar",T:12}]),gh=A.makeMessageType("yorkie.v1.BroadcastResponse",[]),ph={typeName:"yorkie.v1.YorkieService",methods:{activateClient:{name:"ActivateClient",I:Zu,O:Qu,kind:He.Unary},deactivateClient:{name:"DeactivateClient",I:eh,O:th,kind:He.Unary},attachDocument:{name:"AttachDocument",I:nh,O:rh,kind:He.Unary},detachDocument:{name:"DetachDocument",I:sh,O:ih,kind:He.Unary},removeDocument:{name:"RemoveDocument",I:lh,O:uh,kind:He.Unary},pushPullChanges:{name:"PushPullChanges",I:hh,O:fh,kind:He.Unary},watchDocument:{name:"WatchDocument",I:oh,O:ah,kind:He.ServerStreaming},broadcast:{name:"Broadcast",I:dh,O:gh,kind:He.Unary}}};/**
 * @license
 * Copyright 2009 The Closure Library Authors
 * Copyright 2020 Daniel Wirtz / The long.js Authors.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * SPDX-License-Identifier: Apache-2.0
 */var dt=null;try{dt=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function X(r,e,t){this.low=r|0,this.high=e|0,this.unsigned=!!t}X.prototype.__isLong__,Object.defineProperty(X.prototype,"__isLong__",{value:!0});function Ke(r){return(r&&r.__isLong__)===!0}function Ca(r){var e=Math.clz32(r&-r);return r?31-e:e}X.isLong=Ke;var Na={},xa={};function $n(r,e){var t,n,s;return e?(r>>>=0,(s=0<=r&&r<256)&&(n=xa[r],n)?n:(t=le(r,0,!0),s&&(xa[r]=t),t)):(r|=0,(s=-128<=r&&r<128)&&(n=Na[r],n)?n:(t=le(r,r<0?-1:0,!1),s&&(Na[r]=t),t))}X.fromInt=$n;function gt(r,e){if(isNaN(r))return e?on:bt;if(e){if(r<0)return on;if(r>=Pa)return Ba}else{if(r<=-Da)return et;if(r+1>=Da)return Ma}return r<0?gt(-r,e).neg():le(r%or|0,r/or|0,e)}X.fromNumber=gt;function le(r,e,t){return new X(r,e,t)}X.fromBits=le;var As=Math.pow;function Ti(r,e,t){if(r.length===0)throw Error("empty string");if(typeof e=="number"?(t=e,e=!1):e=!!e,r==="NaN"||r==="Infinity"||r==="+Infinity"||r==="-Infinity")return e?on:bt;if(t=t||10,t<2||36<t)throw RangeError("radix");var n;if((n=r.indexOf("-"))>0)throw Error("interior hyphen");if(n===0)return Ti(r.substring(1),e,t).neg();for(var s=gt(As(t,8)),a=bt,c=0;c<r.length;c+=8){var f=Math.min(8,r.length-c),g=parseInt(r.substring(c,c+f),t);if(f<8){var m=gt(As(t,f));a=a.mul(m).add(gt(g))}else a=a.mul(s),a=a.add(gt(g))}return a.unsigned=e,a}X.fromString=Ti;function Tt(r,e){return typeof r=="number"?gt(r,e):typeof r=="string"?Ti(r,e):le(r.low,r.high,typeof e=="boolean"?e:r.unsigned)}X.fromValue=Tt;var Oa=1<<16,mh=1<<24,or=Oa*Oa,Pa=or*or,Da=Pa/2,Ra=$n(mh),bt=$n(0);X.ZERO=bt;var on=$n(0,!0);X.UZERO=on;var ar=$n(1);X.ONE=ar;var _a=$n(1,!0);X.UONE=_a;var bi=$n(-1);X.NEG_ONE=bi;var Ma=le(-1,2147483647,!1);X.MAX_VALUE=Ma;var Ba=le(-1,-1,!0);X.MAX_UNSIGNED_VALUE=Ba;var et=le(0,-2147483648,!1);X.MIN_VALUE=et;var M=X.prototype;M.toInt=function(){return this.unsigned?this.low>>>0:this.low},M.toNumber=function(){return this.unsigned?(this.high>>>0)*or+(this.low>>>0):this.high*or+(this.low>>>0)},M.toString=function(e){if(e=e||10,e<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(et)){var t=gt(e),n=this.div(t),s=n.mul(t).sub(this);return n.toString(e)+s.toInt().toString(e)}else return"-"+this.neg().toString(e);for(var a=gt(As(e,6),this.unsigned),c=this,f="";;){var g=c.div(a),m=c.sub(g.mul(a)).toInt()>>>0,b=m.toString(e);if(c=g,c.isZero())return b+f;for(;b.length<6;)b="0"+b;f=""+b+f}},M.getHighBits=function(){return this.high},M.getHighBitsUnsigned=function(){return this.high>>>0},M.getLowBits=function(){return this.low},M.getLowBitsUnsigned=function(){return this.low>>>0},M.getNumBitsAbs=function(){if(this.isNegative())return this.eq(et)?64:this.neg().getNumBitsAbs();for(var e=this.high!=0?this.high:this.low,t=31;t>0&&(e&1<<t)==0;t--);return this.high!=0?t+33:t+1},M.isZero=function(){return this.high===0&&this.low===0},M.eqz=M.isZero,M.isNegative=function(){return!this.unsigned&&this.high<0},M.isPositive=function(){return this.unsigned||this.high>=0},M.isOdd=function(){return(this.low&1)===1},M.isEven=function(){return(this.low&1)===0},M.equals=function(e){return Ke(e)||(e=Tt(e)),this.unsigned!==e.unsigned&&this.high>>>31===1&&e.high>>>31===1?!1:this.high===e.high&&this.low===e.low},M.eq=M.equals,M.notEquals=function(e){return!this.eq(e)},M.neq=M.notEquals,M.ne=M.notEquals,M.lessThan=function(e){return this.comp(e)<0},M.lt=M.lessThan,M.lessThanOrEqual=function(e){return this.comp(e)<=0},M.lte=M.lessThanOrEqual,M.le=M.lessThanOrEqual,M.greaterThan=function(e){return this.comp(e)>0},M.gt=M.greaterThan,M.greaterThanOrEqual=function(e){return this.comp(e)>=0},M.gte=M.greaterThanOrEqual,M.ge=M.greaterThanOrEqual,M.compare=function(e){if(Ke(e)||(e=Tt(e)),this.eq(e))return 0;var t=this.isNegative(),n=e.isNegative();return t&&!n?-1:!t&&n?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},M.comp=M.compare,M.negate=function(){return!this.unsigned&&this.eq(et)?et:this.not().add(ar)},M.neg=M.negate,M.add=function(e){Ke(e)||(e=Tt(e));var t=this.high>>>16,n=this.high&65535,s=this.low>>>16,a=this.low&65535,c=e.high>>>16,f=e.high&65535,g=e.low>>>16,m=e.low&65535,b=0,x=0,C=0,S=0;return S+=a+m,C+=S>>>16,S&=65535,C+=s+g,x+=C>>>16,C&=65535,x+=n+f,b+=x>>>16,x&=65535,b+=t+c,b&=65535,le(C<<16|S,b<<16|x,this.unsigned)},M.subtract=function(e){return Ke(e)||(e=Tt(e)),this.add(e.neg())},M.sub=M.subtract,M.multiply=function(e){if(this.isZero())return this;if(Ke(e)||(e=Tt(e)),dt){var t=dt.mul(this.low,this.high,e.low,e.high);return le(t,dt.get_high(),this.unsigned)}if(e.isZero())return this.unsigned?on:bt;if(this.eq(et))return e.isOdd()?et:bt;if(e.eq(et))return this.isOdd()?et:bt;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(Ra)&&e.lt(Ra))return gt(this.toNumber()*e.toNumber(),this.unsigned);var n=this.high>>>16,s=this.high&65535,a=this.low>>>16,c=this.low&65535,f=e.high>>>16,g=e.high&65535,m=e.low>>>16,b=e.low&65535,x=0,C=0,S=0,F=0;return F+=c*b,S+=F>>>16,F&=65535,S+=a*b,C+=S>>>16,S&=65535,S+=c*m,C+=S>>>16,S&=65535,C+=s*b,x+=C>>>16,C&=65535,C+=a*m,x+=C>>>16,C&=65535,C+=c*g,x+=C>>>16,C&=65535,x+=n*b+s*m+a*g+c*f,x&=65535,le(S<<16|F,x<<16|C,this.unsigned)},M.mul=M.multiply,M.divide=function(e){if(Ke(e)||(e=Tt(e)),e.isZero())throw Error("division by zero");if(dt){if(!this.unsigned&&this.high===-2147483648&&e.low===-1&&e.high===-1)return this;var t=(this.unsigned?dt.div_u:dt.div_s)(this.low,this.high,e.low,e.high);return le(t,dt.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?on:bt;var n,s,a;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return on;if(e.gt(this.shru(1)))return _a;a=on}else{if(this.eq(et)){if(e.eq(ar)||e.eq(bi))return et;if(e.eq(et))return ar;var c=this.shr(1);return n=c.div(e).shl(1),n.eq(bt)?e.isNegative()?ar:bi:(s=this.sub(e.mul(n)),a=n.add(s.div(e)),a)}else if(e.eq(et))return this.unsigned?on:bt;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();a=bt}for(s=this;s.gte(e);){n=Math.max(1,Math.floor(s.toNumber()/e.toNumber()));for(var f=Math.ceil(Math.log(n)/Math.LN2),g=f<=48?1:As(2,f-48),m=gt(n),b=m.mul(e);b.isNegative()||b.gt(s);)n-=g,m=gt(n,this.unsigned),b=m.mul(e);m.isZero()&&(m=ar),a=a.add(m),s=s.sub(b)}return a},M.div=M.divide,M.modulo=function(e){if(Ke(e)||(e=Tt(e)),dt){var t=(this.unsigned?dt.rem_u:dt.rem_s)(this.low,this.high,e.low,e.high);return le(t,dt.get_high(),this.unsigned)}return this.sub(this.div(e).mul(e))},M.mod=M.modulo,M.rem=M.modulo,M.not=function(){return le(~this.low,~this.high,this.unsigned)},M.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32},M.clz=M.countLeadingZeros,M.countTrailingZeros=function(){return this.low?Ca(this.low):Ca(this.high)+32},M.ctz=M.countTrailingZeros,M.and=function(e){return Ke(e)||(e=Tt(e)),le(this.low&e.low,this.high&e.high,this.unsigned)},M.or=function(e){return Ke(e)||(e=Tt(e)),le(this.low|e.low,this.high|e.high,this.unsigned)},M.xor=function(e){return Ke(e)||(e=Tt(e)),le(this.low^e.low,this.high^e.high,this.unsigned)},M.shiftLeft=function(e){return Ke(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?le(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):le(0,this.low<<e-32,this.unsigned)},M.shl=M.shiftLeft,M.shiftRight=function(e){return Ke(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?le(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):le(this.high>>e-32,this.high>=0?0:-1,this.unsigned)},M.shr=M.shiftRight,M.shiftRightUnsigned=function(e){return Ke(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?le(this.low>>>e|this.high<<32-e,this.high>>>e,this.unsigned):e===32?le(this.high,0,this.unsigned):le(this.high>>>e-32,0,this.unsigned)},M.shru=M.shiftRightUnsigned,M.shr_u=M.shiftRightUnsigned,M.rotateLeft=function(e){var t;return Ke(e)&&(e=e.toInt()),(e&=63)===0?this:e===32?le(this.high,this.low,this.unsigned):e<32?(t=32-e,le(this.low<<e|this.high>>>t,this.high<<e|this.low>>>t,this.unsigned)):(e-=32,t=32-e,le(this.high<<e|this.low>>>t,this.low<<e|this.high>>>t,this.unsigned))},M.rotl=M.rotateLeft,M.rotateRight=function(e){var t;return Ke(e)&&(e=e.toInt()),(e&=63)===0?this:e===32?le(this.high,this.low,this.unsigned):e<32?(t=32-e,le(this.high<<t|this.low>>>e,this.low<<t|this.high>>>e,this.unsigned)):(e-=32,t=32-e,le(this.low<<t|this.high>>>e,this.high<<t|this.low>>>e,this.unsigned))},M.rotr=M.rotateRight,M.toSigned=function(){return this.unsigned?le(this.low,this.high,!1):this},M.toUnsigned=function(){return this.unsigned?this:le(this.low,this.high,!0)},M.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},M.toBytesLE=function(){var e=this.high,t=this.low;return[t&255,t>>>8&255,t>>>16&255,t>>>24,e&255,e>>>8&255,e>>>16&255,e>>>24]},M.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,e&255,t>>>24,t>>>16&255,t>>>8&255,t&255]},X.fromBytes=function(e,t,n){return n?X.fromBytesLE(e,t):X.fromBytesBE(e,t)},X.fromBytesLE=function(e,t){return new X(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)},X.fromBytesBE=function(e,t){return new X(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)};const yh=A.makeMessageType("google.rpc.ErrorInfo",()=>[{no:1,name:"reason",kind:"scalar",T:9},{no:2,name:"domain",kind:"scalar",T:9},{no:3,name:"metadata",kind:"map",K:9,V:{kind:"scalar",T:9}}]);A.makeMessageType("google.rpc.RetryInfo",()=>[{no:1,name:"retry_delay",kind:"message",T:tn}]),A.makeMessageType("google.rpc.DebugInfo",()=>[{no:1,name:"stack_entries",kind:"scalar",T:9,repeated:!0},{no:2,name:"detail",kind:"scalar",T:9}]),A.makeMessageType("google.rpc.QuotaFailure",()=>[{no:1,name:"violations",kind:"message",T:vh,repeated:!0}]);const vh=A.makeMessageType("google.rpc.QuotaFailure.Violation",()=>[{no:1,name:"subject",kind:"scalar",T:9},{no:2,name:"description",kind:"scalar",T:9}],{localName:"QuotaFailure_Violation"});A.makeMessageType("google.rpc.PreconditionFailure",()=>[{no:1,name:"violations",kind:"message",T:Th,repeated:!0}]);const Th=A.makeMessageType("google.rpc.PreconditionFailure.Violation",()=>[{no:1,name:"type",kind:"scalar",T:9},{no:2,name:"subject",kind:"scalar",T:9},{no:3,name:"description",kind:"scalar",T:9}],{localName:"PreconditionFailure_Violation"});A.makeMessageType("google.rpc.BadRequest",()=>[{no:1,name:"field_violations",kind:"message",T:bh,repeated:!0}]);const bh=A.makeMessageType("google.rpc.BadRequest.FieldViolation",()=>[{no:1,name:"field",kind:"scalar",T:9},{no:2,name:"description",kind:"scalar",T:9}],{localName:"BadRequest_FieldViolation"});A.makeMessageType("google.rpc.RequestInfo",()=>[{no:1,name:"request_id",kind:"scalar",T:9},{no:2,name:"serving_data",kind:"scalar",T:9}]),A.makeMessageType("google.rpc.ResourceInfo",()=>[{no:1,name:"resource_type",kind:"scalar",T:9},{no:2,name:"resource_name",kind:"scalar",T:9},{no:3,name:"owner",kind:"scalar",T:9},{no:4,name:"description",kind:"scalar",T:9}]),A.makeMessageType("google.rpc.Help",()=>[{no:1,name:"links",kind:"message",T:wh,repeated:!0}]);const wh=A.makeMessageType("google.rpc.Help.Link",()=>[{no:1,name:"description",kind:"scalar",T:9},{no:2,name:"url",kind:"scalar",T:9}],{localName:"Help_Link"});A.makeMessageType("google.rpc.LocalizedMessage",()=>[{no:1,name:"locale",kind:"scalar",T:9},{no:2,name:"message",kind:"scalar",T:9}]);var oe=(r=>(r.Ok="ok",r.ErrClientNotActivated="ErrClientNotActivated",r.ErrClientNotFound="ErrClientNotFound",r.ErrUnimplemented="ErrUnimplemented",r.Unsupported="unsupported",r.ErrDocumentNotAttached="ErrDocumentNotAttached",r.ErrDocumentNotDetached="ErrDocumentNotDetached",r.ErrDocumentRemoved="ErrDocumentRemoved",r.ErrInvalidObjectKey="ErrInvalidObjectKey",r.ErrInvalidArgument="ErrInvalidArgument",r))(oe||{});class ue extends Error{constructor(e,t){super(t),u(this,"name","YorkieError"),u(this,"stack"),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}function wt(r){if(r instanceof Map){const e=Array.from(r);return new Map(JSON.parse(JSON.stringify(e)))}return JSON.parse(JSON.stringify(r))}const La=r=>r?Object.entries(r).length===0:!0,cr=r=>{const e={};for(const[t,n]of Object.entries(r))e[t]=JSON.stringify(n);return e},lr=r=>{const e={};for(const[t,n]of Object.entries(r))e[t]=JSON.parse(n);return e};var bn=(r=>(r.Put="put",r.Clear="clear",r))(bn||{});class wi{constructor(e,t){u(this,"context"),u(this,"presence"),this.context=e,this.presence=t}set(e,t){for(const n of Object.keys(e))this.presence[n]=e[n];this.context.setPresenceChange({type:"put",presence:wt(this.presence)}),this.context.setReversePresence(e,t)}get(e){return this.presence[e]}clear(){this.presence={},this.context.setPresenceChange({type:"clear"})}}const Ss="000000000000000000000000",Ah="FFFFFFFFFFFFFFFFFFFFFFFF";class Ge{constructor(e,t,n){u(this,"lamport"),u(this,"delimiter"),u(this,"actorID"),this.lamport=e,this.delimiter=t,this.actorID=n}static of(e,t,n){return new Ge(e,t,n)}static fromStruct(e){return Ge.of(X.fromString(e.lamport,!0),e.delimiter,e.actorID)}toIDString(){return`${this.lamport.toString()}:${this.actorID}:${this.delimiter}`}toStruct(){return{lamport:this.getLamportAsString(),delimiter:this.getDelimiter(),actorID:this.getActorID()}}toTestString(){return`${this.lamport.toString()}:${this.actorID.slice(-2)}:${this.delimiter}`}setActor(e){return new Ge(this.lamport,this.delimiter,e)}getLamportAsString(){return this.lamport.toString()}getLamport(){return this.lamport}getDelimiter(){return this.delimiter}getActorID(){return this.actorID}after(e){return this.compare(e)>0}equals(e){return this.compare(e)===0}compare(e){if(this.lamport.greaterThan(e.lamport))return 1;if(e.lamport.greaterThan(this.lamport))return-1;const t=this.actorID.localeCompare(e.actorID);return t!==0?t:this.delimiter>e.delimiter?1:e.delimiter>this.delimiter?-1:0}}const Ai=0,Sh=4294967295,Ih=X.MAX_VALUE,At=new Ge(X.fromNumber(0),Ai,Ss);new Ge(X.fromNumber(1),Ai+1,Ss);const _r=new Ge(Ih,Sh,Ah);var Ve=(r=>(r[r.Trivial=0]="Trivial",r[r.Debug=1]="Debug",r[r.Info=2]="Info",r[r.Warn=3]="Warn",r[r.Error=4]="Error",r[r.Fatal=5]="Fatal",r))(Ve||{});let Fn=2;function Si(r){Fn=r}const R={trivial:(...r)=>{Fn>0||typeof console<"u"&&console.log("YORKIE T:",...r)},debug:(...r)=>{Fn>1||typeof console<"u"&&console.log("YORKIE D:",...r)},info:(...r)=>{Fn>2||typeof console<"u"&&console.log("YORKIE I:",...r)},warn:(...r)=>{Fn>3||typeof console<"u"&&(typeof console.warn<"u"?console.warn("YORKIE W:",...r):console.log("YORKIE W:",...r))},error:(...r)=>{Fn>4||typeof console<"u"&&(typeof console.error<"u"?console.error("YORKIE E:",...r):console.log("YORKIE E:",...r))},fatal:(r,...e)=>{throw typeof console<"u"&&(typeof console.error<"u"?console.error("YORKIE F:",...e):console.log("YORKIE F:",...e)),new Error(`YORKIE F: ${r}`)},isEnabled:r=>Fn<=r};function Vt(r){return r.replace(/["'\\\n\r\f\b\t\u2028\u2029]/g,function(e){switch(e){case'"':case"\\":return"\\"+e;case`
`:return"\\n";case"\r":return"\\r";case"\f":return"\\f";case"\b":return"\\b";case"	":return"\\t";case"\u2028":return"\\u2028";case"\u2029":return"\\u2029";default:return e}})}class Mr{constructor(e){u(this,"createdAt"),u(this,"movedAt"),u(this,"removedAt"),this.createdAt=e}getCreatedAt(){return this.createdAt}getID(){return this.createdAt}getMovedAt(){return this.movedAt}getRemovedAt(){return this.removedAt}getPositionedAt(){return this.movedAt?this.movedAt:this.createdAt}setMovedAt(e){return!this.movedAt||e&&e.after(this.movedAt)?(this.movedAt=e,!0):!1}setRemovedAt(e){this.removedAt=e}remove(e){return e&&e.after(this.getPositionedAt())&&(!this.removedAt||e.after(this.removedAt))?(this.removedAt=e,!0):!1}isRemoved(){return!!this.removedAt}}class wn extends Mr{constructor(e){super(e)}}class Ii{constructor(e,t){u(this,"strKey"),u(this,"value"),this.strKey=e,this.value=t}static of(e,t){return new Ii(e,t)}isRemoved(){return this.value.isRemoved()}getStrKey(){return this.strKey}getValue(){return this.value}remove(e){return this.value.remove(e)}}class Br{constructor(){u(this,"nodeMapByKey"),u(this,"nodeMapByCreatedAt"),this.nodeMapByKey=new Map,this.nodeMapByCreatedAt=new Map}static create(){return new Br}set(e,t,n){let s;const a=this.nodeMapByKey.get(e);a!=null&&!a.isRemoved()&&a.remove(n)&&(s=a.getValue());const c=Ii.of(e,t);return this.nodeMapByCreatedAt.set(t.getCreatedAt().toIDString(),c),(a==null||n.after(a.getValue().getPositionedAt()))&&(this.nodeMapByKey.set(e,c),t.setMovedAt(n)),s}delete(e,t){this.nodeMapByCreatedAt.has(e.toIDString())||R.fatal(`fail to find ${e.toIDString()}`);const n=this.nodeMapByCreatedAt.get(e.toIDString());return n.remove(t),n.getValue()}subPathOf(e){const t=this.nodeMapByCreatedAt.get(e.toIDString());if(!!t)return t.getStrKey()}purge(e){const t=this.nodeMapByCreatedAt.get(e.getCreatedAt().toIDString());if(!t){R.fatal(`fail to find ${e.getCreatedAt().toIDString()}`);return}const n=this.nodeMapByKey.get(t.getStrKey());t===n&&this.nodeMapByKey.delete(n.getStrKey()),this.nodeMapByCreatedAt.delete(t.getValue().getCreatedAt().toIDString())}deleteByKey(e,t){const n=this.nodeMapByKey.get(e);if(n!=null&&!!n.remove(t))return n.getValue()}has(e){const t=this.nodeMapByKey.get(e);return t==null?!1:!t.isRemoved()}getByID(e){return this.nodeMapByCreatedAt.get(e.toIDString())}get(e){const t=this.nodeMapByKey.get(e);if(!(!t||t.isRemoved()))return t}*[Symbol.iterator](){for(const[,e]of this.nodeMapByKey)yield e}}class tt extends wn{constructor(e,t){super(e),u(this,"memberNodes"),this.memberNodes=t}static create(e,t){if(!t)return new tt(e,Br.create());const n=Br.create();for(const[s,a]of Object.entries(t))n.set(s,a.deepcopy(),a.getCreatedAt());return new tt(e,n)}subPathOf(e){return this.memberNodes.subPathOf(e)}purge(e){this.memberNodes.purge(e)}set(e,t,n){return this.memberNodes.set(e,t,n)}delete(e,t){return this.memberNodes.delete(e,t)}deleteByKey(e,t){return this.memberNodes.deleteByKey(e,t)}get(e){const t=this.memberNodes.get(e);return t==null?void 0:t.getValue()}getByID(e){const t=this.memberNodes.getByID(e);return t==null?void 0:t.getValue()}has(e){return this.memberNodes.has(e)}toJSON(){const e=[];for(const[t,n]of this)e.push(`"${Vt(t)}":${n.toJSON()}`);return`{${e.join(",")}}`}toJS(){return JSON.parse(this.toJSON())}toJSForTest(){const e={};for(const[t,n]of this){const{createdAt:s,value:a,type:c}=n.toJSForTest();e[t]={key:t,createdAt:s,value:a,type:c}}return{createdAt:this.getCreatedAt().toTestString(),value:e,type:"YORKIE_OBJECT"}}getKeys(){const e=Array();for(const[t]of this)e.push(t);return e}toSortedJSON(){var e;const t=Array();for(const[s]of this)t.push(s);const n=[];for(const s of t.sort()){const a=(e=this.memberNodes.get(s))==null?void 0:e.getValue();n.push(`"${Vt(s)}":${a.toSortedJSON()}`)}return`{${n.join(",")}}`}getRHT(){return this.memberNodes}deepcopy(){const e=tt.create(this.getCreatedAt());for(const t of this.memberNodes)e.memberNodes.set(t.getStrKey(),t.getValue().deepcopy(),this.getPositionedAt());return e.remove(this.getRemovedAt()),e}getDescendants(e){for(const t of this.memberNodes){const n=t.getValue();if(e(n,this))return;n instanceof wn&&n.getDescendants(e)}}*[Symbol.iterator](){const e=new Set;for(const t of this.memberNodes)e.has(t.getStrKey())||(e.add(t.getStrKey()),t.isRemoved()||(yield[t.getStrKey(),t.getValue()]))}}var pe=(r=>(r.Local="local",r.Remote="remote",r.UndoRedo="undoredo",r))(pe||{});class St{constructor(e,t){u(this,"parentCreatedAt"),u(this,"executedAt"),this.parentCreatedAt=e,this.executedAt=t}getParentCreatedAt(){return this.parentCreatedAt}getExecutedAt(){if(!this.executedAt)throw new Error("executedAt has not been set yet");return this.executedAt}setActor(e){this.executedAt&&(this.executedAt=this.executedAt.setActor(e))}setExecutedAt(e){this.executedAt=e}}class $a{constructor(e){u(this,"value"),u(this,"left"),u(this,"right"),u(this,"parent"),u(this,"weight"),this.value=e,this.initWeight()}getNodeString(){return`${this.weight}${this.value}`}getValue(){return this.value}getLeftWeight(){return this.hasLeft()?this.left.getWeight():0}getRightWeight(){return this.hasRight()?this.right.getWeight():0}getWeight(){return this.weight}getLeft(){return this.left}getRight(){return this.right}getParent(){return this.parent}hasLeft(){return!!this.left}hasRight(){return!!this.right}hasParent(){return!!this.parent}setLeft(e){this.left=e}setRight(e){this.right=e}setParent(e){this.parent=e}unlink(){this.parent=void 0,this.right=void 0,this.left=void 0}hasLinks(){return this.hasParent()||this.hasLeft()||this.hasRight()}increaseWeight(e){this.weight+=e}initWeight(){this.weight=this.getLength()}}class Lr{constructor(e){u(this,"root"),this.root=e}get length(){return this.root?this.root.getWeight():0}find(e){if(!this.root||e<0)return[void 0,0];let t=this.root;for(;;)if(t.hasLeft()&&e<=t.getLeftWeight())t=t.getLeft();else if(t.hasRight()&&t.getLeftWeight()+t.getLength()<e)e-=t.getLeftWeight()+t.getLength(),t=t.getRight();else{e-=t.getLeftWeight();break}return e>t.getLength()&&R.fatal(`out of index range: pos: ${e} > node.length: ${t.getLength()}`),[t,e]}indexOf(e){if(!e||e!==this.root&&!e.hasLinks())return-1;let t=0,n=e,s;for(;n;)(!s||s===n.getRight())&&(t+=n.getLength()+(n.hasLeft()?n.getLeftWeight():0)),s=n,n=n.getParent();return t-e.getLength()}getRoot(){return this.root}insert(e){return this.insertAfter(this.root,e)}insertAfter(e,t){return e?(this.splayNode(e),this.root=t,t.setRight(e.getRight()),e.hasRight()&&e.getRight().setParent(t),t.setLeft(e),e.setParent(t),e.setRight(),this.updateWeight(e),this.updateWeight(t),t):(this.root=t,t)}updateWeight(e){e.initWeight(),e.hasLeft()&&e.increaseWeight(e.getLeftWeight()),e.hasRight()&&e.increaseWeight(e.getRightWeight())}updateTreeWeight(e){for(;e;)this.updateWeight(e),e=e.getParent()}splayNode(e){if(!!e)for(;;)if(this.isLeftChild(e.getParent())&&this.isRightChild(e))this.rotateLeft(e),this.rotateRight(e);else if(this.isRightChild(e.getParent())&&this.isLeftChild(e))this.rotateRight(e),this.rotateLeft(e);else if(this.isLeftChild(e.getParent())&&this.isLeftChild(e))this.rotateRight(e.getParent()),this.rotateRight(e);else if(this.isRightChild(e.getParent())&&this.isRightChild(e))this.rotateLeft(e.getParent()),this.rotateLeft(e);else{this.isLeftChild(e)?this.rotateRight(e):this.isRightChild(e)&&this.rotateLeft(e),this.updateWeight(e);return}}delete(e){this.splayNode(e);const t=new Lr(e.getLeft());t.root&&t.root.setParent();const n=new Lr(e.getRight());if(n.root&&n.root.setParent(),t.root){const s=t.getRightmost();t.splayNode(s),t.root.setRight(n.root),n.root&&n.root.setParent(t.root),this.root=t.root}else this.root=n.root;e.unlink(),this.root&&this.updateWeight(this.root)}deleteRange(e,t){if(!t){this.splayNode(e),this.cutOffRight(e);return}this.splayNode(e),this.splayNode(t),t.getLeft()!=e&&this.rotateRight(e),this.cutOffRight(e)}cutOffRight(e){const t=[];this.traversePostorder(e.getRight(),t);for(const n of t)n.initWeight();this.updateTreeWeight(e)}toTestString(){const e=[];return this.traverseInorder(this.root,e),e.map(t=>`[${t.getWeight()},${t.getLength()}]${t.getValue()||""}`).join("")}checkWeight(){const e=[];this.traverseInorder(this.root,e);for(const t of e)if(t.getWeight()!=t.getLength()+t.getLeftWeight()+t.getRightWeight())return!1;return!0}getRightmost(){let e=this.root;for(;e.hasRight();)e=e.getRight();return e}traverseInorder(e,t){!e||(this.traverseInorder(e.getLeft(),t),t.push(e),this.traverseInorder(e.getRight(),t))}traversePostorder(e,t){!e||(this.traversePostorder(e.getLeft(),t),this.traversePostorder(e.getRight(),t),t.push(e))}rotateLeft(e){const t=e.getParent();t.hasParent()?t===t.getParent().getLeft()?t.getParent().setLeft(e):t.getParent().setRight(e):this.root=e,e.setParent(t.getParent()),t.setRight(e.getLeft()),t.hasRight()&&t.getRight().setParent(t),e.setLeft(t),e.getLeft().setParent(e),this.updateWeight(t),this.updateWeight(e)}rotateRight(e){const t=e.getParent();t.hasParent()?t===t.getParent().getLeft()?t.getParent().setLeft(e):t.getParent().setRight(e):this.root=e,e.setParent(t.getParent()),t.setLeft(e.getRight()),t.hasLeft()&&t.getLeft().setParent(t),e.setRight(t),e.getRight().setParent(e),this.updateWeight(t),this.updateWeight(e)}isLeftChild(e){return e&&e.hasParent()?e.getParent().getLeft()===e:!1}isRightChild(e){return e&&e.hasParent()?e.getParent().getRight()===e:!1}}var Le=(r=>(r[r.Null=0]="Null",r[r.Boolean=1]="Boolean",r[r.Integer=2]="Integer",r[r.Long=3]="Long",r[r.Double=4]="Double",r[r.String=5]="String",r[r.Bytes=6]="Bytes",r[r.Date=7]="Date",r))(Le||{});class Ae extends Mr{constructor(e,t){super(t),u(this,"valueType"),u(this,"value"),this.valueType=Ae.getPrimitiveType(e),this.value=e===void 0?null:e}static of(e,t){return new Ae(e,t)}static valueFromBytes(e,t){switch(e){case 0:return null;case 1:return!!t[0];case 2:return t[0]|t[1]<<8|t[2]<<16|t[3]<<24;case 4:{const n=new DataView(t.buffer);return t.forEach(function(s,a){n.setUint8(a,s)}),n.getFloat64(0,!0)}case 5:return new TextDecoder("utf-8").decode(t);case 3:return X.fromBytesLE(Array.from(t));case 6:return t;case 7:return new Date(X.fromBytesLE(Array.from(t),!0).toNumber());default:throw new ue(oe.ErrUnimplemented,`unimplemented type: ${e}`)}}toJSON(){return this.valueType===5?`"${Vt(this.value)}"`:`${this.value}`}toSortedJSON(){return this.toJSON()}toJSForTest(){return{createdAt:this.getCreatedAt().toTestString(),value:this.value,type:"YORKIE_PRIMITIVE"}}deepcopy(){const e=Ae.of(this.value,this.getCreatedAt());return e.setMovedAt(this.getMovedAt()),e.setRemovedAt(this.getRemovedAt()),e}getType(){return this.valueType}static getPrimitiveType(e){switch(typeof e){case"undefined":return 0;case"boolean":return 1;case"number":return this.isInteger(e)?2:4;case"string":return 5;case"object":if(e===null)return 0;if(e instanceof X)return 3;if(e instanceof Uint8Array)return 6;if(e instanceof Date)return 7}}static isSupport(e){return Ae.getPrimitiveType(e)!==void 0}static isInteger(e){return e%1===0}isNumericType(){const e=this.valueType;return e===2||e===3||e===4}getValue(){return this.value}toBytes(){switch(this.valueType){case 0:return new Uint8Array;case 1:return this.value?new Uint8Array([1]):new Uint8Array([0]);case 2:{const e=this.value;return new Uint8Array([e&255,e>>8&255,e>>16&255,e>>24&255])}case 4:{const e=this.value,t=new Uint8Array(8);return new DataView(t.buffer).setFloat64(0,e,!0),t}case 5:return new TextEncoder().encode(this.value);case 3:{const t=this.value.toBytesLE();return Uint8Array.from(t)}case 6:return this.value;case 7:{const e=this.value,t=X.fromNumber(e.getTime(),!0).toBytesLE();return Uint8Array.from(t)}default:throw new ue(oe.ErrUnimplemented,`unimplemented type: ${this.valueType}`)}}}class Is extends $a{constructor(e){super(e),u(this,"prev"),u(this,"next"),this.value=e}static createAfter(e,t){const n=new Is(t),s=e.next;return e.next=n,n.prev=e,n.next=s,s&&(s.prev=n),n}remove(e){return this.value.remove(e)}getCreatedAt(){return this.value.getCreatedAt()}getPositionedAt(){return this.value.getPositionedAt()}release(){this.prev&&(this.prev.next=this.next),this.next&&(this.next.prev=this.prev),this.prev=void 0,this.next=void 0}getLength(){return this.value.isRemoved()?0:1}getPrev(){return this.prev}getNext(){return this.next}getValue(){return this.value}isRemoved(){return this.value.isRemoved()}}class $r{constructor(){u(this,"dummyHead"),u(this,"last"),u(this,"nodeMapByIndex"),u(this,"nodeMapByCreatedAt");const e=Ae.of(0,At);e.setRemovedAt(At),this.dummyHead=new Is(e),this.last=this.dummyHead,this.nodeMapByIndex=new Lr,this.nodeMapByCreatedAt=new Map,this.nodeMapByIndex.insert(this.dummyHead),this.nodeMapByCreatedAt.set(this.dummyHead.getCreatedAt().toIDString(),this.dummyHead)}static create(){return new $r}get length(){return this.nodeMapByIndex.length}findNextBeforeExecutedAt(e,t){let n=this.nodeMapByCreatedAt.get(e.toIDString());for(n||R.fatal(`cant find the given node: ${e.toIDString()}`);n.getNext()&&n.getNext().getPositionedAt().after(t);)n=n.getNext();return n}release(e){this.last===e&&(this.last=e.getPrev()),e.release(),this.nodeMapByIndex.delete(e),this.nodeMapByCreatedAt.delete(e.getValue().getCreatedAt().toIDString())}insertAfter(e,t,n=t.getCreatedAt()){const s=this.findNextBeforeExecutedAt(e,n),a=Is.createAfter(s,t);s===this.last&&(this.last=a),this.nodeMapByIndex.insertAfter(s,a),this.nodeMapByCreatedAt.set(a.getCreatedAt().toIDString(),a)}moveAfter(e,t,n){const s=this.nodeMapByCreatedAt.get(e.toIDString());s||R.fatal(`cant find the given node: ${e.toIDString()}`);const a=this.nodeMapByCreatedAt.get(t.toIDString());a||R.fatal(`cant find the given node: ${t.toIDString()}`),s!==a&&(!a.getValue().getMovedAt()||n.after(a.getValue().getMovedAt()))&&(this.release(a),this.insertAfter(s.getCreatedAt(),a.getValue(),n),a.getValue().setMovedAt(n))}insert(e){this.insertAfter(this.last.getCreatedAt(),e)}getByID(e){return this.nodeMapByCreatedAt.get(e.toIDString())}subPathOf(e){const t=this.nodeMapByCreatedAt.get(e.toIDString());if(!!t)return String(this.nodeMapByIndex.indexOf(t))}purge(e){const t=this.nodeMapByCreatedAt.get(e.getCreatedAt().toIDString());t||R.fatal(`fail to find the given createdAt: ${e.getCreatedAt().toIDString()}`),this.release(t)}getByIndex(e){if(e>=this.length)return;const[t,n]=this.nodeMapByIndex.find(e);let s=t;if(e===0&&t===this.dummyHead||n>0)do s&&(s=s.getNext());while(s&&s.isRemoved());return s}getPrevCreatedAt(e){let t=this.nodeMapByCreatedAt.get(e.toIDString());do t=t.getPrev();while(this.dummyHead!==t&&t.isRemoved());return t.getValue().getCreatedAt()}delete(e,t){const n=this.nodeMapByCreatedAt.get(e.toIDString()),s=n.isRemoved();return n.remove(t)&&!s&&this.nodeMapByIndex.splayNode(n),n.getValue()}deleteByIndex(e,t){const n=this.getByIndex(e);if(!!n)return n.remove(t)&&this.nodeMapByIndex.splayNode(n),n.getValue()}getHead(){return this.dummyHead.getValue()}getLast(){return this.last.getValue()}getLastCreatedAt(){return this.last.getCreatedAt()}toTestString(){const e=[];for(const t of this){const n=`${t.getCreatedAt().toIDString()}:${t.getValue().toJSON()}`;t.isRemoved()?e.push(`{${n}}`):e.push(`[${n}]`)}return e.join("")}*[Symbol.iterator](){let e=this.dummyHead.getNext();for(;e;)yield e,e=e.getNext()}}class ct extends wn{constructor(e,t){super(e),u(this,"elements"),this.elements=t}static create(e,t){if(!t)return new ct(e,$r.create());const n=$r.create();for(const s of t)n.insertAfter(n.getLastCreatedAt(),s.deepcopy());return new ct(e,n)}subPathOf(e){return this.elements.subPathOf(e)}purge(e){this.elements.purge(e)}insertAfter(e,t){this.elements.insertAfter(e,t)}moveAfter(e,t,n){this.elements.moveAfter(e,t,n)}get(e){const t=this.elements.getByIndex(e);return t==null?void 0:t.getValue()}getByID(e){const t=this.elements.getByID(e);return t==null?void 0:t.getValue()}getHead(){return this.elements.getHead()}getLast(){return this.elements.getLast()}getPrevCreatedAt(e){return this.elements.getPrevCreatedAt(e)}delete(e,t){return this.elements.delete(e,t)}deleteByIndex(e,t){return this.elements.deleteByIndex(e,t)}getLastCreatedAt(){return this.elements.getLastCreatedAt()}get length(){return this.elements.length}*[Symbol.iterator](){for(const e of this.elements)e.isRemoved()||(yield e.getValue())}toTestString(){return this.elements.toTestString()}getDescendants(e){for(const t of this.elements){const n=t.getValue();if(e(n,this))return;n instanceof wn&&n.getDescendants(e)}}toJSON(){const e=[];for(const t of this)e.push(t.toJSON());return`[${e.join(",")}]`}toJS(){return JSON.parse(this.toJSON())}toJSForTest(){const e={};for(let t=0;t<this.length;t++){const{createdAt:n,value:s,type:a}=this.get(t).toJSForTest();e[t]={key:String(t),createdAt:n,value:s,type:a}}return{createdAt:this.getCreatedAt().toTestString(),value:e,type:"YORKIE_ARRAY"}}toSortedJSON(){return this.toJSON()}getElements(){return this.elements}deepcopy(){const e=ct.create(this.getCreatedAt());for(const t of this.elements)e.elements.insertAfter(e.getLastCreatedAt(),t.getValue().deepcopy());return e.remove(this.getRemovedAt()),e}}class An extends St{constructor(e,t,n){super(e,n),u(this,"createdAt"),this.createdAt=t}static create(e,t,n){return new An(e,t,n)}execute(e,t){var n;const s=e.findByCreatedAt(this.getParentCreatedAt());if(s||R.fatal(`fail to find ${this.getParentCreatedAt()}`),s instanceof wn||R.fatal(`only object and array can execute remove: ${s}`),t===pe.UndoRedo){let m=s.getByID(this.createdAt);for(;m;){if(m.getRemovedAt())return;m=(n=e.findElementPairByCreatedAt(m.getCreatedAt()))==null?void 0:n.parent}}const a=s.subPathOf(this.createdAt),c=this.toReverseOperation(s),f=s.delete(this.createdAt,this.getExecutedAt());return e.registerRemovedElement(f),{opInfos:s instanceof ct?[{type:"remove",path:e.createPath(this.getParentCreatedAt()),index:Number(a)}]:[{type:"remove",path:e.createPath(this.getParentCreatedAt()),key:a}],reverseOp:c}}toReverseOperation(e){if(e instanceof tt){const t=e.subPathOf(this.createdAt);if(t!==void 0){const n=e.get(t);if(n!==void 0)return Un.create(t,n.deepcopy(),this.getParentCreatedAt())}}}getEffectedCreatedAt(){return this.getParentCreatedAt()}toTestString(){return`${this.getParentCreatedAt().toTestString()}.REMOVE.${this.createdAt.toTestString()}`}getCreatedAt(){return this.createdAt}}class Un extends St{constructor(e,t,n,s){super(n,s),u(this,"key"),u(this,"value"),this.key=e,this.value=t}static create(e,t,n,s){return new Un(e,t,n,s)}execute(e,t){var n;const s=e.findByCreatedAt(this.getParentCreatedAt());if(s||R.fatal(`fail to find ${this.getParentCreatedAt()}`),s instanceof tt||R.fatal("fail to execute, only object can execute set"),t===pe.UndoRedo){let m=s;for(;m;){if(m.getRemovedAt())return;m=(n=e.findElementPairByCreatedAt(m.getCreatedAt()))==null?void 0:n.parent}}const a=s.get(this.key),c=this.toReverseOperation(a),f=this.value.deepcopy(),g=s.set(this.key,f,this.getExecutedAt());return t===pe.UndoRedo&&e.findByCreatedAt(f.getCreatedAt())&&e.deregisterElement(f),e.registerElement(f,s),g&&e.registerRemovedElement(g),{opInfos:[{type:"set",path:e.createPath(this.getParentCreatedAt()),key:this.key}],reverseOp:c}}toReverseOperation(e){let t=An.create(this.getParentCreatedAt(),this.value.getCreatedAt());return e!==void 0&&!e.isRemoved()&&(t=Un.create(this.key,e.deepcopy(),this.getParentCreatedAt())),t}getEffectedCreatedAt(){return this.value.getCreatedAt()}toTestString(){return`${this.getParentCreatedAt().toTestString()}.SET.${this.key}=${this.value.toSortedJSON()}`}getKey(){return this.key}getValue(){return this.value}}class Fr extends St{constructor(e,t,n,s){super(e,s),u(this,"prevCreatedAt"),u(this,"value"),this.prevCreatedAt=t,this.value=n}static create(e,t,n,s){return new Fr(e,t,n,s)}execute(e){const t=e.findByCreatedAt(this.getParentCreatedAt());t||R.fatal(`fail to find ${this.getParentCreatedAt()}`),t instanceof ct||R.fatal("fail to execute, only array can execute add");const n=t,s=this.value.deepcopy();return n.insertAfter(this.prevCreatedAt,s),e.registerElement(s,n),{opInfos:[{type:"add",path:e.createPath(this.getParentCreatedAt()),index:Number(n.subPathOf(this.getEffectedCreatedAt()))}]}}getEffectedCreatedAt(){return this.value.getCreatedAt()}toTestString(){return`${this.getParentCreatedAt().toTestString()}.ADD.${this.value.toJSON()}`}getPrevCreatedAt(){return this.prevCreatedAt}getValue(){return this.value}}class Sn extends St{constructor(e,t,n,s){super(e,s),u(this,"prevCreatedAt"),u(this,"createdAt"),this.prevCreatedAt=t,this.createdAt=n}static create(e,t,n,s){return new Sn(e,t,n,s)}execute(e){const t=e.findByCreatedAt(this.getParentCreatedAt());t||R.fatal(`fail to find ${this.getParentCreatedAt()}`),t instanceof ct||R.fatal("fail to execute, only array can execute move");const n=t,s=Number(n.subPathOf(this.createdAt));n.moveAfter(this.prevCreatedAt,this.createdAt,this.getExecutedAt());const a=Number(n.subPathOf(this.createdAt));return{opInfos:[{type:"move",path:e.createPath(this.getParentCreatedAt()),index:a,previousIndex:s}]}}getEffectedCreatedAt(){return this.createdAt}toTestString(){return`${this.getParentCreatedAt().toTestString()}.MOVE`}getPrevCreatedAt(){return this.prevCreatedAt}getCreatedAt(){return this.createdAt}}class Jn{constructor(e,t,n,s){u(this,"key"),u(this,"value"),u(this,"updatedAt"),u(this,"_isRemoved"),this.key=e,this.value=t,this.updatedAt=n,this._isRemoved=s}static of(e,t,n,s){return new Jn(e,t,n,s)}getKey(){return this.key}getValue(){return this.value}getUpdatedAt(){return this.updatedAt}isRemoved(){return this._isRemoved}toIDString(){return`${this.updatedAt.toIDString()}:${this.key}`}getRemovedAt(){if(this._isRemoved)return this.updatedAt}}class an{constructor(){u(this,"nodeMapByKey"),u(this,"numberOfRemovedElement"),this.nodeMapByKey=new Map,this.numberOfRemovedElement=0}static create(){return new an}getNodeMapByKey(){return this.nodeMapByKey}set(e,t,n){const s=this.nodeMapByKey.get(e);if(s&&s.isRemoved()&&n.after(s.getUpdatedAt())&&(this.numberOfRemovedElement-=1),s===void 0||n.after(s.getUpdatedAt())){const a=Jn.of(e,t,n,!1);return this.nodeMapByKey.set(e,a),s!==void 0&&s.isRemoved()?[s,a]:[void 0,a]}return s.isRemoved()?[s,void 0]:[void 0,void 0]}setInternal(e,t,n,s){const a=Jn.of(e,t,n,s);this.nodeMapByKey.set(e,a),s&&this.numberOfRemovedElement++}remove(e,t){const n=this.nodeMapByKey.get(e),s=[];if(n===void 0||t.after(n.getUpdatedAt())){if(n===void 0){this.numberOfRemovedElement+=1;const f=Jn.of(e,"",t,!0);return this.nodeMapByKey.set(e,f),s.push(f),s}const a=n.isRemoved();a||(this.numberOfRemovedElement+=1),a&&s.push(n);const c=Jn.of(e,n.getValue(),t,!0);return this.nodeMapByKey.set(e,c),s.push(c),s}return s}has(e){if(this.nodeMapByKey.has(e)){const t=this.nodeMapByKey.get(e);return t!==void 0&&!t.isRemoved()}return!1}get(e){if(!!this.nodeMapByKey.has(e))return this.nodeMapByKey.get(e).getValue()}deepcopy(){const e=new an;for(const[,t]of this.nodeMapByKey)e.setInternal(t.getKey(),t.getValue(),t.getUpdatedAt(),t.isRemoved());return e}toJSON(){if(!this.size())return"{}";const e=[];for(const[t,n]of this.nodeMapByKey)n.isRemoved()||e.push(`"${Vt(t)}":"${Vt(n.getValue())}"`);return`{${e.join(",")}}`}size(){return this.nodeMapByKey.size-this.numberOfRemovedElement}toObject(){const e={};for(const[t,n]of this.nodeMapByKey)n.isRemoved()||(e[t]=n.getValue());return e}*[Symbol.iterator](){for(const[,e]of this.nodeMapByKey)yield e}purge(e){const t=this.nodeMapByKey.get(e.getKey());t==null||t.toIDString()!=e.toIDString()||(this.nodeMapByKey.delete(e.getKey()),this.numberOfRemovedElement--)}}class Ur{constructor(e){u(this,"attributes"),u(this,"content"),this.attributes=an.create(),this.content=e}static create(e){return new Ur(e)}get length(){return this.content.length}substring(e,t){const n=new Ur(this.content.substring(e,t));return n.attributes=this.attributes.deepcopy(),n}setAttr(e,t,n){return this.attributes.set(e,t,n)}getAttrs(){return this.attributes}toString(){return this.content}toJSON(){const e=Vt(this.content),t=this.attributes.toObject(),n=[];for(const[s,a]of Object.entries(t)){const c=JSON.parse(a),f=typeof c=="string"?`"${Vt(s)}":"${Vt(c)}"`:`"${Vt(s)}":${String(c)}`;n.push(f)}return n.sort(),n.length===0?`{"val":"${e}"}`:`{"attrs":{${n.join(",")}},"val":"${e}"}`}getAttributes(){return this.attributes.toObject()}getContent(){return this.content}purge(e){this.attributes&&e instanceof Jn&&this.attributes.purge(e)}getGCPairs(){const e=[];for(const t of this.attributes)t.getRemovedAt()&&e.push({parent:this,child:t});return e}}class pt extends Mr{constructor(e,t){super(t),u(this,"rgaTreeSplit"),this.rgaTreeSplit=e}static create(e,t){return new pt(e,t)}edit(e,t,n,s,a){const c=t?Ur.create(t):void 0;if(c&&s)for(const[C,S]of Object.entries(s))c.setAttr(C,S,n);const[f,g,m,b]=this.rgaTreeSplit.edit(e,n,c,a),x=b.map(C=>({...C,value:C.value?{attributes:lr(C.value.getAttributes()),content:C.value.getContent()}:{attributes:void 0,content:""},type:"content"}));return[g,x,m,[f,f]]}setStyle(e,t,n,s){const[,a]=this.rgaTreeSplit.findNodeWithSplit(e[1],n),[,c]=this.rgaTreeSplit.findNodeWithSplit(e[0],n),f=[],g=this.rgaTreeSplit.findBetween(c,a),m=new Map,b=[];for(const C of g){const S=C.getCreatedAt().getActorID(),F=s!=null&&s.size?s.has(S)?s.get(S):At:_r;if(C.canStyle(n,F)){const G=m.get(S),H=C.getCreatedAt();(!G||H.after(G))&&m.set(S,H),b.push(C)}}const x=[];for(const C of b){if(C.isRemoved())continue;const[S,F]=this.rgaTreeSplit.findIndexesFromRange(C.createPosRange());f.push({type:"style",actor:n.getActorID(),from:S,to:F,value:{attributes:lr(t)}});for(const[G,H]of Object.entries(t)){const[se]=C.getValue().setAttr(G,H,n);se!==void 0&&x.push({parent:C.getValue(),child:se})}}return[m,x,f]}indexRangeToPosRange(e,t){const n=this.rgaTreeSplit.indexToPos(e);return e===t?[n,n]:[n,this.rgaTreeSplit.indexToPos(t)]}get length(){return this.rgaTreeSplit.length}getTreeByIndex(){return this.rgaTreeSplit.getTreeByIndex()}getTreeByID(){return this.rgaTreeSplit.getTreeByID()}toJSON(){const e=[];for(const t of this.rgaTreeSplit)t.isRemoved()||e.push(t.getValue().toJSON());return`[${e.join(",")}]`}toSortedJSON(){return this.toJSON()}toJSForTest(){return{createdAt:this.getCreatedAt().toTestString(),value:JSON.parse(this.toJSON()),type:"YORKIE_TEXT"}}toString(){return this.rgaTreeSplit.toString()}values(){const e=[];for(const t of this.rgaTreeSplit)if(!t.isRemoved()){const n=t.getValue();e.push({attributes:lr(n.getAttributes()),content:n.getContent()})}return e}getRGATreeSplit(){return this.rgaTreeSplit}toTestString(){return this.rgaTreeSplit.toTestString()}deepcopy(){const e=new pt(this.rgaTreeSplit.deepcopy(),this.getCreatedAt());return e.remove(this.getRemovedAt()),e}findIndexesFromRange(e){return this.rgaTreeSplit.findIndexesFromRange(e)}getGCPairs(){const e=[];for(const t of this.rgaTreeSplit){t.getRemovedAt()&&e.push({parent:this.rgaTreeSplit,child:t});for(const n of t.getValue().getGCPairs())e.push(n)}return e}}class Jr extends St{constructor(e,t,n,s,a,c,f){super(e,f),u(this,"fromPos"),u(this,"toPos"),u(this,"maxCreatedAtMapByActor"),u(this,"content"),u(this,"attributes"),this.fromPos=t,this.toPos=n,this.maxCreatedAtMapByActor=s,this.content=a,this.attributes=c}static create(e,t,n,s,a,c,f){return new Jr(e,t,n,s,a,c,f)}execute(e){const t=e.findByCreatedAt(this.getParentCreatedAt());t||R.fatal(`fail to find ${this.getParentCreatedAt()}`),t instanceof pt||R.fatal("fail to execute, only Text can execute edit");const n=t,[,s,a]=n.edit([this.fromPos,this.toPos],this.content,this.getExecutedAt(),Object.fromEntries(this.attributes),this.maxCreatedAtMapByActor);for(const c of a)e.registerGCPair(c);return{opInfos:s.map(({from:c,to:f,value:g})=>({type:"edit",from:c,to:f,value:g,path:e.createPath(this.getParentCreatedAt())}))}}getEffectedCreatedAt(){return this.getParentCreatedAt()}toTestString(){const e=this.getParentCreatedAt().toTestString(),t=this.fromPos.toTestString(),n=this.toPos.toTestString(),s=this.content;return`${e}.EDIT(${t},${n},${s})`}getFromPos(){return this.fromPos}getToPos(){return this.toPos}getContent(){return this.content}getAttributes(){return this.attributes||new Map}getMaxCreatedAtMapByActor(){return this.maxCreatedAtMapByActor}}class jr extends St{constructor(e,t,n,s,a,c){super(e,c),u(this,"fromPos"),u(this,"toPos"),u(this,"maxCreatedAtMapByActor"),u(this,"attributes"),this.fromPos=t,this.toPos=n,this.maxCreatedAtMapByActor=s,this.attributes=a}static create(e,t,n,s,a,c){return new jr(e,t,n,s,a,c)}execute(e){const t=e.findByCreatedAt(this.getParentCreatedAt());t||R.fatal(`fail to find ${this.getParentCreatedAt()}`),t instanceof pt||R.fatal("fail to execute, only Text can execute edit");const n=t,[,s,a]=n.setStyle([this.fromPos,this.toPos],this.attributes?Object.fromEntries(this.attributes):{},this.getExecutedAt(),this.maxCreatedAtMapByActor);for(const c of s)e.registerGCPair(c);return{opInfos:a.map(({from:c,to:f,value:g})=>({type:"style",from:c,to:f,value:g,path:e.createPath(this.getParentCreatedAt())}))}}getEffectedCreatedAt(){return this.getParentCreatedAt()}toTestString(){const e=this.getParentCreatedAt().toTestString(),t=this.fromPos.toTestString(),n=this.toPos.toTestString(),s=this.attributes;return`${e}.STYL(${t},${n},${JSON.stringify(s)})`}getFromPos(){return this.fromPos}getToPos(){return this.toPos}getAttributes(){return this.attributes}getMaxCreatedAtMapByActor(){return this.maxCreatedAtMapByActor}}const kh=2,Eh="root",cn="text";function qr(r,e){let t=0;const n=r.children;for(let s=0;s<e;s++){const a=n[s];!a||a.isRemoved||(t+=a.paddedSize)}return t}class Ch{constructor(e,t=[]){if(u(this,"type"),u(this,"parent"),u(this,"_children"),u(this,"size"),this.type=e,this.size=0,this._children=t,this.isText&&this._children.length>0)throw new Error(`Text node cannot have children: ${this.type}`)}updateAncestorsSize(){let e=this.parent;const t=this.isRemoved?-1:1;for(;e&&(e.size+=this.paddedSize*t,!e.isRemoved);)e=e.parent}updateDescendantsSize(){let e=0;for(const t of this._children){const n=t.updateDescendantsSize();t.isRemoved||(e+=n)}return this.size+=e,this.paddedSize}get isText(){return this.type===cn}get paddedSize(){return this.size+(this.isText?0:kh)}isAncestorOf(e){return Nh(this,e)}get nextSibling(){const e=this.parent.findOffset(this),t=this.parent.children[e+1];if(t)return t}get prevSibling(){const e=this.parent.findOffset(this),t=this.parent.children[e-1];if(t)return t}splitText(e,t){if(e===0||e===this.size)return;const n=this.value.slice(0,e),s=this.value.slice(e);if(!s.length)return;this.value=n;const a=this.cloneText(e+t);return a.value=s,this.parent.insertAfterInternal(a,this),a}get children(){return this._children.filter(e=>!e.isRemoved)}get allChildren(){return[...this._children]}hasTextChild(){return this.children.length>0&&this.children.every(e=>e.isText)}append(...e){if(this.isText)throw new Error("Text node cannot have children");this._children.push(...e);for(const t of e)t.parent=this,t.updateAncestorsSize()}prepend(...e){if(this.isText)throw new Error("Text node cannot have children");this._children.unshift(...e);for(const t of e)t.parent=this}insertBefore(e,t){if(this.isText)throw new Error("Text node cannot have children");const n=this._children.indexOf(t);if(n===-1)throw new Error("child not found");this.insertAtInternal(e,n),e.updateAncestorsSize()}insertAfter(e,t){if(this.isText)throw new Error("Text node cannot have children");const n=this._children.indexOf(t);if(n===-1)throw new Error("child not found");this.insertAtInternal(e,n+1),e.updateAncestorsSize()}insertAt(e,t){if(this.isText)throw new Error("Text node cannot have children");this.insertAtInternal(e,t),e.updateAncestorsSize()}removeChild(e){if(this.isText)throw new Error("Text node cannot have children");const t=this._children.indexOf(e);if(t===-1)throw new Error("child not found");this._children.splice(t,1),e.parent=void 0}splitElement(e,t){const n=this.cloneElement(t);this.parent.insertAfterInternal(n,this),n.updateAncestorsSize();const s=this.children.slice(0,e),a=this.children.slice(e);this._children=s,n._children=a,this.size=this._children.reduce((c,f)=>c+f.paddedSize,0),n.size=n._children.reduce((c,f)=>c+f.paddedSize,0);for(const c of n._children)c.parent=n;return n}insertAfterInternal(e,t){if(this.isText)throw new Error("Text node cannot have children");const n=this._children.indexOf(t);if(n===-1)throw new Error("child not found");this.insertAtInternal(e,n+1)}insertAtInternal(e,t){if(this.isText)throw new Error("Text node cannot have children");this._children.splice(t,0,e),e.parent=this}findOffset(e){if(this.isText)throw new Error("Text node cannot have children");if(e.isRemoved){const t=this._children.indexOf(e);return this.allChildren.splice(0,t).filter(s=>!s.isRemoved).length}return this.children.indexOf(e)}findBranchOffset(e){if(this.isText)throw new Error("Text node cannot have children");let t=e;for(;t;){const n=this._children.indexOf(t);if(n!==-1)return n;t=t.parent}return-1}}function Nh(r,e){if(r===e)return!1;for(;e.parent;){if(e.parent===r)return!0;e=e.parent}return!1}var De=(r=>(r.Start="Start",r.End="End",r.Text="Text",r))(De||{});function Fa(r,e,t,n){if(e>t)throw new Error(`from is greater than to: ${e} > ${t}`);if(e>r.size)throw new Error(`from is out of range: ${e} > ${r.size}`);if(t>r.size)throw new Error(`to is out of range: ${t} > ${r.size}`);if(e===t)return;let s=0;for(const a of r.children){if(e-a.paddedSize<s&&s<t){const c=a.isText?e-s:e-s-1,f=a.isText?t-s:t-s-1,g=!a.isText&&c<0,m=!a.isText&&f>a.size;(a.isText||g)&&n([a,a.isText?"Text":"Start"],m),Fa(a,Math.max(0,c),Math.min(f,a.size),n),m&&n([a,"End"],m)}s+=a.paddedSize}}function Ua(r,e,t=0){for(const n of r.children)Ua(n,e,t+1);e(r,t)}function ks(r,e,t=0){for(const n of r._children)ks(n,e,t+1);e(r,t)}function ki(r,e,t=!0){if(e>r.size)throw new Error(`index is out of range: ${e} > ${r.size}`);if(r.isText)return{node:r,offset:e};let n=0,s=0;for(const a of r.children){if(t&&a.isText&&a.size>=e-s)return ki(a,e-s,t);if(e===s)return{node:r,offset:n};if(!t&&a.paddedSize===e-s)return{node:r,offset:n+1};if(a.paddedSize>e-s)return ki(a,e-s-1,t);s+=a.paddedSize,n+=1}return{node:r,offset:n}}function Ja(r){return r.isText||r.children.length===0?r:Ja(r.children[0])}function xh(r,e){if(r.size<e)throw new Error("unacceptable path");for(let t=0;t<r.children.length;t++){const n=r.children[t];if(n.size<e)e-=n.size;else{r=n;break}}return{node:r,offset:e}}class Oh{constructor(e){u(this,"root"),this.root=e}tokensBetween(e,t,n){Fa(this.root,e,t,n)}traverse(e){Ua(this.root,e,0)}traverseAll(e){ks(this.root,e,0)}findTreePos(e,t=!0){return ki(this.root,e,t)}treePosToPath(e){const t=[];let n=e.node;if(n.isText){const s=n.parent.findOffset(n);if(s===-1)throw new Error("invalid treePos");const a=qr(n.parent,s);t.push(a+e.offset),n=n.parent}else if(n.hasTextChild()){const s=qr(n,e.offset);t.push(s)}else t.push(e.offset);for(;n.parent;){const s=n.parent.findOffset(n);if(s===-1)throw new Error("invalid treePos");t.push(s),n=n.parent}return t.reverse()}pathToIndex(e){const t=this.pathToTreePos(e);return this.indexOf(t)}pathToTreePos(e){if(!e.length)throw new Error("unacceptable path");let t=this.root;for(let n=0;n<e.length-1;n++){const s=e[n];if(t=t.children[s],!t)throw new Error("unacceptable path")}if(t.hasTextChild())return xh(t,e[e.length-1]);if(t.children.length<e[e.length-1])throw new Error("unacceptable path");return{node:t,offset:e[e.length-1]}}getRoot(){return this.root}get size(){return this.root.size}findPostorderRight(e){const{node:t,offset:n}=e;if(t.isText){if(t.size===n){const s=t.nextSibling;return s||t.parent}return t}return t.children.length===n?t:Ja(t.children[n])}indexOf(e){let{node:t}=e;const{offset:n}=e;let s=0,a=1;if(t.isText){s+=n;const c=t.parent,f=c.findOffset(t);if(f===-1)throw new Error("invalid pos");s+=qr(c,f),t=t.parent}else s+=qr(t,n);for(;t!=null&&t.parent;){const c=t.parent,f=c.findOffset(t);if(f===-1)throw new Error("invalid pos");s+=qr(c,f),a++,t=t.parent}return s+a-1}indexToPath(e){const t=this.findTreePos(e);return this.treePosToPath(t)}}const Ph=(r,e)=>r===e?0:r<e?-1:1;class Dh{constructor(e,t,n){u(this,"key"),u(this,"value"),u(this,"parent"),u(this,"left"),u(this,"right"),u(this,"isRed"),this.key=e,this.value=t,this.isRed=n}}class Rh{constructor(e){u(this,"stack"),this.stack=[],this.traverseInorder(e)}traverseInorder(e){!e||(this.traverseInorder(e.left),this.stack.push({key:e.key,value:e.value}),this.traverseInorder(e.right))}}class ja{constructor(e){u(this,"root"),u(this,"comparator"),u(this,"counter"),this.comparator=typeof e<"u"?e:Ph,this.counter=0}put(e,t){return this.root=this.putInternal(e,t,this.root),this.root.isRed=!1,t}get(e){const t=this.getInternal(e,this.root);return t?t.value:void 0}remove(e){!this.isRed(this.root.left)&&!this.isRed(this.root.right)&&(this.root.isRed=!0),this.root=this.removeInternal(this.root,e),this.root&&(this.root.isRed=!1)}getIterator(){return new Rh(this.root)}values(){const e=[];for(const t of this.getIterator().stack)e.push(t.value);return e}floorEntry(e){let t=this.root;for(;t;){const n=this.comparator(e,t.key);if(n>0)if(t.right)t.right.parent=t,t=t.right;else return t;else if(n<0)if(t.left)t.left.parent=t,t=t.left;else{let s=t.parent,a=t;for(;s&&a===s.left;)a=s,s=s.parent;return s}else return t}}lastEntry(){if(!this.root)return this.root;let e=this.root;for(;e.right;)e=e.right;return e}size(){return this.counter}isEmpty(){return this.counter===0}getInternal(e,t){for(;t;){const n=this.comparator(e,t.key);if(n===0)return t;n<0?t=t.left:n>0&&(t=t.right)}}putInternal(e,t,n){if(!n)return this.counter+=1,new Dh(e,t,!0);const s=this.comparator(e,n.key);return s<0?n.left=this.putInternal(e,t,n.left):s>0?n.right=this.putInternal(e,t,n.right):n.value=t,this.isRed(n.right)&&!this.isRed(n.left)&&(n=this.rotateLeft(n)),this.isRed(n.left)&&this.isRed(n.left.left)&&(n=this.rotateRight(n)),this.isRed(n.left)&&this.isRed(n.right)&&this.flipColors(n),n}removeInternal(e,t){if(this.comparator(t,e.key)<0)!this.isRed(e.left)&&!this.isRed(e.left.left)&&(e=this.moveRedLeft(e)),e.left=this.removeInternal(e.left,t);else{if(this.isRed(e.left)&&(e=this.rotateRight(e)),this.comparator(t,e.key)===0&&!e.right){this.counter-=1;return}if(!this.isRed(e.right)&&!this.isRed(e.right.left)&&(e=this.moveRedRight(e)),this.comparator(t,e.key)===0){this.counter-=1;const n=this.min(e.right);e.value=n.value,e.key=n.key,e.right=this.removeMin(e.right)}else e.right=this.removeInternal(e.right,t)}return this.fixUp(e)}min(e){return e.left?this.min(e.left):e}removeMin(e){if(!!e.left)return!this.isRed(e.left)&&!this.isRed(e.left.left)&&(e=this.moveRedLeft(e)),e.left=this.removeMin(e.left),this.fixUp(e)}fixUp(e){return this.isRed(e.right)&&(e=this.rotateLeft(e)),this.isRed(e.left)&&this.isRed(e.left.left)&&(e=this.rotateRight(e)),this.isRed(e.left)&&this.isRed(e.right)&&this.flipColors(e),e}moveRedLeft(e){return this.flipColors(e),this.isRed(e.right.left)&&(e.right=this.rotateRight(e.right),e=this.rotateLeft(e),this.flipColors(e)),e}moveRedRight(e){return this.flipColors(e),this.isRed(e.left.left)&&(e=this.rotateRight(e),this.flipColors(e)),e}isRed(e){return e&&e.isRed}rotateLeft(e){const t=e.right;return e.right=t.left,t.left=e,t.isRed=t.left.isRed,t.left.isRed=!0,t}rotateRight(e){const t=e.left;return e.left=t.right,t.right=e,t.isRed=t.right.isRed,t.right.isRed=!0,t}flipColors(e){e.isRed=!e.isRed,e.left.isRed=!e.left.isRed,e.right.isRed=!e.right.isRed}}class It{constructor(e,t){u(this,"parentID"),u(this,"leftSiblingID"),this.parentID=e,this.leftSiblingID=t}static of(e,t){return new It(e,t)}static fromTreePos(e){const{offset:t}=e;let{node:n}=e,s;return n.isText?(n.parent.children[0]===n&&t===0?s=n.parent:s=n,n=n.parent):t===0?s=n:s=n.children[t-1],It.of(n.id,Je.of(s.getCreatedAt(),s.getOffset()+t))}getParentID(){return this.parentID}static fromStruct(e){return It.of(Je.of(Ge.fromStruct(e.parentID.createdAt),e.parentID.offset),Je.of(Ge.fromStruct(e.leftSiblingID.createdAt),e.leftSiblingID.offset))}toStruct(){return{parentID:{createdAt:this.getParentID().getCreatedAt().toStruct(),offset:this.getParentID().getOffset()},leftSiblingID:{createdAt:this.getLeftSiblingID().getCreatedAt().toStruct(),offset:this.getLeftSiblingID().getOffset()}}}toTreeNodePair(e){const t=this.getParentID(),n=this.getLeftSiblingID(),s=e.findFloorNode(t);let a=e.findFloorNode(n);if(!s||!a)throw new Error(`cannot find node of CRDTTreePos(${t.toTestString()}, ${n.toTestString()})`);return!n.equals(t)&&n.getOffset()>0&&n.getOffset()===a.id.getOffset()&&a.insPrevID&&(a=e.findFloorNode(a.insPrevID)),[s,a]}getLeftSiblingID(){return this.leftSiblingID}equals(e){return this.getParentID().getCreatedAt().equals(e.getParentID().getCreatedAt())&&this.getParentID().getOffset()===e.getParentID().getOffset()&&this.getLeftSiblingID().getCreatedAt().equals(e.getLeftSiblingID().getCreatedAt())&&this.getLeftSiblingID().getOffset()===e.getLeftSiblingID().getOffset()}}class Je{constructor(e,t){u(this,"createdAt"),u(this,"offset"),this.createdAt=e,this.offset=t}static of(e,t){return new Je(e,t)}static fromStruct(e){return Je.of(Ge.fromStruct(e.createdAt),e.offset)}static createComparator(){return(e,t)=>{const n=e.getCreatedAt().compare(t.getCreatedAt());return n!==0?n:e.getOffset()>t.getOffset()?1:e.getOffset()<t.getOffset()?-1:0}}getCreatedAt(){return this.createdAt}equals(e){return this.createdAt.compare(e.createdAt)===0&&this.offset===e.offset}getOffset(){return this.offset}setOffset(e){this.offset=e}toStruct(){return{createdAt:this.createdAt.toStruct(),offset:this.offset}}toIDString(){return`${this.createdAt.toIDString()}:${this.offset}`}toTestString(){return`${this.createdAt.toTestString()}/${this.offset}`}}class lt extends Ch{constructor(e,t,n,s,a){super(t),u(this,"id"),u(this,"removedAt"),u(this,"attrs"),u(this,"insPrevID"),u(this,"insNextID"),u(this,"_value",""),this.id=e,this.removedAt=a,s&&(this.attrs=s),typeof n=="string"?this.value=n:Array.isArray(n)&&(this._children=n)}toIDString(){return this.id.toIDString()}getRemovedAt(){return this.removedAt}static create(e,t,n,s){return new lt(e,t,n,s)}deepcopy(){var e;const t=new lt(this.id,this.type);return t.removedAt=this.removedAt,t._value=this._value,t.size=this.size,t.attrs=(e=this.attrs)==null?void 0:e.deepcopy(),t._children=this._children.map(n=>{const s=n.deepcopy();return s.parent=t,s}),t.insPrevID=this.insPrevID,t.insNextID=this.insNextID,t}get value(){if(!this.isText)throw new Error(`cannot get value of element node: ${this.type}`);return this._value}set value(e){if(!this.isText)throw new Error(`cannot set value of element node: ${this.type}`);this._value=e,this.size=e.length}get isRemoved(){return!!this.removedAt}remove(e){const t=!this.removedAt;(!this.removedAt||this.removedAt.compare(e)>0)&&(this.removedAt=e),t&&this.updateAncestorsSize()}cloneText(e){return new lt(Je.of(this.id.getCreatedAt(),e),this.type,void 0,void 0,this.removedAt)}cloneElement(e){return new lt(Je.of(e(),0),this.type,void 0,void 0,this.removedAt)}split(e,t,n){const s=this.isText?this.splitText(t,this.id.getOffset()):this.splitElement(t,n);if(s){if(s.insPrevID=this.id,this.insNextID){const a=e.findFloorNode(this.insNextID);a.insPrevID=s.id,s.insNextID=this.insNextID}this.insNextID=s.id,e.registerNode(s)}return s}getCreatedAt(){return this.id.getCreatedAt()}getOffset(){return this.id.getOffset()}canDelete(e,t){return!this.getCreatedAt().after(t)&&(!this.removedAt||e.after(this.removedAt))}canStyle(e,t){return this.isText?!1:!this.getCreatedAt().after(t)&&(!this.removedAt||e.after(this.removedAt))}setAttrs(e,t){this.attrs||(this.attrs=new an);const n=new Array;for(const[s,a]of Object.entries(e))n.push(this.attrs.set(s,a,t));return n}purge(e){this.attrs&&this.attrs.purge(e)}getGCPairs(){const e=[];if(!this.attrs)return e;for(const t of this.attrs)t.getRemovedAt()&&e.push({parent:this,child:t});return e}}function Ei(r){var e;if(r.isText){const n=r;return{type:n.type,value:n.value}}const t={type:r.type,children:r.children.map(Ei)};return r.attrs&&(t.attributes=lr((e=r.attrs)==null?void 0:e.toObject())),t}function Ci(r){if(r.isText)return r.value;let e="";return r.attrs&&r.attrs.size()&&(e=" "+Array.from(r.attrs).filter(t=>!t.isRemoved()).sort((t,n)=>t.getKey().localeCompare(n.getKey())).map(t=>{const n=JSON.parse(t.getValue());return typeof n=="string"?`${t.getKey()}="${n}"`:`${t.getKey()}="${Vt(t.getValue())}"`}).join(" ")),`<${r.type}${e}>${r.children.map(t=>Ci(t)).join("")}</${r.type}>`}function qa(r){if(r.isText){const e=r;return{type:e.type,value:e.value,size:e.size,isRemoved:e.isRemoved}}return{type:r.type,children:r.children.map(qa),size:r.size,isRemoved:r.isRemoved}}class mt extends Mr{constructor(e,t){super(t),u(this,"indexTree"),u(this,"nodeMapByID"),this.indexTree=new Oh(e),this.nodeMapByID=new ja(Je.createComparator()),this.indexTree.traverseAll(n=>{this.nodeMapByID.put(n.id,n)})}static create(e,t){return new mt(e,t)}findFloorNode(e){const t=this.nodeMapByID.floorEntry(e);if(!(!t||!t.key.getCreatedAt().equals(e.getCreatedAt())))return t.value}registerNode(e){this.nodeMapByID.put(e.id,e)}findNodesAndSplitText(e,t){const[n,s]=e.toTreeNodePair(this);let a=s;const c=n===a,f=a.parent&&!c?a.parent:n;if(a.isText&&a.split(this,e.getLeftSiblingID().getOffset()-a.id.getOffset()),t){const g=f.allChildren,m=c?0:g.indexOf(a)+1;for(let b=m;b<g.length;b++){const x=g[b];if(!x.id.getCreatedAt().after(t))break;a=x}}return[f,a]}style(e,t,n,s){const[a,c]=this.findNodesAndSplitText(e[0],n),[f,g]=this.findNodesAndSplitText(e[1],n),m=[],b=t?lr(t):{},x=new Map,C=[];return this.traverseInPosRange(a,c,f,g,([S])=>{const F=S.getCreatedAt().getActorID(),G=s?s.has(F)?s.get(F):At:_r;if(S.canStyle(n,G)&&t){const H=x.get(F),se=S.getCreatedAt();(!H||se.after(H))&&x.set(F,se);const Se=S.setAttrs(t,n),ae=Se.reduce((Ie,[,Kn])=>(Kn&&(Ie[Kn.getKey()]=b[Kn.getKey()]),Ie),{}),me=S.parent,ye=S.prevSibling||S.parent;Object.keys(ae).length>0&&m.push({type:"style",from:this.toIndex(me,ye),to:this.toIndex(S,S),fromPath:this.toPath(me,ye),toPath:this.toPath(S,S),actor:n.getActorID(),value:ae});for(const[Ie]of Se)Ie&&C.push({parent:S,child:Ie})}}),[x,C,m]}removeStyle(e,t,n,s){const[a,c]=this.findNodesAndSplitText(e[0],n),[f,g]=this.findNodesAndSplitText(e[1],n),m=[],b=new Map,x=[];return this.traverseInPosRange(a,c,f,g,([C])=>{const S=C.getCreatedAt().getActorID(),F=s?s.has(S)?s.get(S):At:_r;if(C.canStyle(n,F)&&t){const G=b.get(S),H=C.getCreatedAt();(!G||H.after(G))&&b.set(S,H),C.attrs||(C.attrs=new an);for(const ae of t){const me=C.attrs.remove(ae,n);for(const ye of me)x.push({parent:C,child:ye})}const se=C.parent,Se=C.prevSibling||C.parent;m.push({actor:n.getActorID(),type:"removeStyle",from:this.toIndex(se,Se),to:this.toIndex(C,C),fromPath:this.toPath(se,Se),toPath:this.toPath(C,C),value:t})}}),[b,x,m]}edit(e,t,n,s,a,c){const[f,g]=this.findNodesAndSplitText(e[0],s),[m,b]=this.findNodesAndSplitText(e[1],s),x=this.toIndex(f,g),C=this.toPath(f,g),S=[],F=[],G=[],H=new Map;this.traverseInPosRange(f,g,m,b,([ae,me],ye)=>{if(me===De.Start&&!ye)for(const Vn of ae.children)G.push(Vn);const Ie=ae.getCreatedAt().getActorID(),Kn=c?c.has(Ie)?c.get(Ie):At:_r;if(ae.canDelete(s,Kn)||S.includes(ae.parent)){const Vn=H.get(Ie),Qr=ae.getCreatedAt();(!Vn||Qr.after(Vn))&&H.set(Ie,Qr),(me===De.Text||me===De.Start)&&S.push(ae),F.push([ae,me])}});const se=this.makeDeletionChanges(F,s),Se=[];for(const ae of S)ae.remove(s),ae.isRemoved&&Se.push({parent:this,child:ae});for(const ae of G)ae.removedAt||f.append(ae);if(n>0){let ae=0,me=f,ye=g;for(;ae<n;)me.split(this,me.findOffset(ye)+1,a),ye=me,me=me.parent,ae++;se.push({type:"content",from:x,to:x,fromPath:C,toPath:C,actor:s.getActorID()})}if(t!=null&&t.length){const ae=[];let me=g;for(const ye of t)me===f?f.insertAt(ye,0):f.insertAfter(ye,me),me=ye,ks(ye,Ie=>{f.isRemoved&&(Ie.remove(s),Se.push({parent:this,child:Ie})),this.nodeMapByID.put(Ie.id,Ie)}),ye.isRemoved||ae.push(ye);if(ae.length){const ye=ae.map(Ie=>Ei(Ie));se.length&&se[se.length-1].from===x?se[se.length-1].value=ye:se.push({type:"content",from:x,to:x,fromPath:C,toPath:C,actor:s.getActorID(),value:ye})}}return[se,Se,H]}editT(e,t,n,s,a){const c=this.findPos(e[0]),f=this.findPos(e[1]);this.edit([c,f],t,n,s,a)}move(e,t,n){throw new Error(`not implemented: ${e}, ${t}, ${n}`)}purge(e){var t;(t=e.parent)==null||t.removeChild(e),this.nodeMapByID.remove(e.id);const n=e.insPrevID,s=e.insNextID;if(n){const a=this.findFloorNode(n);a.insNextID=s}if(s){const a=this.findFloorNode(s);a.insPrevID=n}e.insPrevID=void 0,e.insNextID=void 0}getGCPairs(){const e=[];return this.indexTree.traverse(t=>{t.getRemovedAt()&&e.push({parent:this,child:t});for(const n of t.getGCPairs())e.push(n)}),e}findPos(e,t=!0){const n=this.indexTree.findTreePos(e,t);return It.fromTreePos(n)}pathToPosRange(e){const t=this.pathToIndex(e);return[this.findPos(t),this.findPos(t+1)]}pathToPos(e){const t=this.indexTree.pathToIndex(e);return this.findPos(t)}getRoot(){return this.indexTree.getRoot()}getSize(){return this.indexTree.size}getNodeSize(){return this.nodeMapByID.size()}getIndexTree(){return this.indexTree}toXML(){return Ci(this.indexTree.getRoot())}toJSON(){return JSON.stringify(this.getRootTreeNode())}toJSForTest(){return{createdAt:this.getCreatedAt().toTestString(),value:JSON.parse(this.toJSON()),type:"YORKIE_TREE"}}toJSInfoForTest(){const e=this.indexTree.getRoot(),t=(n,s=void 0,a=void 0,c=0)=>{var f,g,m,b;let x,C,S;const F=n.isText?{node:n,offset:0}:s&&a?this.toTreePos(s,a):null;F&&(x=this.indexTree.indexOf(F),C=this.indexTree.treePosToPath(F),S=It.fromTreePos(F).toStruct());const G={type:n.type,parent:s==null?void 0:s.id.toTestString(),size:n.size,id:n.id.toTestString(),removedAt:(f=n.removedAt)==null?void 0:f.toTestString(),insPrev:(g=n.insPrevID)==null?void 0:g.toTestString(),insNext:(m=n.insNextID)==null?void 0:m.toTestString(),value:n.isText?n.value:void 0,isRemoved:n.isRemoved,children:[],depth:c,attributes:n.attrs?lr((b=n.attrs)==null?void 0:b.toObject()):void 0,index:x,path:C,pos:S};for(let H=0;H<n.allChildren.length;H++){const se=H===0?n:n.allChildren[H-1];G.children.push(t(n.allChildren[H],n,se,c+1))}return G};return t(e)}getRootTreeNode(){return Ei(this.indexTree.getRoot())}toTestTreeNode(){return qa(this.indexTree.getRoot())}toSortedJSON(){return this.toJSON()}deepcopy(){const e=this.getRoot();return new mt(e.deepcopy(),this.getCreatedAt())}toPath(e,t){const n=this.toTreePos(e,t);return n?this.indexTree.treePosToPath(n):[]}toIndex(e,t){const n=this.toTreePos(e,t);return n?this.indexTree.indexOf(n):-1}indexToPath(e){return this.indexTree.indexToPath(e)}pathToIndex(e){return this.indexTree.pathToIndex(e)}indexRangeToPosRange(e){const t=this.findPos(e[0]);return e[0]===e[1]?[t,t]:[t,this.findPos(e[1])]}indexRangeToPosStructRange(e){const[t,n]=e,s=this.findPos(t);return t===n?[s.toStruct(),s.toStruct()]:[s.toStruct(),this.findPos(n).toStruct()]}posRangeToPathRange(e){const[t,n]=this.findNodesAndSplitText(e[0]),[s,a]=this.findNodesAndSplitText(e[1]);return[this.toPath(t,n),this.toPath(s,a)]}posRangeToIndexRange(e){const[t,n]=this.findNodesAndSplitText(e[0]),[s,a]=this.findNodesAndSplitText(e[1]);return[this.toIndex(t,n),this.toIndex(s,a)]}traverseInPosRange(e,t,n,s,a){const c=this.toIndex(e,t),f=this.toIndex(n,s);return this.indexTree.tokensBetween(c,f,a)}toTreePos(e,t){if(!e||!t)return;if(e.isRemoved){let s;for(;e.isRemoved;)s=e,e=s.parent;const a=e.findOffset(s);return{node:e,offset:a}}if(e===t)return{node:e,offset:0};let n=e.findOffset(t);if(!t.isRemoved){if(t.isText)return{node:t,offset:t.paddedSize};n++}return{node:e,offset:n}}makeDeletionChanges(e,t){const n=[],s=[];let a=null,c=null;for(let f=0;f<e.length;f++){const g=e[f],m=e[f+1];a||(a=g),c=g;const b=this.findRightToken(g);(!b||!m||b[0]!==m[0]||b[1]!==m[1])&&(s.push([a,c]),a=null,c=null)}for(const f of s){const[g,m]=f,[b,x]=this.findLeftToken(g),[C,S]=m,F=x===De.Start?b:b.parent,G=S===De.Start?C:C.parent,H=this.toIndex(F,b),se=this.toIndex(G,C);H<se&&(n.length>0&&H===n[n.length-1].to?(n[n.length-1].to=se,n[n.length-1].toPath=this.toPath(G,C)):n.push({type:"content",from:H,to:se,fromPath:this.toPath(F,b),toPath:this.toPath(G,C),actor:t.getActorID()}))}return n.reverse()}findRightToken([e,t]){if(t===De.Start){const f=e.allChildren;return f.length>0?[f[0],f[0].isText?De.Text:De.Start]:[e,De.End]}const n=e.parent,s=n.allChildren,a=s.indexOf(e);if(n&&a===s.length-1)return[n,De.End];const c=s[a+1];return[c,c.isText?De.Text:De.Start]}findLeftToken([e,t]){if(t===De.End){const f=e.allChildren;if(f.length>0){const g=f[f.length-1];return[g,g.isText?De.Text:De.End]}return[e,De.Start]}const n=e.parent,s=n.allChildren,a=s.indexOf(e);if(n&&a===0)return[n,De.Start];const c=s[a-1];return[c,c.isText?De.Text:De.End]}}class Kr extends St{constructor(e,t,n,s,a,c,f){super(e,f),u(this,"fromPos"),u(this,"toPos"),u(this,"contents"),u(this,"splitLevel"),u(this,"maxCreatedAtMapByActor"),this.fromPos=t,this.toPos=n,this.contents=s,this.splitLevel=a,this.maxCreatedAtMapByActor=c}static create(e,t,n,s,a,c,f){return new Kr(e,t,n,s,a,c,f)}execute(e){var t;const n=e.findByCreatedAt(this.getParentCreatedAt());n||R.fatal(`fail to find ${this.getParentCreatedAt()}`),n instanceof mt||R.fatal("fail to execute, only Tree can execute edit");const s=this.getExecutedAt(),a=n,[c,f]=a.edit([this.fromPos,this.toPos],(t=this.contents)==null?void 0:t.map(g=>g.deepcopy()),this.splitLevel,s,(()=>{let g=s.getDelimiter();return this.contents!==void 0&&(g+=this.contents.length),()=>Ge.of(s.getLamport(),++g,s.getActorID())})(),this.maxCreatedAtMapByActor);for(const g of f)e.registerGCPair(g);return{opInfos:c.map(({from:g,to:m,value:b,splitLevel:x,fromPath:C,toPath:S})=>({type:"tree-edit",path:e.createPath(this.getParentCreatedAt()),from:g,to:m,value:b,splitLevel:x,fromPath:C,toPath:S}))}}getEffectedCreatedAt(){return this.getParentCreatedAt()}toTestString(){const e=this.getParentCreatedAt().toTestString(),t=`${this.fromPos.getLeftSiblingID().getCreatedAt().toTestString()}/${this.fromPos.getLeftSiblingID().getOffset()}`,n=`${this.toPos.getLeftSiblingID().getCreatedAt().toTestString()}/${this.toPos.getLeftSiblingID().getOffset()}`,s=this.contents||[];return`${e}.EDIT(${t},${n},${s.map(a=>Ci(a)).join("")})`}getFromPos(){return this.fromPos}getToPos(){return this.toPos}getContents(){return this.contents}getSplitLevel(){return this.splitLevel}getMaxCreatedAtMapByActor(){return this.maxCreatedAtMapByActor}}class In{constructor(e,t,n,s){u(this,"clientSeq"),u(this,"serverSeq"),u(this,"lamport"),u(this,"actor"),this.clientSeq=e,this.serverSeq=s,this.lamport=t,this.actor=n}static of(e,t,n,s){return new In(e,t,n,s)}next(){return new In(this.clientSeq+1,this.lamport.add(1),this.actor)}syncLamport(e){return e.greaterThan(this.lamport)?new In(this.clientSeq,e,this.actor):new In(this.clientSeq,this.lamport.add(1),this.actor)}createTimeTicket(e){return Ge.of(this.lamport,e,this.actor)}setActor(e){return new In(this.clientSeq,this.lamport,e,this.serverSeq)}getClientSeq(){return this.clientSeq}getServerSeq(){return this.serverSeq?this.serverSeq.toString():""}getLamport(){return this.lamport}getLamportAsString(){return this.lamport.toString()}getActorID(){return this.actor}toTestString(){return`${this.lamport.toString()}:${this.actor.slice(-2)}:${this.clientSeq}`}}const _h=new In(0,X.fromInt(0,!0),Ss);class jn{constructor({id:e,operations:t,presenceChange:n,message:s}){u(this,"id"),u(this,"operations"),u(this,"presenceChange"),u(this,"message"),this.id=e,this.operations=t||[],this.presenceChange=n,this.message=s}static create({id:e,operations:t,presenceChange:n,message:s}){return new jn({id:e,operations:t,presenceChange:n,message:s})}getID(){return this.id}getMessage(){return this.message}hasOperations(){return this.operations.length>0}getOperations(){return this.operations}setActor(e){for(const t of this.operations)t.setActor(e);this.id=this.id.setActor(e)}hasPresenceChange(){return this.presenceChange!==void 0}getPresenceChange(){return this.presenceChange}execute(e,t,n){const s=[],a=[];for(const c of this.operations){const f=c.execute(e,n);if(!f)continue;const{opInfos:g,reverseOp:m}=f;s.push(...g),m&&a.unshift(m)}return this.presenceChange&&(this.presenceChange.type===bn.Put?t.set(this.id.getActorID(),wt(this.presenceChange.presence)):t.delete(this.id.getActorID())),{opInfos:s,reverseOps:a}}toTestString(){return`${this.operations.map(e=>e.toTestString()).join(",")}`}toStruct(){return{changeID:Re.bytesToHex(Re.toChangeID(this.getID()).toBinary()),message:this.getMessage(),operations:this.getOperations().map(e=>Re.bytesToHex(Re.toOperation(e).toBinary())),presenceChange:this.getPresenceChange()}}static fromStruct(e){const{changeID:t,operations:n,presenceChange:s,message:a}=e;return jn.create({id:Re.bytesToChangeID(Re.hexToBytes(t)),operations:n==null?void 0:n.map(c=>Re.bytesToOperation(Re.hexToBytes(c))),presenceChange:s,message:a})}}class Es{constructor(e,t,n,s,a,c){u(this,"documentKey"),u(this,"checkpoint"),u(this,"isRemoved"),u(this,"changes"),u(this,"snapshot"),u(this,"minSyncedTicket"),this.documentKey=e,this.checkpoint=t,this.isRemoved=n,this.changes=s,this.snapshot=a,this.minSyncedTicket=c}static create(e,t,n,s,a,c){return new Es(e,t,n,s,a,c)}getDocumentKey(){return this.documentKey}getCheckpoint(){return this.checkpoint}getIsRemoved(){return this.isRemoved}getChanges(){return this.changes}hasChanges(){return this.changes.length>0}getChangeSize(){return this.changes.length}hasSnapshot(){return!!this.snapshot&&!!this.snapshot.length}getSnapshot(){return this.snapshot}getMinSyncedTicket(){return this.minSyncedTicket}}class ur{constructor(e,t){u(this,"serverSeq"),u(this,"clientSeq"),this.serverSeq=e,this.clientSeq=t}static of(e,t){return new ur(e,t)}increaseClientSeq(e){return e===0?this:new ur(this.serverSeq,this.clientSeq+e)}forward(e){if(this.equals(e))return this;const t=this.serverSeq.greaterThan(e.serverSeq)?this.serverSeq:e.serverSeq,n=Math.max(this.clientSeq,e.clientSeq);return ur.of(t,n)}getServerSeqAsString(){return this.serverSeq.toString()}getClientSeq(){return this.clientSeq}getServerSeq(){return this.serverSeq}equals(e){return this.clientSeq===e.clientSeq&&this.serverSeq.equals(e.serverSeq)}toTestString(){return`serverSeq=${this.serverSeq}, clientSeq=${this.clientSeq}`}}const Mh=new ur(X.fromInt(0,!0),0);class zt{constructor(e,t){u(this,"createdAt"),u(this,"offset"),this.createdAt=e,this.offset=t}static of(e,t){return new zt(e,t)}static fromStruct(e){return zt.of(Ge.fromStruct(e.createdAt),e.offset)}getCreatedAt(){return this.createdAt}getOffset(){return this.offset}equals(e){return this.createdAt.compare(e.createdAt)===0&&this.offset===e.offset}hasSameCreatedAt(e){return this.createdAt.compare(e.createdAt)===0}split(e){return new zt(this.createdAt,this.offset+e)}toStruct(){return{createdAt:this.createdAt.toStruct(),offset:this.offset}}toTestString(){return`${this.createdAt.toTestString()}:${this.offset}`}toIDString(){return`${this.createdAt.toIDString()}:${this.offset}`}}const Bh=zt.of(At,0);class kt{constructor(e,t){u(this,"id"),u(this,"relativeOffset"),this.id=e,this.relativeOffset=t}static of(e,t){return new kt(e,t)}static fromStruct(e){const t=zt.fromStruct(e.id);return kt.of(t,e.relativeOffset)}getID(){return this.id}getRelativeOffset(){return this.relativeOffset}getAbsoluteID(){return zt.of(this.id.getCreatedAt(),this.id.getOffset()+this.relativeOffset)}toTestString(){return`${this.id.toTestString()}:${this.relativeOffset}`}toStruct(){return{id:this.id.toStruct(),relativeOffset:this.relativeOffset}}equals(e){return this.id.equals(e.id)?this.relativeOffset===e.relativeOffset:!1}}class kn extends $a{constructor(e,t,n){super(t),u(this,"id"),u(this,"removedAt"),u(this,"prev"),u(this,"next"),u(this,"insPrev"),u(this,"insNext"),this.id=e,this.removedAt=n}static create(e,t){return new kn(e,t)}static createComparator(){return(e,t)=>{const n=e.getCreatedAt().compare(t.getCreatedAt());return n!==0?n:e.getOffset()>t.getOffset()?1:e.getOffset()<t.getOffset()?-1:0}}getID(){return this.id}getCreatedAt(){return this.id.getCreatedAt()}getLength(){return this.removedAt?0:this.getContentLength()}getContentLength(){return this.value&&this.value.length||0}getPrev(){return this.prev}getNext(){return this.next}getInsPrev(){return this.insPrev}getInsNext(){return this.insNext}getInsPrevID(){return this.insPrev.getID()}setPrev(e){this.prev=e,e&&(e.next=this)}setNext(e){this.next=e,e&&(e.prev=this)}setInsPrev(e){this.insPrev=e,e&&(e.insNext=this)}setInsNext(e){this.insNext=e,e&&(e.insPrev=this)}hasNext(){return!!this.next}hasInsPrev(){return!!this.insPrev}isRemoved(){return!!this.removedAt}getRemovedAt(){return this.removedAt}split(e){return new kn(this.id.split(e),this.splitValue(e),this.removedAt)}canDelete(e,t){const n=!this.removedAt;return!this.getCreatedAt().after(t)&&(!this.removedAt||e.after(this.removedAt))?n:!1}canStyle(e,t){return!this.getCreatedAt().after(t)&&(!this.removedAt||e.after(this.removedAt))}remove(e){this.removedAt=e}createPosRange(){return[kt.of(this.id,0),kt.of(this.id,this.getLength())]}deepcopy(){return new kn(this.id,this.value,this.removedAt)}toTestString(){return`${this.id.toTestString()} ${this.value?this.value:""}`}splitValue(e){const t=this.value;return this.value=t.substring(0,e),t.substring(e,t.length)}toIDString(){return this.id.toIDString()}}class hr{constructor(){u(this,"head"),u(this,"treeByIndex"),u(this,"treeByID"),this.head=kn.create(Bh),this.treeByIndex=new Lr,this.treeByID=new ja(kn.createComparator()),this.treeByIndex.insert(this.head),this.treeByID.put(this.head.getID(),this.head)}static create(){return new hr}edit(e,t,n,s){const[a,c]=this.findNodeWithSplit(e[1],t),[f,g]=this.findNodeWithSplit(e[0],t),m=this.findBetween(g,c),[b,x,C]=this.deleteNodes(m,t,s),S=c?c.getID():a.getID();let F=kt.of(S,0);if(n){const H=this.posToIndex(f.createPosRange()[1],!0),se=this.insertAfter(f,kn.create(zt.of(t,0),n));b.length&&b[b.length-1].from===H?b[b.length-1].value=n:b.push({actor:t.getActorID(),from:H,to:H,value:n}),F=kt.of(se.getID(),se.getContentLength())}const G=[];for(const[,H]of C)G.push({parent:this,child:H});return[F,x,G,b]}indexToPos(e){const[t,n]=this.treeByIndex.find(e),s=t;return kt.of(s.getID(),n)}findIndexesFromRange(e){const[t,n]=e;return[this.posToIndex(t,!1),this.posToIndex(n,!0)]}posToIndex(e,t){const n=e.getAbsoluteID(),s=t?this.findFloorNodePreferToLeft(n):this.findFloorNode(n);s||R.fatal(`the node of the given id should be found: ${n.toTestString()}`);const a=this.treeByIndex.indexOf(s),c=s.isRemoved()?0:n.getOffset()-s.getID().getOffset();return a+c}findNode(e){return this.findFloorNode(e)}get length(){return this.treeByIndex.length}getTreeByIndex(){return this.treeByIndex}getTreeByID(){return this.treeByID}toString(){const e=[];for(const t of this)t.isRemoved()||e.push(t.getValue());return e.join("")}*[Symbol.iterator](){let e=this.head.getNext();for(;e;)yield e,e=e.getNext()}getHead(){return this.head}deepcopy(){const e=new hr;let t=this.head.getNext(),n=e.head,s;for(;t;){if(s=e.insertAfter(n,t.deepcopy()),t.hasInsPrev()){const a=e.findNode(t.getInsPrevID());s.setInsPrev(a)}n=s,t=t.getNext()}return e}toTestString(){const e=[];let t=this.head;for(;t;)t.isRemoved()?e.push(`{${t.toTestString()}}`):e.push(`[${t.toTestString()}]`),t=t.getNext();return e.join("")}insertAfter(e,t){const n=e.getNext();return t.setPrev(e),n&&n.setPrev(t),this.treeByID.put(t.getID(),t),this.treeByIndex.insertAfter(e,t),t}findNodeWithSplit(e,t){const n=e.getAbsoluteID();let s=this.findFloorNodePreferToLeft(n);const a=n.getOffset()-s.getID().getOffset();for(this.splitNode(s,a);s.hasNext()&&s.getNext().getCreatedAt().after(t);)s=s.getNext();return[s,s.getNext()]}findFloorNodePreferToLeft(e){let t=this.findFloorNode(e);if(t||R.fatal(`the node of the given id should be found: ${e.toTestString()}`),e.getOffset()>0&&t.getID().getOffset()==e.getOffset()){if(!t.hasInsPrev())return t;t=t.getInsPrev()}return t}findFloorNode(e){const t=this.treeByID.floorEntry(e);if(!!t&&!(!t.key.equals(e)&&!t.key.hasSameCreatedAt(e)))return t.value}findBetween(e,t){const n=[];let s=e;for(;s&&s!==t;)n.push(s),s=s.getNext();return n}splitNode(e,t){if(t>e.getContentLength()&&R.fatal("offset should be less than or equal to length"),t===0)return e;if(t===e.getContentLength())return e.getNext();const n=e.split(t);this.treeByIndex.updateWeight(n),this.insertAfter(e,n);const s=e.getInsNext();return s&&s.setInsPrev(n),n.setInsPrev(e),n}deleteNodes(e,t,n){if(!e.length)return[[],new Map,new Map];const[s,a]=this.filterNodes(e,t,n),c=new Map,f=new Map,g=this.makeChanges(a,t);for(const m of s){const b=m.getCreatedAt().getActorID();(!c.has(b)||m.getID().getCreatedAt().after(c.get(b)))&&c.set(b,m.getID().getCreatedAt()),f.set(m.getID().toIDString(),m),m.remove(t)}return this.deleteIndexNodes(a),[g,c,f]}filterNodes(e,t,n){const s=!!n,a=[],c=[],[f,g]=this.findEdgesOfCandidates(e);c.push(f);for(const m of e){const b=m.getCreatedAt().getActorID(),x=s?n.has(b)?n.get(b):At:_r;m.canDelete(t,x)?a.push(m):c.push(m)}return c.push(g),[a,c]}findEdgesOfCandidates(e){return[e[0].getPrev(),e[e.length-1].getNext()]}makeChanges(e,t){const n=[];let s,a;for(let c=0;c<e.length-1;c++){const f=e[c],g=e[c+1];f.getNext()!=g&&([s]=this.findIndexesFromRange(f.getNext().createPosRange()),g?[,a]=this.findIndexesFromRange(g.getPrev().createPosRange()):a=this.treeByIndex.length,s<a&&n.push({actor:t.getActorID(),from:s,to:a}))}return n.reverse()}deleteIndexNodes(e){for(let t=0;t<e.length-1;t++){const n=e[t],s=e[t+1];n.getNext()!=s&&this.treeByIndex.deleteRange(n,s)}}purge(e){this.treeByIndex.delete(e),this.treeByID.remove(e.getID());const t=e.getPrev(),n=e.getNext(),s=e.getInsPrev(),a=e.getInsNext();t&&t.setNext(n),n&&n.setPrev(t),e.setPrev(void 0),e.setNext(void 0),s&&s.setInsNext(a),a&&a.setInsPrev(s),e.setInsPrev(void 0),e.setInsNext(void 0)}}const Ka=r=>r<0?Math.ceil(r):Math.floor(r);var Wt=(r=>(r[r.IntegerCnt=0]="IntegerCnt",r[r.LongCnt=1]="LongCnt",r))(Wt||{});class ut extends Mr{constructor(e,t,n){switch(super(n),u(this,"valueType"),u(this,"value"),this.valueType=e,e){case 0:typeof t=="number"?t>Math.pow(2,31)-1||t<-Math.pow(2,31)?this.value=X.fromNumber(t).toInt():this.value=Ka(t):this.value=t.toInt();break;case 1:typeof t=="number"?this.value=X.fromNumber(t):this.value=t;break;default:throw new ue(oe.ErrUnimplemented,`unimplemented type: ${e}`)}}static create(e,t,n){return new ut(e,t,n)}static valueFromBytes(e,t){switch(e){case 0:return t[0]|t[1]<<8|t[2]<<16|t[3]<<24;case 1:return X.fromBytesLE(Array.from(t));default:throw new ue(oe.ErrUnimplemented,`unimplemented type: ${e}`)}}toJSON(){return`${this.value}`}toSortedJSON(){return this.toJSON()}toJSForTest(){return{createdAt:this.getCreatedAt().toTestString(),value:this.value,type:"YORKIE_COUNTER"}}deepcopy(){const e=ut.create(this.valueType,this.value,this.getCreatedAt());return e.setMovedAt(this.getMovedAt()),e}getType(){return this.valueType}static getCounterType(e){switch(typeof e){case"object":return e instanceof X?1:void 0;case"number":return e>Math.pow(2,31)-1||e<-Math.pow(2,31)?1:0;default:return}}static isSupport(e){return!!ut.getCounterType(e)}static isInteger(e){return e%1===0}isNumericType(){const e=this.valueType;return e===0||e===1}getValueType(){return this.valueType}getValue(){return this.value}toBytes(){switch(this.valueType){case 0:{const e=this.value;return new Uint8Array([e&255,e>>8&255,e>>16&255,e>>24&255])}case 1:{const t=this.value.toBytesLE();return Uint8Array.from(t)}default:throw new ue(oe.ErrUnimplemented,`unimplemented type: ${this.valueType}`)}}increase(e){function t(n){if(!n.isNumericType())throw new TypeError(`Unsupported type of value: ${typeof n.getValue()}`)}return t(this),t(e),this.valueType===1?this.value=this.value.add(e.getValue()):e.getType()===Le.Long?this.value=this.value+e.getValue().toInt():this.value=X.fromNumber(this.value+Ka(e.getValue())).toInt(),this}}class fr extends St{constructor(e,t,n){super(e,n),u(this,"value"),this.value=t}static create(e,t,n){return new fr(e,t,n)}execute(e){const t=e.findByCreatedAt(this.getParentCreatedAt());t||R.fatal(`fail to find ${this.getParentCreatedAt()}`),t instanceof ut||R.fatal("fail to execute, only Counter can execute increase");const n=t,s=this.value.deepcopy();return n.increase(s),{opInfos:[{type:"increase",path:e.createPath(this.getParentCreatedAt()),value:s.getValue()}],reverseOp:this.toReverseOperation()}}toReverseOperation(){const e=this.value.deepcopy(),n=e.getType()===Le.Long?e.getValue().multiply(-1):e.getValue()*-1;return fr.create(this.getParentCreatedAt(),Ae.of(n,e.getCreatedAt()))}getEffectedCreatedAt(){return this.getParentCreatedAt()}toTestString(){return`${this.getParentCreatedAt().toTestString()}.INCREASE.${this.value.toJSON()}`}getValue(){return this.value}}class ln extends St{constructor(e,t,n,s,a,c,f){super(e,f),u(this,"fromPos"),u(this,"toPos"),u(this,"maxCreatedAtMapByActor"),u(this,"attributes"),u(this,"attributesToRemove"),this.fromPos=t,this.toPos=n,this.maxCreatedAtMapByActor=s,this.attributes=a,this.attributesToRemove=c}static create(e,t,n,s,a,c){return new ln(e,t,n,s,a,new Array,c)}static createTreeRemoveStyleOperation(e,t,n,s,a,c){return new ln(e,t,n,s,new Map,a,c)}execute(e){const t=e.findByCreatedAt(this.getParentCreatedAt());t||R.fatal(`fail to find ${this.getParentCreatedAt()}`),t instanceof mt||R.fatal("fail to execute, only Tree can execute edit");const n=t;let s,a;if(this.attributes.size){const c={};[...this.attributes].forEach(([f,g])=>c[f]=g),[,a,s]=n.style([this.fromPos,this.toPos],c,this.getExecutedAt(),this.maxCreatedAtMapByActor)}else{const c=this.attributesToRemove;[,a,s]=n.removeStyle([this.fromPos,this.toPos],c,this.getExecutedAt(),this.maxCreatedAtMapByActor)}for(const c of a)e.registerGCPair(c);return{opInfos:s.map(({from:c,to:f,value:g,fromPath:m,toPath:b})=>({type:"tree-style",from:c,to:f,value:this.attributes.size?{attributes:g}:{attributesToRemove:g},fromPath:m,toPath:b,path:e.createPath(this.getParentCreatedAt())}))}}getEffectedCreatedAt(){return this.getParentCreatedAt()}toTestString(){const e=this.getParentCreatedAt().toTestString(),t=`${this.fromPos.getLeftSiblingID().getCreatedAt().toTestString()}:${this.fromPos.getLeftSiblingID().getOffset()}`,n=`${this.toPos.getLeftSiblingID().getCreatedAt().toTestString()}:${this.toPos.getLeftSiblingID().getOffset()}`;return`${e}.STYLE(${t},${n},${Object.entries(this.attributes||{}).map(([s,a])=>`${s}:"${a}"`).join(" ")})`}getFromPos(){return this.fromPos}getToPos(){return this.toPos}getAttributes(){return this.attributes}getAttributesToRemove(){return this.attributesToRemove}getMaxCreatedAtMapByActor(){return this.maxCreatedAtMapByActor}}function Lh(r){const e=new vi,t=e.data;for(const[n,s]of Object.entries(r))t[n]=JSON.stringify(s);return e}function $h(r){if(r.type===bn.Put)return new yi({type:Rr.PUT,presence:Lh(r.presence)});if(r.type===bn.Clear)return new yi({type:Rr.CLEAR});throw new ue(oe.ErrUnimplemented,"unimplemented type")}function Fh(r){return new Ea({serverSeq:r.getServerSeqAsString(),clientSeq:r.getClientSeq()})}function Va(r){return new bs({clientSeq:r.getClientSeq(),lamport:r.getLamportAsString(),actorId:_i(r.getActorID())})}function q(r){if(!!r)return new K({lamport:r.getLamportAsString(),delimiter:r.getDelimiter(),actorId:_i(r.getActorID())})}function za(r){switch(r){case Le.Null:return te.NULL;case Le.Boolean:return te.BOOLEAN;case Le.Integer:return te.INTEGER;case Le.Long:return te.LONG;case Le.Double:return te.DOUBLE;case Le.String:return te.STRING;case Le.Bytes:return te.BYTES;case Le.Date:return te.DATE;default:throw new ue(oe.Unsupported,`unsupported type: ${r}`)}}function Wa(r){switch(r){case Wt.IntegerCnt:return te.INTEGER_CNT;case Wt.LongCnt:return te.LONG_CNT;default:throw new ue(oe.Unsupported,`unsupported type: ${r}`)}}function Ni(r){if(r instanceof tt)return new sn({type:te.JSON_OBJECT,createdAt:q(r.getCreatedAt()),value:lc(r)});if(r instanceof ct)return new sn({type:te.JSON_ARRAY,createdAt:q(r.getCreatedAt()),value:pf(r)});if(r instanceof pt)return new sn({type:te.TEXT,createdAt:q(r.getCreatedAt())});if(r instanceof Ae)return new sn({type:za(r.getType()),createdAt:q(r.getCreatedAt()),value:r.toBytes()});if(r instanceof ut)return new sn({type:Wa(r.getType()),createdAt:q(r.getCreatedAt()),value:r.toBytes()});if(r instanceof mt)return new sn({type:te.TREE,createdAt:q(r.getCreatedAt()),value:yf(r)});throw new ue(oe.ErrUnimplemented,"unimplemented element")}function Uh(r){return new pi({createdAt:q(r.getCreatedAt()),offset:r.getOffset()})}function Cs(r){return new Ln({createdAt:q(r.getID().getCreatedAt()),offset:r.getID().getOffset(),relativeOffset:r.getRelativeOffset()})}function Ns(r){return new Dr({parentId:Vr(r.getParentID()),leftSiblingId:Vr(r.getLeftSiblingID())})}function Vr(r){return new ir({createdAt:q(r.getCreatedAt()),offset:r.getOffset()})}function Ha(r){const e=new di;if(r instanceof Un){const t=r,n=new ca;n.parentCreatedAt=q(t.getParentCreatedAt()),n.key=t.getKey(),n.value=Ni(t.getValue()),n.executedAt=q(t.getExecutedAt()),e.body.case="set",e.body.value=n}else if(r instanceof Fr){const t=r,n=new la;n.parentCreatedAt=q(t.getParentCreatedAt()),n.prevCreatedAt=q(t.getPrevCreatedAt()),n.value=Ni(t.getValue()),n.executedAt=q(t.getExecutedAt()),e.body.case="add",e.body.value=n}else if(r instanceof Sn){const t=r,n=new ua;n.parentCreatedAt=q(t.getParentCreatedAt()),n.prevCreatedAt=q(t.getPrevCreatedAt()),n.createdAt=q(t.getCreatedAt()),n.executedAt=q(t.getExecutedAt()),e.body.case="move",e.body.value=n}else if(r instanceof An){const t=r,n=new ha;n.parentCreatedAt=q(t.getParentCreatedAt()),n.createdAt=q(t.getCreatedAt()),n.executedAt=q(t.getExecutedAt()),e.body.case="remove",e.body.value=n}else if(r instanceof Jr){const t=r,n=new fa;n.parentCreatedAt=q(t.getParentCreatedAt()),n.from=Cs(t.getFromPos()),n.to=Cs(t.getToPos());const s=n.createdAtMapByActor;for(const[c,f]of t.getMaxCreatedAtMapByActor())s[c]=q(f);n.content=t.getContent();const a=n.attributes;for(const[c,f]of t.getAttributes())a[c]=f;n.executedAt=q(t.getExecutedAt()),e.body.case="edit",e.body.value=n}else if(r instanceof jr){const t=r,n=new da;n.parentCreatedAt=q(t.getParentCreatedAt()),n.from=Cs(t.getFromPos()),n.to=Cs(t.getToPos());const s=n.createdAtMapByActor;for(const[c,f]of t.getMaxCreatedAtMapByActor())s[c]=q(f);const a=n.attributes;for(const[c,f]of t.getAttributes())a[c]=f;n.executedAt=q(t.getExecutedAt()),e.body.case="style",e.body.value=n}else if(r instanceof fr){const t=r,n=new ga;n.parentCreatedAt=q(t.getParentCreatedAt()),n.value=Ni(t.getValue()),n.executedAt=q(t.getExecutedAt()),e.body.case="increase",e.body.value=n}else if(r instanceof Kr){const t=r,n=new pa,s=n.createdAtMapByActor;for(const[a,c]of t.getMaxCreatedAtMapByActor())s[a]=q(c);n.parentCreatedAt=q(t.getParentCreatedAt()),n.from=Ns(t.getFromPos()),n.to=Ns(t.getToPos()),n.contents=Wh(t.getContents()),n.splitLevel=t.getSplitLevel(),n.executedAt=q(t.getExecutedAt()),e.body.case="treeEdit",e.body.value=n}else if(r instanceof ln){const t=r,n=new ma;n.parentCreatedAt=q(t.getParentCreatedAt()),n.from=Ns(t.getFromPos()),n.to=Ns(t.getToPos());const s=n.createdAtMapByActor;for(const[c,f]of t.getMaxCreatedAtMapByActor())s[c]=q(f);const a=t.getAttributesToRemove();if(a.length>0)n.attributesToRemove=a;else{const c=n.attributes;for(const[f,g]of t.getAttributes())c[f]=g}n.executedAt=q(t.getExecutedAt()),e.body.case="treeStyle",e.body.value=n}else throw new ue(oe.ErrUnimplemented,"unimplemented operation");return e}function Jh(r){const e=[];for(const t of r)e.push(Ha(t));return e}function jh(r){const e=new aa({id:Va(r.getID()),message:r.getMessage()});return r.hasOperations()&&(e.operations=Jh(r.getOperations())),r.hasPresenceChange()&&(e.presenceChange=$h(r.getPresenceChange())),e}function qh(r){const e=[];for(const t of r)e.push(jh(t));return e}function Kh(r){const e=[];for(const t of r)e.push(new Sa({key:t.getStrKey(),element:xi(t.getValue())}));return e}function Vh(r){const e=[];for(const t of r)e.push(new gi({element:xi(t.getValue())}));return e}function zh(r){const e=[];for(const t of r){const n=new Ia;n.id=Uh(t.getID()),n.value=t.getValue().getContent(),n.removedAt=q(t.getRemovedAt());const s=n.attributes,a=t.getValue().getAttrs();for(const c of a){const f=new ws;f.value=c.getValue(),f.updatedAt=q(c.getUpdatedAt()),s[c.getKey()]=f}e.push(n)}return e}function Wh(r){const e=[];if(!r||!r.length)return e;for(const t of r)e.push(new ka({content:Ga(t)}));return e}function Hh(r){const e={};for(const t of r)e[t.getKey()]=new ws({value:t.getValue(),updatedAt:q(t.getUpdatedAt()),isRemoved:t.isRemoved()});return e}function Ga(r){if(!r)return[];const e=[];return ks(r,(t,n)=>{const s=new mi({id:Vr(t.id),type:t.type,removedAt:q(t.removedAt),depth:n});t.isText&&(s.value=t.value),t.insPrevID&&(s.insPrevId=Vr(t.insPrevID)),t.insNextID&&(s.insNextId=Vr(t.insNextID)),t.attrs&&(s.attributes=Hh(t.attrs)),e.push(s)}),e}function Gh(r){const e=new ft;return e.body.case="jsonObject",e.body.value=new ya({nodes:Kh(r.getRHT()),createdAt:q(r.getCreatedAt()),movedAt:q(r.getMovedAt()),removedAt:q(r.getRemovedAt())}),e}function Ya(r){const e=new ft;return e.body.case="jsonArray",e.body.value=new va({nodes:Vh(r.getElements()),createdAt:q(r.getCreatedAt()),movedAt:q(r.getMovedAt()),removedAt:q(r.getRemovedAt())}),e}function Yh(r){const e=new ft;return e.body.case="primitive",e.body.value=new Ta({type:za(r.getType()),value:r.toBytes(),createdAt:q(r.getCreatedAt()),movedAt:q(r.getMovedAt()),removedAt:q(r.getRemovedAt())}),e}function Xh(r){const e=new ft;return e.body.case="text",e.body.value=new ba({nodes:zh(r.getRGATreeSplit()),createdAt:q(r.getCreatedAt()),movedAt:q(r.getMovedAt()),removedAt:q(r.getRemovedAt())}),e}function Zh(r){const e=new ft;return e.body.case="counter",e.body.value=new wa({type:Wa(r.getType()),value:r.toBytes(),createdAt:q(r.getCreatedAt()),movedAt:q(r.getMovedAt()),removedAt:q(r.getRemovedAt())}),e}function Xa(r){const e=new ft;return e.body.case="tree",e.body.value=new Aa({nodes:Ga(r.getRoot()),createdAt:q(r.getCreatedAt()),movedAt:q(r.getMovedAt()),removedAt:q(r.getRemovedAt())}),e}function xi(r){if(r instanceof tt)return Gh(r);if(r instanceof ct)return Ya(r);if(r instanceof Ae)return Yh(r);if(r instanceof pt)return Xh(r);if(r instanceof ut)return Zh(r);if(r instanceof mt)return Xa(r);throw new ue(oe.ErrUnimplemented,"unimplemented element")}function Qh(r){return new rn({documentKey:r.getDocumentKey(),checkpoint:Fh(r.getCheckpoint()),isRemoved:r.getIsRemoved(),changes:qh(r.getChanges()),snapshot:r.getSnapshot(),minSyncedTicket:q(r.getMinSyncedTicket())})}function Za(r){const e=r.findDetails(yh);for(const t of e)if(t.metadata.code)return t.metadata.code;return""}function Qa(r){let e;return r.serverSeq&&(e=X.fromString(r.serverSeq,!0)),In.of(r.clientSeq,X.fromString(r.lamport,!0),Ri(r.actorId),e)}function V(r){if(!!r)return Ge.of(X.fromString(r.lamport,!0),r.delimiter,Ri(r.actorId))}function Oi(r){const e={};return Object.entries(r.data).forEach(([t,n])=>{e[t]=JSON.parse(n)}),e}function ef(r){const e=r.type;if(e===Rr.PUT){const t=Oi(r.presence);return{type:bn.Put,presence:t}}if(e===Rr.CLEAR)return{type:bn.Clear};throw new ue(oe.Unsupported,`unsupported type: ${e}`)}function tf(r){const e=new Map;return Object.entries(r).forEach(([t,n])=>{e.set(t,Oi(n))}),e}function ec(r){switch(r){case te.NULL:return Le.Null;case te.BOOLEAN:return Le.Boolean;case te.INTEGER:return Le.Integer;case te.LONG:return Le.Long;case te.DOUBLE:return Le.Double;case te.STRING:return Le.String;case te.BYTES:return Le.Bytes;case te.DATE:return Le.Date}throw new ue(oe.ErrUnimplemented,`unimplemented value type: ${r}`)}function xs(r){switch(r){case te.INTEGER_CNT:return Wt.IntegerCnt;case te.LONG_CNT:return Wt.LongCnt}throw new ue(oe.ErrUnimplemented,`unimplemented value type: ${r}`)}function Pi(r){switch(r.type){case te.JSON_OBJECT:return r.value?cc(r.value):tt.create(V(r.createdAt));case te.JSON_ARRAY:return r.value?gf(r.value):ct.create(V(r.createdAt));case te.TEXT:return pt.create(hr.create(),V(r.createdAt));case te.TREE:return mf(r.value);case te.NULL:case te.BOOLEAN:case te.INTEGER:case te.LONG:case te.DOUBLE:case te.STRING:case te.BYTES:case te.DATE:return Ae.of(Ae.valueFromBytes(ec(r.type),r.value),V(r.createdAt));case te.INTEGER_CNT:case te.LONG_CNT:return ut.create(xs(r.type),ut.valueFromBytes(xs(r.type),r.value),V(r.createdAt))}}function Os(r){return kt.of(zt.of(V(r.createdAt),r.offset),r.relativeOffset)}function tc(r){return zt.of(V(r.createdAt),r.offset)}function nf(r){const e=Ur.create(r.value);Object.entries(r.attributes).forEach(([n,s])=>{e.setAttr(n,s.value,V(s.updatedAt))});const t=kn.create(tc(r.id),e);return t.remove(V(r.removedAt)),t}function dr(r){return It.of(zr(r.parentId),zr(r.leftSiblingId))}function zr(r){return Je.of(V(r.createdAt),r.offset)}function rf(r){if(!r.length)return;const e=[];return r.forEach(t=>{const n=nc(t.content);e.push(n)}),e}function nc(r){if(r.length===0)return;const e=[];for(const n of r)e.push(of(n));const t=e[e.length-1];for(let n=e.length-2;n>=0;n--){let s;for(let a=n+1;a<e.length;a++)if(r[n].depth-1===r[a].depth){s=e[a];break}s.prepend(e[n])}return t.updateDescendantsSize(),mt.create(t,At).getRoot()}function sf(r){const e=an.create();for(const[t,n]of Object.entries(r))e.setInternal(t,n.value,V(n.updatedAt),n.isRemoved);return e}function of(r){const e=zr(r.id),t=lt.create(e,r.type),n=Object.entries(r.attributes);return t.isText?t.value=r.value:n.length&&(t.attrs=sf(r.attributes)),r.insPrevId&&(t.insPrevID=zr(r.insPrevId)),r.insNextId&&(t.insNextID=zr(r.insNextId)),t.removedAt=V(r.removedAt),t}function rc(r){if(r.body.case==="set"){const e=r.body.value;return Un.create(e.key,Pi(e.value),V(e.parentCreatedAt),V(e.executedAt))}else if(r.body.case==="add"){const e=r.body.value;return Fr.create(V(e.parentCreatedAt),V(e.prevCreatedAt),Pi(e.value),V(e.executedAt))}else if(r.body.case==="move"){const e=r.body.value;return Sn.create(V(e.parentCreatedAt),V(e.prevCreatedAt),V(e.createdAt),V(e.executedAt))}else if(r.body.case==="remove"){const e=r.body.value;return An.create(V(e.parentCreatedAt),V(e.createdAt),V(e.executedAt))}else if(r.body.case==="edit"){const e=r.body.value,t=new Map;Object.entries(e.createdAtMapByActor).forEach(([s,a])=>{t.set(s,V(a))});const n=new Map;return Object.entries(e.attributes).forEach(([s,a])=>{n.set(s,a)}),Jr.create(V(e.parentCreatedAt),Os(e.from),Os(e.to),t,e.content,n,V(e.executedAt))}else if(r.body.case==="style"){const e=r.body.value,t=new Map;Object.entries(e.createdAtMapByActor).forEach(([s,a])=>{t.set(s,V(a))});const n=new Map;return Object.entries(e.attributes).forEach(([s,a])=>{n.set(s,a)}),jr.create(V(e.parentCreatedAt),Os(e.from),Os(e.to),t,n,V(e.executedAt))}else{if(r.body.case==="select")return;if(r.body.case==="increase"){const e=r.body.value;return fr.create(V(e.parentCreatedAt),Pi(e.value),V(e.executedAt))}else if(r.body.case==="treeEdit"){const e=r.body.value,t=new Map;return Object.entries(e.createdAtMapByActor).forEach(([n,s])=>{t.set(n,V(s))}),Kr.create(V(e.parentCreatedAt),dr(e.from),dr(e.to),rf(e.contents),e.splitLevel,t,V(e.executedAt))}else if(r.body.case==="treeStyle"){const e=r.body.value,t=new Map,n=e.attributesToRemove,s=new Map;return e!=null&&e.createdAtMapByActor&&Object.entries(e.createdAtMapByActor).forEach(([a,c])=>{s.set(a,V(c))}),(n==null?void 0:n.length)>0?ln.createTreeRemoveStyleOperation(V(e.parentCreatedAt),dr(e.from),dr(e.to),s,n,V(e.executedAt)):(Object.entries(e.attributes).forEach(([a,c])=>{t.set(a,c)}),ln.create(V(e.parentCreatedAt),dr(e.from),dr(e.to),s,t,V(e.executedAt)))}else throw new ue(oe.ErrUnimplemented,"unimplemented operation")}}function af(r){const e=[];for(const t of r){const n=rc(t);n&&e.push(n)}return e}function sc(r){const e=[];for(const t of r)e.push(jn.create({id:Qa(t.id),operations:af(t.operations),presenceChange:t.presenceChange?ef(t.presenceChange):void 0,message:t.message}));return e}function cf(r){return ur.of(X.fromString(r.serverSeq,!0),r.clientSeq)}function lf(r){return Es.create(r.documentKey,cf(r.checkpoint),r.isRemoved,sc(r.changes),r.snapshot,V(r.minSyncedTicket))}function ic(r){const e=new Br;for(const n of r.nodes){const s=Di(n.element);e.set(n.key,s,s.getPositionedAt())}const t=new tt(V(r.createdAt),e);return t.setMovedAt(V(r.movedAt)),t.setRemovedAt(V(r.removedAt)),t}function oc(r){const e=new $r;for(const n of r.nodes)e.insert(Di(n.element));const t=new ct(V(r.createdAt),e);return t.setMovedAt(V(r.movedAt)),t.setRemovedAt(V(r.removedAt)),t}function uf(r){const e=Ae.of(Ae.valueFromBytes(ec(r.type),r.value),V(r.createdAt));return e.setMovedAt(V(r.movedAt)),e.setRemovedAt(V(r.removedAt)),e}function hf(r){const e=new hr;let t=e.getHead();for(const s of r.nodes){const a=e.insertAfter(t,nf(s));s.insPrevId&&a.setInsPrev(e.findNode(tc(s.insPrevId))),t=a}const n=new pt(e,V(r.createdAt));return n.setMovedAt(V(r.movedAt)),n.setRemovedAt(V(r.removedAt)),n}function ff(r){const e=ut.create(xs(r.type),ut.valueFromBytes(xs(r.type),r.value),V(r.createdAt));return e.setMovedAt(V(r.movedAt)),e.setRemovedAt(V(r.removedAt)),e}function ac(r){const e=nc(r.nodes);return mt.create(e,V(r.createdAt))}function Di(r){if(r.body.case==="jsonObject")return ic(r.body.value);if(r.body.case==="jsonArray")return oc(r.body.value);if(r.body.case==="primitive")return uf(r.body.value);if(r.body.case==="text")return hf(r.body.value);if(r.body.case==="counter")return ff(r.body.value);if(r.body.case==="tree")return ac(r.body.value);throw new ue(oe.ErrUnimplemented,"unimplemented element")}function df(r){if(!r)return{root:tt.create(At),presences:new Map};const e=Wu.fromBinary(r);return{root:Di(e.root),presences:tf(e.presences)}}function cc(r){if(!r)throw new Error("bytes is empty");const e=ft.fromBinary(r);return ic(e.body.value)}function lc(r){return xi(r).toBinary()}function gf(r){if(!r)throw new Error("bytes is empty");const e=ft.fromBinary(r);return oc(e.body.value)}function pf(r){return Ya(r).toBinary()}function mf(r){if(!r)throw new Error("bytes is empty");const e=ft.fromBinary(r);return ac(e.body.value)}function yf(r){return Xa(r).toBinary()}function uc(r){return r?Array.from(r).map(e=>e.toString(16).padStart(2,"0")).join(""):""}function Ri(r){return uc(r)}function hc(r){return new Uint8Array(r.match(/.{1,2}/g).map(e=>parseInt(e,16)))}function _i(r){return hc(r)}function vf(r){const e=bs.fromBinary(r);return Qa(e)}function Tf(r){const e=di.fromBinary(r);return rc(e)}const Re={fromPresence:Oi,toChangePack:Qh,fromChangePack:lf,fromChanges:sc,objectToBytes:lc,bytesToObject:cc,bytesToSnapshot:df,bytesToHex:uc,hexToBytes:hc,toHexString:Ri,toUint8Array:_i,toOperation:Ha,toChangeID:Va,PbChangeID:bs,bytesToChangeID:vf,bytesToOperation:Tf};function fc(){return"xxxxxxxx-xxxx-4xxxy-xxxx-xxxxxxxxxxx".replace(/[xy]/g,r=>{const e=Math.random()*16|0;return(r==="x"?e:e&3|8).toString(16)})}class bf{constructor(e,t,n,s){u(this,"reconnectStreamDelay"),u(this,"doc"),u(this,"docID"),u(this,"syncMode"),u(this,"remoteChangeEventReceived"),u(this,"watchStream"),u(this,"watchLoopTimerID"),u(this,"watchAbortController"),this.reconnectStreamDelay=e,this.doc=t,this.docID=n,this.syncMode=s,this.remoteChangeEventReceived=!1}changeSyncMode(e){this.syncMode=e}needRealtimeSync(){return this.syncMode===Zr.RealtimeSyncOff?!1:this.syncMode===Zr.RealtimePushOnly?this.doc.hasLocalChanges():this.syncMode!==Zr.Manual&&(this.doc.hasLocalChanges()||this.remoteChangeEventReceived)}async runWatchLoop(e){const t=async()=>{if(this.watchStream)return Promise.resolve();this.watchLoopTimerID&&(clearTimeout(this.watchLoopTimerID),this.watchLoopTimerID=void 0);try{[this.watchStream,this.watchAbortController]=await e(()=>{this.watchStream=void 0,this.watchAbortController=void 0,this.watchLoopTimerID=setTimeout(t,this.reconnectStreamDelay)})}catch{}};await t()}cancelWatchStream(){this.watchStream&&this.watchAbortController&&(this.watchAbortController.abort(),this.watchStream=void 0,this.watchAbortController=void 0),clearTimeout(this.watchLoopTimerID),this.watchLoopTimerID=void 0}}const Mi=()=>{};class wf{constructor(e){u(this,"finalized",!1),u(this,"observers",[]),u(this,"finalError");try{e(this)}catch(t){this.error(t)}}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,n){let s;e||R.fatal("missing observer"),this.finalized&&R.fatal("observable is finalized due to previous error"),typeof e=="object"?s=e:s={next:e,error:t,complete:n},s.next===void 0&&(s.next=Mi),s.error===void 0&&(s.error=Mi),s.complete===void 0&&(s.complete=Mi);const a=fc(),c=this.unsubscribeOne.bind(this,a);if(this.observers.push({subscriptionID:a,observer:s}),this.finalized)try{this.finalError?s.error(this.finalError):s.complete()}catch(f){R.warn(f)}return c}unsubscribeOne(e){var t;this.observers=(t=this.observers)==null?void 0:t.filter(n=>n.subscriptionID!==e)}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e].observer)}catch(n){R.error(n)}}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.observers=void 0)}}function Af(r){const e=new wf(r);return{subscribe:e.subscribe.bind(e),getProxy:()=>e}}class gr{constructor(e,t,n,s){u(this,"id"),u(this,"delimiter"),u(this,"message"),u(this,"root"),u(this,"operations"),u(this,"presenceChange"),u(this,"previousPresence"),u(this,"reversePresenceKeys"),this.id=e,this.delimiter=Ai,this.root=t,this.operations=[],this.previousPresence=wt(n),this.presenceChange=void 0,this.reversePresenceKeys=new Set,this.message=s}static create(e,t,n,s){return new gr(e,t,n,s)}push(e){this.operations.push(e)}registerElement(e,t){this.root.registerElement(e,t)}registerRemovedElement(e){this.root.registerRemovedElement(e)}registerGCPair(e){this.root.registerGCPair(e)}getChange(){return jn.create({id:this.id,operations:this.operations,presenceChange:this.presenceChange,message:this.message})}hasChange(){return this.operations.length>0||this.presenceChange!==void 0}setPresenceChange(e){this.presenceChange=e}setReversePresence(e,t){for(const n of Object.keys(e))t!=null&&t.addToHistory?this.reversePresenceKeys.add(n):this.reversePresenceKeys.delete(n)}getReversePresence(){if(this.reversePresenceKeys.size===0)return;const e={};for(const t of this.reversePresenceKeys)e[t]=this.previousPresence[t];return e}issueTimeTicket(){return this.delimiter+=1,this.id.createTimeTicket(this.delimiter)}getLastTimeTicket(){return this.id.createTimeTicket(this.delimiter)}}class Wr{constructor(e){u(this,"rootObject"),u(this,"elementPairMapByCreatedAt"),u(this,"gcElementSetByCreatedAt"),u(this,"gcPairMap"),this.rootObject=e,this.elementPairMapByCreatedAt=new Map,this.gcElementSetByCreatedAt=new Set,this.gcPairMap=new Map,this.registerElement(e,void 0),e.getDescendants(t=>{if(t.getRemovedAt()&&this.registerRemovedElement(t),t instanceof pt||t instanceof mt)for(const n of t.getGCPairs())this.registerGCPair(n);return!1})}static create(){return new Wr(tt.create(At))}findByCreatedAt(e){const t=this.elementPairMapByCreatedAt.get(e.toIDString());if(!!t)return t.element}findElementPairByCreatedAt(e){return this.elementPairMapByCreatedAt.get(e.toIDString())}createSubPaths(e){let t=this.elementPairMapByCreatedAt.get(e.toIDString());if(!t)return[];const n=[];for(;t.parent;){const s=t.element.getCreatedAt(),a=t.parent.subPathOf(s);a===void 0&&R.fatal(`cant find the given element: ${s.toIDString()}`),n.unshift(a),t=this.elementPairMapByCreatedAt.get(t.parent.getCreatedAt().toIDString())}return n.unshift("$"),n}createPath(e){return this.createSubPaths(e).join(".")}registerElement(e,t){this.elementPairMapByCreatedAt.set(e.getCreatedAt().toIDString(),{parent:t,element:e}),e instanceof wn&&e.getDescendants((n,s)=>(this.registerElement(n,s),!1))}deregisterElement(e){let t=0;const n=s=>{const a=s.getCreatedAt().toIDString();this.elementPairMapByCreatedAt.delete(a),this.gcElementSetByCreatedAt.delete(a),t++};return n(e),e instanceof wn&&e.getDescendants(s=>(n(s),!1)),t}registerRemovedElement(e){this.gcElementSetByCreatedAt.add(e.getCreatedAt().toIDString())}registerGCPair(e){if(this.gcPairMap.get(e.child.toIDString())){this.gcPairMap.delete(e.child.toIDString());return}this.gcPairMap.set(e.child.toIDString(),e)}getElementMapSize(){return this.elementPairMapByCreatedAt.size}getGarbageElementSetSize(){const e=new Set;for(const t of this.gcElementSetByCreatedAt){e.add(t);const n=this.elementPairMapByCreatedAt.get(t);n.element instanceof wn&&n.element.getDescendants(s=>(e.add(s.getCreatedAt().toIDString()),!1))}return e.size}getObject(){return this.rootObject}getGarbageLen(){return this.getGarbageElementSetSize()+this.gcPairMap.size}deepcopy(){return new Wr(this.rootObject.deepcopy())}garbageCollect(e){let t=0;for(const n of this.gcElementSetByCreatedAt){const s=this.elementPairMapByCreatedAt.get(n);s.element.getRemovedAt()&&e.compare(s.element.getRemovedAt())>=0&&(s.parent.purge(s.element),t+=this.deregisterElement(s.element))}for(const[,n]of this.gcPairMap){const s=n.child.getRemovedAt();s!==void 0&&e.compare(s)>=0&&(n.parent.purge(n.child),this.gcPairMap.delete(n.child.toIDString()),t+=1)}return t}toJSON(){return this.rootObject.toJSON()}toSortedJSON(){return this.rootObject.toSortedJSON()}}function dc(r,e){const t=new Hr(r);return new Proxy(e,t.getHandlers())}class Hr{constructor(e){u(this,"context"),u(this,"handlers"),this.context=e,this.handlers={set:(t,n,s)=>(R.isEnabled(Ve.Trivial)&&R.trivial(`obj[${n}]=${JSON.stringify(s)}`),Hr.setInternal(e,t,n,s),!0),get:(t,n)=>(R.isEnabled(Ve.Trivial)&&R.trivial(`obj[${n}]`),n==="getID"?()=>t.getCreatedAt():n==="toJSON"||n==="toString"?()=>t.toJSON():n==="toJS"?()=>t.toJS():n==="toJSForTest"?()=>t.toJSForTest():qn(e,t.get(n))),ownKeys:t=>t.getKeys(),getOwnPropertyDescriptor:()=>({enumerable:!0,configurable:!0}),deleteProperty:(t,n)=>(R.isEnabled(Ve.Trivial)&&R.trivial(`obj[${n}]`),Hr.deleteInternal(e,t,n),!0)}}static setInternal(e,t,n,s){if(n.includes("."))throw new ue(oe.ErrInvalidObjectKey,"key must not contain the '.'.");const a=e.issueTimeTicket(),c=Ps(e,s,a),f=t.set(n,c,a);e.registerElement(c,t),f&&e.registerRemovedElement(f),e.push(Un.create(n,c.deepcopy(),t.getCreatedAt(),a))}static buildObjectMembers(e,t){const n={};for(const[s,a]of Object.entries(t)){if(s.includes("."))throw new ue(oe.ErrInvalidObjectKey,"key must not contain the '.'.");const c=e.issueTimeTicket(),f=Ps(e,a,c);n[s]=f}return n}static deleteInternal(e,t,n){const s=e.issueTimeTicket(),a=t.deleteByKey(n,s);!a||(e.push(An.create(t.getCreatedAt(),a.getCreatedAt(),s)),e.registerRemovedElement(a))}getHandlers(){return this.handlers}}function Sf(r,e){const t=new Oe(r,e);return new Proxy(e,t.getHandlers())}function If(r){return typeof r=="string"||r instanceof String?!isNaN(r):!1}function kf(r){return["concat","entries","every","filter","find","findIndex","forEach","join","keys","map","reduce","reduceRight","slice","some","toLocaleString","toString","values"].includes(r)}class Oe{constructor(e,t){u(this,"context"),u(this,"handlers"),u(this,"array"),this.context=e,this.array=t,this.handlers={get:(n,s,a)=>s==="getID"?()=>n.getCreatedAt():s==="getElementByID"?c=>{const f=n.getByID(c);if(!(!f||f.isRemoved()))return En(e,f)}:s==="getElementByIndex"?c=>{const f=n.get(c);return En(e,f)}:s==="getLast"?()=>En(e,n.getLast()):s==="deleteByID"?c=>{const f=Oe.deleteInternalByID(e,n,c);return En(e,f)}:s==="insertAfter"?(c,f)=>{const g=Oe.insertAfterInternal(e,n,c,f);return En(e,g)}:s==="insertBefore"?(c,f)=>{const g=Oe.insertBeforeInternal(e,n,c,f);return En(e,g)}:s==="moveBefore"?(c,f)=>{Oe.moveBeforeInternal(e,n,c,f)}:s==="moveAfter"?(c,f)=>{Oe.moveAfterInternal(e,n,c,f)}:s==="moveFront"?c=>{Oe.moveFrontInternal(e,n,c)}:s==="moveLast"?c=>{Oe.moveLastInternal(e,n,c)}:If(s)?qn(e,n.get(Number(s))):s==="push"?c=>Oe.pushInternal(e,n,c):s==="splice"?(c,f,...g)=>Oe.splice(e,n,c,f,...g):s==="length"?n.length:typeof s=="symbol"&&s===Symbol.iterator?Oe.iteratorInternal.bind(this,e,n):s==="includes"?(c,f)=>Oe.includes(e,n,c,f):s==="indexOf"?(c,f)=>Oe.indexOf(e,n,c,f):s==="lastIndexOf"?(c,f)=>Oe.lastIndexOf(e,n,c,f):s==="toJSForTest"?()=>n.toJSForTest():s==="toTestString"?()=>Oe.toTestString(n):typeof s=="string"&&kf(s)?(...c)=>{const f=Array.from(n).map(g=>qn(e,g));return Array.prototype[s].apply(f,c)}:Reflect.get(n,s,a),deleteProperty:(n,s)=>(R.isEnabled(Ve.Trivial)&&R.trivial(`array[${s}]`),Oe.deleteInternalByIndex(e,n,Number.parseInt(s)),!0)}}static*iteratorInternal(e,t){for(const n of t)yield En(e,n)}static buildArrayElements(e,t){const n=[];for(const s of t){const a=e.issueTimeTicket(),c=Ps(e,s,a);n.push(c)}return n}static pushInternal(e,t,n){return Oe.insertAfterInternal(e,t,t.getLastCreatedAt(),n),t.length}static moveBeforeInternal(e,t,n,s){const a=e.issueTimeTicket(),c=t.getPrevCreatedAt(n);t.moveAfter(c,s,a),e.push(Sn.create(t.getCreatedAt(),c,s,a))}static moveAfterInternal(e,t,n,s){const a=e.issueTimeTicket();t.moveAfter(n,s,a),e.push(Sn.create(t.getCreatedAt(),n,s,a))}static moveFrontInternal(e,t,n){const s=e.issueTimeTicket(),a=t.getHead();t.moveAfter(a.getCreatedAt(),n,s),e.push(Sn.create(t.getCreatedAt(),a.getCreatedAt(),n,s))}static moveLastInternal(e,t,n){const s=e.issueTimeTicket(),a=t.getLastCreatedAt();t.moveAfter(a,n,s),e.push(Sn.create(t.getCreatedAt(),a,n,s))}static insertAfterInternal(e,t,n,s){const a=e.issueTimeTicket(),c=Ps(e,s,a);return t.insertAfter(n,c),e.registerElement(c,t),e.push(Fr.create(t.getCreatedAt(),n,c.deepcopy(),a)),c}static insertBeforeInternal(e,t,n,s){return Oe.insertAfterInternal(e,t,t.getPrevCreatedAt(n),s)}static deleteInternalByIndex(e,t,n){const s=e.issueTimeTicket(),a=t.deleteByIndex(n,s);if(!!a)return e.push(An.create(t.getCreatedAt(),a.getCreatedAt(),s)),e.registerRemovedElement(a),a}static deleteInternalByID(e,t,n){const s=e.issueTimeTicket(),a=t.delete(n,s);return e.push(An.create(t.getCreatedAt(),a.getCreatedAt(),s)),e.registerRemovedElement(a),a}static splice(e,t,n,s,...a){const c=t.length,f=n>=0?Math.min(n,c):Math.max(c+n,0),g=s===void 0?c:s<0?f:Math.min(f+s,c),m=[];for(let b=f;b<g;b++){const x=Oe.deleteInternalByIndex(e,t,f);if(x){const C=x.deepcopy();C.setRemovedAt(),m.push(qn(e,C))}}if(a){let b=f===0?t.getHead().getID():t.get(f-1).getID();for(const x of a)b=Oe.insertAfterInternal(e,t,b,x).getID()}return m}static includes(e,t,n,s){var a;const c=t.length,f=s===void 0?0:s<0?Math.max(s+c,0):s;if(f>=c)return!1;if(Ae.isSupport(n))return Array.from(t).map(m=>qn(e,m)).includes(n,f);for(let g=f;g<c;g++)if(((a=t.get(g))==null?void 0:a.getID())===n.getID())return!0;return!1}static indexOf(e,t,n,s){var a;const c=t.length,f=s===void 0?0:s<0?Math.max(s+c,0):s;if(f>=c)return-1;if(Ae.isSupport(n))return Array.from(t).map(m=>qn(e,m)).indexOf(n,f);for(let g=f;g<c;g++)if(((a=t.get(g))==null?void 0:a.getID())===n.getID())return g;return-1}static lastIndexOf(e,t,n,s){var a;const c=t.length,f=s===void 0||s>=c?c-1:s<0?s+c:s;if(f<0)return-1;if(Ae.isSupport(n))return Array.from(t).map(m=>qn(e,m)).lastIndexOf(n,f);for(let g=f;g>0;g--)if(((a=t.get(g))==null?void 0:a.getID())===n.getID())return g;return-1}static toTestString(e){return e.toTestString()}getHandlers(){return this.handlers}}class Gr{constructor(e,t){u(this,"context"),u(this,"text"),this.context=e,this.text=t}initialize(e,t){this.context=e,this.text=t}getID(){return this.text.getID()}edit(e,t,n,s){if(!this.context||!this.text){R.fatal("it is not initialized yet");return}if(e>t){R.fatal("from should be less than or equal to to");return}const a=this.text.indexRangeToPosRange(e,t);R.isEnabled(Ve.Debug)&&R.debug(`EDIT: f:${e}->${a[0].toTestString()}, t:${t}->${a[1].toTestString()} c:${n}`);const c=s?cr(s):void 0,f=this.context.issueTimeTicket(),[g,,m,b]=this.text.edit(a,n,f,c);for(const x of m)this.context.registerGCPair(x);return this.context.push(new Jr(this.text.getCreatedAt(),a[0],a[1],g,n,c?new Map(Object.entries(c)):new Map,f)),this.text.findIndexesFromRange(b)}delete(e,t){return this.edit(e,t,"")}empty(){return this.edit(0,this.length,"")}setStyle(e,t,n){if(!this.context||!this.text)return R.fatal("it is not initialized yet"),!1;if(e>t)return R.fatal("from should be less than or equal to to"),!1;const s=this.text.indexRangeToPosRange(e,t);R.isEnabled(Ve.Debug)&&R.debug(`STYL: f:${e}->${s[0].toTestString()}, t:${t}->${s[1].toTestString()} a:${JSON.stringify(n)}`);const a=cr(n),c=this.context.issueTimeTicket(),[f,g]=this.text.setStyle(s,a,c);for(const m of g)this.context.registerGCPair(m);return this.context.push(new jr(this.text.getCreatedAt(),s[0],s[1],f,new Map(Object.entries(a)),c)),!0}indexRangeToPosRange(e){if(!this.context||!this.text){R.fatal("it is not initialized yet");return}const t=this.text.indexRangeToPosRange(e[0],e[1]);return[t[0].toStruct(),t[1].toStruct()]}posRangeToIndexRange(e){if(!this.context||!this.text){R.fatal("it is not initialized yet");return}const t=this.text.findIndexesFromRange([kt.fromStruct(e[0]),kt.fromStruct(e[1])]);return[t[0],t[1]]}toTestString(){if(!this.context||!this.text){R.fatal("it is not initialized yet");return}return this.text.toTestString()}values(){if(!this.context||!this.text){R.fatal("it is not initialized yet");return}return this.text.values()}get length(){return this.text.length}getTreeByIndex(){return this.text.getTreeByIndex()}getTreeByID(){return this.text.getTreeByID()}toString(){return!this.context||!this.text?(R.fatal("it is not initialized yet"),""):this.text.toString()}toJSON(){if(!this.context||!this.text)throw new Error("it is not initialized yet");return this.text.toJSON()}toJSForTest(){if(!this.context||!this.text)throw new Error("it is not initialized yet");return this.text.toJSForTest()}createRangeForTest(e,t){if(!this.context||!this.text){R.fatal("it is not initialized yet");return}return this.text.indexRangeToPosRange(e,t)}}class Yr{constructor(e,t){u(this,"valueType"),u(this,"value"),u(this,"context"),u(this,"counter"),this.valueType=e,this.value=t}initialize(e,t){this.valueType=t.getValueType(),this.context=e,this.counter=t,this.value=t.getValue()}getID(){return this.counter.getID()}getValue(){return this.value}getValueType(){return this.valueType}increase(e){if(!this.context||!this.counter){R.fatal("it is not initialized yet");return}const t=this.context.issueTimeTicket(),n=Ae.of(e,t);if(!n.isNumericType())throw new TypeError(`Unsupported type of value: ${typeof n.getValue()}`);return this.counter.increase(n),this.context.push(fr.create(this.counter.getCreatedAt(),n,t)),this}toJSForTest(){if(!this.context||!this.counter)throw new Error("it is not initialized yet");return this.counter.toJSForTest()}}function Bi(r,e,t){const{type:n}=r,s=t.issueTimeTicket();if(n===cn){gc(r);const{value:a}=r,c=lt.create(Je.of(s,0),n,a);e.append(c)}else{const{children:a=[]}=r;let{attributes:c}=r,f;if(typeof c=="object"&&!La(c)){c=cr(c),f=new an;for(const[m,b]of Object.entries(c))f.set(m,b,s)}const g=lt.create(Je.of(s,0),n,void 0,f);e.append(g);for(const m of a)Bi(m,g,t)}}function Ef(r,e){const{type:t}=e,n=r.issueTimeTicket();let s;if(e.type===cn){const{value:a}=e;s=lt.create(Je.of(n,0),t,a)}else if(e){const{children:a=[]}=e;let{attributes:c}=e,f;if(typeof c=="object"&&!La(c)){c=cr(c),f=new an;for(const[g,m]of Object.entries(c))f.set(g,m,n)}s=lt.create(Je.of(r.issueTimeTicket(),0),t,void 0,f);for(const g of a)Bi(g,s,r)}return s}function gc(r){if(!r.value.length)throw new Error("text node cannot have empty value");return!0}function pc(r){if(!r.length)return!0;if(r[0].type===cn)for(const t of r){const{type:n}=t;if(n!==cn)throw new Error("element node and text node cannot be passed together");gc(t)}else for(const t of r){const{type:n}=t;if(n===cn)throw new Error("element node and text node cannot be passed together")}return!0}class Xr{constructor(e){u(this,"initialRoot"),u(this,"context"),u(this,"tree"),this.initialRoot=e}initialize(e,t){this.context=e,this.tree=t}getID(){return this.tree.getID()}buildRoot(e){if(!this.initialRoot)return lt.create(Je.of(e.issueTimeTicket(),0),Eh);const t=lt.create(Je.of(e.issueTimeTicket(),0),this.initialRoot.type);for(const n of this.initialRoot.children)Bi(n,t,e);return t}getSize(){if(!this.context||!this.tree)throw new Error("it is not initialized yet");return this.tree.getSize()}getNodeSize(){if(!this.context||!this.tree)throw new Error("it is not initialized yet");return this.tree.getNodeSize()}getIndexTree(){if(!this.context||!this.tree)throw new Error("it is not initialized yet");return this.tree.getIndexTree()}styleByPath(e,t){if(!this.context||!this.tree)throw new Error("it is not initialized yet");if(!e.length)throw new Error("path should not be empty");const[n,s]=this.tree.pathToPosRange(e),a=this.context.issueTimeTicket(),c=t?cr(t):void 0,[f]=this.tree.style([n,s],c,a);this.context.push(ln.create(this.tree.getCreatedAt(),n,s,f,c?new Map(Object.entries(c)):new Map,a))}style(e,t,n){if(!this.context||!this.tree)throw new Error("it is not initialized yet");if(e>t)throw new Error("from should be less than or equal to to");const s=this.tree.findPos(e),a=this.tree.findPos(t),c=this.context.issueTimeTicket(),f=n?cr(n):void 0,[g,m]=this.tree.style([s,a],f,c);for(const b of m)this.context.registerGCPair(b);this.context.push(ln.create(this.tree.getCreatedAt(),s,a,g,f?new Map(Object.entries(f)):new Map,c))}removeStyle(e,t,n){if(!this.context||!this.tree)throw new Error("it is not initialized yet");if(e>t)throw new Error("from should be less than or equal to to");const s=this.tree.findPos(e),a=this.tree.findPos(t),c=this.context.issueTimeTicket(),[f,g]=this.tree.removeStyle([s,a],n,c);for(const m of g)this.context.registerGCPair(m);this.context.push(ln.createTreeRemoveStyleOperation(this.tree.getCreatedAt(),s,a,f,n,c))}editInternal(e,t,n,s=0){var a;if(n.length!==0&&n[0]&&(pc(n),n[0].type!==cn))for(const b of n){const{children:x=[]}=b;pc(x)}const c=this.context.getLastTimeTicket();let f=new Array;if(((a=n[0])==null?void 0:a.type)===cn){let b="";for(const x of n){const{value:C}=x;b+=C}f.push(lt.create(Je.of(this.context.issueTimeTicket(),0),cn,b))}else f=n.map(b=>b&&Ef(this.context,b)).filter(b=>b);const[,g,m]=this.tree.edit([e,t],f.length?f.map(b=>b==null?void 0:b.deepcopy()):void 0,s,c,()=>this.context.issueTimeTicket());for(const b of g)this.context.registerGCPair(b);return this.context.push(Kr.create(this.tree.getCreatedAt(),e,t,f.length?f:void 0,s,m,c)),!0}editByPath(e,t,n,s=0){if(!this.context||!this.tree)throw new Error("it is not initialized yet");if(e.length!==t.length)throw new Error("path length should be equal");if(!e.length||!t.length)throw new Error("path should not be empty");const a=this.tree.pathToPos(e),c=this.tree.pathToPos(t);return this.editInternal(a,c,n?[n]:[],s)}editBulkByPath(e,t,n,s=0){if(!this.context||!this.tree)throw new Error("it is not initialized yet");if(e.length!==t.length)throw new Error("path length should be equal");if(!e.length||!t.length)throw new Error("path should not be empty");const a=this.tree.pathToPos(e),c=this.tree.pathToPos(t);return this.editInternal(a,c,n,s)}edit(e,t,n,s=0){if(!this.context||!this.tree)throw new Error("it is not initialized yet");if(e>t)throw new Error("from should be less than or equal to to");const a=this.tree.findPos(e),c=this.tree.findPos(t);return this.editInternal(a,c,n?[n]:[],s)}editBulk(e,t,n,s=0){if(!this.context||!this.tree)throw new Error("it is not initialized yet");if(e>t)throw new Error("from should be less than or equal to to");const a=this.tree.findPos(e),c=this.tree.findPos(t);return this.editInternal(a,c,n,s)}toXML(){if(!this.context||!this.tree)throw new Error("it is not initialized yet");return this.tree.toXML()}toJSON(){if(!this.context||!this.tree)throw new Error("it is not initialized yet");return this.tree.toJSON()}toJSForTest(){if(!this.context||!this.tree)throw new Error("it is not initialized yet");return this.tree.toJSForTest()}toJSInfoForTest(){if(!this.context||!this.tree)throw new Error("it is not initialized yet");return this.tree.toJSInfoForTest()}getRootTreeNode(){if(!this.context||!this.tree)throw new Error("it is not initialized yet");return this.tree.getRootTreeNode()}indexToPath(e){if(!this.context||!this.tree)throw new Error("it is not initialized yet");return this.tree.indexToPath(e)}pathToIndex(e){if(!this.context||!this.tree)throw new Error("it is not initialized yet");return this.tree.pathToIndex(e)}pathRangeToPosRange(e){if(!this.context||!this.tree){R.fatal("it is not initialized yet");return}const t=[this.tree.pathToIndex(e[0]),this.tree.pathToIndex(e[1])],n=this.tree.indexRangeToPosRange(t);return[n[0].toStruct(),n[1].toStruct()]}indexRangeToPosRange(e){if(!this.context||!this.tree){R.fatal("it is not initialized yet");return}return this.tree.indexRangeToPosStructRange(e)}posRangeToIndexRange(e){if(!this.context||!this.tree){R.fatal("it is not initialized yet");return}const t=[It.fromStruct(e[0]),It.fromStruct(e[1])];return this.tree.posRangeToIndexRange(t)}posRangeToPathRange(e){if(!this.context||!this.tree){R.fatal("it is not initialized yet");return}const t=[It.fromStruct(e[0]),It.fromStruct(e[1])];return this.tree.posRangeToPathRange(t)}}function mc(r,e){return dc(r,e)}function En(r,e){if(e){if(e instanceof Ae)return e;if(e instanceof tt)return dc(r,e);if(e instanceof ct)return Sf(r,e);if(e instanceof pt)return new Gr(r,e);if(e instanceof ut){const t=new Yr(Wt.IntegerCnt,0);return t.initialize(r,e),t}else if(e instanceof mt){const t=new Xr;return t.initialize(r,e),t}}else return;throw new TypeError(`Unsupported type of element: ${typeof e}`)}function qn(r,e){const t=En(r,e);return t instanceof Ae?t.getValue():t}function Ps(r,e,t){let n;if(Ae.isSupport(e))n=Ae.of(e,t);else if(Array.isArray(e))n=ct.create(t,Oe.buildArrayElements(r,e));else if(typeof e=="object")e instanceof Gr?(n=pt.create(hr.create(),t),e.initialize(r,n)):e instanceof Yr?(n=ut.create(e.getValueType(),e.getValue(),t),e.initialize(r,n)):e instanceof Xr?(n=mt.create(e.buildRoot(r),t),e.initialize(r,n)):n=tt.create(t,Hr.buildObjectMembers(r,e));else throw new TypeError(`Unsupported type of value: ${typeof e}`);return n}const yc=50;class Cf{constructor(){u(this,"undoStack",[]),u(this,"redoStack",[])}hasUndo(){return this.undoStack.length>0}hasRedo(){return this.redoStack.length>0}pushUndo(e){this.undoStack.length>=yc&&this.undoStack.shift(),this.undoStack.push(e)}popUndo(){return this.undoStack.pop()}pushRedo(e){this.redoStack.length>=yc&&this.redoStack.shift(),this.redoStack.push(e)}popRedo(){return this.redoStack.pop()}clearRedo(){this.redoStack=[]}getUndoStackForTest(){return this.undoStack}getRedoStackForTest(){return this.redoStack}}const vc="yorkie-devtools-panel",Tc="yorkie-devtools-sdk";let pr="disconnected";const bc=new Map,Ds=new Map;typeof window<"u"&&(window.transactionEventsByDocKey=Ds);function Rs(r,e){!((e==null?void 0:e.force)||pr!=="disconnected")||window.postMessage({source:Tc,...r},"*")}function Nf(r){if(!r.isEnableDevtools()||typeof window>"u"||bc.has(r.getKey()))return;Ds.set(r.getKey(),[]);const e=r.subscribe("all",t=>{t.some(n=>n.type!==Ye.StatusChanged&&n.type!==Ye.Snapshot&&n.type!==Ye.LocalChange&&n.type!==Ye.RemoteChange&&n.type!==Ye.Initialized&&n.type!==Ye.Watched&&n.type!==Ye.Unwatched&&n.type!==Ye.PresenceChanged)||(Ds.get(r.getKey()).push(t),pr==="synced"&&Rs({msg:"doc::sync::partial",docKey:r.getKey(),event:t}))});bc.set(r.getKey(),[e]),Rs({msg:"refresh-devtools"},{force:!0}),window.addEventListener("message",t=>{var n;if(((n=t.data)==null?void 0:n.source)!==vc)return;switch(t.data.msg){case"devtools::connect":if(pr!=="disconnected")break;pr="connected",Rs({msg:"doc::available",docKey:r.getKey()}),R.info(`[YD] Devtools connected. Doc: ${r.getKey()}`);break;case"devtools::disconnect":pr="disconnected",R.info(`[YD] Devtools disconnected. Doc: ${r.getKey()}`);break;case"devtools::subscribe":pr="synced",Rs({msg:"doc::sync::full",docKey:r.getKey(),events:Ds.get(r.getKey())}),R.info(`[YD] Devtools subscribed. Doc: ${r.getKey()}`);break}})}var un=(r=>(r.Detached="detached",r.Attached="attached",r.Removed="removed",r))(un||{}),Ye=(r=>(r.StatusChanged="status-changed",r.ConnectionChanged="connection-changed",r.SyncStatusChanged="sync-status-changed",r.Snapshot="snapshot",r.LocalChange="local-change",r.RemoteChange="remote-change",r.Initialized="initialized",r.Watched="watched",r.Unwatched="unwatched",r.PresenceChanged="presence-changed",r))(Ye||{}),_s=(r=>(r.Connected="connected",r.Disconnected="disconnected",r))(_s||{}),Ms=(r=>(r.Synced="synced",r.SyncFailed="sync-failed",r))(Ms||{});class Li{constructor(e,t){u(this,"key"),u(this,"status"),u(this,"opts"),u(this,"changeID"),u(this,"checkpoint"),u(this,"localChanges"),u(this,"root"),u(this,"clone"),u(this,"eventStream"),u(this,"eventStreamObserver"),u(this,"onlineClients"),u(this,"presences"),u(this,"history"),u(this,"internalHistory"),u(this,"isUpdating"),this.opts=t||{},this.key=e,this.status="detached",this.root=Wr.create(),this.changeID=_h,this.checkpoint=Mh,this.localChanges=[],this.eventStream=Af(n=>{this.eventStreamObserver=n}),this.onlineClients=new Set,this.presences=new Map,this.isUpdating=!1,this.internalHistory=new Cf,this.history={canUndo:this.canUndo.bind(this),canRedo:this.canRedo.bind(this),undo:this.undo.bind(this),redo:this.redo.bind(this)},Nf(this)}update(e,t){if(this.getStatus()==="removed")throw new ue(oe.ErrDocumentRemoved,`${this.key} is removed`);this.ensureClone();const n=this.changeID.getActorID(),s=gr.create(this.changeID.next(),this.clone.root,this.clone.presences.get(n)||{},t);try{const a=mc(s,this.clone.root.getObject());this.presences.has(n)||this.clone.presences.set(n,{}),this.isUpdating=!0,e(a,new wi(s,this.clone.presences.get(n)))}catch(a){throw this.clone=void 0,R.error(a),a}finally{this.isUpdating=!1}if(s.hasChange()){R.isEnabled(Ve.Trivial)&&R.trivial(`trying to update a local change: ${this.toJSON()}`);const a=s.getChange(),{opInfos:c,reverseOps:f}=a.execute(this.root,this.presences,pe.Local),g=s.getReversePresence();g&&f.push({type:"presence",value:g}),this.localChanges.push(a),f.length>0&&this.internalHistory.pushUndo(f),c.length>0&&this.internalHistory.clearRedo(),this.changeID=a.getID();const m=[];c.length>0&&m.push({type:"local-change",source:pe.Local,value:{message:a.getMessage()||"",operations:c,actor:n,clientSeq:a.getID().getClientSeq(),serverSeq:a.getID().getServerSeq()},rawChange:this.isEnableDevtools()?a.toStruct():void 0}),a.hasPresenceChange()&&m.push({type:"presence-changed",source:pe.Local,value:{clientID:n,presence:this.getPresence(n)}}),this.publish(m),R.isEnabled(Ve.Trivial)&&R.trivial(`after update a local change: ${this.toJSON()}`)}}subscribe(e,t,n,s){if(typeof e=="string"){if(typeof t!="function")throw new Error("Second argument must be a callback function");if(e==="presence"){const f=t;return this.eventStream.subscribe(g=>{for(const m of g)m.type!=="initialized"&&m.type!=="watched"&&m.type!=="unwatched"&&m.type!=="presence-changed"||f(m)},n,s)}if(e==="my-presence"){const f=t;return this.eventStream.subscribe(g=>{for(const m of g)m.type!=="initialized"&&m.type!=="presence-changed"||m.type==="presence-changed"&&m.value.clientID!==this.changeID.getActorID()||f(m)},n,s)}if(e==="others"){const f=t;return this.eventStream.subscribe(g=>{for(const m of g)m.type!=="watched"&&m.type!=="unwatched"&&m.type!=="presence-changed"||m.value.clientID!==this.changeID.getActorID()&&f(m)},n,s)}if(e==="connection"){const f=t;return this.eventStream.subscribe(g=>{for(const m of g)m.type==="connection-changed"&&f(m)},n,s)}if(e==="status"){const f=t;return this.eventStream.subscribe(g=>{for(const m of g)m.type==="status-changed"&&f(m)},n,s)}if(e==="sync"){const f=t;return this.eventStream.subscribe(g=>{for(const m of g)m.type==="sync-status-changed"&&f(m)},n,s)}if(e==="all"){const f=t;return this.eventStream.subscribe(f,n,s)}const a=e,c=t;return this.eventStream.subscribe(f=>{for(const g of f){if(g.type!=="local-change"&&g.type!=="remote-change")continue;const m=[];for(const b of g.value.operations)this.isSameElementOrChildOf(b.path,a)&&m.push(b);m.length&&c({...g,value:{...g.value,operations:m}})}},n,s)}if(typeof e=="function"){const a=e,c=t,f=n;return this.eventStream.subscribe(g=>{for(const m of g)m.type!=="snapshot"&&m.type!=="local-change"&&m.type!=="remote-change"||a(m)},c,f)}throw new Error(`"${e}" is not a valid`)}publish(e){this.eventStreamObserver&&this.eventStreamObserver.next(e)}isSameElementOrChildOf(e,t){if(t===e)return!0;const n=e.split(".");return t.split(".").every((a,c)=>a===n[c])}applyChangePack(e){for(e.hasSnapshot()?this.applySnapshot(e.getCheckpoint().getServerSeq(),e.getSnapshot()):e.hasChanges()&&this.applyChanges(e.getChanges(),pe.Remote);this.localChanges.length&&!(this.localChanges[0].getID().getClientSeq()>e.getCheckpoint().getClientSeq());)this.localChanges.shift();e.hasSnapshot()&&this.applyChanges(this.localChanges,pe.Remote),this.checkpoint=this.checkpoint.forward(e.getCheckpoint()),this.garbageCollect(e.getMinSyncedTicket()),e.getIsRemoved()&&this.applyStatus("removed"),R.isEnabled(Ve.Trivial)&&R.trivial(`${this.root.toJSON()}`)}getCheckpoint(){return this.checkpoint}getChangeID(){return this.changeID}hasLocalChanges(){return this.localChanges.length>0}ensureClone(){this.clone||(this.clone={root:this.root.deepcopy(),presences:wt(this.presences)})}createChangePack(){const e=Array.from(this.localChanges),t=this.checkpoint.increaseClientSeq(e.length);return Es.create(this.key,t,!1,e)}setActor(e){for(const t of this.localChanges)t.setActor(e);this.changeID=this.changeID.setActor(e)}isEnableDevtools(){return!!this.opts.enableDevtools}getKey(){return this.key}getStatus(){return this.status}getCloneRoot(){if(!!this.clone)return this.clone.root.getObject()}getRoot(){this.ensureClone();const e=gr.create(this.changeID.next(),this.clone.root,this.clone.presences.get(this.changeID.getActorID())||{});return mc(e,this.clone.root.getObject())}garbageCollect(e){return this.opts.disableGC?0:(this.clone&&this.clone.root.garbageCollect(e),this.root.garbageCollect(e))}getRootObject(){return this.root.getObject()}getGarbageLen(){return this.root.getGarbageLen()}getGarbageLenFromClone(){return this.clone.root.getGarbageLen()}toJSON(){return this.root.toJSON()}toSortedJSON(){return this.root.toSortedJSON()}toJSForTest(){return{...this.getRoot().toJSForTest(),key:"root"}}applySnapshot(e,t){const{root:n,presences:s}=Re.bytesToSnapshot(t);this.root=new Wr(n),this.presences=s,this.changeID=this.changeID.syncLamport(e),this.clone=void 0,this.publish([{type:"snapshot",source:pe.Remote,value:{snapshot:this.isEnableDevtools()?Re.bytesToHex(t):void 0,serverSeq:e.toString()}}])}applyChanges(e,t){R.isEnabled(Ve.Debug)&&R.debug(`trying to apply ${e.length} remote changes.elements:${this.root.getElementMapSize()}, removeds:${this.root.getGarbageElementSetSize()}`),R.isEnabled(Ve.Trivial)&&R.trivial(e.map(n=>`${n.getID().toTestString()}	${n.toTestString()}`).join(`
`));for(const n of e)this.applyChange(n,t);R.isEnabled(Ve.Debug)&&R.debug(`after appling ${e.length} remote changes.elements:${this.root.getElementMapSize()},  removeds:${this.root.getGarbageElementSetSize()}`)}applyChange(e,t){this.ensureClone(),e.execute(this.clone.root,this.clone.presences,t);const n=[],s=e.getID().getActorID();if(e.hasPresenceChange()&&this.onlineClients.has(s)){const c=e.getPresenceChange();switch(c.type){case bn.Put:n.push(this.presences.has(s)?{type:"presence-changed",source:t,value:{clientID:s,presence:c.presence}}:{type:"watched",source:pe.Remote,value:{clientID:s,presence:c.presence}});break;case bn.Clear:n.push({type:"unwatched",source:pe.Remote,value:{clientID:s,presence:this.getPresence(s)}}),this.removeOnlineClient(s);break}}const{opInfos:a}=e.execute(this.root,this.presences,t);if(this.changeID=this.changeID.syncLamport(e.getID().getLamport()),a.length>0){const c=this.isEnableDevtools()?e.toStruct():void 0;n.push(t===pe.Remote?{type:"remote-change",source:t,value:{actor:s,clientSeq:e.getID().getClientSeq(),serverSeq:e.getID().getServerSeq(),message:e.getMessage()||"",operations:a},rawChange:c}:{type:"local-change",source:t,value:{actor:s,clientSeq:e.getID().getClientSeq(),serverSeq:e.getID().getServerSeq(),message:e.getMessage()||"",operations:a},rawChange:c})}n.length>0&&this.publish(n)}applyWatchStream(e){if(e.body.case==="initialization"){const t=e.body.value.clientIds,n=new Set;for(const s of t)s!==this.changeID.getActorID()&&n.add(s);this.setOnlineClients(n),this.publish([{type:"initialized",source:pe.Local,value:this.getPresences()}]);return}if(e.body.case==="event"){const{type:t,publisher:n}=e.body.value,s=[];if(t===Ts.DOCUMENT_WATCHED)this.addOnlineClient(n),this.hasPresence(n)&&s.push({type:"watched",source:pe.Remote,value:{clientID:n,presence:this.getPresence(n)}});else if(t===Ts.DOCUMENT_UNWATCHED){const a=this.getPresence(n);this.removeOnlineClient(n),a&&s.push({type:"unwatched",source:pe.Remote,value:{clientID:n,presence:a}})}s.length>0&&this.publish(s)}}applyStatus(e){this.status=e,e==="detached"&&this.setActor(Ss),this.publish([{source:e==="removed"?pe.Remote:pe.Local,type:"status-changed",value:e==="attached"?{status:e,actorID:this.changeID.getActorID()}:{status:e}}])}applyDocEvent(e){if(e.type==="status-changed"){this.applyStatus(e.value.status),e.value.status==="attached"&&this.setActor(e.value.actorID);return}if(e.type==="snapshot"){const{snapshot:t,serverSeq:n}=e.value;if(!t)return;this.applySnapshot(X.fromString(n),Re.hexToBytes(t));return}if(e.type==="local-change"||e.type==="remote-change"){if(!e.rawChange)return;const t=jn.fromStruct(e.rawChange);this.applyChange(t,e.source)}if(e.type==="initialized"){const t=new Set;for(const{clientID:n,presence:s}of e.value)t.add(n),this.presences.set(n,s);this.setOnlineClients(t);return}if(e.type==="watched"){const{clientID:t,presence:n}=e.value;this.addOnlineClient(t),this.presences.set(t,n);return}if(e.type==="unwatched"){const{clientID:t}=e.value;this.removeOnlineClient(t),this.presences.delete(t)}if(e.type==="presence-changed"){const{clientID:t,presence:n}=e.value;this.presences.set(t,n)}}applyTransactionEvent(e){for(const t of e)this.applyDocEvent(t)}getValueByPath(e){if(!e.startsWith("$"))throw new ue(oe.ErrInvalidArgument,'path must start with "$"');const t=e.split(".");t.shift();let n=this.getRoot();for(const s of t)if(n=n[s],n===void 0)return;return n}setOnlineClients(e){this.onlineClients=e}resetOnlineClients(){this.onlineClients=new Set}addOnlineClient(e){this.onlineClients.add(e)}removeOnlineClient(e){this.onlineClients.delete(e)}hasPresence(e){return this.presences.has(e)}getMyPresence(){if(this.status!=="attached")return{};const e=this.presences.get(this.changeID.getActorID());return e?wt(e):{}}getPresence(e){if(e===this.changeID.getActorID())return this.getMyPresence();if(!this.onlineClients.has(e))return;const t=this.presences.get(e);return t?wt(t):void 0}getPresenceForTest(e){const t=this.presences.get(e);return t?wt(t):void 0}getPresences(){const e=[];e.push({clientID:this.changeID.getActorID(),presence:wt(this.getMyPresence())});for(const t of this.onlineClients)this.presences.has(t)&&e.push({clientID:t,presence:wt(this.presences.get(t))});return e}getSelfForTest(){return{clientID:this.getChangeID().getActorID(),presence:this.getMyPresence()}}getOthersForTest(){const e=this.getChangeID().getActorID();return this.getPresences().filter(t=>t.clientID!==e).sort((t,n)=>t.clientID>n.clientID?1:-1)}canUndo(){return this.internalHistory.hasUndo()&&!this.isUpdating}canRedo(){return this.internalHistory.hasRedo()&&!this.isUpdating}undo(){if(this.isUpdating)throw new Error("Undo is not allowed during an update");const e=this.internalHistory.popUndo();if(e===void 0)throw new Error("There is no operation to be undone");this.ensureClone();const t=gr.create(this.changeID.next(),this.clone.root,this.clone.presences.get(this.changeID.getActorID())||{});for(const m of e){if(!(m instanceof St)){new wi(t,wt(this.clone.presences.get(this.changeID.getActorID()))).set(m.value,{addToHistory:!0});continue}const b=t.issueTimeTicket();m.setExecutedAt(b),t.push(m)}const n=t.getChange();n.execute(this.clone.root,this.clone.presences,pe.UndoRedo);const{opInfos:s,reverseOps:a}=n.execute(this.root,this.presences,pe.UndoRedo),c=t.getReversePresence();if(c&&a.push({type:"presence",value:c}),a.length>0&&this.internalHistory.pushRedo(a),!n.hasPresenceChange()&&s.length===0)return;this.localChanges.push(n),this.changeID=n.getID();const f=this.changeID.getActorID(),g=[];s.length>0&&g.push({type:"local-change",source:pe.UndoRedo,value:{message:n.getMessage()||"",operations:s,actor:f,clientSeq:n.getID().getClientSeq(),serverSeq:n.getID().getServerSeq()},rawChange:this.isEnableDevtools()?n.toStruct():void 0}),n.hasPresenceChange()&&g.push({type:"presence-changed",source:pe.UndoRedo,value:{clientID:f,presence:this.getPresence(f)}}),this.publish(g)}redo(){if(this.isUpdating)throw new Error("Redo is not allowed during an update");const e=this.internalHistory.popRedo();if(e===void 0)throw new Error("There is no operation to be redone");this.ensureClone();const t=gr.create(this.changeID.next(),this.clone.root,this.clone.presences.get(this.changeID.getActorID())||{});for(const m of e){if(!(m instanceof St)){new wi(t,wt(this.clone.presences.get(this.changeID.getActorID()))).set(m.value,{addToHistory:!0});continue}const b=t.issueTimeTicket();m.setExecutedAt(b),t.push(m)}const n=t.getChange();n.execute(this.clone.root,this.clone.presences,pe.UndoRedo);const{opInfos:s,reverseOps:a}=n.execute(this.root,this.presences,pe.UndoRedo),c=t.getReversePresence();if(c&&a.push({type:"presence",value:c}),a.length>0&&this.internalHistory.pushUndo(a),!n.hasPresenceChange()&&s.length===0)return;this.localChanges.push(n),this.changeID=n.getID();const f=this.changeID.getActorID(),g=[];s.length>0&&g.push({type:"local-change",source:pe.UndoRedo,value:{message:n.getMessage()||"",operations:s,actor:f,clientSeq:n.getID().getClientSeq(),serverSeq:n.getID().getServerSeq()},rawChange:this.isEnableDevtools()?n.toStruct():void 0}),n.hasPresenceChange()&&g.push({type:"presence-changed",source:pe.UndoRedo,value:{clientID:f,presence:this.getPresence(f)}}),this.publish(g)}getUndoStackForTest(){return this.internalHistory.getUndoStackForTest()}getRedoStackForTest(){return this.internalHistory.getRedoStackForTest()}}function xf(r,e){return t=>async n=>(r&&n.header.set("x-api-key",r),e&&n.header.set("authorization",e),await t(n))}const wc={name:"yorkie-js-sdk",version:"0.4.27",description:"Yorkie JS SDK",main:"./dist/yorkie-js-sdk.js",typings:"./dist/yorkie-js-sdk.d.ts",files:["dist"],scripts:{build:"tsc && vite build","build:proto":"npx buf generate","build:docs":"typedoc","build:examples":"npm run build --workspace examples","build:ghpages":"mkdir -p ghpages/examples && cp -r docs ghpages/api-reference && find examples -name 'dist' -type d -exec sh -c 'cp -r {} ghpages/examples/$(basename $(dirname {}))' \\;",dev:"vite build -c vite.preview.ts && vite preview",test:"vitest run","test:watch":"vitest","test:bench":"vitest bench","test:ci":"vitest run --coverage","test:yorkie.dev":"TEST_RPC_ADDR=https://api.yorkie.dev vitest run --coverage",lint:"eslint . --fix --max-warnings=0 --ext .ts",prepare:"npm run build"},engines:{node:">=18.0.0",npm:">=7.1.0"},repository:{type:"git",url:"git+https://github.com/yorkie-team/yorkie-js-sdk.git"},author:{name:"hackerwins",email:"susukang98@gmail.com"},license:"Apache-2.0",bugs:{url:"https://github.com/yorkie-team/yorkie-js-sdk/issues"},homepage:"https://github.com/yorkie-team/yorkie-js-sdk#readme",devDependencies:{"@buf/googleapis_googleapis.connectrpc_es":"^1.4.0-20240524201209-f0e53af8f2fc.3","@bufbuild/buf":"^1.28.1","@bufbuild/protoc-gen-es":"^1.6.0","@connectrpc/protoc-gen-connect-es":"^1.4.0","@types/google-protobuf":"^3.15.5","@types/long":"^4.0.1","@typescript-eslint/eslint-plugin":"^5.30.6","@typescript-eslint/parser":"^5.30.6","@vitest/coverage-istanbul":"^0.34.5","@vitest/coverage-v8":"^0.34.5",eslint:"^8.19.0","eslint-plugin-jsdoc":"^39.3.3","eslint-plugin-prettier":"^4.2.1","eslint-plugin-tsdoc":"^0.2.16",husky:"^8.0.3",prettier:"^2.7.1","ts-node":"^10.9.1",typedoc:"^0.25.13",typescript:"^4.7.4","typescript-transform-paths":"^3.3.1",vite:"^4.4.9","vite-plugin-commonjs":"^0.10.1","vite-plugin-dts":"^3.9.1","vite-tsconfig-paths":"^4.2.1",vitest:"^0.34.5"},dependencies:{"@bufbuild/protobuf":"^1.6.0","@connectrpc/connect":"^1.4.0","@connectrpc/connect-web":"^1.4.0",long:"^5.2.0"},husky:{hooks:{"pre-commit":"npm run lint"}},workspaces:["examples/*"]};function Of(){return r=>async e=>(e.header.set("x-yorkie-user-agent",wc.name+"/"+wc.version),await r(e))}var Zr=(r=>(r.Manual="manual",r.Realtime="realtime",r.RealtimePushOnly="realtime-pushonly",r.RealtimeSyncOff="realtime-syncoff",r))(Zr||{}),Ac=(r=>(r.Deactivated="deactivated",r.Activated="activated",r))(Ac||{}),Sc=(r=>(r.SyncLoop="SyncLoop",r.WatchLoop="WatchLoop",r))(Sc||{});const Bs={syncLoopDuration:50,retrySyncLoopDelay:1e3,reconnectStreamDelay:1e3};class $i{constructor(e,t){u(this,"id"),u(this,"key"),u(this,"status"),u(this,"attachmentMap"),u(this,"apiKey"),u(this,"conditions"),u(this,"syncLoopDuration"),u(this,"reconnectStreamDelay"),u(this,"retrySyncLoopDelay"),u(this,"rpcClient"),u(this,"taskQueue"),u(this,"processing",!1),t=t||Bs,this.key=t.key?t.key:fc(),this.status="deactivated",this.attachmentMap=new Map,this.apiKey=t.apiKey||"",this.conditions={SyncLoop:!1,WatchLoop:!1},this.syncLoopDuration=t.syncLoopDuration||Bs.syncLoopDuration,this.reconnectStreamDelay=t.reconnectStreamDelay||Bs.reconnectStreamDelay,this.retrySyncLoopDelay=t.retrySyncLoopDelay||Bs.retrySyncLoopDelay,this.rpcClient=Su(ph,zu({baseUrl:e,interceptors:[xf(t.apiKey,t.token),Of()]})),this.taskQueue=[]}activate(){return this.isActive()?Promise.resolve():this.enqueueTask(async()=>this.rpcClient.activateClient({clientKey:this.key},{headers:{"x-shard-key":this.apiKey}}).then(e=>{this.id=e.clientId,this.status="activated",this.runSyncLoop(),R.info(`[AC] c:"${this.getKey()}" activated, id:"${this.id}"`)}).catch(e=>{throw R.error(`[AC] c:"${this.getKey()}" err :`,e),this.handleConnectError(e),e}))}deactivate(){return this.status==="deactivated"?Promise.resolve():this.enqueueTask(async()=>this.rpcClient.deactivateClient({clientId:this.id},{headers:{"x-shard-key":this.apiKey}}).then(()=>{this.deactivateInternal(),R.info(`[DC] c"${this.getKey()}" deactivated`)}).catch(e=>{throw R.error(`[DC] c:"${this.getKey()}" err :`,e),this.handleConnectError(e),e}))}attach(e,t={}){var s;if(!this.isActive())throw new ue(oe.ErrClientNotActivated,`${this.key} is not active`);if(e.getStatus()!==un.Detached)throw new ue(oe.ErrDocumentNotDetached,`${e.getKey()} is not detached`);e.setActor(this.id),e.update((a,c)=>c.set(t.initialPresence||{}));const n=(s=t.syncMode)!=null?s:"realtime";return this.enqueueTask(async()=>this.rpcClient.attachDocument({clientId:this.id,changePack:Re.toChangePack(e.createChangePack())},{headers:{"x-shard-key":`${this.apiKey}/${e.getKey()}`}}).then(async a=>{const c=Re.fromChangePack(a.changePack);return e.applyChangePack(c),e.getStatus()===un.Removed||(e.applyStatus(un.Attached),this.attachmentMap.set(e.getKey(),new bf(this.reconnectStreamDelay,e,a.documentId,n)),n!=="manual"&&await this.runWatchLoop(e.getKey()),R.info(`[AD] c:"${this.getKey()}" attaches d:"${e.getKey()}"`)),e}).catch(a=>{throw R.error(`[AD] c:"${this.getKey()}" err :`,a),this.handleConnectError(a),a}))}detach(e,t={}){if(!this.isActive())throw new ue(oe.ErrClientNotActivated,`${this.key} is not active`);const n=this.attachmentMap.get(e.getKey());if(!n)throw new ue(oe.ErrDocumentNotAttached,`${e.getKey()} is not attached`);return e.update((s,a)=>a.clear()),this.enqueueTask(async()=>{var s;return this.rpcClient.detachDocument({clientId:this.id,documentId:n.docID,changePack:Re.toChangePack(e.createChangePack()),removeIfNotAttached:(s=t.removeIfNotAttached)!=null?s:!1},{headers:{"x-shard-key":`${this.apiKey}/${e.getKey()}`}}).then(a=>{const c=Re.fromChangePack(a.changePack);return e.applyChangePack(c),e.getStatus()!==un.Removed&&e.applyStatus(un.Detached),this.detachInternal(e.getKey()),R.info(`[DD] c:"${this.getKey()}" detaches d:"${e.getKey()}"`),e}).catch(a=>{throw R.error(`[DD] c:"${this.getKey()}" err :`,a),this.handleConnectError(a),a})})}async changeSyncMode(e,t){if(!this.isActive())throw new ue(oe.ErrClientNotActivated,`${this.key} is not active`);const n=this.attachmentMap.get(e.getKey());if(!n)throw new ue(oe.ErrDocumentNotAttached,`${e.getKey()} is not attached`);const s=n.syncMode;return s===t?e:(n.changeSyncMode(t),t==="manual"?(n.cancelWatchStream(),e):(t==="realtime"&&(n.remoteChangeEventReceived=!0),s==="manual"&&await this.runWatchLoop(e.getKey()),e))}sync(e){if(!this.isActive())throw new ue(oe.ErrClientNotActivated,`${this.key} is not active`);if(e){const t=this.attachmentMap.get(e.getKey());if(!t)throw new ue(oe.ErrDocumentNotAttached,`${e.getKey()} is not attached`);return this.enqueueTask(async()=>this.syncInternal(t,"realtime").catch(n=>{throw R.error(`[SY] c:"${this.getKey()}" err :`,n),this.handleConnectError(n),n}))}return this.enqueueTask(async()=>{const t=[];for(const[,n]of this.attachmentMap)t.push(this.syncInternal(n,n.syncMode));return Promise.all(t).catch(n=>{throw R.error(`[SY] c:"${this.getKey()}" err :`,n),this.handleConnectError(n),n})})}remove(e){if(!this.isActive())throw new ue(oe.ErrClientNotActivated,`${this.key} is not active`);const t=this.attachmentMap.get(e.getKey());if(!t)throw new ue(oe.ErrDocumentNotAttached,`${e.getKey()} is not attached`);e.setActor(this.id);const n=Re.toChangePack(e.createChangePack());return n.isRemoved=!0,this.enqueueTask(async()=>this.rpcClient.removeDocument({clientId:this.id,documentId:t.docID,changePack:n},{headers:{"x-shard-key":`${this.apiKey}/${e.getKey()}`}}).then(s=>{const a=Re.fromChangePack(s.changePack);e.applyChangePack(a),this.detachInternal(e.getKey()),R.info(`[RD] c:"${this.getKey()}" removes d:"${e.getKey()}"`)}).catch(s=>{throw R.error(`[RD] c:"${this.getKey()}" err :`,s),this.handleConnectError(s),s}))}getID(){return this.id}getKey(){return this.key}isActive(){return this.status==="activated"}getStatus(){return this.status}getCondition(e){return this.conditions[e]}runSyncLoop(){const e=()=>{if(!this.isActive()){R.debug(`[SL] c:"${this.getKey()}" exit sync loop`),this.conditions.SyncLoop=!1;return}const t=[];for(const[,n]of this.attachmentMap)n.needRealtimeSync()&&(n.remoteChangeEventReceived=!1,t.push(this.syncInternal(n,n.syncMode)));Promise.all(t).then(()=>setTimeout(e,this.syncLoopDuration)).catch(n=>{R.error(`[SL] c:"${this.getKey()}" sync failed:`,n),this.handleConnectError(n)?setTimeout(e,this.retrySyncLoopDelay):this.conditions.SyncLoop=!1})};R.debug(`[SL] c:"${this.getKey()}" run sync loop`),this.conditions.SyncLoop=!0,e()}async runWatchLoop(e){const t=this.attachmentMap.get(e);if(!t)throw new ue(oe.ErrDocumentNotAttached,`${e} is not attached`);return this.conditions.WatchLoop=!0,t.runWatchLoop(n=>{if(!this.isActive())return this.conditions.WatchLoop=!1,Promise.reject(new ue(oe.ErrClientNotActivated,`${this.key} is not active`));const s=new AbortController,a=this.rpcClient.watchDocument({clientId:this.id,documentId:t.docID},{headers:{"x-shard-key":`${this.apiKey}/${e}`},signal:s.signal});return t.doc.publish([{type:Ye.ConnectionChanged,value:_s.Connected}]),R.info(`[WD] c:"${this.getKey()}" watches d:"${e}"`),new Promise((c,f)=>{(async()=>{try{for await(const m of a)this.handleWatchDocumentsResponse(t,m),m.body.case==="initialization"&&c([a,s])}catch(m){t.doc.resetOnlineClients(),t.doc.publish([{type:Ye.Initialized,source:pe.Local,value:t.doc.getPresences()}]),t.doc.publish([{type:Ye.ConnectionChanged,value:_s.Disconnected}]),R.debug(`[WD] c:"${this.getKey()}" unwatches`),this.handleConnectError(m)?n():this.conditions.WatchLoop=!1,f(m)}})()})})}handleWatchDocumentsResponse(e,t){if(t.body.case==="event"&&t.body.value.type===Ts.DOCUMENT_CHANGED){e.remoteChangeEventReceived=!0;return}e.doc.applyWatchStream(t)}deactivateInternal(){this.status="deactivated";for(const[e,t]of this.attachmentMap)this.detachInternal(e),t.doc.applyStatus(un.Detached)}detachInternal(e){const t=this.attachmentMap.get(e);!t||(t.cancelWatchStream(),this.attachmentMap.delete(e))}syncInternal(e,t){const{doc:n,docID:s}=e,a=n.createChangePack();return this.rpcClient.pushPullChanges({clientId:this.id,documentId:s,changePack:Re.toChangePack(a),pushOnly:t==="realtime-pushonly"},{headers:{"x-shard-key":`${this.apiKey}/${n.getKey()}`}}).then(c=>{const f=Re.fromChangePack(c.changePack);if(f.hasChanges()&&(e.syncMode==="realtime-pushonly"||e.syncMode==="realtime-syncoff"))return n;n.applyChangePack(f),e.doc.publish([{type:Ye.SyncStatusChanged,value:Ms.Synced}]),n.getStatus()===un.Removed&&this.detachInternal(n.getKey());const g=n.getKey(),m=f.getChangeSize();return R.info(`[PP] c:"${this.getKey()}" sync d:"${g}", push:${a.getChangeSize()} pull:${m} cp:${f.getCheckpoint().toTestString()}`),n}).catch(c=>{throw n.publish([{type:Ye.SyncStatusChanged,value:Ms.SyncFailed}]),R.error(`[PP] c:"${this.getKey()}" err :`,c),c})}handleConnectError(e){return e instanceof v?e.code===p.Canceled||e.code===p.Unknown||e.code===p.ResourceExhausted||e.code===p.Unavailable?!0:((Za(e)===oe.ErrClientNotActivated||Za(e)===oe.ErrClientNotFound)&&this.deactivateInternal(),!1):!1}enqueueTask(e){return new Promise((t,n)=>{this.taskQueue.push(()=>e().then(t).catch(n)),this.processing||this.processNext()})}async processNext(){if(this.taskQueue.length===0){this.processing=!1;return}try{this.processing=!0,await this.taskQueue.shift()()}catch{R.error(`[TQ] c:"${this.getKey()}" process failed, id:"${this.id}"`)}this.processNext()}}const Pf=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"})),Df={Client:$i,Document:Li,Primitive:Ae,Text:Gr,Counter:Yr,Tree:Xr,LogLevel:Ve,setLogLevel:Si,IntType:Wt.IntegerCnt,LongType:Wt.LongCnt};typeof globalThis<"u"&&(globalThis.yorkie={Client:$i,Document:Li,Primitive:Ae,Text:Gr,Counter:Yr,Tree:Xr,LogLevel:Ve,setLogLevel:Si,IntType:Wt.IntegerCnt,LongType:Wt.LongCnt}),l.Change=jn,l.Client=$i,l.ClientCondition=Sc,l.ClientStatus=Ac,l.Counter=Yr,l.Devtools=Pf,l.DocEventType=Ye,l.Document=Li,l.DocumentStatus=un,l.DocumentSyncStatus=Ms,l.EventSourceDevPanel=vc,l.EventSourceSDK=Tc,l.LogLevel=Ve,l.OpSource=pe,l.Primitive=Ae,l.StreamConnectionStatus=_s,l.SyncMode=Zr,l.Text=Gr,l.TimeTicket=Ge,l.Tree=Xr,l.converter=Re,l.default=Df,l.setLogLevel=Si,Object.defineProperties(l,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})})(oo,oo.exports);const Gl=cp(oo.exports),lp=(i,o)=>{const l=i.__vccOpts||i;for(const[h,d]of o)l[h]=d;return l},up=[{title:"Todo",cards:[{title:"Pruning document"},{title:"Clean up codes"}]},{title:"Doing",cards:[{title:"Array operations"}]},{title:"Done",cards:[{title:"Create a sample page"},{title:"Launch demo site"}]}],Nn=new Gl.Client("https://api.yorkie.dev",{apiKey:"cedaovjuioqlk4pjqn6g"}),dn=new Gl.Document(`vuejs-kanban-${new Date().toISOString().substring(0,10).replace(/-/g,"")}`,{enableDevtools:!0}),hp={data(){return{lists:[],title:"",opened:null}},created(){this.fetchDoc()},beforeUnmount(){this.disconnect()},watch:{opened(i){this.$nextTick(function(){i===0?this.$refs.addListForm.querySelector("input").focus():i&&this.$refs.addCardForm[i-1].querySelector("input").focus(),this.title=""})}},methods:{async fetchDoc(){await Nn.activate(),await Nn.attach(dn),dn.update(i=>{i.lists||(i.lists=up)},"create default list if not exists"),dn.subscribe(i=>{this.lists=dn.getRoot().lists}),await Nn.sync(),this.lists=dn.getRoot().lists},async disconnect(){await Nn.deactivate()},isOpened(i){return this.opened===i},openForm(i){this.opened=i},closeForm(){this.opened=null},addCard(i){this.title!==""&&dn.update(o=>{o.lists.getElementByID(i.getID()).cards.push({title:this.title}),this.title=""},`add new card by ${Nn.getID()}`)},deleteCard(i,o){dn.update(l=>{l.lists.getElementByID(i.getID()).cards.deleteByID(o.getID())},`delete a card by ${Nn.getID()}`)},addList(){this.title!==""&&dn.update(i=>{i.lists.push({title:this.title,cards:[]}),this.title=""},`add new list by ${Nn.getID()}`)},deleteList(i){dn.update(o=>{o.lists.deleteByID(i.getID())},`delete a list by ${Nn.getID()}`)}}},fp={class:"list"},dp=["onClick"],gp={class:"title"},pp={class:"card"},mp=["onClick"],yp={key:0,class:"add-form"},vp=["onKeyup"],Tp={class:"buttons"},bp=["onClick"],wp=["onClick"],Ap={class:"add-list",ref:"addListForm"},Sp={key:0,class:"add-form"},Ip={class:"buttons"};function kp(i,o,l,h,d,u){return hn(),fn(yt,null,[(hn(!0),fn(yt,null,Bc(d.lists,(p,T)=>(hn(),fn("div",fp,[Ze("span",{class:"delete",onClick:v=>u.deleteList(p)},"\u274C",8,dp),Ze("div",gp,kc(p.title),1),(hn(!0),fn(yt,null,Bc(p.cards,v=>(hn(),fn("div",pp,[Ze("span",{class:"delete",onClick:k=>u.deleteCard(p,v)},"\u274C",8,mp),zl(" "+kc(v.title),1)]))),256)),Ze("div",{class:"add-card",ref_for:!0,ref:"addCardForm"},[u.isOpened(T+1)?(hn(),fn("div",yp,[Mc(Ze("input",{type:"text",placeholder:"Enter card title","onUpdate:modelValue":o[0]||(o[0]=v=>d.title=v),onKeyup:[qs(v=>u.addCard(p),["enter"]),o[1]||(o[1]=qs(v=>u.closeForm(),["esc"]))]},null,40,vp),[[rl,d.title]]),Ze("div",Tp,[Ze("input",{type:"button",value:"Add",onClick:v=>u.addCard(p)},null,8,bp),Ze("input",{type:"button",value:"Close",class:"pull-right",onClick:o[2]||(o[2]=v=>u.closeForm())})])])):(hn(),fn("div",{key:1,class:"add-card-opener",onClick:v=>u.openForm(T+1)}," Add another card ",8,wp))],512)]))),256)),Ze("div",Ap,[u.isOpened(0)?(hn(),fn("div",Sp,[Mc(Ze("input",{type:"text",placeholder:"Enter list title","onUpdate:modelValue":o[3]||(o[3]=p=>d.title=p),onKeyup:[o[4]||(o[4]=qs(p=>u.addList(),["enter"])),o[5]||(o[5]=qs(p=>u.closeForm(),["esc"]))]},null,544),[[rl,d.title]]),Ze("div",Ip,[Ze("input",{type:"button",value:"Add",onClick:o[6]||(o[6]=p=>u.addList())}),Ze("input",{type:"button",value:"Close",class:"pull-right",onClick:o[7]||(o[7]=p=>u.closeForm())})])])):(hn(),fn("div",{key:1,class:"add-list-opener",onClick:o[8]||(o[8]=p=>u.openForm(0))}," Add another list "))],512)],64)}const Ep=lp(hp,[["render",kp]]);ip(Ep).mount("#app");
